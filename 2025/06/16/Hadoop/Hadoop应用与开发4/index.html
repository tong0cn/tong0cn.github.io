<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Hadoop应用与开发4 | Blog</title><meta name="author" content="tong"><meta name="copyright" content="tong"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Hadoop应用与开发459.Hadoop实验：HDFS基础与部署 目的1.理解大数据生态圈各组件特性2.理解HDFS存在的优势3.理解HDFS体系架构4.学会在环境中部署HDFS学会HDFS基本命令 要求1.要求实验结束时，能够构建出HDFS集群2.要求能够在构建出的HDFS集群上使用基本的HDFS命令3.要求能够大致了解Hadoop生态圈中各个组件 原理3.1 Hadoop 生态：Hadoop">
<meta property="og:type" content="article">
<meta property="og:title" content="Hadoop应用与开发4">
<meta property="og:url" content="http://example.com/2025/06/16/Hadoop/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="Hadoop应用与开发459.Hadoop实验：HDFS基础与部署 目的1.理解大数据生态圈各组件特性2.理解HDFS存在的优势3.理解HDFS体系架构4.学会在环境中部署HDFS学会HDFS基本命令 要求1.要求实验结束时，能够构建出HDFS集群2.要求能够在构建出的HDFS集群上使用基本的HDFS命令3.要求能够大致了解Hadoop生态圈中各个组件 原理3.1 Hadoop 生态：Hadoop">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/touxiang.png">
<meta property="article:published_time" content="2025-06-16T04:00:00.000Z">
<meta property="article:modified_time" content="2025-10-31T07:41:51.372Z">
<meta property="article:author" content="tong">
<meta property="article:tag" content="博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/touxiang.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Hadoop应用与开发4",
  "url": "http://example.com/2025/06/16/Hadoop/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/",
  "image": "http://example.com/img/touxiang.png",
  "datePublished": "2025-06-16T04:00:00.000Z",
  "dateModified": "2025-10-31T07:41:51.372Z",
  "author": [
    {
      "@type": "Person",
      "name": "tong",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/./img/favicon1.ico"><link rel="canonical" href="http://example.com/2025/06/16/Hadoop/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Hadoop应用与开发4',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(https://i.loli.net/2019/09/09/5oDRkWVKctx2b6A.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/./img/touxiang.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Hadoop应用与开发4</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Hadoop应用与开发4</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-06-16T04:00:00.000Z" title="发表于 2025-06-16 12:00:00">2025-06-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-31T07:41:51.372Z" title="更新于 2025-10-31 15:41:51">2025-10-31</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h1 id="Hadoop应用与开发4"><a href="#Hadoop应用与开发4" class="headerlink" title="Hadoop应用与开发4"></a>Hadoop应用与开发4</h1><h2 id="59-Hadoop实验：HDFS基础与部署"><a href="#59-Hadoop实验：HDFS基础与部署" class="headerlink" title="59.Hadoop实验：HDFS基础与部署"></a>59.Hadoop实验：HDFS基础与部署</h2><blockquote>
<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>1.理解大数据生态圈各组件特性<br>2.理解HDFS存在的优势<br>3.理解HDFS体系架构<br>4.学会在环境中部署HDFS学会HDFS基本命令</p>
<h3 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h3><p>1.要求实验结束时，能够构建出HDFS集群<br>2.要求能够在构建出的HDFS集群上使用基本的HDFS命令<br>3.要求能够大致了解Hadoop生态圈中各个组件</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><h2 id="3-1-Hadoop-生态："><a href="#3-1-Hadoop-生态：" class="headerlink" title="3.1 Hadoop 生态："></a>3.1 Hadoop 生态：</h2><p>Hadoop是一个提供高可靠，可扩展（横向）的分布式计算的开源软件平台。<br>1.Hadoop 是一个由 Apache 基金会所开发的分布式系统基础架构。<br>2.主要解决，海量数据的存储和海量数据的分析计算问题。<br>3.我们现在讲HADOOP 通常是指一个更广泛的概念——HADOOP 生态圈。<br>Hadoop的核心是HDFS和MapReduce、yarn，图3-1为hadoop生态系统：</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676256145817.png" alt="img"><br>图3-1</p>
<p>HDFS（Hadoop分布式文件系统）<br>HDFS是Hadoop体系中数据存储管理的基础。它是一个高度容错的系统，能检测和应对硬件故障，用于在低成本的通用硬件上运行。HDFS简化了文件的一致性模型，通过流式数据访问，提供高吞吐量应用程序数据访问功能，适合带有大型数据集的应用程序。 </p>
<p>HDFS主要有以下几个部分组成：<br>Client：切分文件；访问HDFS；与NameNode交互，获取文件位置信息；与DataNode交互，读取和写入数据。<br>NameNode：Master节点，在hadoop1.X中只有一个，管理HDFS的名称空间和数据块映射信息，配置副本策略，处理客户端请求。<br>DataNode：Slave节点，存储实际的数据，汇报存储信息给NameNode。<br>Secondary NameNode：辅助NameNode，分担其工作量；定期合并fsimage和edits，推送给NameNode；</p>
<p>Mapreduce（分布式计算框架）<br>MapReduce是一种计算模型，用以进行大数据量的计算。其中Map对数据集上的独立元素进行指定的操作，生成键-值对形式中间结果。Reduce则对中间结果中相同“键”的所有“值”进行规约，以得到最终结果。MapReduce这样的功能划分，非常适合在大量计算机组成的分布式并行环境里进行数据处理。 </p>
<p>Yarn（资源管理框架）<br>YARN （Yet Another Resource Negotiator，另一种资源协调者）是一种新的  Hadoop  资源管理器，它是一个通用资源管理系统，可为上层应用提供统一的资源管理和调度，它的引入为集群在利用率、资源统一管理和数据共享等方面带来了巨大好处。<br>主要工作过程如下：<br>ResourceManager主要负责所有的应用程序的资源分配，<br>ApplicationMaster主要负责每个作业的任务调度，也就是说每一个作业对应一个ApplicationMaster。<br>Nodemanager是接收Resourcemanager 和ApplicationMaster的命令来实现资源的分配执行体。<br>在YARN中，资源管理由ResourceManager和NodeManager共同完成，其中，ResourceManager中的调度器负责资源的分配，而NodeManager则负责资源的供给和隔离。ResourceManager将某个NodeManager上资源分配给任务（这就是所谓的“资源调度”）后，NodeManager需按照要求为任务提供相应的资源，甚至保证这些资源应具有独占性，为任务运行提供基础的保证，这就是所谓的资源隔离。<br>在Yarn平台上可以运行多个计算框架，如：MR，Tez，Storm，Spark等计算，框架。</p>
<p>Sqoop（数据同步工具）<br>Sqoop是SQL-to-Hadoop的缩写，主要用于传统数据库和Hadoop之间传输数据。数据的导入和导出本质上是Mapreduce程序，充分利用了MR的并行化和容错性。其中主要利用的是MP中的Map任务来实现并行导入，导出。</p>
<p>Hbase（分布式列存数据库）<br>HBase是一个针对结构化数据的可伸缩、高可靠、高性能、分布式和面向列的动态模式数据库。和传统关系数据库不同，HBase采用了BigTable的数据模型：增强的稀疏排序映射表（Key&#x2F;Value），其中，键由行关键字、列关键字和时间戳构成。HBase提供了对大规模数据的随机、实时读写访问，同时，HBase中保存的数据可以使用MapReduce来处理，它将数据存储和并行计算完美地结合在一起。<br>Zookeeper（分布式协作服务）<br>主要解决分布式环境下的数据管理问题：统一命名，状态同步，集群管理，配置同步等。</p>
<p>Hive（基于Hadoop的数据仓库）<br>Hive定义了一种类似SQL的查询语言(HQL),将SQL转化为MapReduce任务在Hadoop上执行。通常用于离线分析。</p>
<p>Flume（日志收集工具）<br>它将数据从产生、传输、处理并最终写入目标的路径的过程抽象为数据流，在具体的数据流中，数据源支持在Flume中定制数据发送方，从而支持收集各种不同协议数据。同时，Flume数据流提供对日志数据进行简单处理的能力，如过滤、格式转换等。此外，Flume还具有能够将日志写往各种数据目标（可定制）的能力。总的来说，Flume是一个可扩展、适合复杂环境的海量日志收集系统。</p>
<p>Spark<br>Spark 是专为大规模数据处理而设计的快速通用的计算引擎。Spark拥有Hadoop  MapReduce所具有的优点；但不同于MapReduce的是——Job中间输出结果可以保存在内存中，从而不再需要读写HDFS，因此Spark能更好地适用于数据挖掘与机器学习等需要迭代的MapReduce的算法。</p>
<p>Spark 启用了内存分布数据集，除了能够提供交互式查询外，它还可以优化迭代工作负载。<br>尽管创建 Spark 是为了支持分布式数据集上的迭代作业，但是实际上它是对 Hadoop 的补充，可以在 Hadoop 文件系统中并行运行。通过名为 Mesos 的第三方集群框架可以支持此行为。Spark可用来构建大型的、低延迟的数据分析应用程序。</p>
<p>Storm<br>Storm为分布式实时计算提供了一组通用原语，可被用于“流处理”之中，实时处理消息并更新数据库。<br>Storm可以方便地在一个计算机集群中编写与扩展复杂的实时计算，Storm用于实时处理，就好比 Hadoop 用于批处理。Storm保证每个消息都会得到处理，而且它很快，在一个小集群中，每秒可以处理数以百万计的消息。</p>
<h2 id="3-2-HDFS优点："><a href="#3-2-HDFS优点：" class="headerlink" title="3.2 HDFS优点："></a>3.2 HDFS优点：</h2><p>1.存储并管理PB级数据<br>2.处理非结构化数据<br>3.注重数据处理的吞吐量（latency）<br>4.应用模式为：write-once-read-many 存取模式<br>5.完美解决数据传输和读写的性能瓶颈<br>6.过去所拥有的技能可以平稳过渡。比如SQL,R<br>7.极大的降低转移平台的成本<br>8.大幅度减少系统维护工具</p>
</blockquote>
<h3 id="4-1-设置-Host-映射文件"><a href="#4-1-设置-Host-映射文件" class="headerlink" title="4.1 设置 Host 映射文件"></a>4.1 设置 Host 映射文件</h3><p>1.设置 IP 地址与机器名的映射，设置信息如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/hosts   //配置主机名对应的IP地址  设置：&lt;IP 地址&gt; &lt;主机名&gt;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.30.3.114     master</span><br><span class="line">10.30.0.105     slave1</span><br><span class="line">10.30.3.115     slave2</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1696735175653.png" alt="img"><br>注意：就是在打开的 &#x2F;etc&#x2F;hosts 文件的最后一行加上 ip+master、ip+slave1、ip+slave2，记得使用的是 tab 键而不是空格。<br>2.使用 ping 命令验证设置是否成功。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ping slave1</span><br><span class="line"># ping slave2</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1696735197736.png" alt="img"></p>
<h3 id="4-2-设置集群节点免密登录"><a href="#4-2-设置集群节点免密登录" class="headerlink" title="4.2 设置集群节点免密登录"></a>4.2 设置集群节点免密登录</h3><p>1.生成master服务器密钥<br>执行命令ssh-keygen，生成master服务器密钥。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ssh-keygen</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1696735214230.png" alt="img"><br>在master上执行“ssh-keygen”命令生成公私钥。</p>
<p>第一个提示是询问将公私钥文件存放在哪，直接回车，选择默认位置。<br>第二个提示是请求用户输入密钥，既然操作的目的就是实现SSH无密钥登录，故此处必须使用空密钥，所谓的空密钥指的是直接回车，不是空格，更不是其他字符。此处请读者务必直接回车，使用空密钥。<br>第三个提示是要求用户确认刚才输入的密钥，既然刚才是空密钥（直接回车即空），那现在也应为空，直接回车即可。</p>
<p>最后，可通过命令“ls -all &#x2F;root&#x2F;.ssh”查看到，SSH密钥文件夹.ssh目录下的确生成了两个文件id_rsa和id_rsa_pub，这两个文件都有用，其中公钥用于加密，私钥用于解密。中间的rsa表示算法为RSA算法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ls -all /root/.ssh</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1696735232806.png" alt="img"><br>2.拷贝master服务器公钥至本机<br>执行命令ssh-copy-id master，将master服务器公钥拷贝至master服务器本身。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ssh-copy-id master</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1696735242214.png" alt="img"><br>&lt;1&gt;第一次连接 master 时，需要输入用户密码来完成公钥文件传输。<br>&lt;2&gt;验证 master 服务器 ssh 免密登录 master 本身<br>&lt;3&gt;公钥拷贝完成后，可以在 master 服务器上直接执行命令 ssh master ，查看是否可以免密登录 master 服务器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ssh master       #登录本机网络地址</span><br><span class="line"># exit    #退出本次登录</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1696735251286.png" alt="img"><br>&lt;4&gt;拷贝 master 服务器公钥至其余服务器<br>&lt;5&gt;执行命令 ssh-copy-id slave1，将 master 服务器公钥拷贝至 slave1 服务器。<br>&lt;6&gt;第一次连接 slave1 时，需要输入用户密码来完成公钥文件传输。<br>&lt;7&gt;依照同样的方式将公钥拷贝至 slave2 服务器。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1696735424019.png" alt="img"><br>公钥拷贝完成后，可以在 master 服务器上直接执行命令 ssh master ，查看是否可以免密登录 slave1 ~ 2 服务器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ssh  slave1    //用户从master远程登录slave1</span><br><span class="line"># ssh  slave2    //用户从master远程登录slave2</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1696735447204.png" alt="img"><br>注意：我们搭建的是3节点完全分布式的Hadoop集群，所以3个节点的 &#x2F;etc&#x2F;hosts 文件要保持一致。用 scp 命令分发文件到每个节点覆盖原有配置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># scp /etc/hosts slave1:/etc/hosts</span><br><span class="line"># scp /etc/hosts slave2:/etc/hosts</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1696735456998.png" alt="img"></p>
<h3 id="4-3-设置操作系统环境"><a href="#4-3-设置操作系统环境" class="headerlink" title="4.3 设置操作系统环境"></a>4.3 设置操作系统环境</h3><p>确认一下当前的Hadoop版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop version</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1696735520436.png" alt="img"></p>
<h3 id="4-3-1设置JDK安装目录"><a href="#4-3-1设置JDK安装目录" class="headerlink" title="4.3.1设置JDK安装目录"></a>4.3.1设置JDK安装目录</h3><p>进入conf目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cd /usr/cstor/hadoop/etc/hadoop</span><br></pre></td></tr></table></figure>

<p>编辑文件“hadoop-env.sh”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim hadoop-env.sh</span><br></pre></td></tr></table></figure>

<p>找到如下一行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=$&#123;JAVA_HOME&#125;</span><br></pre></td></tr></table></figure>

<p>将这行内容修改为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/local/jdk1.8.0_161</span><br></pre></td></tr></table></figure>

<p>这里的“&#x2F;usr&#x2F;local&#x2F;jdk1.8.0_161”就是JDK安装位置，如果不同，请根据实际情况更改。</p>
<h3 id="4-3-2-配置HDFS"><a href="#4-3-2-配置HDFS" class="headerlink" title="4.3.2 配置HDFS"></a>4.3.2 配置HDFS</h3><p>编辑文件“core-site.xml”，将如下内容嵌入此文件里最后两行的标签之间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim core-site.xml</span><br></pre></td></tr></table></figure>

<p>内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;/usr/cstor/hadoop/cloud&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;hdfs://master:8020&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1696735541534.png" alt="img"><br>配置“slaves”文件，将localhost修改为slave1~2：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim slaves</span><br></pre></td></tr></table></figure>

<p>输入内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slave1  </span><br><span class="line">slave2</span><br></pre></td></tr></table></figure>

<p>core-site.xml属性说明<br>1.hadoop.tmp.dir 设置hadoop运行时产生文件的存储目录<br>2.fs.defalutFS 设置hadoop文件系统，由URL指定8020位namenode和datanode的通信端口</p>
<h3 id="4-3-3-HDFS配置文件关键属性介绍"><a href="#4-3-3-HDFS配置文件关键属性介绍" class="headerlink" title="4.3.3 HDFS配置文件关键属性介绍"></a>4.3.3 HDFS配置文件关键属性介绍</h3><p>1.io.file.buffer.size 设置缓冲区大小，默认4kb（64kb 128kb）<br>2.fs.trash.interval  设置回收站中的文件保留多久后删除，以分钟为单位，默认值是0，表示回收特性无效。该回收功能是用户级特性，启用后，每个用户都有自己独立的回收站目录，即home目录下的.trash目录，恢复时只要从该目录找到被删除的文件，将其移除就可以了。hdfs会自动删除回收站中的文件，其它文件系统不具备这个功能，需要使用下列命令自行删除 hadoop fs -expunge<br>3.dfs.block.size 设置hdfs块大小，默认64mb （128mb 256mb）<br>4.dfs.balance.bandwidthPerSec 设置均衡器在不同节点之间复制数据的带宽<br>5.dfs.datanode.du.reserved 设置保留空间的大小，以供其它程序使用,以字节为单位<br>6.fs.checkpoint.period 设置辅助namenode每隔多久创建检查点，以秒为单位<br>7.fs.checkpoint.size 设置当编辑日志（edits）大大小达到多少mb时，创建检查点，系统每5分钟检查一次编辑日志大小<br>8.dfs.datanode.numblocks 设置datanode一个目录存放多少个块时，就重新创建一个子目录<br>9.dfs.datanode.scan.period.hours 设置datanode块扫描的周期，默认三周（504小时）扫描一次</p>
<h3 id="4-3-4-拷贝集群配置至其它服务器"><a href="#4-3-4-拷贝集群配置至其它服务器" class="headerlink" title="4.3.4 拷贝集群配置至其它服务器"></a>4.3.4 拷贝集群配置至其它服务器</h3><p>在master机上执行下列命令，将配置好的hadoop从master节点拷贝至slave节点。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># cd /usr/cstor</span><br><span class="line"># scp -r hadoop/ slave1:/usr/cstor/ </span><br><span class="line"># scp -r hadoop/ slave2:/usr/cstor/</span><br></pre></td></tr></table></figure>

<p>Hadoop 环境搭建<br>在master服务器上格式化主节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hadoop/bin/hadoop namenode -format</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1696735562260.png" alt="img"></p>
<h3 id="4-4-启动Hadoop"><a href="#4-4-启动Hadoop" class="headerlink" title="4.4 启动Hadoop"></a>4.4 启动Hadoop</h3><p>启动前需注意我们需要在环境变量添加如下配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export HDFS_NAMENODE_USER=root</span><br><span class="line">export HDFS_DATANODE_USER=root</span><br><span class="line">export HDFS_SECONDARYNAMENODE_USER=root</span><br><span class="line">export YARN_RESOURCEMANAGER_USER=root</span><br><span class="line">export YARN_NODEMANAGER_USER=root</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cd /usr/cstor/hadoop/sbin</span><br><span class="line"># ./start-dfs.sh</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676268536706.png" alt="img"></p>
<h3 id="4-5-通过查看进程的方式验证"><a href="#4-5-通过查看进程的方式验证" class="headerlink" title="4.5 通过查看进程的方式验证"></a>4.5 通过查看进程的方式验证</h3><p>master节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># jps</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676268546186.png" alt="img"><br>slave节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ssh slave1</span><br><span class="line"># jps</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676268552118.png" alt="img"></p>
<h3 id="4-6-HDFS基本命令格式如下"><a href="#4-6-HDFS基本命令格式如下" class="headerlink" title="4.6 HDFS基本命令格式如下"></a>4.6 HDFS基本命令格式如下</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hadoop fs -cmd args</span><br></pre></td></tr></table></figure>

<p>其中，cmd为具体的操作，args为参数。<br>部分HDFS命令示例如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hadoop fs -help ls           //查看ls命令的帮助文档</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676268671088.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hadoop fs -mkdir -p /user/test        //建立目录/user/test</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676268678439.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hadoop fs -ls /user                //查看/user目录下的目录和文件</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676268684592.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim a.txt                      //创建,编辑a.txt文件</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676268690865.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hadoop fs -put a.txt /user/test    //上传a.txt文件至/user/test</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676268697118.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hadoop fs -cat /user/test/a.txt    //查看/user/test/a.txt文件内容</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676268702499.png" alt="img"></p>
<h2 id="60-Hadoop实验：YARN集群部署与介绍"><a href="#60-Hadoop实验：YARN集群部署与介绍" class="headerlink" title="60.Hadoop实验：YARN集群部署与介绍"></a>60.Hadoop实验：YARN集群部署与介绍</h2><blockquote>
<h3 id="目的-1"><a href="#目的-1" class="headerlink" title="目的"></a>目的</h3><p>1.了解什么是MapReduce框架<br>2.了解什么是YARN框架<br>3.学会搭建YARN分布式集群<br>4.学会使用YARN集群提交一些简单的任务<br>5.理解YARN作为Hadoop生态中的资源管理器的意义。</p>
<h3 id="要求-1"><a href="#要求-1" class="headerlink" title="要求"></a>要求</h3><p>1.学会如何搭建YARN集群<br>2.实验结束后可以用YARN集群来提交任务<br>3.观察任务提交之后YARN的执行过程</p>
<h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><h2 id="3-1-MapReduce-概述"><a href="#3-1-MapReduce-概述" class="headerlink" title="3.1 MapReduce 概述"></a>3.1 MapReduce 概述</h2><h3 id="3-1-1简介"><a href="#3-1-1简介" class="headerlink" title="3.1.1简介"></a>3.1.1简介</h3><p>MapReduce是一个用于处理海量数据的分布式计算框架。这个框架解决了数据分布式存储（数据都存取在HDFS上，计算的目标数据就是来自于HDFS）、作业调度（一个Hadoop集群上可以跑很多个MapReduce，不可能某一个MapReduce占了所有资源，资源是共享的）、容错（非个人因素导致的问题比如网络堵塞、机器间通信等复杂问题，会自动切换到其他节点上）。</p>
<h3 id="3-1-2MapReduce分而治之思想"><a href="#3-1-2MapReduce分而治之思想" class="headerlink" title="3.1.2MapReduce分而治之思想"></a>3.1.2MapReduce分而治之思想</h3><p>1.数钱实例：一堆钞票，各种面值分别多少<br>-单点策略(一个人数所有的钞票，数出各种面值有多少张)<br>-分治策略(每个人分得一堆钞票，数出各种面值有多少种; 汇总，每个人负责统计一种面值)<br>2.解决数据可以切割进行计算的应用<br>分治思想（分解、求解、合并）<br>MapReduce映射（分：map（把复杂的问题分解为若干“简单的任务”）合：reduce）</p>
<h3 id="3-1-3MapReduce计算框架·执行流程"><a href="#3-1-3MapReduce计算框架·执行流程" class="headerlink" title="3.1.3MapReduce计算框架·执行流程"></a>3.1.3MapReduce计算框架·执行流程</h3><p>Map部分：<br>一个map实际上对应一个split分片，首先map读取split，因为map是一个程序，作为系统里面的一个进程，自己维护着一个进程空间。把split数据读进来之后直接存到了自己的内存上（buffer in  memory），然后开始往内存写。内存默认大小为100M，但是100M很容易写满，当它写到80M的时候会锁住内存区，然后把这80%的数据转储到磁盘上，然后清理内存。转储的过程中会作排序（sort），图中partitions中三个部分相当于前面数钱的例子中面值的分类。三个小的数据部分再归并排序成大的数据（merge on disk）。途中只展示出一个Map的执行流程，还有other maps。</p>
<p>Reduce部分<br>还是数钱的例子，假设图中Reduce部分是负责处理一百元面值的，把每个Map上属于一百元区域的数据通过fetch红线全部归纳到Reduce机器上（相当于拷贝）。然后把从每个从Map拷贝过来的数据两两合并，再统一交给Reduce处理，最后输出。</p>
<h3 id="3-1-4两个重要的进程"><a href="#3-1-4两个重要的进程" class="headerlink" title="3.1.4两个重要的进程"></a>3.1.4两个重要的进程</h3><p>&lt;1&gt;JobTracker主进程，负责接收客户作业提交，调度任务到作节点上运行，并提供诸如监控工作节点状态及任务进度等管理功能，一个MapReduce集群有一个JobTracker，一般运行在可靠的硬件上。<br>TaskTracker是通过周期性的心跳来通知JobTracker其当前的健康状态，每一次心跳包含了可用的Map和Reduce任务数目、占用的数目以及运行中的任务详细信息。JobTracker利用一个线程池来同时处理心跳和客户请求。</p>
<p>&lt;2&gt;TaskTracker由JobTracker指派任务，实例化用户程序，在本地执行任务并周期性地向JobTracker汇报状态。在每一个工作节点上永远只会有一个TaskTracker。<br>-JobTracker一直在等待用户提交作业<br>-TaskTracker每隔3秒向JobTracker发送心跳询问有没有任务可做，如果有，让其派发任务给它执行.</p>
<h3 id="3-1-5MapReduce配置文件属性介绍"><a href="#3-1-5MapReduce配置文件属性介绍" class="headerlink" title="3.1.5MapReduce配置文件属性介绍"></a>3.1.5MapReduce配置文件属性介绍</h3><p>mapred-site.xml（MapReduce守护进程的配置项，包括作业历史服务器）<br>    mapreduce.frame.work(告诉mapreduce运行在什么之上)<br>    yarn.app.mapreduce.am.resource.mb(mapreduce作业的缺省配置)<br>    mapreduce.map.memory.mb(每个map task需要的内存量)<br>    mapreduce.ruduce.memory.mb(每个map task 需要的内存量)</p>
<h2 id="3-2-YARN概述"><a href="#3-2-YARN概述" class="headerlink" title="3.2 YARN概述"></a>3.2 YARN概述</h2><p>YARN是一个资源管理、任务调度的框架，采用master&#x2F;slave架构，主要包含三大模块：ResourceManager（RM）、NodeManager（NM）、ApplicationMaster（AM）。</p>
<p>其中，ResourceManager负责所有资源的监控、分配和管理，运行在主节点；  NodeManager负责每一个节点的维护，运行在从节点；ApplicationMaster负责每一个具体应用程序的调度和协调，只有在有任务正在执行时存在。对于所有的applications，RM拥有绝对的控制权和对资源的分配权。而每个AM则会和RM协商资源，同时和NodeManager通信来执行和监控task。几个模块之间的关系如图3-1所示：</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676277051834.png" alt="img"><br>图3-1</p>
<h3 id="3-2-1-YARN运行流程"><a href="#3-2-1-YARN运行流程" class="headerlink" title="3.2.1 YARN运行流程"></a>3.2.1 YARN运行流程</h3><p>YARN运行流程如图 3-2 所示：</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676277057903.png" alt="img"><br>图3-2</p>
<p>master向RM提交应用程序，其中包括启动该应用的ApplicationMaster的必须信息，例如ApplicationMaster程序、启动ApplicationMaster的命令、用户程序等。</p>
<p>ResourceManager启动一个container用于运行ApplicationMaster。<br>启动中的ApplicationMaster向ResourceManager注册自己，启动成功后与RM保持心跳。<br>ApplicationMaster向ResourceManager发送请求，申请相应数目的container。<br>ResourceManager返回ApplicationMaster的申请的containers信息。申请成功的container，由ApplicationMaster进行初始化。container的启动信息初始化后，AM与对应的NodeManager通信，要求NM启动container。AM与NM保持心跳，从而对NM上运行的任务进行监控和管理。</p>
<p>container运行期间，ApplicationMaster对container进行监控。container通过RPC协议向对应的AM汇报自己的进度和状态等信息。<br>应用运行期间，master直接与AM通信获取应用的状态、进度更新等信息。<br>应用运行结束后，ApplicationMaster向ResourceManager注销自己，并允许属于它的container被收回。</p>
<h3 id="3-2-2-Yarn配置文件属性介绍"><a href="#3-2-2-Yarn配置文件属性介绍" class="headerlink" title="3.2.2 Yarn配置文件属性介绍"></a>3.2.2 Yarn配置文件属性介绍</h3><p>yarn-site.xml（YARN守护进程的配置项，包括资源管理器、web应用代理服务器和节点管理器）</p>
<p>yarn.resourcemanager.hostname(运行资源管理器的机器主机名，默认值为0.0.0.0。)</p>
<p>yarn.resourcemanager.address(运行资源管理器的PRC服务器的主机名和端口。)</p>
<p>yarn.nodemanager.local-dirs(逗号分隔的目录名称，是YARN容器本地临时存储空间。)</p>
<p>yarn.nodemanager.aux-services	 (逗号分隔的服务名称，是节点管理器运行的附加服务列表。每项服务由属性yarn.nodemanager.auxservices.servicename.class所定义的类实现。默认情况下，不指定附加服务)</p>
<p>yarn.nodemanager.resource.memorymb(节点管理器运行的容器可以分配到的物理内存容量（单位是MB）。默认值是8192。)</p>
<p>yarn.nodemanager.vmem-pmem-ratio(容器所占的虚拟内存和物理内存之比。该值指示了虚拟内存的使用可以超过所分配内存的量。默认值是2.1)</p>
<p>yarn.nodemanager.resource.cpuvcores(节点管理器运行的容器可以分配到的CPU核数目)</p>
</blockquote>
<h3 id="4-1-在master机上配置YARN"><a href="#4-1-在master机上配置YARN" class="headerlink" title="4.1 在master机上配置YARN"></a>4.1 在master机上配置YARN</h3><p>操作之前请确认HDFS已经启动，具体操作参考之前的实验内容。<br>指定YARN主节点，编辑文件“&#x2F;usr&#x2F;cstor&#x2F;hadoop&#x2F;etc&#x2F;hadoop&#x2F;yarn-site.xml”，将如下内容嵌入此文件里configuration标签间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;master&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676277881816.png" alt="img"><br>yarn-site.xml是YARN守护进程的配置文件。第一句配置了ResourceManager的主机名，第二句配置了节点管理器运行的附加服务为mapreduce_shuffle，只有这样才可以运行MapReduce程序。<br>在master机上操作：将配置好的YARN配置文件拷贝至slaveX。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# scp -r /usr/cstor/hadoop/etc/hadoop/yarn-site.xml slave1:/usr/cstor/hadoop/etc/hadoop/</span><br><span class="line">[root@master ~]# scp -r /usr/cstor/hadoop/etc/hadoop/yarn-site.xml slave2:/usr/cstor/hadoop/etc/hadoop/</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676277890425.png" alt="img"></p>
<h3 id="4-2-统一启动YARN"><a href="#4-2-统一启动YARN" class="headerlink" title="4.2 统一启动YARN"></a>4.2 统一启动YARN</h3><p>确认已配置slaves文件，在master机器上查看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat  /usr/cstor/hadoop/etc/hadoop/slaves</span><br></pre></td></tr></table></figure>

<p>内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slave1</span><br><span class="line">slave2</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676277900136.png" alt="img"></p>
<p>环境变量中应有如下配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export HDFS_NAMENODE_USER=root</span><br><span class="line">export HDFS_DATANODE_USER=root</span><br><span class="line">export HDFS_SECONDARYNAMENODE_USER=root</span><br><span class="line">export YARN_RESOURCEMANAGER_USER=root</span><br><span class="line">export YARN_NODEMANAGER_USER=root</span><br></pre></td></tr></table></figure>

<p>YARN配置无误，统一启动YARN：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# /usr/cstor/hadoop/sbin/start-yarn.sh</span><br></pre></td></tr></table></figure>

<h3 id="4-3-验证YARN启动成功"><a href="#4-3-验证YARN启动成功" class="headerlink" title="4.3 验证YARN启动成功"></a>4.3 验证YARN启动成功</h3><p>读者可分别在三台机器上执行如下命令，查看YARN服务是否已启动。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# jps      //jps查看java进程</span><br></pre></td></tr></table></figure>

<p>你会在master上看到类似的如下信息：<br>2347  ResourceManager</p>
<p>这表明在master节点成功启动ResourceManager，它负责整个集群的资源管理分配，是一个全局的资源管理系统。</p>
<p>而在slave1、slave2上看到类似的如下信息：<br>4021  NodeManager</p>
<p>NodeManager是每个节点上的资源和任务管理器，它是管理这台机器的代理，负责该节点程序的运行，以及该节点资源的管理和监控。YARN集群每个节点都运行一个NodeManager。</p>
<p>在当前的Windows机器上打开浏览器，地址栏输入master的IP和端口号8088（例：10.1.1.7:8088），即可在Web界面看到YARN相关信息。</p>
<h3 id="4-4-在master机上提交DistributedShell任务"><a href="#4-4-在master机上提交DistributedShell任务" class="headerlink" title="4.4 在master机上提交DistributedShell任务"></a>4.4 在master机上提交DistributedShell任务</h3><p>distributedshell，他可以看做YARN编程中的“hello  world”，它的主要功能是并行执行用户提供的shell命令或者shell脚本。-jar指定了包含ApplicationMaster的jar文件，-shell_command指定了需要被ApplicationMaster执行的Shell命令。<br>在xshell上再打开一个master的连接，执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# /usr/cstor/hadoop/bin/yarn \</span><br><span class="line">org.apache.hadoop.yarn.applications.distributedshell.Client  -jar \</span><br><span class="line">/usr/cstor/hadoop/share/hadoop/yarn/hadoop-yarn-applications-distributedshell-2.7.3.jar \</span><br><span class="line">-shell_command  uptime</span><br></pre></td></tr></table></figure>

<h3 id="4-5-在master机上提交MapReduce型任务"><a href="#4-5-在master机上提交MapReduce型任务" class="headerlink" title="4.5 在master机上提交MapReduce型任务"></a>4.5 在master机上提交MapReduce型任务</h3><h3 id="4-5-1-指定在YARN上运行MapReduce任务"><a href="#4-5-1-指定在YARN上运行MapReduce任务" class="headerlink" title="4.5.1 指定在YARN上运行MapReduce任务"></a>4.5.1 指定在YARN上运行MapReduce任务</h3><p>首先，在master机上，将文件“&#x2F;usr&#x2F;cstor&#x2F;hadoop&#x2F;etc&#x2F;hadoop&#x2F;mapred-site.xml. template”重命名为“&#x2F;usr&#x2F;cstor&#x2F;hadoop&#x2F;etc&#x2F;hadoop&#x2F;mapred-site.xml”。<br>接着，编辑此文件并将如下内容嵌入此文件的configuration标签间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;yarn&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676277917656.png" alt="img"><br>最后，将master机的“&#x2F;usr&#x2F;local&#x2F;hadoop&#x2F;etc&#x2F;hadoop&#x2F;mapred-site.xml”文件拷贝到slaveX，重新启动集群。</p>
<h3 id="4-5-2-在master端提交PI-Estimator任务"><a href="#4-5-2-在master端提交PI-Estimator任务" class="headerlink" title="4.5.2 在master端提交PI Estimator任务"></a>4.5.2 在master端提交PI Estimator任务</h3><p>首先进入Hadoop安装目录：&#x2F;usr&#x2F;cstor&#x2F;hadoop&#x2F;，然后提交PI Estimator任务。<br>命令最后两个两个参数的含义：第一个参数是指要运行map的次数，这里是2次；第二个参数是指每个map任务，取样的个数；而两数相乘即为总的取样数。Pi Estimator使用Monte Carlo方法计算Pi值的，Monte Carlo方法自行百度。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master hadoop]# bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.3.jar pi 2 10</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1676277926562.png" alt="img"></p>
<blockquote>
<p>（1）yarn启动之后在master上的web界面上能看到的界面。如图4-3所示： <img src="/static/upload/resource/exp/ins/4ab1fed988414bd29c5a777aca07f423/image/image.1676277934723.png" alt="image.png"> 图4-3 （2）提交DistributedShell任务之后web界面看到的界面应该是。如图4-4所示： <img src="/static/upload/resource/exp/ins/4ab1fed988414bd29c5a777aca07f423/image/image.1676277940448.png" alt="image.png"> 图4-4 （3）提交PI任务之后web界面上看到的。如图4-5所示： <img src="/static/upload/resource/exp/ins/4ab1fed988414bd29c5a777aca07f423/image/image.1676277947552.png" alt="image.png"> 图4-5 在终端能观察到的界面。如图4-6所示： <img src="/static/upload/resource/exp/ins/4ab1fed988414bd29c5a777aca07f423/image/image.1676277954367.png" alt="image.png"> 图4-6</p>
</blockquote>
<h2 id="61-项目实训-出租车运营调度管控平台-数据上传到KAFKA接口API"><a href="#61-项目实训-出租车运营调度管控平台-数据上传到KAFKA接口API" class="headerlink" title="61.项目实训-出租车运营调度管控平台-数据上传到KAFKA接口API"></a>61.项目实训-出租车运营调度管控平台-数据上传到KAFKA接口API</h2><blockquote>
<h3 id="目的-2"><a href="#目的-2" class="headerlink" title="目的"></a>目的</h3><p>1.了解Kafka相关概念</p>
<p>2.对外部提供一个上传出租车轨迹数据文件的接口</p>
<p>3.将上传的出租车轨迹数据写入Kafka中</p>
<h3 id="要求-2"><a href="#要求-2" class="headerlink" title="要求"></a>要求</h3><p>本次实验后，了解kafka概念及基本用法</p>
<h3 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h3><p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689128792976.png" alt="img"><br> ​     Apache Kafka是一个分布式发布 -  订阅消息系统和一个强大的队列，可以处理大量的数据，并使您能够将消息从一个端点传递到另一个端点。 Kafka适合离线和在线消息消费。  Kafka消息保留在磁盘上，并在群集内复制以防止数据丢失。 Kafka构建在ZooKeeper同步服务之上。 它与Apache  Storm和Spark非常好地集成，用于实时流式数据分析。</p>
<p>​     以下是Kafka的几个好处 - </p>
<ul>
<li><strong>可靠性</strong>  -  Kafka是分布式，分区，复制和容错的。</li>
<li><strong>可扩展性</strong>  -  Kafka消息传递系统轻松缩放，无需停机。</li>
<li><strong>耐用性</strong>  -  Kafka使用分布式提交日志，这意味着消息会尽可能快地保留在磁盘上，因此它是持久的。</li>
<li><strong>性能</strong>  -  Kafka对于发布和订阅消息都具有高吞吐量。 即使存储了许多TB的消息，它也保持稳定的性能。</li>
</ul>
<p>Kafka非常快，并保证零停机和零数据丢失。</p>
<h5 id="Kafaka相关组件："><a href="#Kafaka相关组件：" class="headerlink" title="Kafaka相关组件："></a>Kafaka相关组件：</h5><p>Topics（主题）：属于特定类别的消息流称为主题。 数据存储在主题中。<br>主题被拆分成分区。 对于每个主题，Kafka保存一个分区的数据。 每个这样的分区包含不可变有序序列的消息。 分区被实现为具有相等大小的一组分段文件。</p>
<p>Partition（分区）：主题可能有许多分区，因此它可以处理任意数量的数据。</p>
<p>Partition offset（分区偏移）：每个分区消息具有称为 offset 的唯一序列标识。</p>
<p>Replicas of partition（分区备份）：副本只是一个分区的备份。 副本从不读取或写入数据。 它们用于防止数据丢失。</p>
<p>Brokers（经纪人）：代理是负责维护发布数据的简单系统。 每个代理中的每个主题可以具有零个或多个分区。 假设，如果在一个主题和N个代理中有N个分区，每个代理将有一个分区。</p>
<p>Kafka Cluster（Kafka集群）：Kafka有多个代理被称为Kafka集群。 可以扩展Kafka集群，无需停机。 这些集群用于管理消息数据的持久性和复制。</p>
<p>Producers（生产者）：生产者是发送给一个或多个Kafka主题的消息的发布者。 生产者向Kafka经纪人发送数据。  每当生产者将消息发布给代理时，代理只需将消息附加到最后一个段文件。 实际上，该消息将被附加到分区。 生产者还可以向他们选择的分区发送消息。<br>Consumers（消费者）：从经纪人处读取数据。 消费者订阅一个或多个主题，并通过从代理中提取数据来使用已发布的消息。</p>
<p>Leader（领导者）：Leader 是负责给定分区的所有读取和写入的节点。 每个分区都有一个服务器充当</p>
<p>Follower（追随者）：跟随领导者指令的节点被称为Follower 如果领导失败，一个追随者将自动成为新的领导者。 跟随者作为正常消费者，拉取消息并更新其自己的数据存储。</p>
</blockquote>
<h3 id="1-修改springboot项目的pom-xml文件添加相关依赖，添加kafka相关依赖"><a href="#1-修改springboot项目的pom-xml文件添加相关依赖，添加kafka相关依赖" class="headerlink" title="1 修改springboot项目的pom.xml文件添加相关依赖，添加kafka相关依赖"></a>1 修改springboot项目的pom.xml文件添加相关依赖，添加kafka相关依赖</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">    &lt;groupId&gt;com.cstor&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;carplatform&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.5.10.RELEASE&lt;/version&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">            &lt;/exclusions&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- 换成undertow --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-undertow&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.5.10.RELEASE&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.5.10.RELEASE&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spark-core_2.11&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.1&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;8.0.22&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--                 通用mapper--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.0.4&lt;/version&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">                    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">            &lt;/exclusions&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.16.18&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--swagger 文档注释--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spark-streaming_2.11&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.1&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spark-streaming-kafka-0-8_2.11&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.1&lt;/version&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;artifactId&gt;scala-xml_2.11&lt;/artifactId&gt;</span><br><span class="line">                    &lt;groupId&gt;org.scala-lang.modules&lt;/groupId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">            &lt;/exclusions&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.netty&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;netty-all&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.0.43.Final&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.47&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.9.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.6.5&lt;/version&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;</span><br><span class="line">                &lt;/exclusion&gt;</span><br><span class="line">            &lt;/exclusions&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.6.5&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.1.10&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.scala-lang&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;scala-xml&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.11.0-M4&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;net.alchim31.maven&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;scala-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;3.2.2&lt;/version&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;compile-scala&lt;/id&gt;</span><br><span class="line">                        &lt;phase&gt;process-resources&lt;/phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;add-source&lt;/goal&gt;</span><br><span class="line">                            &lt;goal&gt;compile&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;scala-compile-first&lt;/id&gt;</span><br><span class="line">                        &lt;phase&gt;compile&lt;/phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;add-source&lt;/goal&gt;</span><br><span class="line">                            &lt;goal&gt;testCompile&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                    &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;mainClass&gt;com.cstor.carplatform.CarPlatFormApplication&lt;/mainClass&gt;　　&lt;!-- springboot的启动类全路径 --&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;repackage&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<p> 根据自己的项目把相关依赖引入</p>
<h3 id="2-对外暴露异步上传数据文件到kafka接口"><a href="#2-对外暴露异步上传数据文件到kafka接口" class="headerlink" title="2  对外暴露异步上传数据文件到kafka接口"></a>2  对外暴露异步上传数据文件到kafka接口</h3><p> 在启动类开启启用异步调用加上注解@EnableAsync</p>
<p>如下代码所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.cstor.carplatform;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Description:</span><br><span class="line"> * 接口文档访问地址：http://serverIP:port/swagger-ui.html</span><br><span class="line"> * Date: 2021/10/15  16:37【需求编号】</span><br><span class="line"> *</span><br><span class="line"> * @author clam</span><br><span class="line"> * @version V1.0.0</span><br><span class="line"> */</span><br><span class="line">@SpringBootApplication</span><br><span class="line">@EnableAsync //开启异步注解</span><br><span class="line">public class CarPlatFormApplication &#123;</span><br><span class="line">    public CarPlatFormApplication() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(CarPlatFormApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>书写上传数据文件到kafka接口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">   @ApiOperation(&quot;处理出租车轨迹数据文件接口&quot;)</span><br><span class="line">    @PostMapping(&quot;/dealfile&quot;)</span><br><span class="line">    public ResponseEntity&lt;String&gt; dealFile(@RequestParam(&quot;myFile&quot;) MultipartFile myFile) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        String result = &quot;上传成功&quot;;</span><br><span class="line">        InputStream inputStream = myFile.getInputStream ( );</span><br><span class="line">        taxiService.dealFile(inputStream);</span><br><span class="line"></span><br><span class="line">        return ResponseEntity.ok (result);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>同时在具体业务处理类上加上@Async注解</p>
<p>如图：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689128858537.png" alt="img"><br>具体处理的车轨迹数据文件的逻辑代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">public class  KafkaUtil &#123;</span><br><span class="line"></span><br><span class="line">    public static void producer(InputStream inputStream) throws IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        Properties properties = new Properties();</span><br><span class="line">        //kafaka服务器地址</span><br><span class="line">        properties.put (&quot;bootstrap.servers&quot;, &quot;192.168.56.128:9092,192.168.56.128:9093,192.168.56.128:9094&quot;);</span><br><span class="line">        //消息确认机制</span><br><span class="line">        properties.put (&quot;acks&quot;, &quot;all&quot;);</span><br><span class="line">        //重试机制</span><br><span class="line">        properties.put (&quot;retries&quot;, 0);</span><br><span class="line">        //批量发送大小</span><br><span class="line">        properties.put (&quot;batch.size&quot;, 16384);</span><br><span class="line">        //消息延迟</span><br><span class="line">        properties.put (&quot;linger.ms&quot;, 1);</span><br><span class="line"></span><br><span class="line">        //批量缓存区大小</span><br><span class="line">        properties.put (&quot;buffer.memory&quot;, 33554432);</span><br><span class="line">        properties.put(&quot;key.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);</span><br><span class="line">        // value序列化</span><br><span class="line">        properties.put(&quot;value.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);</span><br><span class="line"></span><br><span class="line">        KafkaProducer kafkaProducer = new KafkaProducer (properties);</span><br><span class="line"></span><br><span class="line">        String Line = null;</span><br><span class="line">        //解析流中数据并循环发送到Kafaka</span><br><span class="line">        InputStreamReader inputStreamReader = new InputStreamReader (inputStream);</span><br><span class="line">        BufferedReader bufferedReader = new BufferedReader(inputStreamReader);</span><br><span class="line"></span><br><span class="line">        while(!Objects.equals (Line=bufferedReader.readLine(), &quot;&quot;))&#123;</span><br><span class="line">            if(Line!=null&amp;&amp;!Line.equals(&quot;\t\t\t\t\t\t\t\t\t\t&quot;))&#123;</span><br><span class="line"></span><br><span class="line">                kafkaProducer.send(new ProducerRecord (&quot;test&quot;, Line));</span><br><span class="line"></span><br><span class="line">                System.out.println(Line);</span><br><span class="line">                Thread.sleep(100);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        kafkaProducer.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>替换 kafaka服务器地址为自己的kafka集群信息</p>
<h3 id="3-测试上传文件数据到kafka中接口"><a href="#3-测试上传文件数据到kafka中接口" class="headerlink" title="3 测试上传文件数据到kafka中接口"></a>3 测试上传文件数据到kafka中接口</h3><p>启动项目后打开接口文档访问地址：<a href="http://serverIP:port/swagger-ui.html">http://serverIP:port/swagger-ui.html</a></p>
<p>如图：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689128869698.png" alt="img"><br>找到对应接口上传车辆轨迹数据点击try it out </p>
<p>调用接口测试我们后台日志如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">    compression.type = none</span><br><span class="line">    metric.reporters = []</span><br><span class="line">    metadata.max.age.ms = 300000</span><br><span class="line">    metadata.fetch.timeout.ms = 60000</span><br><span class="line">    acks = all</span><br><span class="line">    batch.size = 16384</span><br><span class="line">    reconnect.backoff.ms = 10</span><br><span class="line">    bootstrap.servers = [192.168.56.128:9092]</span><br><span class="line">    receive.buffer.bytes = 32768</span><br><span class="line">    retry.backoff.ms = 100</span><br><span class="line">    buffer.memory = 33554432</span><br><span class="line">    timeout.ms = 30000</span><br><span class="line">    key.serializer = class org.apache.kafka.common.serialization.StringSerializer</span><br><span class="line">    retries = 0</span><br><span class="line">    max.request.size = 1048576</span><br><span class="line">    block.on.buffer.full = true</span><br><span class="line">    value.serializer = class org.apache.kafka.common.serialization.StringSerializer</span><br><span class="line">    metrics.sample.window.ms = 30000</span><br><span class="line">    send.buffer.bytes = 131072</span><br><span class="line">    max.in.flight.requests.per.connection = 5</span><br><span class="line">    metrics.num.samples = 2</span><br><span class="line">    linger.ms = 1</span><br><span class="line">    client.id = </span><br><span class="line"></span><br><span class="line">105,2007-02-20 00:00:48,121.466600,31.220800,  0</span><br><span class="line">105,2007-02-20 00:01:17,121.468100,31.221100, 34</span><br><span class="line">105,2007-02-20 00:01:33,121.469500,31.221600, 34</span><br><span class="line">105,2007-02-20 00:01:49,121.470000,31.221600,  4</span><br><span class="line">105,2007-02-20 00:02:50,121.469500,31.221500,  0</span><br><span class="line">105,2007-02-20 00:03:51,121.469500,31.221800,  4</span><br><span class="line">105,2007-02-20 00:04:20,121.469100,31.223000, 20</span><br><span class="line">105,2007-02-20 00:04:37,121.468300,31.222000, 30</span><br><span class="line">105,2007-02-20 00:05:25,121.468800,31.221300, 10</span><br><span class="line">105,2007-02-20 00:06:26,121.469500,31.221500,  0</span><br><span class="line">105,2007-02-20 00:07:27,121.469500,31.221500,  0</span><br><span class="line">105,2007-02-20 00:08:28,121.469500,31.221500,  0</span><br><span class="line">105,2007-02-20 00:09:28,121.469300,31.222800, 10</span><br><span class="line">105,2007-02-20 00:10:48,121.469000,31.224600, 20</span><br><span class="line">105,2007-02-20 00:11:49,121.469600,31.224300,  0</span><br><span class="line">105,2007-02-20 00:12:11,121.470500,31.225100, 18</span><br><span class="line">105,2007-02-20 00:13:12,121.470300,31.226300,  0</span><br><span class="line">105,2007-02-20 00:14:07,121.471500,31.226800, 26</span><br><span class="line">105,2007-02-20 00:14:33,121.472600,31.227300, 12</span><br><span class="line">105,2007-02-20 00:16:02,121.474300,31.228100,  0</span><br><span class="line">105,2007-02-20 00:16:54,121.474800,31.229000, 26</span><br><span class="line">105,2007-02-20 00:17:11,121.474300,31.230000, 22</span><br><span class="line">105,2007-02-20 00:18:07,121.473600,31.231000, 16</span><br><span class="line">105,2007-02-20 00:18:29,121.473000,31.231600, 24</span><br><span class="line">105,2007-02-20 00:19:04,121.473300,31.232500, 24</span><br><span class="line">105,2007-02-20 00:19:24,121.474300,31.233000, 20</span><br><span class="line">105,2007-02-20 00:19:41,121.475500,31.234000, 30</span><br></pre></td></tr></table></figure>

<h2 id="62-项目实训-出租车运营调度管控平台-SparkStreaming消费Kafka中数据"><a href="#62-项目实训-出租车运营调度管控平台-SparkStreaming消费Kafka中数据" class="headerlink" title="62.项目实训-出租车运营调度管控平台-SparkStreaming消费Kafka中数据"></a>62.项目实训-出租车运营调度管控平台-SparkStreaming消费Kafka中数据</h2><blockquote>
<h3 id="目的-3"><a href="#目的-3" class="headerlink" title="目的"></a>目的</h3><p>1.了解SparkStreaming相关概念</p>
<p>2.对外部提供异步启动SparkStreaming处理Kafka消息接口</p>
<p>3.处理SparkStreaming处理Kafka消息业务处理类</p>
<h3 id="要求-3"><a href="#要求-3" class="headerlink" title="要求"></a>要求</h3><p>1.了解SparkStreaming相关概念</p>
<p>2.对外部提供异步启动SparkStreaming处理Kafka消息接口</p>
<p>3.处理SparkStreaming处理Kafka消息业务处理类</p>
<h3 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h3><p>   Spark Streaming用于流式数据的处理。Spark  Streaming支持的数据输入源很多，例如：Kafka、Flume、Twitter、ZeroMQ和简单的TCP套接字等等。数据输入后可以用Spark的高度抽象算子如：map、reduce、join、window等进行运算。而结果也能保存在很多地方，如HDFS，数据库等。</p>
<p>​            在 Spark Streaming 中，处理数据的单位是一批而不是单条，而数据采集却是逐条进行的，因此  Spark Streaming 系统需要设置间隔使得数据汇总到一定的量后再一并操作，这个间隔就是批处理间隔。批处理间隔是Spark  Streaming的核心概念和关键参数，它决定了Spark  Streaming提交作业的频率和数据处理的延迟，同时也影响着数据处理的吞吐量和性能。 Spark Streaming架构设计如下图：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689128978481.png" alt="img"></p>
</blockquote>
<h3 id="1对外暴露异步启动SparkStreaming处理Kafka消息接口："><a href="#1对外暴露异步启动SparkStreaming处理Kafka消息接口：" class="headerlink" title="1对外暴露异步启动SparkStreaming处理Kafka消息接口："></a>1对外暴露异步启动SparkStreaming处理Kafka消息接口：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(&quot;sparkstream启动器&quot;)</span><br><span class="line">  @PostMapping(&quot;/sparkstreamLuach&quot;)</span><br><span class="line">  public ResponseEntity&lt;String&gt; sparkstreamLuach() throws Exception &#123;</span><br><span class="line"></span><br><span class="line">      String result = &quot;启动成功&quot;;</span><br><span class="line"></span><br><span class="line">      taxiService.launch ();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      return ResponseEntity.ok (result);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h5 id="SparkStreaming主要处理逻辑如下："><a href="#SparkStreaming主要处理逻辑如下：" class="headerlink" title="SparkStreaming主要处理逻辑如下："></a>SparkStreaming主要处理逻辑如下：</h5><p>初始化sparkContext：可以将setMaster(“local[*]”)的参数换成spark集群的url</p>
<p>初始化Kafkaparams：将brokers设置为自己的kafka集群环境信息，topic，group设置为实验二中设置的topic，</p>
<p>重Kafka中获取数据从而创建DStream</p>
<p>对DStream进行业务处理：数据清洗过滤，存入Mysql，存入Redis</p>
<p>关闭数据库连接</p>
<p>启动ssc任务</p>
<p>代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">scala</span><br><span class="line">object SparkStreamLaunch  &#123;</span><br><span class="line">  def launch(): Unit = &#123;</span><br><span class="line">    val conf: SparkConf = new SparkConf().setMaster(&quot;local[*]&quot;).setAppName(&quot;HighKafka&quot;)</span><br><span class="line">    val ssc = new StreamingContext(conf, Seconds(3))</span><br><span class="line">    //设置日志级别</span><br><span class="line">    ssc.sparkContext.setLogLevel(&quot;WARN&quot;)</span><br><span class="line">    //kafka参数声明</span><br><span class="line">    val brokers = &quot;192.168.56.128:9092,192.168.56.128:9093,192.168.56.128:9094&quot;</span><br><span class="line">    val topic = &quot;test&quot;</span><br><span class="line">    val group = &quot;bigdata&quot;</span><br><span class="line">    val deserialization = &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><br><span class="line">    val kafkaParams = Map(</span><br><span class="line">      ConsumerConfig.GROUP_ID_CONFIG -&gt; group,</span><br><span class="line">      ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG -&gt; brokers,</span><br><span class="line">      ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG -&gt; deserialization,</span><br><span class="line">      ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG -&gt; deserialization</span><br><span class="line">    )</span><br><span class="line">    //创建DS</span><br><span class="line">    val kafkaDS: InputDStream[(String, String)] = KafkaUtils.createDirectStream[String, String, StringDecoder, StringDecoder](</span><br><span class="line">      ssc, kafkaParams, Set(topic))</span><br><span class="line">    val redisclient = RedisUtil.getJedisClient</span><br><span class="line">    kafkaDS.foreachRDD(foreachFunc = kafkaRDD =&gt; &#123;</span><br><span class="line">      print(&quot;///////////////////////////////////&quot;)</span><br><span class="line">      println(kafkaRDD)</span><br><span class="line">      if (!kafkaRDD.isEmpty()) &#123;</span><br><span class="line">        //获取当前批次的RDD的偏移量</span><br><span class="line">        val offsetRanges = kafkaRDD.asInstanceOf[HasOffsetRanges].offsetRanges</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        var arry: Array[TaxiInfo] = kafkaRDD.map(_._2).map(_.split(&quot;,&quot;)).map(p =&gt; TaxiInfo(p(0).trim, p(1).trim, p(2).trim, p(3).trim, p(4))).collect()</span><br><span class="line"></span><br><span class="line">        var conn: Connection = null</span><br><span class="line">        var stmt: PreparedStatement = null</span><br><span class="line">        var stmt2: PreparedStatement = null</span><br><span class="line">        try &#123;</span><br><span class="line">          Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;)</span><br><span class="line">          val url = &quot;jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai&amp;allowMultiQueries=true&amp;amp&quot;</span><br><span class="line">          val user = &quot;root&quot;</span><br><span class="line">          val password = &quot;root&quot;</span><br><span class="line">          conn = DriverManager.getConnection(url, user, password)</span><br><span class="line">       arry.foreach(p =&gt; &#123;</span><br><span class="line">            arry.foreach(q =&gt;&#123;</span><br><span class="line">              if(p.taxiId!=q.taxiId&amp;&amp;Math.abs(p.latitude.toDouble-q.latitude.toDouble)&lt;0.00001&amp;&amp;Math.abs(p.longitude.toDouble-q.longitude.toDouble)&lt;0.00001)&#123;</span><br><span class="line">               print(&quot;异常聚集&quot;)</span><br><span class="line">                val sql = &quot;insert into exp_gather(time,latitude,longitude) values (?,?,?)&quot;</span><br><span class="line">                stmt = conn.prepareStatement(sql);</span><br><span class="line">                stmt.setString(1,p.dateTime )</span><br><span class="line">                stmt.setString(2, p.latitude)</span><br><span class="line">                stmt.setString(3, p.longitude)</span><br><span class="line">                stmt.executeUpdate()</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">          arry.foreach(p =&gt; &#123;</span><br><span class="line">            val sql = &quot;insert into taxi(carid,time,longitude,latitude,speed) values (?,?,?,?,?)&quot;</span><br><span class="line">            stmt = conn.prepareStatement(sql)</span><br><span class="line">            stmt.setString(1, p.taxiId)</span><br><span class="line">            stmt.setString(2, p.dateTime)</span><br><span class="line">            stmt.setString(3, p.latitude)</span><br><span class="line">            stmt.setString(4, p.longitude)</span><br><span class="line">            stmt.setString(5, p.speed)</span><br><span class="line">            stmt.executeUpdate()</span><br><span class="line">            val sql2 = &quot;insert into taxi_details(carid,time,longitude,latitude,speed) values (?,?,?,?,?)&quot;</span><br><span class="line">            stmt2 = conn.prepareStatement(sql2);</span><br><span class="line">            stmt2.setString(1, p.taxiId)</span><br><span class="line">            stmt2.setString(2, p.dateTime)</span><br><span class="line">            stmt2.setString(3, p.latitude)</span><br><span class="line">            stmt2.setString(4, p.longitude)</span><br><span class="line">            stmt2.setString(5, p.speed)</span><br><span class="line">            stmt2.executeUpdate()</span><br><span class="line">            redisclient.geoadd(&quot;carplatform&quot;,p.longitude.toDouble,p.latitude.toDouble,p.taxiId+&quot;-&quot;+p.dateTime)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; catch &#123;</span><br><span class="line">          case e: Exception =&gt; e.printStackTrace()</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">          if (stmt != null) &#123;</span><br><span class="line">            stmt.close()</span><br><span class="line">          &#125;</span><br><span class="line">          if (conn != null) &#123;</span><br><span class="line">            conn.close()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        print(&quot;///////////////////////////////////&quot;)</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    ssc.start()</span><br><span class="line">    ssc.awaitTermination()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2初始化Redis客户端"><a href="#2初始化Redis客户端" class="headerlink" title="2初始化Redis客户端"></a>2初始化Redis客户端</h3><p> 初始化Redis客户端代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">scala</span><br><span class="line">object RedisUtil &#123;</span><br><span class="line">    var jedisPool:JedisPool=null</span><br><span class="line"></span><br><span class="line">    def getJedisClient: Jedis = &#123;</span><br><span class="line">        if(jedisPool==null)&#123;</span><br><span class="line">            //println(&quot;开辟一个连接池&quot;)</span><br><span class="line">            val host = &quot;127.0.0.1&quot;</span><br><span class="line">            val port = 6379</span><br><span class="line">            val password = &quot;root&quot;</span><br><span class="line">            val timeout =2000</span><br><span class="line">            val jedisPoolConfig = new JedisPoolConfig()</span><br><span class="line">            jedisPoolConfig.setMaxTotal(100)  //最大连接数</span><br><span class="line">            jedisPoolConfig.setMaxIdle(20)   //最大空闲</span><br><span class="line">            jedisPoolConfig.setMinIdle(20)     //最小空闲</span><br><span class="line">            jedisPoolConfig.setBlockWhenExhausted(true)  //忙碌时是否等待</span><br><span class="line">            jedisPoolConfig.setMaxWaitMillis(500)//忙碌时等待时长 毫秒</span><br><span class="line">            jedisPoolConfig.setTestOnBorrow(true) //每次获得连接的进行测试</span><br><span class="line"></span><br><span class="line">            jedisPool=new JedisPool(jedisPoolConfig,host,port.toInt,timeout,password)</span><br><span class="line">        &#125;</span><br><span class="line">        //println(s&quot;jedisPool.getNumActive = $&#123;jedisPool.getNumActive&#125;&quot;)</span><br><span class="line">        //println(&quot;获得一个连接&quot;)</span><br><span class="line">        jedisPool.getResource</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用Redis的GeoHash数据类型存储车辆的实时位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redisclient.geoadd(&quot;carplatform&quot;,p.longitude.toDouble,p.latitude.toDouble,p.taxiId+&quot;-&quot;+p.dateTime)</span><br></pre></td></tr></table></figure>

<p>GeoHash的相关API：</p>
<ul>
<li>geoadd：添加车辆地理位置的坐标。</li>
<li>geopos：获取车辆地理位置的坐标。</li>
<li>geodist：计算两个车辆位置之间的距离。</li>
<li>georadius：根据用户给定的经纬度坐标来获取指定范围内的地理位置集合。</li>
<li>georadiusbymember：根据储存在位置集合里面的某个地点获取指定范围内的地理位置集合。用来查看附近的车辆</li>
<li>geohash：返回一个或多个车辆位置对象的 geohash 值。</li>
</ul>
<h3 id="3连接数据库创建原始表"><a href="#3连接数据库创建原始表" class="headerlink" title="3连接数据库创建原始表"></a>3连接数据库创建原始表</h3><p> 连接数据库创建原始表：如下图所示</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689129018488.png" alt="img"><br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689129028735.png" alt="img"><br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689129035571.png" alt="img"><br>点击绿色执行如下sql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line">DROP TABLE IF EXISTS `taxi`;</span><br><span class="line">CREATE TABLE `taxi` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `carid` int(11) DEFAULT NULL,</span><br><span class="line">  `time` datetime DEFAULT NULL,</span><br><span class="line">  `longitude` double(255,10) DEFAULT NULL,</span><br><span class="line">  `latitude` double(255,10) DEFAULT NULL,</span><br><span class="line">  `speed` int(11) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=3035 DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for taxi_details</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `taxi_details`;</span><br><span class="line">CREATE TABLE `taxi_details` (</span><br><span class="line">  `carid` int(11) DEFAULT NULL,</span><br><span class="line">  `time` datetime DEFAULT NULL,</span><br><span class="line">  `longitude` double(255,20) DEFAULT NULL,</span><br><span class="line">  `latitude` double(255,20) DEFAULT NULL,</span><br><span class="line">  `speed` int(11) DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">create table taxi_exception</span><br><span class="line">(</span><br><span class="line">    id            int auto_increment</span><br><span class="line">        primary key,</span><br><span class="line">    carid         int         null,</span><br><span class="line">    time          datetime    null,</span><br><span class="line">    exceptiontype varchar(10) null,</span><br><span class="line">    speed         int         null</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>建立相关的业务对象TaxiInfo.scala：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">scala</span><br><span class="line">package com.cstor.carplatform.scala</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * Description:</span><br><span class="line"> * 接口文档访问地址：http://serverIP:port/swagger-ui.html</span><br><span class="line"> * Date: 2021/8/25  11:22【需求编号】</span><br><span class="line"> *</span><br><span class="line"> * @author clam</span><br><span class="line"> * @version V1.0.0</span><br><span class="line"> */</span><br><span class="line">case class TaxiInfo (</span><br><span class="line">    taxiId:String,</span><br><span class="line">    dateTime: String,</span><br><span class="line">    longitude: String,</span><br><span class="line">    latitude:String,</span><br><span class="line">    speed :String</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>idea连接MySQL数据</p>
<p>scala将数据存入mysql代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">scala</span><br><span class="line">           //加载驱动类</span><br><span class="line">          Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;)</span><br><span class="line">        //设置连接参数：url数据库地址 user数据库用户名 password用户名密码</span><br><span class="line">          val url = &quot;jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai&amp;allowMultiQueries=true&amp;amp&quot;</span><br><span class="line">          val user = &quot;root&quot;</span><br><span class="line">          val password = &quot;root&quot;</span><br><span class="line">         //建立连接</span><br><span class="line">          conn = DriverManager.getConnection(url, user, password)</span><br><span class="line">          arry.foreach(p =&gt; &#123;</span><br><span class="line">            val sql = &quot;insert into taxi(carid,time,longitude,latitude,speed) values (?,?,?,?,?)&quot;</span><br><span class="line">              //创建执行sql语句的对象</span><br><span class="line">            stmt = conn.prepareStatement(sql)</span><br><span class="line">              //设置参数值</span><br><span class="line">            stmt.setString(1, p.taxiId)</span><br><span class="line">            stmt.setString(2, p.dateTime)</span><br><span class="line">            stmt.setString(3, p.latitude)</span><br><span class="line">            stmt.setString(4, p.longitude)</span><br><span class="line">            stmt.setString(5, p.speed)</span><br><span class="line">            stmt.executeUpdate()</span><br><span class="line">            val sql2 = &quot;insert into taxi_details(carid,time,longitude,latitude,speed) values (?,?,?,?,?)&quot;</span><br><span class="line">            stmt2 = conn.prepareStatement(sql2);</span><br><span class="line">            stmt2.setString(1, p.taxiId)</span><br><span class="line">            stmt2.setString(2, p.dateTime)</span><br><span class="line">            stmt2.setString(3, p.latitude)</span><br><span class="line">            stmt2.setString(4, p.longitude)</span><br><span class="line">            stmt2.setString(5, p.speed)</span><br><span class="line">            stmt2.executeUpdate()</span><br></pre></td></tr></table></figure>

<h3 id="4-验证结果"><a href="#4-验证结果" class="headerlink" title="4 验证结果"></a>4 验证结果</h3><p> 将数据存入</p>
<p>启动项目后打开接口文档访问地址：<a href="http://serverIP:port/swagger-ui.html；调用如下两个接口">http://serverIP:port/swagger-ui.html；调用如下两个接口</a><br>进入sparkUI页面：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689129057089.png" alt="img"></p>
<p>我们能够看到sparkstreaming处理的具体情况</p>
<h2 id="63-项目实训-出租车运营调度管控平台-对外提供出租车轨迹查询接口"><a href="#63-项目实训-出租车运营调度管控平台-对外提供出租车轨迹查询接口" class="headerlink" title="63.项目实训-出租车运营调度管控平台-对外提供出租车轨迹查询接口"></a>63.项目实训-出租车运营调度管控平台-对外提供出租车轨迹查询接口</h2><blockquote>
<h3 id="目的-4"><a href="#目的-4" class="headerlink" title="目的"></a>目的</h3><p>学习Restful Api接口风格</p>
<p>学习springboot集成mybatis</p>
<h3 id="要求-4"><a href="#要求-4" class="headerlink" title="要求"></a>要求</h3><p>了解Restful Api接口风格</p>
<p>了解springboot集成mybatis</p>
<h3 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h3><p>实时展示车辆轨迹</p>
</blockquote>
<h3 id="1新建实体类"><a href="#1新建实体类" class="headerlink" title="1新建实体类"></a>1新建实体类</h3><p>   新建实体类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.carplatform.model;</span><br><span class="line"></span><br><span class="line">import javax.persistence.GeneratedValue;</span><br><span class="line">import javax.persistence.GenerationType;</span><br><span class="line">import javax.persistence.Id;</span><br><span class="line">import javax.persistence.Table;</span><br><span class="line">import java.beans.ConstructorProperties;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Description:</span><br><span class="line"> * 接口文档访问地址：http://serverIP:port/swagger-ui.html</span><br><span class="line"> * Date: 2021/10/22  9:09【需求编号】</span><br><span class="line"> *</span><br><span class="line"> * @author clam</span><br><span class="line"> * @version V1.0.0</span><br><span class="line"> */</span><br><span class="line">@Table(</span><br><span class="line">        name = &quot;taxi&quot;</span><br><span class="line">)</span><br><span class="line">public class Taxi &#123;</span><br><span class="line">    @Id</span><br><span class="line">    @GeneratedValue(</span><br><span class="line">            strategy = GenerationType.IDENTITY</span><br><span class="line">    )</span><br><span class="line">    private Integer id;</span><br><span class="line">    private Integer carid;</span><br><span class="line">    private Date time;</span><br><span class="line">    private Double longitude;</span><br><span class="line">    private Double latitude;</span><br><span class="line">    private Integer speed;</span><br><span class="line"></span><br><span class="line">    public Integer getId() &#123;</span><br><span class="line">        return this.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getCarid() &#123;</span><br><span class="line">        return this.carid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getTime() &#123;</span><br><span class="line">        return this.time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Double getLongitude() &#123;</span><br><span class="line">        return this.longitude;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Double getLatitude() &#123;</span><br><span class="line">        return this.latitude;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getSpeed() &#123;</span><br><span class="line">        return this.speed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(final Integer id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCarid(final Integer carid) &#123;</span><br><span class="line">        this.carid = carid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTime(final Date time) &#123;</span><br><span class="line">        this.time = time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setLongitude(final Double longitude) &#123;</span><br><span class="line">        this.longitude = longitude;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setLatitude(final Double latitude) &#123;</span><br><span class="line">        this.latitude = latitude;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSpeed(final Integer speed) &#123;</span><br><span class="line">        this.speed = speed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Taxi(id=&quot; + this.getId() + &quot;, carid=&quot; + this.getCarid() + &quot;, time=&quot; + this.getTime() + &quot;, longitude=&quot; + this.getLongitude() + &quot;, latitude=&quot; + this.getLatitude() + &quot;, speed=&quot; + this.getSpeed() + &quot;)&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ConstructorProperties(&#123;&quot;id&quot;, &quot;carid&quot;, &quot;time&quot;, &quot;longitude&quot;, &quot;latitude&quot;, &quot;speed&quot;&#125;)</span><br><span class="line">    public Taxi(final Integer id, final Integer carid, final Date time, final Double longitude, final Double latitude, final Integer speed) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.carid = carid;</span><br><span class="line">        this.time = time;</span><br><span class="line">        this.longitude = longitude;</span><br><span class="line">        this.latitude = latitude;</span><br><span class="line">        this.speed = speed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Taxi() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建实体类TaxiDetails </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.carplatform.model;</span><br><span class="line"></span><br><span class="line">import javax.persistence.Table;</span><br><span class="line">import java.beans.ConstructorProperties;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Description:</span><br><span class="line"> * 接口文档访问地址：http://serverIP:port/swagger-ui.html</span><br><span class="line"> * Date: 2021/10/22  9:10【需求编号】</span><br><span class="line"> *</span><br><span class="line"> * @author clam</span><br><span class="line"> * @version V1.0.0</span><br><span class="line"> */</span><br><span class="line">@Table(</span><br><span class="line">        name = &quot;taxi_details&quot;</span><br><span class="line">)</span><br><span class="line">public class TaxiDetails &#123;</span><br><span class="line">    private Integer carid;</span><br><span class="line">    private Date time;</span><br><span class="line">    private Double longitude;</span><br><span class="line">    private Double latitude;</span><br><span class="line">    private Integer speed;</span><br><span class="line"></span><br><span class="line">    public Integer getCarid() &#123;</span><br><span class="line">        return this.carid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getTime() &#123;</span><br><span class="line">        return this.time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Double getLongitude() &#123;</span><br><span class="line">        return this.longitude;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Double getLatitude() &#123;</span><br><span class="line">        return this.latitude;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getSpeed() &#123;</span><br><span class="line">        return this.speed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCarid(final Integer carid) &#123;</span><br><span class="line">        this.carid = carid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTime(final Date time) &#123;</span><br><span class="line">        this.time = time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setLongitude(final Double longitude) &#123;</span><br><span class="line">        this.longitude = longitude;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setLatitude(final Double latitude) &#123;</span><br><span class="line">        this.latitude = latitude;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSpeed(final Integer speed) &#123;</span><br><span class="line">        this.speed = speed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;TaxiDetails(carid=&quot; + this.getCarid() + &quot;, time=&quot; + this.getTime() + &quot;, longitude=&quot; + this.getLongitude() + &quot;, latitude=&quot; + this.getLatitude() + &quot;, speed=&quot; + this.getSpeed() + &quot;)&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ConstructorProperties(&#123;&quot;carid&quot;, &quot;time&quot;, &quot;longitude&quot;, &quot;latitude&quot;, &quot;speed&quot;&#125;)</span><br><span class="line">    public TaxiDetails(final Integer carid, final Date time, final Double longitude, final Double latitude, final Integer speed) &#123;</span><br><span class="line">        this.carid = carid;</span><br><span class="line">        this.time = time;</span><br><span class="line">        this.longitude = longitude;</span><br><span class="line">        this.latitude = latitude;</span><br><span class="line">        this.speed = speed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public TaxiDetails() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2新建Mapper用于与数据库交互"><a href="#2新建Mapper用于与数据库交互" class="headerlink" title="2新建Mapper用于与数据库交互"></a>2新建Mapper用于与数据库交互</h3><p>  新建MyMapper  interface 集成TKMybatis包下的Mapper 接口及MySqlMapper接口代码如下图所示：</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689129329637.png" alt="img"></p>
<p>新建TaxiMapper，TaxiDetailsMapper继承MyMapper并且添加@Mapper注解使其注册到SpringContext容器中交由容器管理如图所示：</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689129335284.png" alt="img"></p>
<h3 id="3查询业务封装"><a href="#3查询业务封装" class="headerlink" title="3查询业务封装"></a>3查询业务封装</h3><p>  在domain层做具体的查询业务封装如下图：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689129345275.png" alt="img"></p>
<p>其中@Service注解与@Mapper注解功能相似，将TaxiService类注册到SpringContext交由容器管理</p>
<p>其中@Autowired注解是将容器中的bean注入本类，自动完成装配</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Example example = new Example(Taxi.class);</span><br><span class="line">       example.createCriteria().andEqualTo(&quot;carid&quot;, carid);</span><br><span class="line">       return this.taxiMapper.selectByExample(example);</span><br></pre></td></tr></table></figure>

<p>selectByExample方法继承TKMybatis包中，TKMybatis也提供的其他的curd方法</p>
<h3 id="4提供Api查询接口"><a href="#4提供Api查询接口" class="headerlink" title="4提供Api查询接口"></a>4提供Api查询接口</h3><p>  代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">package com.cstor.carplatform.api;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import com.cstor.carplatform.domain.TaxiService;</span><br><span class="line">import com.cstor.carplatform.model.ExpGather;</span><br><span class="line">import com.cstor.carplatform.model.Taxi;</span><br><span class="line">import com.cstor.carplatform.model.TaxiDetails;</span><br><span class="line">import com.cstor.carplatform.model.TaxiExceptionVO;</span><br><span class="line">import com.cstor.carplatform.util.RspBuilder;</span><br><span class="line">import io.swagger.annotations.ApiImplicitParam;</span><br><span class="line">import io.swagger.annotations.ApiImplicitParams;</span><br><span class="line">import io.swagger.annotations.ApiOperation;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.http.ResponseEntity;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">import static java.util.stream.Collectors.groupingBy;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Description:</span><br><span class="line"> * 接口文档访问地址：http://serverIP:port/swagger-ui.html</span><br><span class="line"> * Date: 2021/10/15  15:21【需求编号】</span><br><span class="line"> *</span><br><span class="line"> * @author clam</span><br><span class="line"> * @version V1.0.0</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@RestController</span><br><span class="line">@CrossOrigin</span><br><span class="line">@RequestMapping(&#123;&quot;/api/taxi&quot;&#125;)</span><br><span class="line">public class CarDealApi &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private TaxiService taxiService;</span><br><span class="line"></span><br><span class="line">    /**定义栅栏经纬度区域*/</span><br><span class="line">    private static final Double MAXLATITUDE =40.077;</span><br><span class="line">    private static final Double MINLATITUDE =39.271;</span><br><span class="line">    private static final Double MAXLONGITUDE =116.784;</span><br><span class="line">    private static final Double MINLONGITUDE =115.576;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(&quot;查询车辆&quot;)</span><br><span class="line">    @ApiImplicitParams(&#123;@ApiImplicitParam(</span><br><span class="line">            paramType = &quot;query&quot;,</span><br><span class="line">            name = &quot;carId&quot;,</span><br><span class="line">            value = &quot;车牌号&quot;,</span><br><span class="line">            required = true,</span><br><span class="line">            dataType = &quot;int&quot;</span><br><span class="line">    )&#125;)</span><br><span class="line">    @RequestMapping(path = &quot;/getListTaxiByCarId&quot;, method = RequestMethod.POST)</span><br><span class="line">    public JSONObject getListTaxiByCarId(@RequestParam(&quot;carId&quot;) Integer carId) &#123;</span><br><span class="line">        if (carId == null) &#123;</span><br><span class="line">            return RspBuilder.formatFailResult (&quot;参数不全&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            List&lt;Taxi&gt; listTaxi = this.taxiService.getListTaxiByCarid (carId);</span><br><span class="line">            return RspBuilder.createSuccessRsp ( ).append (&quot;listTaxi&quot;, listTaxi).build ( );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(&quot;查询车辆详细轨迹&quot;)</span><br><span class="line">    @ApiImplicitParams(&#123;@ApiImplicitParam(</span><br><span class="line">            paramType = &quot;query&quot;,</span><br><span class="line">            name = &quot;carId&quot;,</span><br><span class="line">            value = &quot;车牌号&quot;,</span><br><span class="line">            required = true,</span><br><span class="line">            dataType = &quot;int&quot;</span><br><span class="line">    )&#125;)</span><br><span class="line">    @RequestMapping(path = &quot;/getDetailsListTaxiByCarId&quot;, method = RequestMethod.POST)</span><br><span class="line">    public JSONObject getDetailListTaxiByCarId(@RequestParam(&quot;carId&quot;) Integer carId) &#123;</span><br><span class="line">        if (carId == null) &#123;</span><br><span class="line">            return RspBuilder.formatFailResult (&quot;参数不全&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            List&lt;TaxiDetails&gt; listTaxi = this.taxiService.getDetailsListTaxiByCarid (carId);</span><br><span class="line">            return RspBuilder.createSuccessRsp ( ).append (&quot;listTaxi&quot;, listTaxi).build ( );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(path = &quot;/queryTaxiExceptionByCarId&quot;, method = RequestMethod.POST)</span><br><span class="line">    public JSONObject queryTaxiExceptionByCarId(@RequestParam(&quot;carId&quot;) Integer carId) &#123;</span><br><span class="line">        if (carId == null) &#123;</span><br><span class="line">            return RspBuilder.formatFailResult (&quot;参数不全&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            List&lt;TaxiExceptionVO&gt; taxiExceptionVOS = new ArrayList&lt;&gt; ( );</span><br><span class="line">            List&lt;TaxiDetails&gt; listTaxi = this.taxiService.getDetailsListTaxiByCarid (carId);</span><br><span class="line">            List&lt;TaxiDetails&gt; listTaxi2 = listTaxi.stream ( ).filter (a -&gt; a.getSpeed ( ) &gt; 55).collect (Collectors.toList ( ));</span><br><span class="line">            listTaxi2.forEach (a -&gt; &#123;</span><br><span class="line">                        TaxiExceptionVO taxiExceptionVO = new TaxiExceptionVO ( );</span><br><span class="line">                        taxiExceptionVO.setExceptiontype (&quot;超速预警&quot;);</span><br><span class="line">                        taxiExceptionVO.setLatitude (a.getLatitude ( ));</span><br><span class="line">                        taxiExceptionVO.setLongitude (a.getLongitude ( ));</span><br><span class="line">                        taxiExceptionVO.setCarid (a.getCarid ( ));</span><br><span class="line">                        taxiExceptionVO.setSpeed (a.getSpeed ( ));</span><br><span class="line">                        SimpleDateFormat ds = new SimpleDateFormat (&quot;yyyy-MM-dd,HH时mm秒ss毫秒&quot;);</span><br><span class="line">                        taxiExceptionVO.setTime (ds.format (a.getTime ( )));</span><br><span class="line">                        taxiExceptionVOS.add (taxiExceptionVO);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">            );</span><br><span class="line">            Map&lt;TaxiDetails, Long&gt; collect = listTaxi.stream ( ).collect (groupingBy (taxiDetail -&gt; new TaxiDetails (taxiDetail.getCarid ( ), taxiDetail.getLongitude ( ), taxiDetail.getLatitude ( )),</span><br><span class="line">                    Collectors.counting ( )</span><br><span class="line">            ));</span><br><span class="line">            collect.forEach ((taxiDetails, count) -&gt; &#123;</span><br><span class="line">                if (count &gt; 2) &#123;</span><br><span class="line">                    TaxiExceptionVO taxiExceptionVO = new TaxiExceptionVO ( );</span><br><span class="line">                    taxiExceptionVO.setExceptiontype (&quot;异常徘徊&quot;);</span><br><span class="line">                    taxiExceptionVO.setCarid (taxiDetails.getCarid ( ));</span><br><span class="line">                    taxiExceptionVO.setLatitude (taxiDetails.getLatitude ( ));</span><br><span class="line">                    taxiExceptionVO.setLongitude (taxiDetails.getLongitude ( ));</span><br><span class="line">                    taxiExceptionVOS.add (taxiExceptionVO);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            return RspBuilder.createSuccessRsp ( ).append (&quot;taxiExceptionVOS&quot;, taxiExceptionVOS).build ( );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @ApiOperation(&quot;查询车辆异常聚集情况&quot;)</span><br><span class="line">    @RequestMapping(path = &quot;/taxiAbnormaAccumulation&quot;, method = RequestMethod.POST)</span><br><span class="line">    public JSONObject taxiAbnormaAccumulation() &#123;</span><br><span class="line"></span><br><span class="line">            List&lt;TaxiDetails&gt; listTaxi = this.taxiService.selectAll ();</span><br><span class="line"></span><br><span class="line">            return RspBuilder.createSuccessRsp ( ).append (&quot;listTaxi&quot;, listTaxi).build ( );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(&quot;查询车辆栅栏预警&quot;)</span><br><span class="line">    @RequestMapping(path = &quot;/taxiFenceWarning&quot;, method = RequestMethod.POST)</span><br><span class="line">    public JSONObject taxiFenceWarning() &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;ExpGather&gt; expGathers = this.taxiService.selectAllExpGather ();</span><br><span class="line"></span><br><span class="line">        return RspBuilder.createSuccessRsp ( ).append (&quot;list&quot;, expGathers).build ( );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(&quot;处理出租车轨迹数据文件接口&quot;)</span><br><span class="line">    @RequestMapping(path = &quot;/dealfile&quot;, method = RequestMethod.POST)</span><br><span class="line">    public ResponseEntity&lt;String&gt; dealFile(@RequestParam(&quot;myFile&quot;) MultipartFile myFile) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        String result = &quot;上传成功&quot;;</span><br><span class="line">        InputStream inputStream = myFile.getInputStream ( );</span><br><span class="line">        taxiService.dealFile (inputStream);</span><br><span class="line"></span><br><span class="line">        return ResponseEntity.ok (result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(&quot;sparkstream启动器&quot;)</span><br><span class="line">    @RequestMapping(path = &quot;/sparkstreamLuach&quot;, method = RequestMethod.POST)</span><br><span class="line">    public ResponseEntity&lt;String&gt; sparkstreamLuach() throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        String result = &quot;启动成功&quot;;</span><br><span class="line"></span><br><span class="line">        taxiService.launch ( );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        return ResponseEntity.ok (result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5配置数据库信息"><a href="#5配置数据库信息" class="headerlink" title="5配置数据库信息"></a>5配置数据库信息</h3><p>  在resource下的application.properties配置数据据库信息代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url=jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai&amp;allowMultiQueries=true&amp;amp</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=root</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span><br><span class="line">spring.datasource.name=druid</span><br></pre></td></tr></table></figure>

<h3 id="6测试Api接口"><a href="#6测试Api接口" class="headerlink" title="6测试Api接口"></a>6测试Api接口</h3><p>启动项目后打开接口文档访问地址：<a href="http://serverIP:port/swagger-ui.html；调用如下两个接口">http://serverIP:port/swagger-ui.html；调用如下两个接口</a><br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689129359782.png" alt="img"></p>
<h2 id="64-项目实训-出租车运营调度管控平台-前后端对接"><a href="#64-项目实训-出租车运营调度管控平台-前后端对接" class="headerlink" title="64.项目实训-出租车运营调度管控平台-前后端对接"></a>64.项目实训-出租车运营调度管控平台-前后端对接</h2><blockquote>
<h3 id="目的-5"><a href="#目的-5" class="headerlink" title="目的"></a>目的</h3><p>1.部署springboot项目</p>
<p>2.部署前端</p>
<h3 id="要求-5"><a href="#要求-5" class="headerlink" title="要求"></a>要求</h3><p>本次实验后，要求学生能：</p>
<p>1.可以部署springboot项目</p>
<p>2.可以使用httpd服务进行部署前端项目</p>
<p>3.可以理解前端如何发送请求至服务器</p>
<h3 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h3><p>浏览器是请求方 A ，百度网站就是应答方 B。双方约定用 HTTP 协议来通信，于是浏览器把请求数据发送给网站，网站再把一些数据返回给浏览器，最后由浏览器渲染在屏幕，就可以看到图片、视频了。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132173852.png" alt="img"></p>
<p>前端程序采用Vue编写，什么是vue，它是做什么的？</p>
<p>Vue.js是一款流行的JavaScript前端框架，旨在更好地组织与简化Web开发。</p>
<ul>
<li>Vue所关注的核心是MVC模式中的视图层，同时，它也能方便地获取数据更新，并通过组件内部特定的方法实现视图与模型的交互。</li>
<li>通俗的来讲，vue就是一个已经搭建好的空屋，与单纯使用jQuery这种库比，可以更好地实现代码复用，减少工作量；、</li>
<li>与Angular.js这种家具电器一应俱全的框架相比又不会一件件挑选，把自己不喜欢再一件件的扔了，甚至required 必须用且耗费空间的！</li>
<li>简而言之，vue做了必须的事，又不会做职责之外的事。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132229415.png" alt="img"></li>
</ul>
</blockquote>
<h3 id="1springboot的maven项目打包"><a href="#1springboot的maven项目打包" class="headerlink" title="1springboot的maven项目打包"></a>1springboot的maven项目打包</h3><p> 我们可以看到pom.xml文件中的标签如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;net.alchim31.maven&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;scala-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.2.2&lt;/version&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">                &lt;execution&gt;</span><br><span class="line">                    &lt;id&gt;compile-scala&lt;/id&gt;</span><br><span class="line">                    &lt;phase&gt;process-resources&lt;/phase&gt;</span><br><span class="line">                    &lt;goals&gt;</span><br><span class="line">                        &lt;goal&gt;add-source&lt;/goal&gt;</span><br><span class="line">                        &lt;goal&gt;compile&lt;/goal&gt;</span><br><span class="line">                    &lt;/goals&gt;</span><br><span class="line">                &lt;/execution&gt;</span><br><span class="line">                &lt;execution&gt;</span><br><span class="line">                    &lt;id&gt;scala-compile-first&lt;/id&gt;</span><br><span class="line">                    &lt;phase&gt;compile&lt;/phase&gt;</span><br><span class="line">                    &lt;goals&gt;</span><br><span class="line">                        &lt;goal&gt;add-source&lt;/goal&gt;</span><br><span class="line">                        &lt;goal&gt;testCompile&lt;/goal&gt;</span><br><span class="line">                    &lt;/goals&gt;</span><br><span class="line">                &lt;/execution&gt;</span><br><span class="line">            &lt;/executions&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">                &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;mainClass&gt;com.cstor.carplatform.CarPlatFormApplication&lt;/mainClass&gt;　　&lt;!-- springboot的启动类全路径 --&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">                &lt;execution&gt;</span><br><span class="line">                    &lt;goals&gt;</span><br><span class="line">                        &lt;goal&gt;repackage&lt;/goal&gt;</span><br><span class="line">                    &lt;/goals&gt;</span><br><span class="line">                &lt;/execution&gt;</span><br><span class="line">            &lt;/executions&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>

<p>由于本项目中既有java代码，又有Scala代码，Java代码中引用了Scala代码，因此要确保Scala代码优先编译，因此引入scala-maven-plugin的jar包，</p>
<p>代码中的mainClass需要指定 springboot的启动类全路径因此根据自己的项目目录填写；</p>
<p>maven项目打包很简单如下图所示：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132267539.png" alt="img"></p>
<p>点击idea右侧栏的Maven，再点击项目下的Lifecycle的package按钮就可以了，如下图所示则打包成功，打包后的jar包在红色框路径<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132296579.png" alt="img"></p>
<p>把carplatform-1.0-SNAPSHOT.jar包上传到master节点&#x2F;home目录</p>
<p>执行nohup java -jar carplatform-1.0-SNAPSHOT.jar &amp; 启动项目</p>
<p>执行 tail -f nohup.out如图所示则证明后端启动成功<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132316128.png" alt="img"></p>
<h3 id="2了解httpd"><a href="#2了解httpd" class="headerlink" title="2了解httpd"></a>2了解httpd</h3><p> 什么是httpd？</p>
<p>httpd是Apache超文本传输协议(HTTP)服务器的主程序。被设计为一个独立运行的后台进程，它会建立一个处理请求的子进程或线程的池。</p>
<p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">yum -y install httpd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">service  httpd start</span><br></pre></td></tr></table></figure>

<p>把前端项目car.zip解压到放到&#x2F;var&#x2F;www 目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line"> mv car.zip /var/www</span><br><span class="line"> unzip car.zip</span><br><span class="line"> cd /var/www/html</span><br><span class="line"> vim index.html</span><br></pre></td></tr></table></figure>

<p>根据实际情况修改ip地址和端口如下图所示：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132330642.png" alt="img"><br>在浏览器输入ip地址，显示如下：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132337299.png" alt="img"><br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132349691.png" alt="img"></p>
<p>查看到本页面代表部署成功</p>
<h2 id="65-项目实训-出租车运营调度管控平台-环境搭建及springboot脚手架搭建"><a href="#65-项目实训-出租车运营调度管控平台-环境搭建及springboot脚手架搭建" class="headerlink" title="65.项目实训-出租车运营调度管控平台-环境搭建及springboot脚手架搭建"></a>65.项目实训-出租车运营调度管控平台-环境搭建及springboot脚手架搭建</h2><blockquote>
<h3 id="目的-6"><a href="#目的-6" class="headerlink" title="目的"></a>目的</h3><p>1.了解本项目实训需求以及整体架构<br>2.搭建本项目实训所需的环境<br>3.搭建springboot项目脚手架</p>
<h3 id="要求-6"><a href="#要求-6" class="headerlink" title="要求"></a>要求</h3><p>本次实验后，要求学生能：</p>
<p>1.理解出租车运营调度管控平台整体架构</p>
<p>2.本地jdk环境配置</p>
<p>3.maven环境的搭建</p>
<p>4.ScalaSDK的配置</p>
<p>5.搭建redis</p>
<p>6.kafka环境的搭建</p>
<p>7.Spark环境的搭建</p>
<p>8.springboot项目搭建</p>
<h3 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h3><p><strong>需求分析</strong></p>
<p>​         本平台利用Kafka和Spark Streaming框架设计的分布式交通流数据处理平台的系统架构如下图所示, 包括数据传输部分、Kafka消息订阅系统、数据处理程序、以及数据存储部分.</p>
<p>​          Kafka消息系统, 将数据汇集成数据流. Kafka消息系统将不同类型的数据分散在不同的Topic中; 并根据不同的业务处理需求, 将数据转发到Spark Streaming集群中不同的处理模块中进行处理.</p>
<p>​        数据处理程序, 运行在Spark Streaming集群上, 是系统的核心模块;  以Kafka消息系统作为数据输入流进行实时处理. Spark Streaming从Kafka消息队列中按照时间窗口不断提取数据,  然后进行业务处理, 本文主要包括轨迹数据统计和异常数据清洗。</p>
<p>​        数据存储部分, 对处理的结果数据进行存储. 当数据经过数据处理程序完成数据拼接、统计和异常数据清洗处理后, 需要针对不同的处理结果采用不同的存储方式, 主要有关系型数据库 MySQL库Key-Value数据库Redis中。</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131513059.png" alt="img"></p>
<p><strong>项目架构</strong></p>
<p>我们的项目架构主要分为五个部分：</p>
<p>（1）Kafka：作为出租车运营调度管控平台的消息系统，将数据汇集成数据流转发</p>
<p>​    到SparkStreaming集群。</p>
<p>（2）SparkStreaming：从Kafka消息队列中按照时间窗口不断提取数据, 然后进行业务处理, 本文主要包括轨迹数据统计和异常数据清洗</p>
<p>（3）Redis：负责出租车轨迹数据。</p>
<p>（4）Springboot：对外提供服务，提供对外服务。</p>
<p>（5）数据展示：前端使用Vue进行编写，使用httpd部署前端，展现出租车运行轨迹。</p>
</blockquote>
<h3 id="1-Idea中MAVEN安装与配置"><a href="#1-Idea中MAVEN安装与配置" class="headerlink" title="1 Idea中MAVEN安装与配置"></a>1 Idea中MAVEN安装与配置</h3><h4 id="下载Maven"><a href="#下载Maven" class="headerlink" title="下载Maven"></a>下载Maven</h4><p>下载maven，官网地址：<a target="_blank" rel="noopener" href="http://maven.apache.org/download.cgi">http://maven.apache.org/download.cgi</a></p>
<h4 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h4><p>解压压缩包。将解压后的目录配置成环境变量</p>
<p>新建环境变量M2_HOME</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131538497.png" alt="img"></p>
<p>在path中加入bin路径：;%M2_HOME%\bin<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131548647.png" alt="img"></p>
<p>测试是否成功，打开命令行，输入mvn -v,能出现信息就说明ok。</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131556674.png" alt="img"></p>
<h3 id="2-配置Maven本地仓库"><a href="#2-配置Maven本地仓库" class="headerlink" title="2 配置Maven本地仓库"></a>2 配置Maven本地仓库</h3><p>   在D盘中创建D:\maven\repository文件夹。并更改已下载的D:\apache-maven-3.5.3\conf中settings.xml文件，在文件中加入：D:\maven\repository</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131604575.png" alt="img"></p>
<h4 id="配置idea的Maven环境"><a href="#配置idea的Maven环境" class="headerlink" title="配置idea的Maven环境"></a>配置idea的Maven环境</h4><p> 回到  IDEA<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131624440.png" alt="img"><br>检查和选中maven目录</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131634312.png" alt="img"></p>
<p>将Maven home diretory换成本地配置的maven地址：D:\apache-maven-3.5.3</p>
<p>将User setting file换成本地配置的地址：D:\apache-maven-3.5.3\conf\settings.xml</p>
<p>将Local repository换成本地maven仓库地址：D:\maven\repository</p>
<p>至此，idea的maven配置完成</p>
<h3 id="3-配置idea的Scala环境"><a href="#3-配置idea的Scala环境" class="headerlink" title="3 配置idea的Scala环境"></a>3 配置idea的Scala环境</h3><p>1.我们可以直接在Idea工具上下载</p>
<p>File——settings——plugins，输入Scala搜索（下图是我已经安装好了）<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131645939.png" alt="img"></p>
<p>，如果搜索不到，点击下面的“Browse repositories”</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131658188.png" alt="img"><br>就可以看到。点击“Scala （Languages）”对应的install，不过一般情况下，这种下载很慢，很难成功。所以就点击这个对应的网站链接去用浏览器或迅雷去下载，进入网页，所下的</p>
<p>版本号一定要和我用蓝色圈标记的一样，要不然安装不成功。</p>
<p>下载完之后，是一个zip包，不用解压缩</p>
<p>直接可用，如下图File——settings——plugins点击“Install plugin from disk”，<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131685482.png" alt="img"></p>
<p>2.安装ScalaSDK<br>File——projectstructure——GlobalLibiries<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131696763.png" alt="img"><br>点击+号，Scala SDK 点击Download 选择对应的版本2.1.1，下完以后点击OK<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131707557.png" alt="img"></p>
<h3 id="4-配置本机的java环境变量"><a href="#4-配置本机的java环境变量" class="headerlink" title="4 配置本机的java环境变量"></a>4 配置本机的java环境变量</h3><p>变量名：JAVA_HOME<br>变量值：电脑上JDK安装的绝对路径<br>变量名：CLASSPATH<br>变量值：.;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar;<br>变量名：Path<br>变量值：%JAVA_HOME%\bin<br>%JAVA_HOME%\jre\bin</p>
<h3 id="5-redis安装"><a href="#5-redis安装" class="headerlink" title="5 redis安装"></a>5 redis安装</h3><p> redis安装目录&#x2F;usr&#x2F;cstor&#x2F;redis&#x2F; ，进行编译，然后安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cd /usr/cstor/redis/ </span><br><span class="line">make MALLOC=libc</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>修改redis配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">vim redis.conf</span><br></pre></td></tr></table></figure>

<p><strong>注释127.0.0.1</strong>      （bind指定网段才能连接redis，如果bind注释掉，那会接受所有来自于可用网络接口的连接）<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131813504.png" alt="img"><br><strong>protected-mode 设置成no</strong>（默认是设置成yes的， 防止了远程访问）<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131820951.png" alt="img"><br><strong>daemonize参数改为yes</strong> （允许后台执行）<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131840711.png" alt="img"><br><em>开启aof持久化</em><br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131852152.png" alt="img"><br>启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">./src/redis-server redis.conf #执行src目录下redis-server  指定配置文件redis.conf</span><br></pre></td></tr></table></figure>

<h3 id="6-kafka环境的搭建"><a href="#6-kafka环境的搭建" class="headerlink" title="6 kafka环境的搭建"></a>6 kafka环境的搭建</h3><p>   安装docker-compose</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">sudo curl -L &quot;https://get.daocloud.io/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line">chmod +x/usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p> 新建文件夹docker-kafka</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">mkdir docker-kafka</span><br><span class="line">cd docker-kafka</span><br></pre></td></tr></table></figure>

<p>编辑docker-compose.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">version: &#x27;3.3&#x27;</span><br><span class="line">services:</span><br><span class="line">  zookeeper:</span><br><span class="line">    image: wurstmeister/zookeeper</span><br><span class="line">    container_name: zookeeper</span><br><span class="line">    ports:</span><br><span class="line">      - 2181:2181</span><br><span class="line">    volumes:</span><br><span class="line">      - /data/zookeeper/data:/data</span><br><span class="line">      - /data/zookeeper/datalog:/datalog</span><br><span class="line">      - /data/zookeeper/logs:/logs</span><br><span class="line">    restart: always</span><br><span class="line">  kafka1:</span><br><span class="line">    image: wurstmeister/kafka</span><br><span class="line">    depends_on:</span><br><span class="line">      - zookeeper</span><br><span class="line">    container_name: kafka1</span><br><span class="line">    ports:</span><br><span class="line">      - 9092:9092</span><br><span class="line">    environment:</span><br><span class="line">      KAFKA_BROKER_ID: 1</span><br><span class="line">      KAFKA_ZOOKEEPER_CONNECT: 192.168.56.101:2181</span><br><span class="line">      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://192.168.56.101:9092</span><br><span class="line">      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092</span><br><span class="line">      KAFKA_LOG_DIRS: /data/kafka-data</span><br><span class="line">      KAFKA_LOG_RETENTION_HOURS: 24</span><br><span class="line">    volumes:</span><br><span class="line">      - /data/kafka1/data:/data/kafka-data</span><br><span class="line">    restart: unless-stopped  </span><br><span class="line">  kafka2:</span><br><span class="line">    image: wurstmeister/kafka</span><br><span class="line">    depends_on:</span><br><span class="line">      - zookeeper</span><br><span class="line">    container_name: kafka2</span><br><span class="line">    ports:</span><br><span class="line">      - 9093:9093</span><br><span class="line">    environment:</span><br><span class="line">      KAFKA_BROKER_ID: 2</span><br><span class="line">      KAFKA_ZOOKEEPER_CONNECT: 192.168.56.101:2181</span><br><span class="line">      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://192.168.56.101:9093</span><br><span class="line">      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9093</span><br><span class="line">      KAFKA_LOG_DIRS: /data/kafka-data</span><br><span class="line">      KAFKA_LOG_RETENTION_HOURS: 24</span><br><span class="line">    volumes:</span><br><span class="line">      - /data/kafka2/data:/data/kafka-data</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">  kafka3:</span><br><span class="line">    image: wurstmeister/kafka</span><br><span class="line">    depends_on:</span><br><span class="line">      - zookeeper</span><br><span class="line">    container_name: kafka3</span><br><span class="line">    ports:</span><br><span class="line">      - 9094:9094</span><br><span class="line">    environment:</span><br><span class="line">      KAFKA_BROKER_ID: 3</span><br><span class="line">      KAFKA_ZOOKEEPER_CONNECT: 192.168.56.101:2181</span><br><span class="line">      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://192.168.56.101:9094</span><br><span class="line">      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9094</span><br><span class="line">      KAFKA_LOG_DIRS: /data/kafka-data</span><br><span class="line">      KAFKA_LOG_RETENTION_HOURS: 24</span><br><span class="line">    volumes:</span><br><span class="line">      - /data/kafka3/data:/data/kafka-data</span><br><span class="line">    restart: unless-stopped</span><br></pre></td></tr></table></figure>

<p> 启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">undefined</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>查看服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">docker ps </span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131939937.png" alt="img"><br>可以看到kafka服务启动成功</p>
<h3 id="7-Spark环境的搭建"><a href="#7-Spark环境的搭建" class="headerlink" title="7 Spark环境的搭建"></a>7 Spark环境的搭建</h3><p> 新建文件夹spark-kafka</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir spark-kafka</span><br><span class="line">cd spark-kafka</span><br></pre></td></tr></table></figure>

<p>编辑docker-compose.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;2&quot;</span><br><span class="line">services:</span><br><span class="line">  master:</span><br><span class="line">    image: singularities/spark</span><br><span class="line">    command: start-spark master</span><br><span class="line">    hostname: master</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;6066:6066&quot;</span><br><span class="line">      - &quot;7070:7070&quot;</span><br><span class="line">      - &quot;8080:8080&quot;</span><br><span class="line">      - &quot;50070:50070&quot;</span><br><span class="line">  worker:</span><br><span class="line">    image: singularities/spark</span><br><span class="line">    command: start-spark worker master</span><br><span class="line">    environment:</span><br><span class="line">      SPARK_WORKER_CORES: 1</span><br><span class="line">      SPARK_WORKER_MEMORY: 2g</span><br><span class="line">    links:</span><br><span class="line">      - master</span><br></pre></td></tr></table></figure>

<p>在当前目录下执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>显示<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131954488.png" alt="img"></p>
<p>在执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<p>显示<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131964212.png" alt="img"><br>spark容器已启动</p>
<p>浏览器访问：http:&#x2F;{docker_host}:50070<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131975700.png" alt="img"></p>
<p>搭建成功</p>
<h3 id="8-springboot项目搭建"><a href="#8-springboot项目搭建" class="headerlink" title="8 springboot项目搭建"></a>8 springboot项目搭建</h3><p>  （1）file-&gt;new-&gt;project</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689131990676.png" alt="img"><br>（2）点击next（第一个）<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132000241.png" alt="img"><br>填写Group，Artifact等信息，点击next</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132010248.png" alt="img"></p>
<p>（3）点击next</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132016736.png" alt="img"></p>
<p>（4）点击finish，<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132023559.png" alt="img"></p>
<p>新建项目完成</p>
<p>建立如下项目结构：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1689132032257.png" alt="img"><br>api：对外提供api接口</p>
<p>domain：平台的业务处理层</p>
<p>mapper：数据层，写对应的sql语句或者是映射好的方法名</p>
<p>model：用来存放实体类</p>
<p>scala：sparkstreaming相关业务处理</p>
<p>utils：工具类</p>
<p>pom.xml：管理maven相关依赖</p>
<p>resources：放置配置文件</p>
<h2 id="66-项目实训-股票行情实时仿真数据平台-需求分析及前置环境准备"><a href="#66-项目实训-股票行情实时仿真数据平台-需求分析及前置环境准备" class="headerlink" title="66.项目实训-股票行情实时仿真数据平台-需求分析及前置环境准备"></a>66.项目实训-股票行情实时仿真数据平台-需求分析及前置环境准备</h2><blockquote>
<h3 id="目的-7"><a href="#目的-7" class="headerlink" title="目的"></a>目的</h3><p>1.准备本次项目实训所需环境<br>2.了解本次项目海量股票数据的采集，清洗，挖掘，分析，内容输出的需求</p>
<h3 id="要求-7"><a href="#要求-7" class="headerlink" title="要求"></a>要求</h3><p>本次实验后，要求学生能：</p>
<p>1.了解项目需求<br>2.了解项目整体流程<br>3.搭建基础的环境</p>
<h3 id="原理-7"><a href="#原理-7" class="headerlink" title="原理"></a>原理</h3><p><strong>需求分析：</strong></p>
<p>本次金融项目是把股票tick数据，绘制成股票看板(分时图和k线图)，以便于动态分析股价的走势。<br><strong>我们的项目结构主要分为四个部分：</strong><br>（1）Hive数仓：在数仓中分层存储数据并对数据进行采集、清洗、聚合。<br>（2）redis：负责存储Hive数仓ADS层数据，提供高速读写，并对数据进程二次加工。<br>（3）WebSocket+Servlet：负责采集redis数据，放入到Tomcat中，提供对外服务。<br>（4）数据展示：前端使用Vue进行编写，使用httpd部署前端，对日线和K线进行展示。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286480137.png" alt="img"><br><strong>版本选择</strong><br>本次项目涉及多个组件、那么我们就需要考虑各个组件之间的兼容性，这里我们采用以下版本：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286485935.png" alt="img"></p>
</blockquote>
<h3 id="1-了解股票概念"><a href="#1-了解股票概念" class="headerlink" title="1 了解股票概念"></a>1 了解股票概念</h3><p>  要想做出下图的效果，那么在此之前，我们需要了解一些股票的基础知识。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286492888.png" alt="img"><br>分时图：分时图是指大盘和个股的动态实时（即时）分时走势图，其在实战研判中的地位极其重要，是即时把握多空力量转化即市场变化直接的根本所在。所依赖数据包含(时间、成交价、昨日结算价)</p>
<p>k线图：股市及期货市场中的K线图的画法包含四个数据，即开盘价、最高价、最低价、收盘价，所有的k线都是围绕这四个数据展开，反映大势的状况和价格信息。</p>
<p>MA5：MA是移动平均线的意思 是简单的算数平均线。MA5指股票五日均线值，MA10指股票10日均线值，MA30指股票30日均线值。</p>
<p>买一：这一时刻委托买入的单子中，价格最高的那些笔的集合笔数与价格 。</p>
<p>卖一：这一时刻委托卖出的单子中，最低价格的那些笔的集合笔数与价格</p>
<p>最新：股票最近一笔的成交价格。</p>
<p>开盘：股票开盘的价格，也就是股票当天的第一笔成交的价格。</p>
<p>收盘：股票收盘的价格，也就是股票当天的最后一笔成交的价格。</p>
<p>现手：某一股票即时的成交量。对于最近成交的一笔成交量也称现手。</p>
<p><strong>什么是股票tick数据？</strong></p>
<p>tick就是交易所每只股票没有被撮合成交的买、卖的单情况。</p>
<p><strong>我们这里把数据导入到我们环境中，这里我放到home目录，解压</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cd /home</span><br><span class="line">unzip expdata.zip</span><br></pre></td></tr></table></figure>

<p>我们查看一下股票Tick数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">head -n 10 /home/flnancial/data/001/SZ000001_20210506.csv</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286502928.png" alt="img"><br>这里可以看到数据的格式，每个数据间使用 ，隔开</p>
<p>字段包含：市场代码,证券代码,时间,最新价,成交笔数,成交额,成交量,方向,买一价,买二价,买三价,买四价,买五价,卖一价,卖二价,卖三价,卖四价,卖五价,买一量,买二量,买三量,买四量,买五量,卖一量,卖二量,卖三量,卖四量,卖五量</p>
<p>而我们最后构建的看板(分时图和k线图)所需要的数据都包含在这里了。</p>
<h3 id="2-配置hive"><a href="#2-配置hive" class="headerlink" title="2 配置hive"></a>2 配置hive</h3><p>Hive是依赖于HDFS的，但是在启动HDFS与Hive前，我们要做一些配置，以便Hive允许远程连接。</p>
<p>进入 &#x2F;usr&#x2F;cstor&#x2F;hadoop&#x2F;etc&#x2F;hadoop&#x2F; 目录，修改core-site.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cd  /usr/cstor/hadoop/etc/hadoop/ </span><br><span class="line">vim core-site.xml</span><br></pre></td></tr></table></figure>

<p>添加以下内容用于配置root用户访问hadoop</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xml</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.proxyuser.root.hosts&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;*&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.proxyuser.root.groups&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;*&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<p>如果已经启动hadoop，那需要重新启动，如果没有，那就直接启动</p>
<p>关闭Hdfs和Yarn</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cd /usr/cstor/hadoop/sbin</span><br><span class="line">./stop-all.sh</span><br></pre></td></tr></table></figure>

<p>通过jps命令查看主节点进程，可以看到还有一个ResourceManager进程没有杀掉，用kill -9 加上进程号杀死</p>
<p>启动Hdfs和Yarn</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cd /usr/cstor/hadoop/sbin</span><br><span class="line">./start-dfs.sh</span><br><span class="line">./start-yarn.sh</span><br></pre></td></tr></table></figure>

<p>接下来配置hiveserver2（用于提供hive对外连接）</p>
<p>进入到 &#x2F;usr&#x2F;cstor&#x2F;hive&#x2F;conf ，创建hive-site.xml ，添加以下配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">xml</span><br><span class="line">cd /usr/cstor/hive/conf</span><br><span class="line">vim hive-site.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hive.server2.thrift.port&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;10000&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;master&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p>注意：环境中hive使用的是内嵌模式部署，那么运行hive会在当前目录生成一个derby文件和一个metastore_db目录。这种存储方式的弊端是在同一个目录下同时只能有一个hive客户端能使用数据库，所以我们使用hive客户端的时候，就不能开启hiveserver2服务，开启了hiveserver2服务，就不能使用hive客户端。</p>
<p>进入到hive目录，启动hive</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cd /usr/cstor/hive </span><br><span class="line">hive</span><br></pre></td></tr></table></figure>

<p>使用show databases; 可以看到默认的数据库名，此时hive配置完毕<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286515300.png" alt="img"></p>
<h3 id="3-步骤三：配置redis"><a href="#3-步骤三：配置redis" class="headerlink" title="3 步骤三：配置redis"></a>3 步骤三：配置redis</h3><p>  <strong>Redis 简介</strong></p>
<p>Redis 是完全开源的，遵守 BSD 协议，是一个高性能的 key-value 数据库。</p>
<p>Redis 与其他 key - value 缓存产品有以下三个特点：</p>
<ul>
<li>Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</li>
<li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</li>
<li>Redis支持数据的备份，即master-slave模式的数据备份</li>
</ul>
<p><strong>Redis 优势</strong></p>
<ul>
<li>性能极高 – Redis能读的速度是110000次&#x2F;s,写的速度是81000次&#x2F;s 。</li>
<li>丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</li>
<li>原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。</li>
<li>丰富的特性 – Redis还支持 publish&#x2F;subscribe, 通知, key 过期等等特性。</li>
</ul>
<p>本项目中，我们使用redis存储数据，来进行实时读取。</p>
<p>redis安装目录&#x2F;usr&#x2F;cstor&#x2F;redis&#x2F; ，进行编译，然后安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cd /usr/cstor/redis/ </span><br><span class="line">make MALLOC=libc</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>修改redis配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">vim redis.conf</span><br></pre></td></tr></table></figure>

<p><strong>注释127.0.0.1</strong>      （bind指定网段才能连接redis，如果bind注释掉，那会接受所有来自于可用网络接口的连接）<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693287549591.png" alt="img"><br><strong>protected-mode 设置成no</strong>（默认是设置成yes的， 防止了远程访问）<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693287555758.png" alt="img"><br><strong>daemonize参数改为yes</strong> （允许后台执行）<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693287563608.png" alt="img"><br><strong>开启aof持久化</strong><br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693287569209.png" alt="img"><br>启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">./src/redis-server redis.conf #执行src目录下redis-server  指定配置文件redis.conf</span><br></pre></td></tr></table></figure>

<p>通过以下命令可以查看redis是否启动<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693287856333.png" alt="img"></p>
<h3 id="4-配置httpd"><a href="#4-配置httpd" class="headerlink" title="4 配置httpd"></a>4 配置httpd</h3><p>  Web代理服务器工作在Web客户端与Web服务器之间，他负责接收来自客户端的http请求，并将其转发至对应的服务；而后接收来自于服务器的响应，并将响应报文回送至客户端。</p>
<p><strong>什么是httpd？</strong></p>
<p>httpd是一个开源软件，且一般用作web服务器来使用。目前最流行的web服务器软件叫做httpd，<br>在早期的http server就叫做apache，到了http server 2.0以后就改名为httpd了。<br>所以有时候听到apache服务器和httpd服务器其实都是指得是一个意思。</p>
<p><strong>httpd传统风格特性：</strong></p>
<ol>
<li>在进程控制上通常是<strong>事先创建进程</strong>；Web服务器响应用户模型有多种，多进程&#x2F;多线程是一个用户请求使用一个进程来响应，因此如果接收到多个用户请求后再进行创建进程速度会比较慢；所以Apache事先把进程启动作为空闲进程；</li>
<li>事先创建的进程是有数目要求的，有一种适应性叫<strong>按需维持适当的进程</strong>；如：启动500个进程响应500个请求，若500个请求中有400个请求都完成了，那么400个进程都空闲下来了，但不能让进程都空闲下来，因此当空闲太多时需要将空闲的进程一一销毁，直到满足我们所应该维持的最小或最大进程数为止；</li>
<li>**模块化设计（即只具备核心功能），其核心比较小，各种功能都通过模块来进行添加，支持运行时配置，支持单独编译模块。**这些模块可以在运行时启用，类似于Linux内核，平时只启用其核心功能，用到额外的功能时，只需要将额外的功能的模块装载进来即可，同时需要注意的是我们在用到哪个模块的功能时，可以单独编译对应的模块。甚至包括PHP都可以通过模块的方式装载进httpd，Apache与PHP结合有很多种方式，模块化就是比较常见的一种，也是RedHat系列服务器上默认的一种；</li>
<li>**支持多种方式的虚拟主机配置。**我们在此处简单引入一下虚拟主机的概念：如果需要提供Web服务，那就需要有一台物理服务器，并且在服务器上需要运行Web服务器进程，当客户端请求时，这个进程要能够予以响应。而若我们要在互联网上建一台Web服务器，能够提供个人或公司的站点，需要有一台物理服务器、需要IP地址、并且要保证实时能够在线、能够被互联网上的主机所访问，那这需要的资源会非常多，并且如果访问的用户非常少，会造成非常大的资源浪费。因此可以通过提供虚拟主机的方式提供站点。</li>
<li>**支持https协议。**通过mod_ssl模块支持。</li>
<li><strong>支持基于IP或主机名的ACL。</strong></li>
<li>**支持目录的访问控制。**用户访问主站点的时候不用提供账号密码，但是访问某一特殊路径路径时，就需要提供账号密码。</li>
<li>**支持URL重写。**如：本来访问的是&#x2F;image&#x2F;a.jpg但却可以重写成&#x2F;bbs&#x2F;images&#x2F;abc.jpeg，而这对于客户端来讲是透明的，可以在服务器上将这种内容统统转发到另外一个路径上重新访问。</li>
</ol>
<p><strong>接下来进行安装部署</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">yum -y install httpd</span><br></pre></td></tr></table></figure>

<p>安装成功以后启动httpd</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cd /usr/sbin</span><br><span class="line">./apachectl</span><br></pre></td></tr></table></figure>

<p>查看master节点ip地址</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288292069.png" alt="img"><br>在浏览器中输入ip地址(要连接vpn)</p>
<p>查看到此页面，代表启动成功，映射的前端路径在&#x2F;var&#x2F;www&#x2F;html下<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288298844.png" alt="img"></p>
<h3 id="5-配置Tomcat"><a href="#5-配置Tomcat" class="headerlink" title="5 配置Tomcat"></a>5 配置Tomcat</h3><p>  <strong>什么是javaweb？</strong></p>
<p>Java Web，是用Java技术来解决相关web互联网领域的技术总和。<br>web包括：web服务器和web客户端两部分。<br>Java在客户端的应用有java applet，不过使用得很少，Java在服务器端的应用非常的丰富，比 如Servlet，JSP和第三方框架等等。<br>Java技术对Web领域的发展注入了强大的动力。<br>javaweb开发是基于请求和响应的：<br>请求：浏览器（客户端）向服务器发送信息<br>响应：服务器向（客户端）浏览器回送信息</p>
<p><strong>常见web服务器</strong></p>
<p>1）weblogic：oracle公司的大型收费web服务器支持全部javaEE规范<br>2）websphere：IBM公司的大型收费web服务器支持全部的javaEE规范<br>3）Tomcat：Apache开源组织下的 开源免费的中小型的web应用服务器支持javaEE中的servlet 和jsp规范 </p>
<p><strong>Tomcat</strong></p>
<p>Tomcat是由Apache开发的一个Servlet容器，实现了对Servlet和JSP的支持，并提供了作为Web服务器的一些特有功能，并且完全免费。</p>
<p><strong>tomcat的安装目录介绍</strong><br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288312733.png" alt="img"><br>bin：可以执行文件 脚本目录<br>        启动脚本：startup.bat<br>        停止脚本：shutdown.bat<br>conf：配置文件目录 (config &#x2F;configuration)<br>        核心配置文件：server.xml<br>        用户权限配置文件：tomcat-users.xml<br>        所有web项目默认配置文件：web.xml<br>lib：依赖库，tomcat和web项目中需要使用的jar包<br>logs：日志文件.<br>temp：临时文件目录，文件夹内内容可以任意删除。 </p>
<p>webapps：实际项目存在的位置</p>
<p>work：存放运行时的一些文件</p>
<p><strong>修改tomcat的默认端口号</strong></p>
<p>我们使用tomcat提供服务，需要配置端口号、可访问该端口的地址。</p>
<p>在&#x2F;usr&#x2F;cstor&#x2F;tomcat&#x2F;conf目录下，修改配置文件server.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cd /usr/cstor/tomcat/conf</span><br><span class="line">vim server.xml</span><br></pre></td></tr></table></figure>

<p>找到<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288322486.png" alt="img"><br>这里可以看到默认端口是7080，我们可以修改该值来自定义端口号(不要与已经开放的端口冲突即可)</p>
<p>添加address&#x3D;”0.0.0.0”，来指定任何地址都可以访问7080端口的服务。</p>
<p>暂时不用启动tomcat</p>
<blockquote>
<p>了解股票基本概念，熟悉项目流程以及数据源，会安装部署项目所需组件</p>
</blockquote>
<h2 id="67-项目实训-股票行情实时仿真数据平台-搭建数据仓库"><a href="#67-项目实训-股票行情实时仿真数据平台-搭建数据仓库" class="headerlink" title="67.项目实训-股票行情实时仿真数据平台-搭建数据仓库"></a>67.项目实训-股票行情实时仿真数据平台-搭建数据仓库</h2><blockquote>
<h3 id="目的-8"><a href="#目的-8" class="headerlink" title="目的"></a>目的</h3><p>1.了解什么是数据数仓<br>2.了解数据数仓分层</p>
<h3 id="要求-8"><a href="#要求-8" class="headerlink" title="要求"></a>要求</h3><p>本次实验后，要求学生能：<br>1.可以理解数据数仓分层<br>2.可以根据业务进行维度建模<br>3.使用窗口函数</p>
<h3 id="原理-8"><a href="#原理-8" class="headerlink" title="原理"></a>原理</h3><p><strong>什么是数据仓库？</strong></p>
<p>数据仓库，英文名称为Data  Warehouse，可简写为DW或DWH。数据仓库，是为企业所有级别的决策制定过程，提供所有类型数据支持的战略集合。它出于分析性报告和决策支持目的而创建。为需要业务智能的企业，提供指导业务流程改进、监视时间、成本、质量以及控制。</p>
<p><strong>数据库和数据仓库有什么区别？</strong></p>
<p>1.数据是面向事务处的，数据是由日常的业务产生的，常更新；数据仓库是面向主题的,数据来源于数据库或文件，经过一定的规则转换得到，用来分析的。</p>
<p>2.数据库一般是用来存储当前交易数据,数据仓库存储一般存储的是历史数据。</p>
<p>3.数据库的设计一般是符合三范式的，有最大的精确度和最小的冗余度，有利于数据的插入; .数据仓库的设计一般是星型的，有利于查询。</p>
<p><strong>构建数仓</strong><br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288364464.png" alt="img"><br>这里在数仓中设计了五层用于存储数据，启动包括：</p>
<p>ODS层：原始数据层，存放原始数据，直接加载原始日志、数据，数据保持原貌不做处理</p>
<p>DIM层：维度层，保存维度数据，主要是对业务事实的描述信息，例如何人，何时，何地等</p>
<p>DWD层：明细数据层，对ODS层数据进行清洗（去除空值，脏数据，超过极限范围的数据）、脱敏等</p>
<p>DWS层：服务数据层，以DWD层为基础，按天进行汇总</p>
<p>ADS层：为各种统计报表提供数据</p>
<p><strong>为什么要进行分层？</strong></p>
<ol>
<li>把复杂问题简单化：将复杂的任务分解成多层来完成，每一层只处理简单的任务，方便定位问题。</li>
<li>减少重复开发：规范数据分层，通过中间层数据，能够减少极大的重复计算，增加一次计算结果的复用性。</li>
<li>隔离原始数据：不论是数据的异常还是数据的敏感性，使真实数据与统计数据解耦开。</li>
</ol>
</blockquote>
<h3 id="1-搭建ODS层"><a href="#1-搭建ODS层" class="headerlink" title="1 搭建ODS层"></a>1 搭建ODS层</h3><p>  ODS层：原始数据层，存放原始数据，直接加载原始日志、数据，数据保持原貌不做处理。</p>
<p><strong>案例需求</strong>：创建ods_tick表，把Tick数据导入至表中，股票的Tick数据，放置在&#x2F;home&#x2F;flnancial&#x2F;data&#x2F;001。</p>
<p><strong>实现步骤：</strong></p>
<p>我们再查看一下股票Tick数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">head -n 10 /home/flnancial/data/001/SZ000001_20210506.csv</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288384872.png" alt="img"><br>字段包含：市场代码,证券代码,时间,最新价,成交笔数,成交额,成交量,方向,买一价,买二价,买三价,买四价,买五价,卖一价,卖二价,卖三价,卖四价,卖五价,买一量,买二量,买三量,买四量,买五量,卖一量,卖二量,卖三量,卖四量,卖五量</p>
<p>由于ods层保存的是原始数据，那么我们直接按照文件的字段来构建ods_tick表，但是要<strong>注意没个字段之间用，隔开，并且表头也不需要</strong></p>
<p>创建数据库stock，选中数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">create database stock comment &#x27;股票&#x27;;</span><br><span class="line">use stock;</span><br></pre></td></tr></table></figure>

<p>创建ods_tick表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">CREATE EXTERNAL TABLE ods_tick(</span><br><span class="line">`market_code` string comment &#x27;市场代码&#x27;,</span><br><span class="line">`stock_code` string comment &#x27;证券代码&#x27;,</span><br><span class="line">`time` string comment &#x27;时间&#x27;,</span><br><span class="line">`latest_price` DECIMAL(16,2) comment &#x27;最新价&#x27;,</span><br><span class="line">`trading_number` BIGINT  comment &#x27;成交笔数&#x27;,</span><br><span class="line">`trading_volume` BIGINT  comment &#x27;成交额&#x27;,</span><br><span class="line">`trading_amount` BIGINT  comment &#x27;成交量&#x27;,</span><br><span class="line">`direction` string comment &#x27;方向&#x27;,</span><br><span class="line">`buy1_price` DECIMAL(16,2) comment &#x27;买一价&#x27;,</span><br><span class="line">`buy2_price` DECIMAL(16,2) comment &#x27;买二价&#x27;,</span><br><span class="line">`buy3_price` DECIMAL(16,2) comment &#x27;买三价&#x27;,</span><br><span class="line">`buy4_price` DECIMAL(16,2) comment &#x27;买四价&#x27;,</span><br><span class="line">`buy5_price` DECIMAL(16,2) comment &#x27;买五价&#x27;,</span><br><span class="line">`sell1_price` DECIMAL(16,2) comment &#x27;卖一价&#x27;,</span><br><span class="line">`sell2_price` DECIMAL(16,2) comment &#x27;卖二价&#x27;,</span><br><span class="line">`sell3_price` DECIMAL(16,2) comment &#x27;卖三价&#x27;,</span><br><span class="line">`sell4_price` DECIMAL(16,2) comment &#x27;卖四价&#x27;,</span><br><span class="line">`sell5_price` DECIMAL(16,2) comment &#x27;卖五价&#x27;,</span><br><span class="line">`buy1_amount` BIGINT comment &#x27;买一量&#x27;,</span><br><span class="line">`buy2_amount` BIGINT comment &#x27;买二量&#x27;,</span><br><span class="line">`buy3_amount` BIGINT comment &#x27;买三量&#x27;,</span><br><span class="line">`buy4_amount` BIGINT comment &#x27;买四量&#x27;,</span><br><span class="line">`buy5_amount` BIGINT comment &#x27;买五量&#x27;,</span><br><span class="line">`sell1_amount` BIGINT comment &#x27;卖一量&#x27;,</span><br><span class="line">`sell2_amount` BIGINT comment &#x27;卖二量&#x27;,</span><br><span class="line">`sell3_amount` BIGINT comment &#x27;卖三量&#x27;,</span><br><span class="line">`sell4_amount` BIGINT comment &#x27;卖四量&#x27;,</span><br><span class="line">`sell5_amount` BIGINT comment &#x27;卖五量&#x27;</span><br><span class="line">) </span><br><span class="line">COMMENT &#x27;成交信息表&#x27;</span><br><span class="line">partitioned by(createDate string)</span><br><span class="line">ROW FORMAT DELIMITED FIELDS TERMINATED BY &#x27;,&#x27;</span><br><span class="line">tblproperties(&quot;skip.header.line.count&quot;=&quot;1&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>属性分析：</strong></p>
<p>partitioned by(createDate string) : 根据日期对数据进行分区，这样我们在对某一日进行查询的时候可以避免全表扫描。</p>
<p>ROW FORMAT DELIMITED FIELDS TERMINATED BY ‘,’ ：由于我们的数据是，隔开，所以我们读取文件的时候按照，分割</p>
<p>tblproperties(“skip.header.line.count”&#x3D;”1”) ：数据的第一行是表头，我们不需要此行数据所以跳过第一行</p>
<p><strong>导入数据</strong></p>
<p>我们的数据存储在&#x2F;home&#x2F;flnancial&#x2F;data&#x2F;001目录下，有多个文件。</p>
<p>导入数据至ods_tick表，我们可以使用load命令，但是一次只能导入一个文件，要想全部导入要编写大量命令</p>
<p>在这里提供使用shell脚本来编写加载命令，减少工作量</p>
<p>在开一个shell窗口，进入到&#x2F;home 目录，我们编写脚本文件 loadDatas.sh，帮助我们批量编写load语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cd /home</span><br><span class="line">vim loadDatas.sh</span><br></pre></td></tr></table></figure>

<p>添加以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">#!/bin/bash</span><br><span class="line">#1. 判断参数个数</span><br><span class="line">if [ $# -lt 2 ]</span><br><span class="line">then</span><br><span class="line">  echo Not Enough Arguement!</span><br><span class="line">  exit;</span><br><span class="line">fi</span><br><span class="line">#2.遍历指定目录，并获取文件名包含csv 所有文件的绝对路径，进行遍历</span><br><span class="line">files=`find $1 | grep csv`</span><br><span class="line">for name in $files</span><br><span class="line">do</span><br><span class="line">        #获取文件名加后缀</span><br><span class="line">        index=$(awk -v a=&quot;$name&quot; -v b=&quot;_&quot; &#x27;BEGIN&#123;print index(a,b)&#125;&#x27;)</span><br><span class="line">        #去掉后缀获取文件名</span><br><span class="line">        createDate=$&#123;name:index:8&#125;</span><br><span class="line">        #拼接导入语句，按照时间分区，并且输出到指定目录</span><br><span class="line">        echo &quot;load data local inpath &#x27;$name&#x27;  into table stock.ods_tick partition(createDate=&#x27;$createDate&#x27;);&quot;  &gt;&gt; $2</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>添加执行权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">chmod +x loadDatas.sh</span><br></pre></td></tr></table></figure>

<p>执行脚本，该脚本有两个参数，第一个参数为股票tick数据目录 ，第二个为load语句输出目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">./loadDatas.sh /home/flnancial/data/001 /home/test.txt</span><br></pre></td></tr></table></figure>

<p>查看test.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cat /home/test.txt</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288406201.png" alt="img"><br>可以看到load命令已经批量生成成功，接下来就是把这些语句<strong>复制到hive中执行</strong>。</p>
<p>验证是否导入成功，执行下面的sql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">select * from ods_tick;</span><br></pre></td></tr></table></figure>

<p>可以查询到数据，代表导入成功</p>
<h3 id="2-搭建DIM层"><a href="#2-搭建DIM层" class="headerlink" title="2 搭建DIM层"></a>2 搭建DIM层</h3><p>  DIM层：维度层，保存维度数据，主要是对业务事实的描述信息，例如何人，何时，何地等</p>
<p>**案例需求：**根据ods_tick表结构进行拆分，通过星型模型构建DIM层逻辑表 与  DWD层事实表</p>
<p>在搭建DIM层与DWD层之前，我们需要先了解一些维度建模的知识。</p>
<p><strong>构建模型的两种方式：关系建模与维度建模</strong></p>
<p><strong>关系建模</strong></p>
<p>关系建模将复杂的数据抽象为两个概念——实体和关系，并使用规范化的方式表示出来。关系模型如图所示，从图中可以看出，较为松散、零碎，物理表数量多。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288417392.png" alt="img"><br>关系模型严格遵循第三范式（3NF），数据冗余程度低，数据的一致性容易得到保证。由于数据分布于众多的表中，查询会相对复杂，在大数据的场景下，查询效率相对较低。</p>
<p><strong>维度建模</strong></p>
<p>维度模型如图所示，从图中可以看出，模型相对清晰、简洁。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288424920.png" alt="img"><br>维度模型以数据分析作为出发点，不遵循三范式，故数据存在一定的冗余。维度模型面向业务，将业务用事实表和维度表呈现出来。表结构简单，故查询简单，查询效率较高。</p>
<p><strong>那么什么是维度表与事实表？</strong></p>
<p><strong>维度表</strong></p>
<p>维度表：一般是对事实的描述信息。每一张维表对应现实世界中的一个对象或者概念。   例如：用户、商品、日期、地区等。</p>
<p>维表的特征：</p>
<ul>
<li>维表的范围很宽（具有多个属性、列比较多）</li>
<li>跟事实表相比，行数相对较小：通常&lt; 10万条</li>
<li>内容相对固定：编码表</li>
</ul>
<p><strong>事实表</strong></p>
<p>事实表中的每行数据代表一个业务事件（交易等）。“事实”这个术语表示的是业务事件的度量值（可统计次数、个数、金额等）</p>
<p>例如，2020年5月21日，宋宋老师在京东花了250块钱买了一瓶海狗人参丸。</p>
<p>维度表：时间、用户、商品、商家。</p>
<p>事实表：250块钱、一瓶</p>
<p>每一个事实表的行包括：具有可加性的数值型的度量值、与维表相连接的外键，通常具有两个和两个以上的外键。</p>
<p>事实表的特征：</p>
<ul>
<li>非常的大</li>
<li>内容相对的窄：列数较少（主要是外键id和度量值）</li>
<li>经常发生变化，每天会新增加很多。</li>
</ul>
<p><strong>如何进行维度建模？</strong></p>
<p>在维度建模的基础上主要分为两种模型：星型模型、雪花模型。</p>
<p><strong>星型模型</strong></p>
<p>星型模型：是一种多维的数据关系，它由一个事实表（Fact Table）和一组维表（Dimension  Table）组成。每个维表都有一个维作为主键，所有这些维的主键组合成事实表的主键。事实表的非主键属性称为事实（Fact），它们一般都是数值或其他可以进行计算的数据；如下图：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288434872.png" alt="img"><br><strong>雪花模型</strong></p>
<p>雪花型模型：当有一个或多个维表没有直接连接到事实表上，而是通过其他维表连接到事实表上时，其图解就像多个雪花连接在一起，故称雪花模型。雪花模型是对星型模型的扩展。它对星型模型的维表进一步层次化，原有的各维表可能被扩展为小的事实表，形成一些局部的 “层次 “ 区域，这些被分解的表都连接到主维度表而不是事实表。</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288442437.png" alt="img"><br>区别：雪花模型与星型模型的区别主要在于维度的层级，标准的星型模型维度只有一层，而雪花模型可能会涉及多级。</p>
<p>模型的选择：星型还是雪花，取决于性能优先，还是灵活更优先。目前实际企业开发中，不会绝对选择一种，根据情况灵活组合，甚至并存(一层维度和多层维度都保存）。但是整体来看，更倾向于维度更少的星型模型。尤其是Hadoop体系，减少Join就是减少Shuffle，性能差距很大。(关系型数据可以依靠强大的主键索引)</p>
<p><strong>构建维度表</strong></p>
<p>DIM层DWD层需构建维度模型，这里采用星型模型，维度建模一般按照以下四个步骤：</p>
<p>选择业务过程→声明粒度→确认维度→确认事实</p>
<p><strong>(1)选择业务过程</strong></p>
<p>在业务系统中，挑选感兴趣的业务线，在本项目中Tick数据代表买卖情况，那么我们挑选的业务线就是交易业务，一条业务线对应一张事实表。</p>
<p><strong>(2)声明粒度</strong></p>
<p>数据粒度指数据仓库的数据中保存数据的细化程度或综合程度的级别。</p>
<p>声明粒度意味着精确定义事实表中的一行数据表示什么，应该尽可能选择最小粒度，以此来应各种各样的需求。</p>
<p>本项目粒度声明如下：</p>
<p>交易事实表中一行数据表示的是一个股票中的一秒的交易信息。</p>
<p><strong>(3)确定维度</strong></p>
<p>维度的主要作用是描述业务是事实，主要表示的是“谁，何处，何时”等信息。</p>
<p>确定维度的原则是：后续需求中是否要分析相关维度的指标。例如：需要统计，哪个股票什么时间内成交价格最高、最低等。</p>
<p>那么这里维度就包括：时间，股票信息</p>
<p><strong>(4)确定事实</strong></p>
<p>此处的“事实”一词，指的是业务中的度量值，例如最新价、交易额、成交笔数等</p>
<p>根据上述四步，构建的星型模型为：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288451655.png" alt="img"><br><strong>接下来根据星型模型来构建，股票信息维度表和时间维度表</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">CREATE EXTERNAL TABLE dim_category (</span><br><span class="line">`location` STRING COMMENT &#x27;股票交易地点&#x27;,</span><br><span class="line">`code` STRING COMMENT &#x27;股票交易编号&#x27;,</span><br><span class="line">`name` STRING COMMENT &#x27;股票名称&#x27;</span><br><span class="line">) COMMENT &#x27;股票信息表&#x27;</span><br><span class="line">ROW FORMAT DELIMITED FIELDS TERMINATED BY &#x27;\t&#x27;;</span><br><span class="line">sql</span><br><span class="line">CREATE EXTERNAL TABLE dim_date (</span><br><span class="line">`date_id` STRING COMMENT &#x27;日&#x27;,</span><br><span class="line">`week_id` STRING COMMENT &#x27;周ID&#x27;,</span><br><span class="line">`week_day` STRING COMMENT &#x27;周几&#x27;,</span><br><span class="line">`day` STRING COMMENT &#x27;每月的第几天&#x27;,</span><br><span class="line">`month` STRING COMMENT &#x27;第几月&#x27;,</span><br><span class="line">`quarter` STRING COMMENT &#x27;第几季度&#x27;,</span><br><span class="line">`year` STRING COMMENT &#x27;年&#x27;,</span><br><span class="line">`is_workday` STRING COMMENT &#x27;是否是工作日&#x27;,</span><br><span class="line">`holiday_id` STRING COMMENT &#x27;节假日&#x27;</span><br><span class="line">) COMMENT &#x27;时间维度表&#x27;</span><br><span class="line">ROW FORMAT DELIMITED FIELDS TERMINATED BY &#x27;\t&#x27;;</span><br></pre></td></tr></table></figure>

<p>由于股票信息和时间具有可预见性，通常情况下不是来自业务系统。</p>
<p>我们提前准备了两个维度表的数据在&#x2F;home&#x2F;expdata&#x2F;data&#x2F;目录下，stockCategory.txt 和 time.txt</p>
<p>直接导入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">load data local inpath &#x27;/home/expdata/data/time.txt&#x27;  into table stock.dim_date;</span><br><span class="line">load data local inpath &#x27;/home/expdata/data/stockCategory.txt&#x27;  into table stock.dim_category;</span><br></pre></td></tr></table></figure>

<p>检查是否导入成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">select * from dim_date;</span><br><span class="line">select * from dim_category;</span><br></pre></td></tr></table></figure>

<h3 id="3-搭建DWD层"><a href="#3-搭建DWD层" class="headerlink" title="3 搭建DWD层"></a>3 搭建DWD层</h3><p>  DWD层：对ODS层进行数据清洗(去除空值。脏数据，超过极限范围的数据)等,保存业务事实明细</p>
<p>**案例需求：**对ODS层表进行数据清洗</p>
<ol>
<li>清洗空值：清洗字段为null的数据</li>
<li>清洗重复数据</li>
<li>清洗非法数据：对于所有的业务字段不在合法区间内的数据进行清洗，凡是小于0的数值均为非法数据</li>
</ol>
<p>在DIM层我们构建了股票交易事实表，我们根据下图创建事实表<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288465190.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">CREATE TABLE dwd_tick(</span><br><span class="line">`stock_code` string comment &#x27;证券代码&#x27;,</span><br><span class="line">`time` string comment &#x27;时间&#x27;,</span><br><span class="line">`latest_price` DECIMAL(16,2) comment &#x27;最新价&#x27;,</span><br><span class="line">`trading_number` BIGINT  comment &#x27;成交笔数&#x27;,</span><br><span class="line">`trading_volume` BIGINT  comment &#x27;成交额&#x27;,</span><br><span class="line">`trading_amount` BIGINT  comment &#x27;成交量&#x27;,</span><br><span class="line">`direction` string comment &#x27;方向&#x27;,</span><br><span class="line">`buy1_price` DECIMAL(16,2) comment &#x27;买一价&#x27;,</span><br><span class="line">`buy2_price` DECIMAL(16,2) comment &#x27;买二价&#x27;,</span><br><span class="line">`buy3_price` DECIMAL(16,2) comment &#x27;买三价&#x27;,</span><br><span class="line">`buy4_price` DECIMAL(16,2) comment &#x27;买四价&#x27;,</span><br><span class="line">`buy5_price` DECIMAL(16,2) comment &#x27;买五价&#x27;,</span><br><span class="line">`sell1_price` DECIMAL(16,2) comment &#x27;卖一价&#x27;,</span><br><span class="line">`sell2_price` DECIMAL(16,2) comment &#x27;卖二价&#x27;,</span><br><span class="line">`sell3_price` DECIMAL(16,2) comment &#x27;卖三价&#x27;,</span><br><span class="line">`sell4_price` DECIMAL(16,2) comment &#x27;卖四价&#x27;,</span><br><span class="line">`sell5_price` DECIMAL(16,2) comment &#x27;卖五价&#x27;,</span><br><span class="line">`buy1_amount` BIGINT comment &#x27;买一量&#x27;,</span><br><span class="line">`buy2_amount` BIGINT comment &#x27;买二量&#x27;,</span><br><span class="line">`buy3_amount` BIGINT comment &#x27;买三量&#x27;,</span><br><span class="line">`buy4_amount` BIGINT comment &#x27;买四量&#x27;,</span><br><span class="line">`buy5_amount` BIGINT comment &#x27;买五量&#x27;,</span><br><span class="line">`sell1_amount` BIGINT comment &#x27;卖一量&#x27;,</span><br><span class="line">`sell2_amount` BIGINT comment &#x27;卖二量&#x27;,</span><br><span class="line">`sell3_amount` BIGINT comment &#x27;卖三量&#x27;,</span><br><span class="line">`sell4_amount` BIGINT comment &#x27;卖四量&#x27;,</span><br><span class="line">`sell5_amount` BIGINT comment &#x27;卖五量&#x27;</span><br><span class="line">) </span><br><span class="line">COMMENT &#x27;成交事实表&#x27;</span><br><span class="line">partitioned by(createDate string);</span><br></pre></td></tr></table></figure>

<p>接下来就是对数据清洗并导入数据<br><strong>清洗空值</strong></p>
<p>数据中的关键字段 最新价、成交笔数、成交额、成交量等可能存在空值，需要清洗掉这些空值数据</p>
<p>创建临时表 tmp_notNull 用于存储清洗空值后的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">CREATE TABLE tmp_notNull as select * from ods_tick </span><br><span class="line">where latest_price is not null or trading_volume is not null or buy1_price is not null or buy2_price is not null or buy3_price is not null or buy4_price is not null or buy5_price is not null or sell1_price is not null or sell2_price is not null or sell3_price is not null or sell4_price is not null or sell5_price is not null;</span><br></pre></td></tr></table></figure>

<p><strong>清洗重复数据</strong></p>
<p>创建临时表 tmp_notRepeat 用于存储去重后的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">CREATE TABLE tmp_notRepeat as select distinct * from tmp_notNull;</span><br></pre></td></tr></table></figure>

<p><strong>清洗非法数据</strong></p>
<p>对于所有的业务字段不在合法区间内的数据进行清洗，凡是小于0的数值均为非法数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">CREATE TABLE tmp_notIllegality as select * from tmp_notRepeat</span><br><span class="line">where latest_price&gt;0 or trading_number&gt;0 or trading_volume&gt;0 or trading_amount&gt;0 or buy1_price&gt;0  or buy2_price&gt;0  or buy3_price&gt;0</span><br><span class="line">or buy4_price&gt;0  or buy5_price&gt;0 or sell1_price&gt;0 or sell2_price&gt;0 or sell3_price&gt;0 or sell4_price&gt;0 or sell5_price&gt;0 </span><br><span class="line">or buy1_amount&gt;0 or buy2_amount&gt;0 or buy3_amount&gt;0 or buy4_amount&gt;0 or buy5_amount&gt;0</span><br><span class="line">or sell1_amount&gt;0 or sell2_amount&gt;0 or sell3_amount&gt;0 or sell4_amount&gt;0 or sell5_amount&gt;0;</span><br></pre></td></tr></table></figure>

<p>数据清洗完毕之后导入数据至dwd_tick表</p>
<p><strong>注意</strong>：往hive分区表中插入数据时，如果需要创建的分区很多，比如以表中某个字段进行分区存储，则需要复制粘贴修改很多sql去执行，效率低。因为hive是批处理系统，所以hive提供了一个动态分区功能，其可以基于查询参数的位置去推断分区的名称，从而建立分区。</p>
<p>开启动态分区</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">set hive.exec.dynamic.partition=true; </span><br><span class="line">set hive.exec.dynamic.partition.mode=nonstrick;</span><br></pre></td></tr></table></figure>

<p>插入数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">insert into table dwd_tick partition(createdate) </span><br><span class="line">select </span><br><span class="line">stock_code,</span><br><span class="line">`time`,</span><br><span class="line">latest_price,</span><br><span class="line">trading_number,</span><br><span class="line">trading_volume,</span><br><span class="line">trading_amount,</span><br><span class="line">direction,</span><br><span class="line">buy1_price,</span><br><span class="line">buy2_price,</span><br><span class="line">buy3_price,</span><br><span class="line">buy4_price,</span><br><span class="line">buy5_price,</span><br><span class="line">sell1_price,</span><br><span class="line">sell2_price,</span><br><span class="line">sell3_price,</span><br><span class="line">sell4_price,</span><br><span class="line">sell5_price,</span><br><span class="line">buy1_amount,</span><br><span class="line">buy2_amount,</span><br><span class="line">buy3_amount,</span><br><span class="line">buy4_amount,</span><br><span class="line">buy5_amount,</span><br><span class="line">sell1_amount,</span><br><span class="line">sell2_amount,</span><br><span class="line">sell3_amount,</span><br><span class="line">sell4_amount,</span><br><span class="line">sell5_amount,</span><br><span class="line">createdate </span><br><span class="line">from tmp_notIllegality;</span><br></pre></td></tr></table></figure>

<p>最后删除掉临时表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">DROP TABLE IF EXISTS tmp_notNull;</span><br><span class="line">DROP TABLE IF EXISTS tmp_notRepeat;</span><br><span class="line">DROP TABLE IF EXISTS tmp_notIllegality;</span><br></pre></td></tr></table></figure>

<p>验证是否插入成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">select * form dwd_tick;</span><br></pre></td></tr></table></figure>

<p>查询到数据代表成功</p>
<h3 id="4-搭建DWS层"><a href="#4-搭建DWS层" class="headerlink" title="4 搭建DWS层"></a>4 搭建DWS层</h3><p>  DWS层对DWD层数据进行汇总</p>
<p>需求：</p>
<ol>
<li>查询每个股票的  每一日的开盘价、最高价、最低价、收盘价、成交总额、成交笔数、成交总量</li>
<li>查询每个股票的  每分钟的开盘价、最高价、最低价、收盘价</li>
</ol>
<p><strong>创建成交信息统计表(天)  dws_tickStatistics_day</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">CREATE TABLE dws_tickStatistics_day(</span><br><span class="line">`stock_code` string comment &#x27;证券代码&#x27;,</span><br><span class="line">`time` string comment &#x27;时间&#x27;,</span><br><span class="line">`opening_price` DECIMAL(16,2) comment &#x27;开盘价&#x27;,</span><br><span class="line">`top_price` DECIMAL(16,2) comment &#x27;最高价&#x27;,</span><br><span class="line">`minimum_price` DECIMAL(16,2) comment &#x27;最低价&#x27;,</span><br><span class="line">`closing_price` DECIMAL(16,2) comment &#x27;收盘价&#x27;,</span><br><span class="line">`trading_number` BIGINT  comment &#x27;成交总笔数&#x27;,</span><br><span class="line">`trading_volume` BIGINT  comment &#x27;成交总额&#x27;,</span><br><span class="line">`trading_amount` BIGINT  comment &#x27;成交总量&#x27;</span><br><span class="line">) </span><br><span class="line">COMMENT &#x27;成交信息统计表(天)&#x27;;</span><br></pre></td></tr></table></figure>

<p>开盘：股票开盘的价格，也就是股票当天的第一笔成交的价格，那么就要查询当天第一笔交易信息的价格。</p>
<p>收盘：股票收盘的价格，也就是股票当天的最后一笔成交的价格，那么就要查询当天最后一笔交易信息的价格。</p>
<p>最高价、最低价、成交总笔数、成交总额、成交总量：这些可以使用聚合函数来查询</p>
<p>既然要进行聚合查询，又要查询当天第一笔和最后一笔交易价格，这里我们就需要使用到开窗函数。</p>
<p><strong>什么是开窗函数？</strong></p>
<p>普通的聚合函数聚合的行集是组,开窗函数聚合的行集是窗口。</p>
<p>因此,普通的聚合函数每组(Group by)只返回一个值，而开窗函数则可为窗口中的每行都返回一个值。</p>
<p>简单理解，就是对查询的结果多出一列，这一列可以是聚合值，也可以是排序值。</p>
<p>开窗函数一般分为两类,聚合开窗函数和排序开窗函数。</p>
<p>在本次需求中，我们要查询的是当天第一笔和最后一笔交易价格，就需要使用聚合开窗函数first_value</p>
<p>具体使用可以自行到因特网上查询，总之实现需求即可，以下是参考语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">insert into table dws_tickStatistics_day</span><br><span class="line">select </span><br><span class="line">    stock_code,</span><br><span class="line">    date_str,</span><br><span class="line">    opening_price,</span><br><span class="line">    max(latest_price),</span><br><span class="line">    min(latest_price),</span><br><span class="line">    closing_price,</span><br><span class="line">    sum(trading_number),</span><br><span class="line">    sum(trading_volume),</span><br><span class="line">    sum(trading_amount)</span><br><span class="line">from (</span><br><span class="line">    select </span><br><span class="line">        *,</span><br><span class="line">        date_format(`time`,&#x27;yyyy-MM-dd&#x27;) as date_str,</span><br><span class="line">        first_value(latest_price) over(partition by date_format(`time`,&#x27;yyyy-MM-dd&#x27;), stock_code order by `time`) as opening_price,</span><br><span class="line">        first_value(latest_price) over(partition by date_format(`time`,&#x27;yyyy-MM-dd&#x27;), stock_code order by `time` desc) as closing_price</span><br><span class="line">    from dwd_tick</span><br><span class="line">) t1</span><br><span class="line">group by date_str, stock_code, opening_price, closing_price;</span><br></pre></td></tr></table></figure>

<p>数据插入完毕后，自行根据源文件查看数据是否正确</p>
<p><strong>创建成交信息统计表(分) dws_tickStatistics_min</strong> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">CREATE TABLE dws_tickStatistics_min(</span><br><span class="line">`stock_code` string comment &#x27;证券代码&#x27;,</span><br><span class="line">`time` string comment &#x27;时间&#x27;,</span><br><span class="line">`opening_price` DECIMAL(16,2) comment &#x27;开盘价&#x27;,</span><br><span class="line">`top_price` DECIMAL(16,2) comment &#x27;最高价&#x27;,</span><br><span class="line">`minimum_price` DECIMAL(16,2) comment &#x27;最低价&#x27;,</span><br><span class="line">`closing_price` DECIMAL(16,2) comment &#x27;收盘价&#x27;</span><br><span class="line">) </span><br><span class="line">COMMENT &#x27;成交信息统计表(分钟)&#x27;;</span><br></pre></td></tr></table></figure>

<p>插入数据，这里同样是使用开窗函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">insert into table dws_tickStatistics_min</span><br><span class="line">select </span><br><span class="line">    stock_code,</span><br><span class="line">    date_str,</span><br><span class="line">    opening_price,</span><br><span class="line">    max(latest_price),</span><br><span class="line">    min(latest_price),</span><br><span class="line">    closing_price</span><br><span class="line">from (</span><br><span class="line">    select </span><br><span class="line">        *,</span><br><span class="line">        date_format(`time`,&#x27;yyyy-MM-dd HH:mm&#x27;) as date_str,</span><br><span class="line">        first_value(latest_price) over(partition by date_format(`time`,&#x27;yyyy-MM-dd HH:mm&#x27;), stock_code order by `time`) as opening_price,</span><br><span class="line">        first_value(latest_price) over(partition by date_format(`time`,&#x27;yyyy-MM-dd HH:mm&#x27;), stock_code order by `time` desc) as closing_price</span><br><span class="line">    from dwd_tick</span><br><span class="line">) t1</span><br><span class="line">group by date_str, stock_code, opening_price, closing_price;</span><br></pre></td></tr></table></figure>

<h3 id="5-搭建ADS层"><a href="#5-搭建ADS层" class="headerlink" title="5 搭建ADS层"></a>5 搭建ADS层</h3><p>  ADS层为各种统计报表提供数据</p>
<p>需求：</p>
<ol>
<li>为构建分时图、k线图做准备。需要查询股票的市场代码、证券代码、时间(年月日)、时间(时分秒)、开盘价、收盘价、最高价、最低价、方向、买一价、买二价、买三价、买四价、买五价、卖一价、卖二价、卖三价、卖四价、卖五价、买一量、买二量、买三量、买四量、买五量、卖一量、卖二量、卖三量、卖四量、卖五量</li>
</ol>
<p>这里虽然时间精确到秒，但是开盘价、收盘价、最高价、最低价填充dws_tickStatistics_min表的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">DROP TABLE IF EXISTS ads_tick;</span><br><span class="line">CREATE TABLE ads_tick(</span><br><span class="line">`stock_code` string comment &#x27;证券代码&#x27;,</span><br><span class="line">`date` string comment &#x27;时间(年月日)&#x27;,</span><br><span class="line">`time` string comment &#x27;时间(时分秒)&#x27;,</span><br><span class="line">`latest_price` DECIMAL(16,2) comment &#x27;最新价&#x27;,</span><br><span class="line">`trading_amount` BIGINT  comment &#x27;成交量&#x27;,</span><br><span class="line">`opening_price` DECIMAL(16,2) comment &#x27;开盘价&#x27;,</span><br><span class="line">`top_price` DECIMAL(16,2) comment &#x27;最高价&#x27;,</span><br><span class="line">`minimum_price` DECIMAL(16,2) comment &#x27;最低价&#x27;,</span><br><span class="line">`closing_price` DECIMAL(16,2) comment &#x27;收盘价&#x27;,</span><br><span class="line">`direction` string comment &#x27;方向&#x27;,</span><br><span class="line">`buy1_price` DECIMAL(16,2) comment &#x27;买一价&#x27;,</span><br><span class="line">`buy2_price` DECIMAL(16,2) comment &#x27;买二价&#x27;,</span><br><span class="line">`buy3_price` DECIMAL(16,2) comment &#x27;买三价&#x27;,</span><br><span class="line">`buy4_price` DECIMAL(16,2) comment &#x27;买四价&#x27;,</span><br><span class="line">`buy5_price` DECIMAL(16,2) comment &#x27;买五价&#x27;,</span><br><span class="line">`sell1_price` DECIMAL(16,2) comment &#x27;卖一价&#x27;,</span><br><span class="line">`sell2_price` DECIMAL(16,2) comment &#x27;卖二价&#x27;,</span><br><span class="line">`sell3_price` DECIMAL(16,2) comment &#x27;卖三价&#x27;,</span><br><span class="line">`sell4_price` DECIMAL(16,2) comment &#x27;卖四价&#x27;,</span><br><span class="line">`sell5_price` DECIMAL(16,2) comment &#x27;卖五价&#x27;,</span><br><span class="line">`buy1_amount` BIGINT comment &#x27;买一量&#x27;,</span><br><span class="line">`buy2_amount` BIGINT comment &#x27;买二量&#x27;,</span><br><span class="line">`buy3_amount` BIGINT comment &#x27;买三量&#x27;,</span><br><span class="line">`buy4_amount` BIGINT comment &#x27;买四量&#x27;,</span><br><span class="line">`buy5_amount` BIGINT comment &#x27;买五量&#x27;,</span><br><span class="line">`sell1_amount` BIGINT comment &#x27;卖一量&#x27;,</span><br><span class="line">`sell2_amount` BIGINT comment &#x27;卖二量&#x27;,</span><br><span class="line">`sell3_amount` BIGINT comment &#x27;卖三量&#x27;,</span><br><span class="line">`sell4_amount` BIGINT comment &#x27;卖四量&#x27;,</span><br><span class="line">`sell5_amount` BIGINT comment &#x27;卖五量&#x27;</span><br><span class="line">) </span><br><span class="line">COMMENT &#x27;成交信息表&#x27;</span><br><span class="line">partitioned by(createDate string);</span><br></pre></td></tr></table></figure>

<p>插入数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">sql</span><br><span class="line">#动态分区</span><br><span class="line">set hive.exec.dynamic.partition=true; </span><br><span class="line">set hive.exec.dynamic.partition.mode=nonstrick;</span><br><span class="line"></span><br><span class="line">insert into table ads_tick partition(createdate)</span><br><span class="line">select </span><br><span class="line">t.stock_code,</span><br><span class="line">date_format(t.`time`,&#x27;yyyy-MM-dd&#x27;),</span><br><span class="line">date_format(t.`time`,&#x27;HH:mm:ss&#x27;),</span><br><span class="line">t.latest_price,</span><br><span class="line">t.trading_amount,</span><br><span class="line">d.opening_price ,</span><br><span class="line">d.top_price ,</span><br><span class="line">d.minimum_price ,</span><br><span class="line">d.closing_price ,</span><br><span class="line">direction,</span><br><span class="line">buy1_price,</span><br><span class="line">buy2_price,</span><br><span class="line">buy3_price,</span><br><span class="line">buy4_price,</span><br><span class="line">buy5_price,</span><br><span class="line">sell1_price,</span><br><span class="line">sell2_price,</span><br><span class="line">sell3_price,</span><br><span class="line">sell4_price,</span><br><span class="line">sell5_price,</span><br><span class="line">buy1_amount,</span><br><span class="line">buy2_amount,</span><br><span class="line">buy3_amount,</span><br><span class="line">buy4_amount,</span><br><span class="line">buy5_amount,</span><br><span class="line">sell1_amount,</span><br><span class="line">sell2_amount,</span><br><span class="line">sell3_amount,</span><br><span class="line">sell4_amount,</span><br><span class="line">sell5_amount,</span><br><span class="line">createdate </span><br><span class="line">from dwd_tick t</span><br><span class="line">left join dws_tickStatistics_min d on t.stock_code = d.stock_code and d.`time` = date_format(t.`time`,&#x27;yyyy-MM-dd HH:mm&#x27;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>数仓搭建完成，接下来就是把数仓中ADS层的数据导入到redis进行实时查询</p>
</blockquote>
<h2 id="68-项目实训-股票行情实时仿真数据平台-使用数仓数据搭建缓存层"><a href="#68-项目实训-股票行情实时仿真数据平台-使用数仓数据搭建缓存层" class="headerlink" title="68.项目实训-股票行情实时仿真数据平台-使用数仓数据搭建缓存层"></a>68.项目实训-股票行情实时仿真数据平台-使用数仓数据搭建缓存层</h2><blockquote>
<h3 id="目的-9"><a href="#目的-9" class="headerlink" title="目的"></a>目的</h3><p>1.了解idea开发项目流程</p>
<p>2.了解jdbc</p>
<p>3.了解jedis</p>
<h3 id="要求-9"><a href="#要求-9" class="headerlink" title="要求"></a>要求</h3><p>本次实验后，要求学生能：</p>
<p>1.可以使用idea进行java项目的开发</p>
<p>2.可以使用jdbc对数据数仓进行操作</p>
<p>3.可以使用jedis对redis进行数据交互</p>
<p>4.可以打jar包到服务器执行</p>
<h3 id="原理-9"><a href="#原理-9" class="headerlink" title="原理"></a>原理</h3><p><strong>什么是jdbc？</strong></p>
<p>JDBC（JavaDataBase Connectivity）就是Java数据库连接，说白了就是用Java语言来操作数据库。原来我们操作数据库是在控制台使用SQL语句来操作数据库，JDBC是用Java语言向数据库发送SQL语句。</p>
<p><strong>jdbc原理？</strong></p>
<p>早期SUN公司的天才们想编写一套可以连接天下所有数据库的API，但是当他们刚刚开始时就发现这是不可完成的任务，因为各个厂商的数据库服务器差异太大了。后来SUN开始与数据库厂商们讨论，最终得出的结论是，由SUN提供一套访问数据库的规范（就是一组接口），并提供连接数据库的协议标准，然后各个数据库厂商会遵循SUN的规范提供一套访问自己公司的数据库服务器的API出现。SUN提供的规范命名为JDBC，而各个厂商提供的，遵循了JDBC规范的，可以访问自己数据库的API被称之为驱动！</p>
<p>JDBC是接口，而JDBC驱动才是接口的实现，没有驱动无法完成数据库连接！每个数据库厂商都有自己的驱动，用来连接自己公司的数据库。</p>
<p>当然还有第三方公司专门为某一数据库提供驱动，这样的驱动往往不是开源免费的！</p>
<p><strong>JDBC开发步骤</strong><br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288530989.png" alt="img"><br>  1:注册驱动&#x3D;&#x3D;&#x3D;&#x3D;&gt;数据库的驱动:不同数据库开发商为了某一种开发语言环境能够实现统一数据库调用而开发的一个程序,它的作用相当于&#x3D;&#x3D;&#x3D;一个翻译人员&#x3D;&#x3D;&#x3D;将java语言中对数据库的调用语言通过这个翻译翻译成各个种类的数据库自己的数据库语言,当然这个翻译(数据库驱动)是由各个开发商针对统一的接口自定义开发的</p>
<p>  注:数据库驱动,就是连接数据库的,直接与数据库交互的.</p>
<p>  2:获得连接</p>
<p>  3:创建执行sql语句的对象</p>
<p>  4:执行sql语句,处理结果</p>
<p>  5:关闭资源</p>
<p><strong>什么是jedis？</strong></p>
<p>讲到jedis，先来看看redis，  redis是当今基本所有互联网产品都在使用的一种提供键值对形式的内存数据库。之所以说是内存数据库，是因为redis基于内存的读取和写入相比传统的数据库基于磁盘IO快上数倍。于是乎redis在现在的应用中使用的非常广泛。主要的作用在于：<br>1、提供缓存服务，存储访问频率高的热数据防止穿透到数据库<br>2、在分布式系统中可以作为实现分布式锁的一种实现方案<br>…<br>那jedis就是集成了redis的一些命令操作，封装了redis的java客户端。提供了连接池管理。</p>
</blockquote>
<h3 id="1-配置环境变量"><a href="#1-配置环境变量" class="headerlink" title="1 配置环境变量"></a>1 配置环境变量</h3><p> **需求：**在本地windows环境下配置jdk</p>
<p>先在资料工具–》软件下载    下载jdk1.8的安装包<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288540958.png" alt="img"><br>下载完成后无脑下一步，安装完成后jdk被安装在</p>
<p>C:\Program Files\Java\jdk1.8.0_121   目录下</p>
<p>接下来配置环境变量</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288547223.png" alt="img"><br>新增系统变量<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288553317.png" alt="img"><br>点击path进行编辑<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288560501.png" alt="img"><br>新增C:\Program Files\Java\jdk1.8.0_121\bin<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288570438.png" alt="img"></p>
<h3 id="2-使用IDEA构建项目"><a href="#2-使用IDEA构建项目" class="headerlink" title="2 使用IDEA构建项目"></a>2 使用IDEA构建项目</h3><p> **需求：**在本地windows环境下配置IDEA，并且搭建项目</p>
<p>使用提供的idea安装包进行下载安装（安装包在数据文件下载中）</p>
<p>下载到电脑上后无脑下一步进行安装，安装完成后打开IDEA，进行试用<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288579262.png" alt="img"><br>创建项目<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288585254.png" alt="img"><br>点击两下next，构建项目名称，项目路径，然后点击finish<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288591436.png" alt="img"><br>接下来导入依赖jar包</p>
<p>在&#x2F;home&#x2F;financial&#x2F;redis_jars 目录下的jar包保存至本地</p>
<p>点击File，选择Project Structure</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288597961.png" alt="img"><br>点击Libraries，然后添加jar包，把保存到本地的jar包导入进去<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288603093.png" alt="img"><br>在项目列表中可以看到导入进来了<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288608889.png" alt="img"><br>在src上右键New—-》Package，按照下面目录结构构建<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288614469.png" alt="img"><br>entity：用来存放实体类</p>
<p>mapper：数据层，写对应的sql语句或者是映射好的方法名</p>
<p>service：业务服务层</p>
<p>utils：工具类</p>
<p>至此项目搭建完成</p>
<h3 id="3-使用JDBC获取数仓数据"><a href="#3-使用JDBC获取数仓数据" class="headerlink" title="3 使用JDBC获取数仓数据"></a>3 使用JDBC获取数仓数据</h3><p> **需求：**使用JDBC的方式连接hive，获取ads_tick表数据</p>
<p>根据ads_tick表，先构建实体,在entity包下创建AdsTick类，以下为参考代码，自行生成get、set方法、构造方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.entity;</span><br><span class="line"></span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line">public class AdsTick &#123;</span><br><span class="line">       /**证券代码*/</span><br><span class="line">    private String stockCode;</span><br><span class="line">    /**时间(年月日)*/</span><br><span class="line">    private String date;</span><br><span class="line">    /**时间(时分秒)*/</span><br><span class="line">    private String time;</span><br><span class="line">    /**最新价*/</span><br><span class="line">    private BigDecimal latestPrice;</span><br><span class="line">    /**开盘价*/</span><br><span class="line">    private BigDecimal openingPrice;</span><br><span class="line">    /**成交量*/</span><br><span class="line">    private Long tradingAmount;</span><br><span class="line">    /**最高价*/</span><br><span class="line">    private BigDecimal topPrice;</span><br><span class="line">    /**最低价*/</span><br><span class="line">    private BigDecimal minimumPrice;</span><br><span class="line">    /**收盘价*/</span><br><span class="line">    private BigDecimal closingPrice;</span><br><span class="line">    /**方向*/</span><br><span class="line">    private String direction;</span><br><span class="line">    /**买一价*/</span><br><span class="line">    private BigDecimal buy1Price;</span><br><span class="line">    /**买二价*/</span><br><span class="line">    private BigDecimal buy2Price;</span><br><span class="line">    /**买三价*/</span><br><span class="line">    private BigDecimal buy3Price;</span><br><span class="line">    /**买四价*/</span><br><span class="line">    private BigDecimal buy4Price;</span><br><span class="line">    /**买五价*/</span><br><span class="line">    private BigDecimal buy5Price;</span><br><span class="line">    /**卖一价*/</span><br><span class="line">    private BigDecimal sell1Price;</span><br><span class="line">    /**卖二价*/</span><br><span class="line">    private BigDecimal sell2Price;</span><br><span class="line">    /**卖三价*/</span><br><span class="line">    private BigDecimal sell3Price;</span><br><span class="line">    /**卖四价*/</span><br><span class="line">    private BigDecimal sell4Price;</span><br><span class="line">    /**卖五价*/</span><br><span class="line">    private BigDecimal sell5Price;</span><br><span class="line">    /**买一量*/</span><br><span class="line">    private Long buy1Amount;</span><br><span class="line">    /**买二量*/</span><br><span class="line">    private Long buy2Amount;</span><br><span class="line">    /**买三量*/</span><br><span class="line">    private Long buy3Amount;</span><br><span class="line">    /**买四量*/</span><br><span class="line">    private Long buy4Amount;</span><br><span class="line">    /**买五量*/</span><br><span class="line">    private Long buy5Amount;</span><br><span class="line">    /**卖一量*/</span><br><span class="line">    private Long sell1Amount;</span><br><span class="line">    /**卖二量*/</span><br><span class="line">    private Long sell2Amount;</span><br><span class="line">    /**卖三量*/</span><br><span class="line">    private Long sell3Amount;</span><br><span class="line">    /**卖四量*/</span><br><span class="line">    private Long sell4Amount;</span><br><span class="line">    /**卖五量*/</span><br><span class="line">    private Long sell5Amount;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用jdbc工具进行读取hive，在mapper包下，创建BaseDao类和Callback接口，以下代码直接复制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.mapper;</span><br><span class="line">import java.sql.*;</span><br><span class="line"></span><br><span class="line">public class BaseDao &#123;</span><br><span class="line"></span><br><span class="line">    private Connection conn = null;</span><br><span class="line">    private PreparedStatement ps = null;</span><br><span class="line">    private ResultSet rs = null;</span><br><span class="line"></span><br><span class="line">    private static final String DRIVER = &quot;org.apache.hive.jdbc.HiveDriver&quot;;</span><br><span class="line">    private static final String URL = &quot;jdbc:hive2://master:10000/stock&quot;;</span><br><span class="line">    private static final String USERNAME = &quot;root&quot;;</span><br><span class="line">    private static final String PASSWORD = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class.forName(DRIVER); // 1.加载驱动</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /** 获取连接 */</span><br><span class="line">    private void init() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            conn = DriverManager.getConnection(URL, USERNAME, PASSWORD);</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询，并通过回调函数，把查询结果封装成对象 本方法执行之后，将会释放数据库资源。调用方无需再释放</span><br><span class="line">     *</span><br><span class="line">     * @param sql      要执行的查询sql</span><br><span class="line">     * @param callback 用来封装查询结果的回调函数</span><br><span class="line">     * @param params   动态数组：sql中的?占位符对应的值</span><br><span class="line">     * @return 回调函数封装的结果</span><br><span class="line">     */</span><br><span class="line">    public &lt;T&gt; T query(String sql, Callback&lt;T&gt; callback, Object... params) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            init();</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            for (int i = 0; i &lt; params.length; i++) &#123;</span><br><span class="line">                ps.setObject(i + 1, params[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            rs = ps.executeQuery();</span><br><span class="line">            return callback.process(rs);</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 执行增删改的sql</span><br><span class="line">     *</span><br><span class="line">     * @param sql    增删改的sql</span><br><span class="line">     * @param params 动态数组：sql中的?占位符对应的值</span><br><span class="line">     * @return 影响的行数</span><br><span class="line">     */</span><br><span class="line">    public int update(String sql, Object... params) &#123;// 动态数组</span><br><span class="line">        try &#123;</span><br><span class="line">            init();</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            for (int i = 0; i &lt; params.length; i++) &#123;</span><br><span class="line">                ps.setObject(i + 1, params[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            return ps.executeUpdate();// 返回该sql影响的行数</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return -1;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 释放资源</span><br><span class="line">     */</span><br><span class="line">    public void close() &#123;</span><br><span class="line">        if (rs != null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (ps != null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                ps.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (conn != null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">java</span><br><span class="line">package com.cstor.mapper;</span><br><span class="line"></span><br><span class="line">import java.sql.ResultSet;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line"></span><br><span class="line">public interface Callback&lt;T&gt; &#123;</span><br><span class="line">    T process(ResultSet rs) throws SQLException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着我们继续在mapper层创建StockHiveMapper接口，以及StockHiveMapperImpl类(继承BaseDao实现StockHiveMapper)</p>
<p>然后在StockHiveMapper接口中声明，一个获取数据的方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.mapper;</span><br><span class="line"></span><br><span class="line">import com.cstor.entity.AdsTick;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public interface StockHiveMapper &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;AdsTick&gt; getAdsTickList();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后到StockHiveMapperImpl类中实现方法</p>
<p>这里我们创建一个回调函数，用于处理ResultSet结果集，然后使用sql语句进行查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.mapper;</span><br><span class="line"></span><br><span class="line">import com.cstor.entity.AdsTick;</span><br><span class="line"></span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line">import java.sql.ResultSet;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class StockHiveMapperImpl extends BaseDao implements StockHiveMapper &#123;</span><br><span class="line">  @Override</span><br><span class="line">    public List&lt;AdsTick&gt; getAdsTickList() &#123;</span><br><span class="line">        String sql = &quot;select * from ads_tick&quot;;</span><br><span class="line">        return query(sql,getAdsTick);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Callback&lt;List&lt;AdsTick&gt;&gt; getAdsTick = new Callback&lt;List&lt;AdsTick&gt;&gt;() &#123;</span><br><span class="line">        public List&lt;AdsTick&gt; process(ResultSet rs) throws SQLException &#123;</span><br><span class="line">            List&lt;AdsTick&gt; adsTicks = new ArrayList&lt;AdsTick&gt;();</span><br><span class="line">            while (rs.next()) &#123;</span><br><span class="line">                String stockCode = rs.getString(&quot;stock_code&quot;);</span><br><span class="line">                String date = rs.getString(&quot;date&quot;);</span><br><span class="line">                String time = rs.getString(&quot;time&quot;);</span><br><span class="line">                BigDecimal latestPrice = rs.getBigDecimal(&quot;latest_price&quot;);</span><br><span class="line">                long tradingAmount = rs.getLong(&quot;trading_amount&quot;);</span><br><span class="line"></span><br><span class="line">                BigDecimal openingPrice = rs.getBigDecimal(&quot;opening_price&quot;);</span><br><span class="line">                BigDecimal topPrice = rs.getBigDecimal(&quot;top_price&quot;);</span><br><span class="line">                BigDecimal minimumPrice = rs.getBigDecimal(&quot;minimum_price&quot;);</span><br><span class="line">                BigDecimal closingPrice = rs.getBigDecimal(&quot;closing_price&quot;);</span><br><span class="line">                String direction = rs.getString(&quot;direction&quot;);</span><br><span class="line">                BigDecimal buy1Price = rs.getBigDecimal(&quot;buy1_price&quot;);</span><br><span class="line">                BigDecimal buy2Price = rs.getBigDecimal(&quot;buy2_price&quot;);</span><br><span class="line">                BigDecimal buy3Price = rs.getBigDecimal(&quot;buy3_price&quot;);</span><br><span class="line">                BigDecimal buy4Price = rs.getBigDecimal(&quot;buy4_price&quot;);</span><br><span class="line">                BigDecimal buy5Price = rs.getBigDecimal(&quot;buy5_price&quot;);</span><br><span class="line">                BigDecimal sell1Price = rs.getBigDecimal(&quot;sell1_price&quot;);</span><br><span class="line">                BigDecimal sell2Price = rs.getBigDecimal(&quot;sell2_price&quot;);</span><br><span class="line">                BigDecimal sell3Price = rs.getBigDecimal(&quot;sell3_price&quot;);</span><br><span class="line">                BigDecimal sell4Price = rs.getBigDecimal(&quot;sell4_price&quot;);</span><br><span class="line">                BigDecimal sell5Price = rs.getBigDecimal(&quot;sell5_price&quot;);</span><br><span class="line">                long buy1Amount = rs.getLong(&quot;buy1_amount&quot;);</span><br><span class="line">                long buy2Amount = rs.getLong(&quot;buy2_amount&quot;);</span><br><span class="line">                long buy3Amount = rs.getLong(&quot;buy3_amount&quot;);</span><br><span class="line">                long buy4Amount = rs.getLong(&quot;buy4_amount&quot;);</span><br><span class="line">                long buy5Amount = rs.getLong(&quot;buy5_amount&quot;);</span><br><span class="line">                long sell11Amount = rs.getLong(&quot;sell1_amount&quot;);</span><br><span class="line">                long sell12Amount = rs.getLong(&quot;sell2_amount&quot;);</span><br><span class="line">                long sell13Amount = rs.getLong(&quot;sell3_amount&quot;);</span><br><span class="line">                long sell14Amount = rs.getLong(&quot;sell4_amount&quot;);</span><br><span class="line">                long sell15Amount = rs.getLong(&quot;sell5_amount&quot;);</span><br><span class="line">                AdsTick adsTick = new AdsTick(stockCode, date, time, latestPrice, openingPrice, tradingAmount,topPrice, minimumPrice, closingPrice,direction, buy1Price, buy2Price, buy3Price, buy4Price, buy5Price, sell1Price, sell2Price, sell3Price, sell4Price, sell5Price, buy1Amount, buy2Amount, buy3Amount, buy4Amount, buy5Amount, sell11Amount, sell12Amount, sell13Amount, sell14Amount, sell15Amount);</span><br><span class="line">                adsTicks.add(adsTick);</span><br><span class="line">            &#125;</span><br><span class="line">            return adsTicks;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此已经可以获取到hive的数据了</p>
<h3 id="4-使用Jedis存储数据至redis"><a href="#4-使用Jedis存储数据至redis" class="headerlink" title="4 使用Jedis存储数据至redis"></a>4 使用Jedis存储数据至redis</h3><p> **需求：**把读取到的hive数据，进行格式转换，然后保存到redis</p>
<p>首先在utils包下创建RedisUtils类，复制粘贴以下代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.utils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import redis.clients.jedis.Jedis;</span><br><span class="line">import redis.clients.jedis.JedisPool;</span><br><span class="line">import redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Set;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class RedisUtils &#123;</span><br><span class="line"></span><br><span class="line">    private Jedis jedis;</span><br><span class="line"></span><br><span class="line">    public RedisUtils() &#123;</span><br><span class="line">        JedisPool pool = getPool();</span><br><span class="line">        jedis = pool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public JedisPool getPool() &#123;</span><br><span class="line">        JedisPool pool = null;</span><br><span class="line">        JedisPoolConfig config = new JedisPoolConfig();</span><br><span class="line">        config.setMaxIdle(Integer.parseInt(&quot;50&quot;));</span><br><span class="line">        config.setMaxTotal(Integer.parseInt(&quot;1000&quot;));</span><br><span class="line">        config.setMaxWaitMillis((long) Integer.parseInt(&quot;3000&quot;));</span><br><span class="line">        config.setTestOnBorrow(Boolean.parseBoolean(&quot; true&quot;));</span><br><span class="line">        config.setTestOnReturn(Boolean.parseBoolean(&quot; true&quot;));</span><br><span class="line">        config.setTimeBetweenEvictionRunsMillis(-1L);</span><br><span class="line">        String ip = &quot;master&quot;;</span><br><span class="line">        int port = 6379;</span><br><span class="line">        //String password = &quot;&quot;;</span><br><span class="line">        pool = new JedisPool(config, ip, port, 2000);</span><br><span class="line">        return pool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String get(String key) &#123;</span><br><span class="line">        return jedis.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String set(String key, String value) &#123;</span><br><span class="line">        return jedis.set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long del(String keys) &#123;</span><br><span class="line">        return jedis.del(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 切换数据库</span><br><span class="line">     * @param index 数据库索引</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String select(int index)&#123;</span><br><span class="line">        return jedis.select(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key向指定的value追加值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param str</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long append(String key, String str) &#123;</span><br><span class="line">        return jedis.append(key, str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Boolean exist(String key) &#123;</span><br><span class="line">        return jedis.exists(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置key-value，若key已存在返回0 则返回1</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long setnx(String key, String value) &#123;</span><br><span class="line">        return jedis.setnx(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置key-value并指定键值的有效期</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param seconds 以秒为单位</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String setex(String key, int seconds, String value) &#123;</span><br><span class="line">        return jedis.setex(key, seconds, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 从指定的位置替换原先value aa 1 tt -&gt;atta</span><br><span class="line">     * 值不存在也会有空格 ee 1 uu-&gt;&quot; uu&quot;</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param offset</span><br><span class="line">     * @param str</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long setrange(String key, int offset, String str) &#123;</span><br><span class="line">        return jedis.setrange(key, offset, str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过批量keys获取批量values</span><br><span class="line">     *</span><br><span class="line">     * @param keys</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List mget(String keys) &#123;</span><br><span class="line">        return jedis.mget(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 批量设置keyvalues，也可以一个 “key”,“value”,…</span><br><span class="line">     *</span><br><span class="line">     * @param keyvalues</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String mset(String keyvalues) &#123;</span><br><span class="line">        return jedis.mset(keyvalues);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 批量设置keyvalues，也可以一个 如果key存在则会失败，操作回滚</span><br><span class="line">     *</span><br><span class="line">     * @param keyvalues</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long msetnx(String keyvalues) &#123;</span><br><span class="line">        return jedis.msetnx(keyvalues);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置key的值，返回一个旧值，key不存在，也会设置</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String getSet(String key, String value) &#123;</span><br><span class="line">        return jedis.getSet(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key和指定下标获取指定下标的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param startOffset</span><br><span class="line">     * @param endOffset</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String getrange(String key, int startOffset, int endOffset) &#123;</span><br><span class="line">        return jedis.getrange(key, startOffset, endOffset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key对value加1操作，如果value不是int类型会返回错误，如果key不存在，value为1</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long incr(String key) &#123;</span><br><span class="line">        return jedis.incr(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key对value加指定的值，如果value不是int类型会返回错误，若key不存在，value为该值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long decr(String key) &#123;</span><br><span class="line">        return jedis.decr(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key对value减去指定的值，如果value不是int类型会返回错误，若key不存在，value为该值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param integer</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long decrBy(String key, int integer) &#123;</span><br><span class="line">        return jedis.decrBy(key, integer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取value的长度</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long StrLen(String key) &#123;</span><br><span class="line">        return jedis.strlen(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key给field设置指定的值，若key不存在则先创建，若field已存在，返回0</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long hsetnx(String key, String field, String value) &#123;</span><br><span class="line">        return jedis.hsetnx(key, field, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key给field设置指定的值，若key不存在则先创建</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long hset(String key, String field, String value) &#123;</span><br><span class="line">        return jedis.hset(key, field, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key同时设置多个field</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param hash</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String hmset(String key, Map&lt;String, String&gt; hash) &#123;</span><br><span class="line">        return jedis.hmset(key, hash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key和field获取指定的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String hget(String key, String field) &#123;</span><br><span class="line">        return jedis.hget(key, field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置key的过期时间秒</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param seconds</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long expirt(String key, int seconds) &#123;</span><br><span class="line">        return jedis.expire(key, seconds);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key和fields获取指定的value，如果没有value，返回null</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List hmget(String key, String field) &#123;</span><br><span class="line">        return jedis.hmget(key, field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key给指定的field加指定的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long hincBy(String key, String field, Long value) &#123;</span><br><span class="line">        return jedis.hincrBy(key, field, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key和field判断指定的value是否存在</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean hexist(String key, String field) &#123;</span><br><span class="line">        return jedis.hexists(key, field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key返回field数量</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field 一个 也可以是数组</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long hdel(String key, String field) &#123;</span><br><span class="line">        return jedis.hdel(key, field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过field获取所有field</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set hkeys(String key) &#123;</span><br><span class="line">        return jedis.hkeys(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取和key有关的value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List hvals(String key) &#123;</span><br><span class="line">        return jedis.hvals(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取有关的field和value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Map&lt;String, String&gt; hgetall(String key) &#123;</span><br><span class="line">        return jedis.hgetAll(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key向list头部添加字符串</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param strs</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lpush(String key, String strs) &#123;</span><br><span class="line">        return jedis.lpush(key, strs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key向list尾部添加字符串</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param strs</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long rpush(String key, String strs) &#123;</span><br><span class="line">        return jedis.rpush(key, strs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key设置list指定下标位置value，越界报错</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param index</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String lset(String key, Long index, String value) &#123;</span><br><span class="line">        return jedis.lset(key, index, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key删除count个与value相同的元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param count</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lrem(String key, long count, String value) &#123;</span><br><span class="line">        return jedis.lrem(key, count, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key保留下标start到end的value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     * @param end</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String ltrim(String key, long start, long end) &#123;</span><br><span class="line">        return jedis.ltrim(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key删除头部一个value，返回value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String rpop(String key) &#123;</span><br><span class="line">        return jedis.rpop(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key删除list尾部一个value，添加到另一个list的头部，返回该value</span><br><span class="line">     * list为空或不存在返回null</span><br><span class="line">     *</span><br><span class="line">     * @param srckey</span><br><span class="line">     * @param dstkey</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String rpoplpush(String srckey, String dstkey) &#123;</span><br><span class="line">        return jedis.rpoplpush(srckey, dstkey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取list指定下标的value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param index</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String lindex(String key, long index) &#123;</span><br><span class="line">        return jedis.lindex(key, index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取list的长度</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long llen(String key) &#123;</span><br><span class="line">        return jedis.llen(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取指定下标位置的value</span><br><span class="line">     * 若start为0，end为-1，返回所有value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     * @param end</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List lrange(String key, long start, long end) &#123;</span><br><span class="line">        return jedis.lrange(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key向set添加value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param members</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sadd(String key, String members) &#123;</span><br><span class="line">        return jedis.sadd(key, members);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key删除set对应的value值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param members</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long srem(String key, String members) &#123;</span><br><span class="line">        return jedis.srem(key, members);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key随机删除set一个value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String spop(String key) &#123;</span><br><span class="line">        return jedis.spop(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取set中的差集</span><br><span class="line">     * 以第一个为标准</span><br><span class="line">     *</span><br><span class="line">     * @param keys</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set sdiff(String keys) &#123;</span><br><span class="line">        return jedis.sdiff(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取set中差集并存入另一set中</span><br><span class="line">     *</span><br><span class="line">     * @param dstkey</span><br><span class="line">     * @param keys</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sdiffstore(String dstkey, String keys) &#123;</span><br><span class="line">        return jedis.sdiffstore(dstkey, keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取set中交集</span><br><span class="line">     *</span><br><span class="line">     * @param keys</span><br><span class="line">     * @param dstkey</span><br><span class="line">     * @param keys</span><br><span class="line">     * @param keys</span><br><span class="line">     * @param dstkey</span><br><span class="line">     * @param keys</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sunionstore(String dstkey, String keys) &#123;</span><br><span class="line">        return jedis.sunionstore(dstkey, keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key将set中的value移除并把该value值添加到第二个set中</span><br><span class="line">     *</span><br><span class="line">     * @param srckey</span><br><span class="line">     * @param dstkey</span><br><span class="line">     * @param member</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long smove(String srckey, String dstkey, String member) &#123;</span><br><span class="line">        return jedis.smove(srckey, dstkey, member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取set中value个数</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long scard(String key) &#123;</span><br><span class="line">        return jedis.scard(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key判断value是否是set中元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param member</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean sismember(String key, String member) &#123;</span><br><span class="line">        return jedis.sismember(key, member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key随机获取set中的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String srandmember(String key) &#123;</span><br><span class="line">        return jedis.srandmember(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取set所有元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set smembers(String key) &#123;</span><br><span class="line">        return jedis.smembers(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key的zset中添加value，score，其中score是用来排序的</span><br><span class="line">     * 若该value已存在则根据score更新元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param score</span><br><span class="line">     * @param member</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zadd(String key, double score, String member) &#123;</span><br><span class="line">        return jedis.zadd(key, score, member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key删除在zset中指定的value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param member</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zrem(String key, String member) &#123;</span><br><span class="line">        return jedis.zrem(key, member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key增加该value中score值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param score</span><br><span class="line">     * @param member</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Double zincrby(String key, double score, String member) &#123;</span><br><span class="line">        return jedis.zincrby(key, score, member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key返回zset中的排名</span><br><span class="line">     * 下标从小到大排序</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param member</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zrank(String key, String member) &#123;</span><br><span class="line">        return jedis.zrank(key, member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key返回zset中的排名</span><br><span class="line">     * 下标从大道小排序</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zcard(String key) &#123;</span><br><span class="line">        return jedis.zcard(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取zset中value的score值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zremrangeByScore(String key, double start, double end) &#123;</span><br><span class="line">        return jedis.zremrangeByScore(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key存储是什么类型</span><br><span class="line">     *</span><br><span class="line">     * @param pattern</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set keys(String pattern) &#123;</span><br><span class="line">        return jedis.keys(pattern);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是一个redis工具类，可以操作redis。</p>
<p>然后在service包下创建StockHiveService接口和StockHiveServiceImpl类(实现StockHiveService)</p>
<p>编写一个写入redis的方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public interface StockHiveService &#123;</span><br><span class="line"></span><br><span class="line">    Boolean setTickInRedis();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在StockHiveServiceImpl类中实现该方法</p>
<p>首先创建RedisUtils对象，然后获取hive数据</p>
<p>redis采用list结构，同一日期下的数据都在一个list中</p>
<p>这里我们会对AdsTick这个实体进行转换，以便于适配前端页面，导入下面的实体类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.entity;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class FinceModel &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 时间(时分秒)</span><br><span class="line">     */</span><br><span class="line">    private String time;</span><br><span class="line">    /**</span><br><span class="line">     * 时间(年月日)</span><br><span class="line">     */</span><br><span class="line">    private String date;</span><br><span class="line">    /**</span><br><span class="line">     * 开盘价</span><br><span class="line">     */</span><br><span class="line">    private String open;</span><br><span class="line">    /**</span><br><span class="line">     * 收盘价</span><br><span class="line">     */</span><br><span class="line">    private String close;</span><br><span class="line">    /**</span><br><span class="line">     * 最高价</span><br><span class="line">     */</span><br><span class="line">    private String high;</span><br><span class="line">    /**</span><br><span class="line">     * 最低价</span><br><span class="line">     */</span><br><span class="line">    private String low;</span><br><span class="line">    /**</span><br><span class="line">     * 成交量</span><br><span class="line">     */</span><br><span class="line">    private String buy;</span><br><span class="line">    /**</span><br><span class="line">     * 最新价</span><br><span class="line">     */</span><br><span class="line">    private String balance;</span><br><span class="line">    private String buy1_apply;</span><br><span class="line">    private String buy1;</span><br><span class="line">    private String buy2_apply;</span><br><span class="line">    private String buy2;</span><br><span class="line">    private String buy3_apply;</span><br><span class="line">    private String buy3;</span><br><span class="line">    private String buy4_apply;</span><br><span class="line">    private String buy4;</span><br><span class="line">    private String buy5_apply;</span><br><span class="line">    private String buy5;</span><br><span class="line">    private String sell1_apply;</span><br><span class="line">    private String sell1;</span><br><span class="line">    private String sell2_apply;</span><br><span class="line">    private String sell2;</span><br><span class="line">    private String sell3_apply;</span><br><span class="line">    private String sell3;</span><br><span class="line">    private String sell4_apply;</span><br><span class="line">    private String sell4;</span><br><span class="line">    private String sell5_apply;</span><br><span class="line">    private String sell5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static FinceModel AdsTickConvertFinceModel(AdsTick adsTick) &#123;</span><br><span class="line">        FinceModel finceModel = new FinceModel();</span><br><span class="line">        finceModel.setTime(adsTick.getTime());</span><br><span class="line">        finceModel.setDate(adsTick.getDate());</span><br><span class="line">        finceModel.setOpen(adsTick.getOpeningPrice().toString());</span><br><span class="line">        finceModel.setClose(adsTick.getClosingPrice().toString());</span><br><span class="line">        finceModel.setHigh(adsTick.getTopPrice().toString());</span><br><span class="line">        finceModel.setLow(adsTick.getMinimumPrice().toString());</span><br><span class="line">        finceModel.setBuy(adsTick.getTradingAmount().toString());</span><br><span class="line">        finceModel.setBalance(adsTick.getLatestPrice().toString());</span><br><span class="line">        finceModel.setBuy1(adsTick.getBuy1Price().toString());</span><br><span class="line">        finceModel.setBuy1_apply(adsTick.getBuy1Amount().toString());</span><br><span class="line">        finceModel.setBuy2(adsTick.getBuy2Price().toString());</span><br><span class="line">        finceModel.setBuy2_apply(adsTick.getBuy2Amount().toString());</span><br><span class="line">        finceModel.setBuy3(adsTick.getBuy3Price().toString());</span><br><span class="line">        finceModel.setBuy3_apply(adsTick.getBuy3Amount().toString());</span><br><span class="line">        finceModel.setBuy4(adsTick.getBuy4Price().toString());</span><br><span class="line">        finceModel.setBuy4_apply(adsTick.getBuy4Amount().toString());</span><br><span class="line">        finceModel.setBuy5(adsTick.getBuy5Price().toString());</span><br><span class="line">        finceModel.setBuy5_apply(adsTick.getBuy5Amount().toString());</span><br><span class="line">        finceModel.setSell1(adsTick.getSell1Price().toString());</span><br><span class="line">        finceModel.setSell1_apply(adsTick.getSell1Amount().toString());</span><br><span class="line">        finceModel.setSell2(adsTick.getSell2Price().toString());</span><br><span class="line">        finceModel.setSell2_apply(adsTick.getSell2Amount().toString());</span><br><span class="line">        finceModel.setSell3(adsTick.getSell3Price().toString());</span><br><span class="line">        finceModel.setSell3_apply(adsTick.getSell3Amount().toString());</span><br><span class="line">        finceModel.setSell4(adsTick.getSell4Price().toString());</span><br><span class="line">        finceModel.setSell4_apply(adsTick.getSell4Amount().toString());</span><br><span class="line">        finceModel.setSell5(adsTick.getSell5Price().toString());</span><br><span class="line">        finceModel.setSell5_apply(adsTick.getSell5Amount().toString());</span><br><span class="line">        return finceModel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public String getDate() &#123;</span><br><span class="line">        return date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDate(String date) &#123;</span><br><span class="line">        this.date = date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getOpen() &#123;</span><br><span class="line">        return open;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOpen(String open) &#123;</span><br><span class="line">        this.open = open;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getClose() &#123;</span><br><span class="line">        return close;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setClose(String close) &#123;</span><br><span class="line">        this.close = close;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getHigh() &#123;</span><br><span class="line">        return high;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setHigh(String high) &#123;</span><br><span class="line">        this.high = high;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getLow() &#123;</span><br><span class="line">        return low;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setLow(String low) &#123;</span><br><span class="line">        this.low = low;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy1_apply() &#123;</span><br><span class="line">        return buy1_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy1_apply(String buy1_apply) &#123;</span><br><span class="line">        this.buy1_apply = buy1_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy1() &#123;</span><br><span class="line">        return buy1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy1(String buy1) &#123;</span><br><span class="line">        this.buy1 = buy1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy2_apply() &#123;</span><br><span class="line">        return buy2_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy2_apply(String buy2_apply) &#123;</span><br><span class="line">        this.buy2_apply = buy2_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy2() &#123;</span><br><span class="line">        return buy2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy2(String buy2) &#123;</span><br><span class="line">        this.buy2 = buy2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy3_apply() &#123;</span><br><span class="line">        return buy3_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy3_apply(String buy3_apply) &#123;</span><br><span class="line">        this.buy3_apply = buy3_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy3() &#123;</span><br><span class="line">        return buy3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy3(String buy3) &#123;</span><br><span class="line">        this.buy3 = buy3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy4_apply() &#123;</span><br><span class="line">        return buy4_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy4_apply(String buy4_apply) &#123;</span><br><span class="line">        this.buy4_apply = buy4_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy4() &#123;</span><br><span class="line">        return buy4;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy4(String buy4) &#123;</span><br><span class="line">        this.buy4 = buy4;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy5_apply() &#123;</span><br><span class="line">        return buy5_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy5_apply(String buy5_apply) &#123;</span><br><span class="line">        this.buy5_apply = buy5_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy5() &#123;</span><br><span class="line">        return buy5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy5(String buy5) &#123;</span><br><span class="line">        this.buy5 = buy5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell1_apply() &#123;</span><br><span class="line">        return sell1_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell1_apply(String sell1_apply) &#123;</span><br><span class="line">        this.sell1_apply = sell1_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell1() &#123;</span><br><span class="line">        return sell1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell1(String sell1) &#123;</span><br><span class="line">        this.sell1 = sell1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell2_apply() &#123;</span><br><span class="line">        return sell2_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell2_apply(String sell2_apply) &#123;</span><br><span class="line">        this.sell2_apply = sell2_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell2() &#123;</span><br><span class="line">        return sell2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell2(String sell2) &#123;</span><br><span class="line">        this.sell2 = sell2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell3_apply() &#123;</span><br><span class="line">        return sell3_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell3_apply(String sell3_apply) &#123;</span><br><span class="line">        this.sell3_apply = sell3_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell3() &#123;</span><br><span class="line">        return sell3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell3(String sell3) &#123;</span><br><span class="line">        this.sell3 = sell3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell4_apply() &#123;</span><br><span class="line">        return sell4_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell4_apply(String sell4_apply) &#123;</span><br><span class="line">        this.sell4_apply = sell4_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell4() &#123;</span><br><span class="line">        return sell4;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell4(String sell4) &#123;</span><br><span class="line">        this.sell4 = sell4;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell5_apply() &#123;</span><br><span class="line">        return sell5_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell5_apply(String sell5_apply) &#123;</span><br><span class="line">        this.sell5_apply = sell5_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell5() &#123;</span><br><span class="line">        return sell5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell5(String sell5) &#123;</span><br><span class="line">        this.sell5 = sell5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy() &#123;</span><br><span class="line">        return buy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy(String buy) &#123;</span><br><span class="line">        this.buy = buy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBalance() &#123;</span><br><span class="line">        return balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBalance(String balance) &#123;</span><br><span class="line">        this.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTime() &#123;</span><br><span class="line">        return time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTime(String time) &#123;</span><br><span class="line">        this.time = time;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写setTickInRedis()方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.service;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.cstor.entity.AdsTick;</span><br><span class="line">import com.cstor.entity.FinceModel;</span><br><span class="line">import com.cstor.mapper.StockHiveMapper;</span><br><span class="line">import com.cstor.mapper.StockHiveMapperImpl;</span><br><span class="line">import com.cstor.utils.RedisUtils;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class StockHiveServiceImpl implements StockHiveService&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Boolean setTickInRedis() &#123;</span><br><span class="line">        RedisUtils redisUtils = new RedisUtils();</span><br><span class="line">        StockHiveMapper stockHiveMapper = new StockHiveMapperImpl();</span><br><span class="line">        List&lt;AdsTick&gt; adsTickList = stockHiveMapper.getAdsTickList();</span><br><span class="line">        redisUtils.select(0);</span><br><span class="line">        for (AdsTick adsTick : adsTickList) &#123;</span><br><span class="line">            FinceModel finceModel = FinceModel.AdsTickConvertFinceModel(adsTick);</span><br><span class="line">            String strAdsTick = JSON.toJSONString(finceModel);</span><br><span class="line">            redisUtils.rpush(&quot;tick_&quot; + finceModel.getDate(), strAdsTick);</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在com.cstor目录下编写一个类Start，作为启动类，执行写入redis操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor;</span><br><span class="line"></span><br><span class="line">import com.cstor.service.StockHiveServiceImpl;</span><br><span class="line"></span><br><span class="line">public class Start &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        StockHiveServiceImpl stockHiveService = new StockHiveServiceImpl();</span><br><span class="line">        stockHiveService.setTickInRedis();</span><br><span class="line">        System.out.println(&quot;执行完毕&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时写入到redis也已经成功</p>
<h3 id="5-执行jar包"><a href="#5-执行jar包" class="headerlink" title="5 执行jar包"></a>5 执行jar包</h3><p> 接下来我们把代码打成jar包</p>
<p>选择File—》Project Structure<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288664548.png" alt="img"><br>在Artifacts添加<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288671365.png" alt="img"><br>选则Main Class，点击ok<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288677248.png" alt="img"><br>选择Build，点击会在屏幕中间出现选项，点击Build<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288683174.png" alt="img"><br>然后可以看到打成的jar包<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288690526.png" alt="img"><br>把这个jar包上传到服务器home目录下</p>
<p>在启动jar包之前，我们要开启 hiveserver2 （ 一个服务端接口，使远程客户端可以执行对Hive的查询并返回结果。）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cd /usr/cstor/hive </span><br><span class="line">nohup hive --service hiveserver2 &amp;</span><br></pre></td></tr></table></figure>

<p>命令启动以后，等待片刻</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">netstat -nultp | grep 10000</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288698420.png" alt="img"><br>然后进入home目录下启动jar包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">java -jar hive_redis.jar</span><br></pre></td></tr></table></figure>

<p>可以看到执行完毕，代表数据从hive到redis成功<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288704822.png" alt="img"></p>
<blockquote>
<p>使用redis构建缓存层成功，接下里就是实时推送redis中的数据。</p>
</blockquote>
<h2 id="69-项目实训-股票行情实时仿真数据平台-实时推送缓存数据"><a href="#69-项目实训-股票行情实时仿真数据平台-实时推送缓存数据" class="headerlink" title="69.项目实训-股票行情实时仿真数据平台-实时推送缓存数据"></a>69.项目实训-股票行情实时仿真数据平台-实时推送缓存数据</h2><blockquote>
<h3 id="目的-10"><a href="#目的-10" class="headerlink" title="目的"></a>目的</h3><p>1.了解如何进行web开发</p>
<p>2.了解webSocket</p>
<p>3.了解跨域</p>
<h3 id="要求-10"><a href="#要求-10" class="headerlink" title="要求"></a>要求</h3><p>本次实验后，要求学生能：</p>
<p>1.可以使用java进行web开发</p>
<p>2.使用webSocket进行推送数据</p>
<h3 id="原理-10"><a href="#原理-10" class="headerlink" title="原理"></a>原理</h3><p><strong>什么是WEB?</strong></p>
<p>　WEB，在英语中web即表示网页的意思，它用于表示Internet主机上供外界访问的资源。</p>
<p>Internet上供外界访问的Web资源分为：</p>
<ol>
<li>静态web资源（如html 页面）：指web页面中供人们浏览的数据始终是不变。</li>
<li>动态web资源：指web页面中供人们浏览的数据是由程序产生的，不同时间点访问web页面看到的内容各不相同。</li>
</ol>
<p>静态web资源开发技术：Html</p>
<p>常用动态web资源开发技术：JSP&#x2F;Servlet、ASP、PHP等</p>
<p>在Java中，动态web资源开发技术统称为Javaweb。</p>
<p><strong>什么是Servlet？</strong></p>
<p>在 JavaWeb 项目中，处理请求和发送响应的过程是由一种叫做 Servlet 的程序来完成的，并且 Servlet 是为了解决实现动态页面而衍生的东西。</p>
<p>简单来讲：Servlet其实就是一个遵循Servlet开发的java类，Serlvet是由服务器调用的，运行在服务器端。</p>
<p>一张图描述 Servler 在 B&#x2F;S 中的作用点：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288825516.png" alt="img"><br><strong>什么是WebSocket？</strong></p>
<p>传统 Web 模式在处理高并发及实时性需求的时候，会遇到难以逾越的瓶颈，我们需要一种高效节能的双向通信机制来保证数据的实时传输。在此背景下，基于 HTML5 规范的、有 Web TCP 之称的 WebSocket 应运而生。</p>
<p>早期 HTML5 并没有形成业界统一的规范，各个浏览器和应用服务器厂商有着各异的类似实现，如 IBM 的 MQTT，Comet  开源框架等，直到 2014 年，HTML5 在 IBM、微软、Google  等巨头的推动和协作下终于尘埃落地，正式从草案落实为实际标准规范，各个应用服务器及浏览器厂商逐步开始统一，在 JavaEE7 中也实现了  WebSocket 协议，从而无论是客户端还是服务端的 WebSocket 都已完备，读者可以查阅HTML5 规范，熟悉新的 HTML  协议规范及 WebSocket 支持。</p>
<p><strong>WebSocket 机制</strong></p>
<p>以下简要介绍一下 WebSocket 的原理及运行机制。</p>
<p>WebSocket 是 HTML5 一种新的协议。它实现了浏览器与服务器全双工通信，能更好的节省服务器资源和带宽并达到实时通讯，它建立在 TCP 之上，同 HTTP 一样通过 TCP 来传输数据，但是它和 HTTP 最大不同是：</p>
<p>WebSocket 是一种双向通信协议，在建立连接后，WebSocket 服务器和 Browser&#x2F;Client Agent 都能主动的向对方发送或接收数据，就像 Socket 一样；<br>WebSocket 需要类似 TCP 的客户端和服务器端通过握手连接，连接成功后才能相互通信。<br>传统模式交互与使用 WebSocket 模式的交互如下图：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288833070.png" alt="img"><br>它的最大特点就是，服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于服务器推送技术的一种。</p>
<p>其他特点包括：</p>
<p>建立在 TCP 协议之上，服务器端的实现比较容易。</p>
<p>与 HTTP 协议有着良好的兼容性，默认端口也是80和443。</p>
<p>数据格式比较轻量，性能开销小，通信高效。</p>
<p>可以发送文本，也可以发送二进制数据。</p>
<p>没有同源限制，客户端可以与任意服务器通信。</p>
<p>协议标识符是ws（如果加密，则为wss），服务器网址就是 URL。</p>
</blockquote>
<h3 id="1-搭建Web项目"><a href="#1-搭建Web项目" class="headerlink" title="1 搭建Web项目"></a>1 搭建Web项目</h3><p> 打开idea创建一个新项目<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288842848.png" alt="img"><br>选择Web然后next<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288848757.png" alt="img"><br>给项目起名<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288855456.png" alt="img"><br>按照该目录结构构建<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288862837.png" alt="img"><br>controller：访问层，用于存放servlet</p>
<p>entity：实体包</p>
<p>utils：工具包</p>
<p>webSocket：webSocket类存放包</p>
<p>接下来导入jar包，jar包在&#x2F;home&#x2F;financial&#x2F;tomcat_jars 目录下</p>
<p>导入完成后，如下图所示<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288874676.png" alt="img"><br>此时web项目构建完成</p>
<h3 id="2-编写Servlet，提供服务"><a href="#2-编写Servlet，提供服务" class="headerlink" title="2 编写Servlet，提供服务"></a>2 编写Servlet，提供服务</h3><p> 需求：提供三个查询Api</p>
<ol>
<li>查询数据所有的年月日信息，进行升序排序</li>
<li>查询指定日期前一日的收盘价</li>
<li>查询历史数据，当type为1时，一分钟一条数据，当type为2时，五分钟一条数据，取前40条</li>
</ol>
<p>接下来编写第一条</p>
<p><strong>查询数据所有的月份信息，进行升序排序</strong></p>
<p>首先导入FinceModel实体类和RedisUtils工具类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.entity;</span><br><span class="line"></span><br><span class="line">public class FinceModel &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 时间(时分秒)</span><br><span class="line">     */</span><br><span class="line">    private String time;</span><br><span class="line">    /**</span><br><span class="line">     * 时间(年月日)</span><br><span class="line">     */</span><br><span class="line">    private String date;</span><br><span class="line">    /**</span><br><span class="line">     * 开盘价</span><br><span class="line">     */</span><br><span class="line">    private String open;</span><br><span class="line">    /**</span><br><span class="line">     * 收盘价</span><br><span class="line">     */</span><br><span class="line">    private String close;</span><br><span class="line">    /**</span><br><span class="line">     * 最高价</span><br><span class="line">     */</span><br><span class="line">    private String high;</span><br><span class="line">    /**</span><br><span class="line">     * 最低价</span><br><span class="line">     */</span><br><span class="line">    private String low;</span><br><span class="line">    /**</span><br><span class="line">     * 成交量</span><br><span class="line">     */</span><br><span class="line">    private String buy;</span><br><span class="line">    /**</span><br><span class="line">     * 最新价</span><br><span class="line">     */</span><br><span class="line">    private String balance;</span><br><span class="line">    private String buy1_apply;</span><br><span class="line">    private String buy1;</span><br><span class="line">    private String buy2_apply;</span><br><span class="line">    private String buy2;</span><br><span class="line">    private String buy3_apply;</span><br><span class="line">    private String buy3;</span><br><span class="line">    private String buy4_apply;</span><br><span class="line">    private String buy4;</span><br><span class="line">    private String buy5_apply;</span><br><span class="line">    private String buy5;</span><br><span class="line">    private String sell1_apply;</span><br><span class="line">    private String sell1;</span><br><span class="line">    private String sell2_apply;</span><br><span class="line">    private String sell2;</span><br><span class="line">    private String sell3_apply;</span><br><span class="line">    private String sell3;</span><br><span class="line">    private String sell4_apply;</span><br><span class="line">    private String sell4;</span><br><span class="line">    private String sell5_apply;</span><br><span class="line">    private String sell5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public String getDate() &#123;</span><br><span class="line">        return date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDate(String date) &#123;</span><br><span class="line">        this.date = date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getOpen() &#123;</span><br><span class="line">        return open;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOpen(String open) &#123;</span><br><span class="line">        this.open = open;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getClose() &#123;</span><br><span class="line">        return close;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setClose(String close) &#123;</span><br><span class="line">        this.close = close;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getHigh() &#123;</span><br><span class="line">        return high;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setHigh(String high) &#123;</span><br><span class="line">        this.high = high;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getLow() &#123;</span><br><span class="line">        return low;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setLow(String low) &#123;</span><br><span class="line">        this.low = low;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy1_apply() &#123;</span><br><span class="line">        return buy1_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy1_apply(String buy1_apply) &#123;</span><br><span class="line">        this.buy1_apply = buy1_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy1() &#123;</span><br><span class="line">        return buy1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy1(String buy1) &#123;</span><br><span class="line">        this.buy1 = buy1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy2_apply() &#123;</span><br><span class="line">        return buy2_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy2_apply(String buy2_apply) &#123;</span><br><span class="line">        this.buy2_apply = buy2_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy2() &#123;</span><br><span class="line">        return buy2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy2(String buy2) &#123;</span><br><span class="line">        this.buy2 = buy2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy3_apply() &#123;</span><br><span class="line">        return buy3_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy3_apply(String buy3_apply) &#123;</span><br><span class="line">        this.buy3_apply = buy3_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy3() &#123;</span><br><span class="line">        return buy3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy3(String buy3) &#123;</span><br><span class="line">        this.buy3 = buy3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy4_apply() &#123;</span><br><span class="line">        return buy4_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy4_apply(String buy4_apply) &#123;</span><br><span class="line">        this.buy4_apply = buy4_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy4() &#123;</span><br><span class="line">        return buy4;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy4(String buy4) &#123;</span><br><span class="line">        this.buy4 = buy4;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy5_apply() &#123;</span><br><span class="line">        return buy5_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy5_apply(String buy5_apply) &#123;</span><br><span class="line">        this.buy5_apply = buy5_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy5() &#123;</span><br><span class="line">        return buy5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy5(String buy5) &#123;</span><br><span class="line">        this.buy5 = buy5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell1_apply() &#123;</span><br><span class="line">        return sell1_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell1_apply(String sell1_apply) &#123;</span><br><span class="line">        this.sell1_apply = sell1_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell1() &#123;</span><br><span class="line">        return sell1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell1(String sell1) &#123;</span><br><span class="line">        this.sell1 = sell1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell2_apply() &#123;</span><br><span class="line">        return sell2_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell2_apply(String sell2_apply) &#123;</span><br><span class="line">        this.sell2_apply = sell2_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell2() &#123;</span><br><span class="line">        return sell2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell2(String sell2) &#123;</span><br><span class="line">        this.sell2 = sell2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell3_apply() &#123;</span><br><span class="line">        return sell3_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell3_apply(String sell3_apply) &#123;</span><br><span class="line">        this.sell3_apply = sell3_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell3() &#123;</span><br><span class="line">        return sell3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell3(String sell3) &#123;</span><br><span class="line">        this.sell3 = sell3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell4_apply() &#123;</span><br><span class="line">        return sell4_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell4_apply(String sell4_apply) &#123;</span><br><span class="line">        this.sell4_apply = sell4_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell4() &#123;</span><br><span class="line">        return sell4;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell4(String sell4) &#123;</span><br><span class="line">        this.sell4 = sell4;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell5_apply() &#123;</span><br><span class="line">        return sell5_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell5_apply(String sell5_apply) &#123;</span><br><span class="line">        this.sell5_apply = sell5_apply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSell5() &#123;</span><br><span class="line">        return sell5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSell5(String sell5) &#123;</span><br><span class="line">        this.sell5 = sell5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBuy() &#123;</span><br><span class="line">        return buy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBuy(String buy) &#123;</span><br><span class="line">        this.buy = buy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBalance() &#123;</span><br><span class="line">        return balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBalance(String balance) &#123;</span><br><span class="line">        this.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTime() &#123;</span><br><span class="line">        return time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTime(String time) &#123;</span><br><span class="line">        this.time = time;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">java</span><br><span class="line">package com.cstor.utils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import redis.clients.jedis.Jedis;</span><br><span class="line">import redis.clients.jedis.JedisPool;</span><br><span class="line">import redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Set;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class RedisUtils &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private Jedis jedis;</span><br><span class="line"></span><br><span class="line">    public RedisUtils() &#123;</span><br><span class="line">        JedisPool pool = getPool();</span><br><span class="line">        jedis = pool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public JedisPool getPool() &#123;</span><br><span class="line">        JedisPool pool = null;</span><br><span class="line">        JedisPoolConfig config = new JedisPoolConfig();</span><br><span class="line">        config.setMaxIdle(Integer.parseInt(&quot;50&quot;));</span><br><span class="line">        config.setMaxTotal(Integer.parseInt(&quot;1000&quot;));</span><br><span class="line">        config.setMaxWaitMillis((long) Integer.parseInt(&quot;3000&quot;));</span><br><span class="line">        config.setTestOnBorrow(Boolean.parseBoolean(&quot; true&quot;));</span><br><span class="line">        config.setTestOnReturn(Boolean.parseBoolean(&quot; true&quot;));</span><br><span class="line">        config.setTimeBetweenEvictionRunsMillis(-1L);</span><br><span class="line">        String ip = &quot;master&quot;;</span><br><span class="line">        int port = 6379;</span><br><span class="line">        //String password = &quot;&quot;;</span><br><span class="line">        pool = new JedisPool(config, ip, port, 2000);</span><br><span class="line">        return pool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String get(String key) &#123;</span><br><span class="line">        return jedis.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String set(String key, String value) &#123;</span><br><span class="line">        return jedis.set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long del(String keys) &#123;</span><br><span class="line">        return jedis.del(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 切换数据库</span><br><span class="line">     * @param index 数据库索引</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String select(int index)&#123;</span><br><span class="line">        return jedis.select(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key向指定的value追加值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param str</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long append(String key, String str) &#123;</span><br><span class="line">        return jedis.append(key, str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Boolean exist(String key) &#123;</span><br><span class="line">        return jedis.exists(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置key-value，若key已存在返回0 则返回1</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long setnx(String key, String value) &#123;</span><br><span class="line">        return jedis.setnx(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置key-value并指定键值的有效期</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param seconds 以秒为单位</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String setex(String key, int seconds, String value) &#123;</span><br><span class="line">        return jedis.setex(key, seconds, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 从指定的位置替换原先value aa 1 tt -&gt;atta</span><br><span class="line">     * 值不存在也会有空格 ee 1 uu-&gt;&quot; uu&quot;</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param offset</span><br><span class="line">     * @param str</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long setrange(String key, int offset, String str) &#123;</span><br><span class="line">        return jedis.setrange(key, offset, str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过批量keys获取批量values</span><br><span class="line">     *</span><br><span class="line">     * @param keys</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List mget(String keys) &#123;</span><br><span class="line">        return jedis.mget(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 批量设置keyvalues，也可以一个 “key”,“value”,…</span><br><span class="line">     *</span><br><span class="line">     * @param keyvalues</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String mset(String keyvalues) &#123;</span><br><span class="line">        return jedis.mset(keyvalues);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 批量设置keyvalues，也可以一个 如果key存在则会失败，操作回滚</span><br><span class="line">     *</span><br><span class="line">     * @param keyvalues</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long msetnx(String keyvalues) &#123;</span><br><span class="line">        return jedis.msetnx(keyvalues);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置key的值，返回一个旧值，key不存在，也会设置</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String getSet(String key, String value) &#123;</span><br><span class="line">        return jedis.getSet(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key和指定下标获取指定下标的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param startOffset</span><br><span class="line">     * @param endOffset</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String getrange(String key, int startOffset, int endOffset) &#123;</span><br><span class="line">        return jedis.getrange(key, startOffset, endOffset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key对value加1操作，如果value不是int类型会返回错误，如果key不存在，value为1</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long incr(String key) &#123;</span><br><span class="line">        return jedis.incr(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key对value加指定的值，如果value不是int类型会返回错误，若key不存在，value为该值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long decr(String key) &#123;</span><br><span class="line">        return jedis.decr(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key对value减去指定的值，如果value不是int类型会返回错误，若key不存在，value为该值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param integer</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long decrBy(String key, int integer) &#123;</span><br><span class="line">        return jedis.decrBy(key, integer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取value的长度</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long StrLen(String key) &#123;</span><br><span class="line">        return jedis.strlen(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key给field设置指定的值，若key不存在则先创建，若field已存在，返回0</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long hsetnx(String key, String field, String value) &#123;</span><br><span class="line">        return jedis.hsetnx(key, field, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key给field设置指定的值，若key不存在则先创建</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long hset(String key, String field, String value) &#123;</span><br><span class="line">        return jedis.hset(key, field, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key同时设置多个field</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param hash</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String hmset(String key, Map&lt;String, String&gt; hash) &#123;</span><br><span class="line">        return jedis.hmset(key, hash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key和field获取指定的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String hget(String key, String field) &#123;</span><br><span class="line">        return jedis.hget(key, field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置key的过期时间秒</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param seconds</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long expirt(String key, int seconds) &#123;</span><br><span class="line">        return jedis.expire(key, seconds);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key和fields获取指定的value，如果没有value，返回null</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List hmget(String key, String field) &#123;</span><br><span class="line">        return jedis.hmget(key, field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key给指定的field加指定的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long hincBy(String key, String field, Long value) &#123;</span><br><span class="line">        return jedis.hincrBy(key, field, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key和field判断指定的value是否存在</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean hexist(String key, String field) &#123;</span><br><span class="line">        return jedis.hexists(key, field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key返回field数量</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field 一个 也可以是数组</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long hdel(String key, String field) &#123;</span><br><span class="line">        return jedis.hdel(key, field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过field获取所有field</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set hkeys(String key) &#123;</span><br><span class="line">        return jedis.hkeys(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取和key有关的value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List hvals(String key) &#123;</span><br><span class="line">        return jedis.hvals(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取有关的field和value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Map&lt;String, String&gt; hgetall(String key) &#123;</span><br><span class="line">        return jedis.hgetAll(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key向list头部添加字符串</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param strs</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lpush(String key, String strs) &#123;</span><br><span class="line">        return jedis.lpush(key, strs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key向list尾部添加字符串</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param strs</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long rpush(String key, String strs) &#123;</span><br><span class="line">        return jedis.rpush(key, strs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key设置list指定下标位置value，越界报错</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param index</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String lset(String key, Long index, String value) &#123;</span><br><span class="line">        return jedis.lset(key, index, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key删除count个与value相同的元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param count</span><br><span class="line">     * @param value</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lrem(String key, long count, String value) &#123;</span><br><span class="line">        return jedis.lrem(key, count, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key保留下标start到end的value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     * @param end</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String ltrim(String key, long start, long end) &#123;</span><br><span class="line">        return jedis.ltrim(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key删除头部一个value，返回value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String rpop(String key) &#123;</span><br><span class="line">        return jedis.rpop(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key删除list尾部一个value，添加到另一个list的头部，返回该value</span><br><span class="line">     * list为空或不存在返回null</span><br><span class="line">     *</span><br><span class="line">     * @param srckey</span><br><span class="line">     * @param dstkey</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String rpoplpush(String srckey, String dstkey) &#123;</span><br><span class="line">        return jedis.rpoplpush(srckey, dstkey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取list指定下标的value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param index</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String lindex(String key, long index) &#123;</span><br><span class="line">        return jedis.lindex(key, index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取list的长度</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long llen(String key) &#123;</span><br><span class="line">        return jedis.llen(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取指定下标位置的value</span><br><span class="line">     * 若start为0，end为-1，返回所有value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     * @param end</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List lrange(String key, long start, long end) &#123;</span><br><span class="line">        return jedis.lrange(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key向set添加value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param members</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sadd(String key, String members) &#123;</span><br><span class="line">        return jedis.sadd(key, members);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key删除set对应的value值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param members</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long srem(String key, String members) &#123;</span><br><span class="line">        return jedis.srem(key, members);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key随机删除set一个value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String spop(String key) &#123;</span><br><span class="line">        return jedis.spop(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取set中的差集</span><br><span class="line">     * 以第一个为标准</span><br><span class="line">     *</span><br><span class="line">     * @param keys</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set sdiff(String keys) &#123;</span><br><span class="line">        return jedis.sdiff(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取set中差集并存入另一set中</span><br><span class="line">     *</span><br><span class="line">     * @param dstkey</span><br><span class="line">     * @param keys</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sdiffstore(String dstkey, String keys) &#123;</span><br><span class="line">        return jedis.sdiffstore(dstkey, keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取set中交集</span><br><span class="line">     *</span><br><span class="line">     * @param keys</span><br><span class="line">     * @param dstkey</span><br><span class="line">     * @param keys</span><br><span class="line">     * @param keys</span><br><span class="line">     * @param dstkey</span><br><span class="line">     * @param keys</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sunionstore(String dstkey, String keys) &#123;</span><br><span class="line">        return jedis.sunionstore(dstkey, keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key将set中的value移除并把该value值添加到第二个set中</span><br><span class="line">     *</span><br><span class="line">     * @param srckey</span><br><span class="line">     * @param dstkey</span><br><span class="line">     * @param member</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long smove(String srckey, String dstkey, String member) &#123;</span><br><span class="line">        return jedis.smove(srckey, dstkey, member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取set中value个数</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long scard(String key) &#123;</span><br><span class="line">        return jedis.scard(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key判断value是否是set中元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param member</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean sismember(String key, String member) &#123;</span><br><span class="line">        return jedis.sismember(key, member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key随机获取set中的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String srandmember(String key) &#123;</span><br><span class="line">        return jedis.srandmember(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取set所有元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set smembers(String key) &#123;</span><br><span class="line">        return jedis.smembers(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key的zset中添加value，score，其中score是用来排序的</span><br><span class="line">     * 若该value已存在则根据score更新元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param score</span><br><span class="line">     * @param member</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zadd(String key, double score, String member) &#123;</span><br><span class="line">        return jedis.zadd(key, score, member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key删除在zset中指定的value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param member</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zrem(String key, String member) &#123;</span><br><span class="line">        return jedis.zrem(key, member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key增加该value中score值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param score</span><br><span class="line">     * @param member</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Double zincrby(String key, double score, String member) &#123;</span><br><span class="line">        return jedis.zincrby(key, score, member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key返回zset中的排名</span><br><span class="line">     * 下标从小到大排序</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param member</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zrank(String key, String member) &#123;</span><br><span class="line">        return jedis.zrank(key, member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key返回zset中的排名</span><br><span class="line">     * 下标从大道小排序</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zcard(String key) &#123;</span><br><span class="line">        return jedis.zcard(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key获取zset中value的score值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zremrangeByScore(String key, double start, double end) &#123;</span><br><span class="line">        return jedis.zremrangeByScore(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过key存储是什么类型</span><br><span class="line">     *</span><br><span class="line">     * @param pattern</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set keys(String pattern) &#123;</span><br><span class="line">        return jedis.keys(pattern);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在controller包下创建MonthServlet类，继承HttpServlet类 , 重写doGet()方法</p>
<p>接下来是参考代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.cstor.utils.RedisUtils;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.*;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@WebServlet(urlPatterns = &quot;/api/date/list&quot;)</span><br><span class="line">public class MonthServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">    //创建redis连接</span><br><span class="line">    private RedisUtils redisUtils = new RedisUtils();</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">        // 设置request字符编码  response的编码及格式</span><br><span class="line">        request.setCharacterEncoding(&quot;utf-8&quot;);</span><br><span class="line">        response.setContentType(&quot;text/json; charset=utf-8&quot;);</span><br><span class="line">        //获取年月日信息</span><br><span class="line">        List&lt;String&gt; monthsBySort = getMonths();</span><br><span class="line">        //创建用于返回的map集合</span><br><span class="line">        Map&lt;String, Object&gt; result = new HashMap&lt;&gt;();</span><br><span class="line">        result.put(&quot;list&quot;, monthsBySort);</span><br><span class="line">        if (monthsBySort.size() != 0)</span><br><span class="line">            result.put(&quot;result&quot;, &quot;success&quot;);</span><br><span class="line">        else &#123;</span><br><span class="line">            result.put(&quot;result&quot;, &quot;fail&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        //输出至前端</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        String resJSON = JSON.toJSONString(result);</span><br><span class="line">        out.print(resJSON);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public List&lt;String&gt; getMonths() &#123;</span><br><span class="line">        //查询所有以tick_开头的key值</span><br><span class="line">        Set&lt;String&gt; keys = redisUtils.keys(&quot;tick_*&quot;);</span><br><span class="line">        //获取key值set集合后，要把tick_去掉，并且对日期做升序</span><br><span class="line">        return keys.stream()</span><br><span class="line">                .map(s -&gt; s.substring(5))</span><br><span class="line">                .sorted((o1, o2) -&gt; &#123;</span><br><span class="line">                    SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Date dt1 = format.parse(o1);</span><br><span class="line">                        Date dt2 = format.parse(o2);</span><br><span class="line">                        return Long.compare(dt1.getTime(), dt2.getTime());</span><br><span class="line">                    &#125; catch (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    return 0;</span><br><span class="line">                &#125;)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>查询指定日期前一日的收盘价</strong></p>
<p>上一个接口，获取了所有的年月日信息，那么前端会向我们传递日期，我们获取前一日收盘价</p>
<p>继续创建PreCloseServlet类</p>
<p>以下是参考代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.controller;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import com.cstor.entity.FinceModel;</span><br><span class="line">import com.cstor.utils.RedisUtils;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">@WebServlet(urlPatterns = &quot;/api/date/preClose&quot;)</span><br><span class="line">public class PreCloseServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">    //创建redis连接</span><br><span class="line">    private RedisUtils redisUtils = new RedisUtils();</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">        // 设置request字符编码  response的编码及格式</span><br><span class="line">        request.setCharacterEncoding(&quot;utf-8&quot;);</span><br><span class="line">        response.setContentType(&quot;text/json; charset=utf-8&quot;);</span><br><span class="line">        //获取月份信息</span><br><span class="line">        MonthServlet monthServlet = new MonthServlet();</span><br><span class="line">        List&lt;String&gt; months = monthServlet.getMonths();</span><br><span class="line">        //获取前端传递的日期参数</span><br><span class="line">        String date = request.getParameter(&quot;date&quot;);</span><br><span class="line">        //由于我们使用的是20210506-20210531的数据，所以前端如果传递的日期是20210506，那么我们写死23.29</span><br><span class="line">        String preClose = &quot;&quot;;</span><br><span class="line">        int index = months.indexOf(date);</span><br><span class="line">        if (index == 0) &#123;</span><br><span class="line">            preClose = &quot;23.29&quot;;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            //获取前一天日期，然后到redis里取数据</span><br><span class="line">            String preMonth = months.get(index - 1);</span><br><span class="line">            List&lt;String&gt; lrange = redisUtils.lrange(&quot;tick_&quot; + preMonth, 0, -1);</span><br><span class="line">            //获取到一天的数据后，获取这一条15:00分的数据</span><br><span class="line">            List&lt;FinceModel&gt; collect = lrange.stream()</span><br><span class="line">                    .map(s -&gt; JSONObject.parseObject(s, FinceModel.class))</span><br><span class="line">                    .filter(finceModel -&gt; finceModel.getTime().substring(0, 5).equals(&quot;15:00&quot;))</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">            //获取15:00分的收盘价</span><br><span class="line">            preClose = collect.get(0).getClose();</span><br><span class="line">        &#125;</span><br><span class="line">        //封装返回数据</span><br><span class="line">        Map&lt;String, Object&gt; result = new HashMap&lt;&gt;();</span><br><span class="line">        result.put(&quot;preClose&quot;, preClose);</span><br><span class="line">        result.put(&quot;result&quot;, &quot;success&quot;);</span><br><span class="line">        //发送数据</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        String resJSON = JSON.toJSONString(result);</span><br><span class="line">        out.print(resJSON);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>查询历史数据，当type为1时，一分钟一条数据，当type为2时，五分钟一条数据，取前40条</strong></p>
<p>前端会向本接口传递两个参数：</p>
<p>第一个type，代表推送数据的类型，如果type为1时，一分钟一条数据，当type为2时，五分钟一条数据，取前40条</p>
<p>第二个data，代表查询某一日的数据</p>
<p>我们要做的就是查询出某一日前40条数据，如果type为1时，每一条数据时间间隔一分钟，如果type为2时，每一条数据时间间隔五分钟</p>
<p>创建HistoryServlet类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.controller;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import com.cstor.entity.FinceModel;</span><br><span class="line">import com.cstor.utils.RedisUtils;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.*;</span><br><span class="line">import java.util.concurrent.atomic.AtomicReference;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">@WebServlet(urlPatterns = &quot;/api/date/history&quot;)</span><br><span class="line">public class HistoryServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">    //创建redis连接</span><br><span class="line">    private RedisUtils redisUtils = new RedisUtils();</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">        // 设置request字符编码  response的编码及格式</span><br><span class="line">        request.setCharacterEncoding(&quot;utf-8&quot;);</span><br><span class="line">        response.setContentType(&quot;text/json; charset=utf-8&quot;);</span><br><span class="line">        //获取type和date参数</span><br><span class="line">        String type = request.getParameter(&quot;type&quot;);</span><br><span class="line">        String date = request.getParameter(&quot;date&quot;);</span><br><span class="line">        //如果type是1 那么就一分钟一条数据   如果type是2 那么就五分钟一条数据</span><br><span class="line">        Integer interval = type.equals(&quot;1&quot;) ? 1 : 5;</span><br><span class="line">        //获取list</span><br><span class="line">        List&lt;String&gt; tickDayListJson = redisUtils.lrange(&quot;tick_&quot; + date, 0, -1);</span><br><span class="line">        List&lt;FinceModel&gt; finceModelList = tickDayListJson.stream().map(s -&gt; JSONObject.parseObject(s, FinceModel.class)).collect(Collectors.toList());</span><br><span class="line">        //根据分钟进行分组，然后获取每分钟第一条</span><br><span class="line">        Map&lt;String, List&lt;FinceModel&gt;&gt; gropByTime = finceModelList.stream().collect(Collectors.groupingBy(finceModel -&gt; finceModel.getTime().substring(0, 5)));</span><br><span class="line">        List&lt;FinceModel&gt; finceModels = new ArrayList&lt;&gt;();</span><br><span class="line">        for (String str : gropByTime.keySet())&#123;</span><br><span class="line">            finceModels.add(gropByTime.get(str).get(0));</span><br><span class="line">        &#125;</span><br><span class="line">        //根据时间进行排序</span><br><span class="line">        List&lt;FinceModel&gt; finceModelsBySort = finceModels.stream()</span><br><span class="line">                .filter(finceModel -&gt; !finceModel.getTime().substring(0,5).equals(&quot;09:25&quot;))</span><br><span class="line">                .sorted((o1, o2) -&gt; &#123;</span><br><span class="line">                    SimpleDateFormat format = new SimpleDateFormat(&quot;HH:mm:ss&quot;);</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Date dt1 = format.parse(o1.getTime());</span><br><span class="line">                        Date dt2 = format.parse(o2.getTime());</span><br><span class="line">                        return Long.compare(dt1.getTime(), dt2.getTime());</span><br><span class="line">                    &#125; catch (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    return 0;</span><br><span class="line">                &#125;).collect(Collectors.toList());</span><br><span class="line">        //筛选   interval是1 那么就一分钟一条数据   interval是2 那么就五分钟一条数据</span><br><span class="line">        AtomicReference&lt;Integer&gt; index = new AtomicReference&lt;&gt;(0);</span><br><span class="line">        List&lt;FinceModel&gt; screeningByInterval = finceModelsBySort.stream().filter(finceModel -&gt; &#123;</span><br><span class="line">            if (index.getAndSet(index.get() + 1) % interval == 0) return true;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        //构建返回体</span><br><span class="line">        Map&lt;String, Object&gt; result = new HashMap&lt;&gt;();</span><br><span class="line">        result.put(&quot;list&quot;, screeningByInterval.subList(0, 39));</span><br><span class="line">        result.put(&quot;result&quot;, &quot;success&quot;);</span><br><span class="line">        result.put(&quot;count&quot;, finceModelList.size());</span><br><span class="line">        //返回数据</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        String resJSON = JSON.toJSONString(result);</span><br><span class="line">        out.print(resJSON);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此三个接口都已经开发完毕</p>
<h3 id="3-编写WebSocket程序，实时推送数据"><a href="#3-编写WebSocket程序，实时推送数据" class="headerlink" title="3 编写WebSocket程序，实时推送数据"></a>3 编写WebSocket程序，实时推送数据</h3><p> 要想和浏览器保持长连接，实时推送数据，那么要使用webSocket</p>
<p>在webSocket包下创建WebSocketServer类,直接复制下面的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.webSocket;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import com.cstor.entity.FinceModel;</span><br><span class="line">import com.cstor.utils.RedisUtils;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.text.ParseException;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.*;</span><br><span class="line">import java.util.concurrent.CopyOnWriteArraySet;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">import javax.websocket.*;</span><br><span class="line">import javax.websocket.server.PathParam;</span><br><span class="line">import javax.websocket.server.ServerEndpoint;</span><br><span class="line"></span><br><span class="line">@ServerEndpoint(&quot;/api/websocket/&#123;sid&#125;/&#123;date&#125;/&#123;type&#125;&quot;)</span><br><span class="line">public class WebSocketServer &#123;</span><br><span class="line"></span><br><span class="line">    private static int onlineCount = 0;</span><br><span class="line"></span><br><span class="line">    private static CopyOnWriteArraySet&lt;WebSocketServer&gt; webSocketSet = new CopyOnWriteArraySet();</span><br><span class="line">    private Session session;</span><br><span class="line">    private String sid = &quot;&quot;;</span><br><span class="line">    //创建redis连接</span><br><span class="line">    private RedisUtils redisUtils = new RedisUtils();</span><br><span class="line"></span><br><span class="line">    public WebSocketServer() &#123;</span><br><span class="line">        System.out.println(&quot;WebsocketTest..&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @OnOpen</span><br><span class="line">    public void onOpen(Session session, @PathParam(&quot;sid&quot;) String sid, @PathParam(&quot;date&quot;) String date, @PathParam(&quot;type&quot;) String type)</span><br><span class="line">            throws Exception &#123;</span><br><span class="line">        this.session = session;</span><br><span class="line">        webSocketSet.add(this);</span><br><span class="line"></span><br><span class="line">        addOnlineCount();</span><br><span class="line">        this.sid = sid;</span><br><span class="line">        sendData(date, type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void sendData(String date, String type) throws IOException, InterruptedException &#123;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @OnClose</span><br><span class="line">    public void onClose() &#123;</span><br><span class="line">        webSocketSet.remove(this);</span><br><span class="line"></span><br><span class="line">        subOnlineCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @OnMessage</span><br><span class="line">    public void onMessage(String message, Session session) &#123;</span><br><span class="line">        for (WebSocketServer item : webSocketSet)</span><br><span class="line">            try &#123;</span><br><span class="line">                item.sendMessage(message);</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @OnError</span><br><span class="line">    public void onError(Session session, Throwable error) &#123;</span><br><span class="line">        error.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void sendMessage(String message)</span><br><span class="line">            throws IOException &#123;</span><br><span class="line">        this.session.getBasicRemote().sendText(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static synchronized void addOnlineCount() &#123;</span><br><span class="line">        onlineCount += 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static synchronized void subOnlineCount() &#123;</span><br><span class="line">        onlineCount -= 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 按指定大小，分隔集合，将集合按规定个数分为n个部分</span><br><span class="line">     * @param &lt;T&gt;</span><br><span class="line">     *</span><br><span class="line">     * @param list</span><br><span class="line">     * @param len</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public  &lt;T&gt; List&lt;List&lt;T&gt;&gt; splitList(List&lt;T&gt; list, int len) &#123;</span><br><span class="line">        if (list == null || list.isEmpty() || len &lt; 1) &#123;</span><br><span class="line">            return Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;List&lt;T&gt;&gt; result = new ArrayList&lt;&gt;();</span><br><span class="line">        int size = list.size();</span><br><span class="line">        int count = (size + len - 1) / len;</span><br><span class="line">        for (int i = 0; i &lt; count; i++) &#123;</span><br><span class="line">            List&lt;T&gt; subList = list.subList(i * len, ((i + 1) * len &gt; size ? size : len * (i + 1)));</span><br><span class="line">            result.add(subList);</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参数解读：</p>
<p>@ServerEndpoint(“&#x2F;api&#x2F;websocket&#x2F;{sid}&#x2F;{date}&#x2F;{type}”)：声明这是一个webSocket服务，&#x2F;api&#x2F;websocket代表请求地址，后面{}代表参数</p>
<p>@OnOpen：该方法将在建立连接后执行，传入Session对象，就是客户端与服务端建立长连接通道</p>
<p>@OnClose：连接关闭后执行</p>
<p>@OnMessage：该方法用于接收客户端发来的消息</p>
<p>接下来我们就是要在sendData方法中实现需求</p>
<p>需求：</p>
<p>根据data获取某天的所有数据，然后当type为1的时候，获取10:09分后的数据，每一秒推送一条数据，一分钟内的数据为一条list，多个list组成一个list。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288930085.png" alt="img"><br>当type为2的时候，获取14:00分后的数据，每一秒推送一条数据，这些数据每58条组成一个list。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288935853.png" alt="img"><br>一下是sendData方法的参考</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">    private void sendData(String date, String type) throws IOException, InterruptedException &#123;</span><br><span class="line">        //获取某股票某天的所有数据</span><br><span class="line">        List&lt;String&gt; tickList = redisUtils.lrange(&quot;tick_&quot; + date, 0, -1);</span><br><span class="line"></span><br><span class="line">        if (type.equals(&quot;1&quot;))&#123;</span><br><span class="line">            //筛选10:09分后的数据</span><br><span class="line">            List&lt;FinceModel&gt; finceModelList = tickList.stream()</span><br><span class="line">                    .map(s -&gt; JSONObject.parseObject(s, FinceModel.class))</span><br><span class="line">                    .filter(finceModel -&gt; &#123;</span><br><span class="line">                SimpleDateFormat simpleDateFormat = new SimpleDateFormat(&quot;HH:mm:ss&quot;);</span><br><span class="line">                try &#123;</span><br><span class="line">                    Date dt1 = simpleDateFormat.parse(finceModel.getTime());</span><br><span class="line">                    Date dt2 = simpleDateFormat.parse(&quot;10:09:00&quot;);</span><br><span class="line">                    if (dt1.getTime() &gt; dt2.getTime()) return true;</span><br><span class="line">                &#125; catch (ParseException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            int index = 1;</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                List&lt;FinceModel&gt; finceModels = finceModelList.subList(0, index);</span><br><span class="line">                //按照日期进行拆分list</span><br><span class="line">                List&lt;List&lt;FinceModel&gt;&gt; lists = new ArrayList&lt;&gt;();</span><br><span class="line">                TreeMap&lt;String, List&lt;FinceModel&gt;&gt; collect1 = finceModels.stream()</span><br><span class="line">                        .collect(Collectors.groupingBy(finceModel -&gt; finceModel.getTime().substring(0, 5), TreeMap::new, Collectors.toList()));</span><br><span class="line">                //把每一分钟的list添加到一个list中</span><br><span class="line">                collect1.forEach((s, finceModels2) -&gt; &#123;</span><br><span class="line">                    lists.add(finceModels2);</span><br><span class="line">                &#125;);</span><br><span class="line">                JSONObject jsonObject = new JSONObject();</span><br><span class="line">                jsonObject.put(&quot;list&quot;, lists);</span><br><span class="line">                jsonObject.put(&quot;result&quot;, &quot;success&quot;);</span><br><span class="line">                this.session.getBasicRemote().sendText(jsonObject.toString());</span><br><span class="line">                Thread.sleep(1000L);</span><br><span class="line">                index++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (type.equals(&quot;2&quot;))&#123;</span><br><span class="line">            //筛选14:10:00分后的数据</span><br><span class="line">            List&lt;FinceModel&gt; finceModelList = tickList.stream()</span><br><span class="line">                    .map(s -&gt; JSONObject.parseObject(s, FinceModel.class))</span><br><span class="line">                    .filter(finceModel -&gt; &#123;</span><br><span class="line">                        SimpleDateFormat simpleDateFormat = new SimpleDateFormat(&quot;HH:mm:ss&quot;);</span><br><span class="line">                        try &#123;</span><br><span class="line">                            Date dt1 = simpleDateFormat.parse(finceModel.getTime());</span><br><span class="line">                            Date dt2 = simpleDateFormat.parse(&quot;14:10:00&quot;);</span><br><span class="line">                            if (dt1.getTime() &gt; dt2.getTime()) return true;</span><br><span class="line">                        &#125; catch (ParseException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                        return false;</span><br><span class="line">                    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">            int index = 1;</span><br><span class="line"></span><br><span class="line">            while (true) &#123;</span><br><span class="line">                List&lt;FinceModel&gt; finceModels = finceModelList.subList(0, index);</span><br><span class="line">                List&lt;List&lt;FinceModel&gt;&gt; lists = splitList(finceModels, 58);</span><br><span class="line">                JSONObject jsonObject = new JSONObject();</span><br><span class="line">                jsonObject.put(&quot;list&quot;, lists);</span><br><span class="line">                jsonObject.put(&quot;result&quot;, &quot;success&quot;);</span><br><span class="line">                this.session.getBasicRemote().sendText(jsonObject.toString());</span><br><span class="line">                Thread.sleep(1000L);</span><br><span class="line">                index++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-跨域"><a href="#4-跨域" class="headerlink" title="4 跨域"></a>4 跨域</h3><p> <strong>什么是跨域？</strong></p>
<p>当一个请求url的<strong>协议、域名、端口</strong>三者之间任意一个与当前页面url不同即为跨域<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693288946951.png" alt="img"><br>跨域会导致浏览器无法正确获取服务器的数据</p>
<p><strong>为什么会出现跨域问题</strong></p>
<p>出于浏览器的同源策略限制。同源策略（Sameoriginpolicy）是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，则浏览器的正常功能可能都会受到影响。可以说Web是构建在同源策略基础之上的，浏览器只是针对同源策略的一种实现。同源策略会阻止一个域的javascript脚本和另外一个域的内容进行交互。所谓同源（即指在同一个域）就是两个页面具有相同的协议（protocol），主机（host）和端口号（port）</p>
<p><strong>如何解决跨域问题</strong></p>
<p>我们使用CORS的方式解决跨域</p>
<p>CORS 是跨域资源分享（Cross-Origin Resource Sharing）的缩写。它是 W3C 标准，属于跨源 AJAX 请求的根本解决方法。</p>
<p>在controller包下创建CorsInterceptor类实现Filter接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">package com.cstor.controller;</span><br><span class="line"></span><br><span class="line">import javax.servlet.*;</span><br><span class="line">import javax.servlet.annotation.WebFilter;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 用于前后端分离，允许跨域。</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@WebFilter(&quot;/*&quot;)</span><br><span class="line">public class CorsInterceptor implements Filter &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span><br><span class="line">            throws IOException, ServletException &#123;</span><br><span class="line">        HttpServletResponse resp = (HttpServletResponse) servletResponse;</span><br><span class="line">        //允许跨域访问，通过response对象写回一些跨域访问的头信息</span><br><span class="line">        resp.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span><br><span class="line">        //允许请求的方法</span><br><span class="line">        resp.setHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;GET,POST,PUT,DELETE&quot;);</span><br><span class="line">        //放行</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void destroy() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个类加入到项目中，即完成跨域配置</p>
<blockquote>
<p>编写Servlet进行web开发，使用webSocket保证服务器和浏览器的长连接进行实时推送数据，那么如何把浏览器和服务器贯通起来，请继续学习下一章节。</p>
</blockquote>
<h2 id="70-项目实训-股票行情实时仿真数据平台-股票看盘动态展示数据"><a href="#70-项目实训-股票行情实时仿真数据平台-股票看盘动态展示数据" class="headerlink" title="70.项目实训-股票行情实时仿真数据平台-股票看盘动态展示数据"></a>70.项目实训-股票行情实时仿真数据平台-股票看盘动态展示数据</h2><blockquote>
<h3 id="目的-11"><a href="#目的-11" class="headerlink" title="目的"></a>目的</h3><p>1.部署web项目</p>
<p>2.部署前端</p>
<h3 id="要求-11"><a href="#要求-11" class="headerlink" title="要求"></a>要求</h3><p>本次实验后，要求学生能：</p>
<p>1.可以使用Tomcat部署web项目</p>
<p>2.可以使用httpd服务进行部署前端项目</p>
<p>3.可以理解前端如何发送请求至服务器</p>
<h3 id="原理-11"><a href="#原理-11" class="headerlink" title="原理"></a>原理</h3><p><strong>服务器和浏览器是如何交互的？</strong></p>
<p>服务器是一种被动程序：只有当Internet上运行在其他计算机中的浏览器发出请求时，服务器才会响应。我们需要把后端项目部署到Tomcat，前端使用Httpd做代理，这样就可以完成可视化展示。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693289004092.png" alt="img"><br><strong>我们的前端程序采用Vue编写，什么是vue，它是做什么的？</strong><br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693289010141.png" alt="img"><br>Vue.js是一款流行的JavaScript前端框架，旨在更好地组织与简化Web开发。</p>
<ul>
<li>Vue所关注的核心是MVC模式中的视图层，同时，它也能方便地获取数据更新，并通过组件内部特定的方法实现视图与模型的交互。</li>
<li>通俗的来讲，vue就是一个已经搭建好的空屋，与单纯使用jQuery这种库比，可以更好地实现代码复用，减少工作量；、</li>
<li>与Angular.js这种家具电器一应俱全的框架相比又不会一件件挑选，把自己不喜欢再一件件的扔了，甚至required 必须用且耗费空间的！</li>
<li>简而言之，vue做了必须的事，又不会做职责之外的事。</li>
</ul>
<p><strong>什么是Echarts？</strong></p>
<p>实现前端的动态统计图，使用的是Echarts。</p>
<p>Echarts是商业级数据图表，它是一个纯JavaScript的图标库，兼容绝大部分的浏览器，底层依赖轻量级的canvas类库ZRender，提供直观，生动，可交互，可高度个性化定制的数据可视化图表。创新的拖拽重计算、数据视图、值域漫游等特性大大增强了用户体验，赋予了用户对数据进行挖掘、整合的能力。</p>
</blockquote>
<h3 id="1-部署后端项目"><a href="#1-部署后端项目" class="headerlink" title="1 部署后端项目"></a>1 部署后端项目</h3><p> 在上一章节，我们创建了web项目，并完成了代码编写。</p>
<p>在web项目中，我们打包并不是jar包，而是war包</p>
<p>我们直接点击Build进行打包<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693289018396.png" alt="img"><br>在项目列表中，out目录下找到打包好的项目，这个redis_web_war_exploded就是我们需要的<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693289024158.png" alt="img"><br>把整个文件夹上传到master节点，&#x2F;usr&#x2F;cstor&#x2F;tomcat&#x2F;webapps&#x2F; 目录下<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693289033270.png" alt="img"><br>由于名称过长修改名称为redisService,删除mbd<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693289039408.png" alt="img"><br>我们在开发工具IDEA中编写的代码依赖了很多jar包，但是放到Tomcat中之后也需要把这些jar包加入到Tomcat</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">mv /home/financial/tomcat_jars/* /usr/cstor/tomcat/lib/</span><br></pre></td></tr></table></figure>

<p>进入到&#x2F;usr&#x2F;cstor&#x2F;tomcat&#x2F;bin 目录下启动tomcat</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">cd /usr/cstor/tomcat/bin</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure>

<p>此时后端服务已经启动成功</p>
<h3 id="2-部署前端项目"><a href="#2-部署前端项目" class="headerlink" title="2 部署前端项目"></a>2 部署前端项目</h3><p> 在&#x2F;home&#x2F;financial目录下已经准备好了前端项目，我们把它移动到&#x2F;var&#x2F;www目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">mv /home/financial/html/ /var/www/</span><br></pre></td></tr></table></figure>

<p>需要修改一些访问路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">vim /var/www/html/index.html</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693289062870.png" alt="img"><br>这个时候前端也部署完成</p>
<p>我们输入主节点的ip地址到浏览器</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693289073798.png" alt="img"><br>点击分时<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693289079184.png" alt="img"></p>
<h2 id="71-项目实训-环境监控平台-数据采集项目基础（一）"><a href="#71-项目实训-环境监控平台-数据采集项目基础（一）" class="headerlink" title="71.项目实训-环境监控平台-数据采集项目基础（一）"></a>71.项目实训-环境监控平台-数据采集项目基础（一）</h2><blockquote>
<h3 id="目的-12"><a href="#目的-12" class="headerlink" title="目的"></a>目的</h3><p>完成本实验，您应该能够：</p>
<p>​    1. 掌握集群基本环境搭建</p>
<p>​    2. 掌握常用采集环境的配置与部署</p>
<p>​    3. 掌握基本采集环境的架构逻辑</p>
<h3 id="要求-12"><a href="#要求-12" class="headerlink" title="要求"></a>要求</h3><ul>
<li>熟悉maven相关基础知识</li>
<li>熟悉zookeeper组件部署</li>
<li>熟悉hadoop组件搭建</li>
<li>熟悉mysql接入方式</li>
</ul>
<h3 id="原理-12"><a href="#原理-12" class="headerlink" title="原理"></a>原理</h3><h4 id="环境猫项目实训架构描述"><a href="#环境猫项目实训架构描述" class="headerlink" title="环境猫项目实训架构描述"></a>环境猫项目实训架构描述</h4><p>日常行业内环境采集平台分为四个步骤：数据采集客户端，数据队列缓冲区，数据清洗及格式化以及最后的数据持久化。通过这四个步骤构建成下述的这个实验架构图，其中服务端+netty框架构建采集数据录入的通道，所有采集的毛数据经过草鸡通道进入kafka队列缓冲区中等待处理。<br>在队列中的数据我们称为环境毛数据，毛数据通过Kafka缓存在系统的内存以及Kafka内部的物理存储，接着我们需要通过java工程对队列中的数据进行统一的采集清洗。数据的采集及清洗主要是为了对采集过程中的脏数据以及空缺数据进行格式化处理，以确保数据格式的统一性以及数据的完整性。当数据清洗动作完成后，就是对数据的业务处理，业务处理的过程主要需要取决于业务的复杂性以及用户对数据的要求，一般会对数据适配一些业务算法并统计算法输出的结果。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693281360431.png" alt="img"></p>
<p>最后一步就是对数据的持久化，本实验样例中，把数据分别存储到hadoop的hdfs文件系统以及mysql中。其中hdfs的数据通过HBase提供后续的数据查询统计过程，在一些业务场景中，也会考虑对HBase的数据进一步推送到Hive中构建数据仓库，而mysql中的数据主要是针对日常实时性要求不高的统计展示类需求提供数据支撑。</p>
</blockquote>
<h2 id="实验任务一：maven部署"><a href="#实验任务一：maven部署" class="headerlink" title="实验任务一：maven部署"></a>实验任务一：maven部署</h2><p>Maven是一个项目管理工具，它包含了一项目对象模型(Project Object  Model)，一组标准集合，一个项目生命周期(Project Lifecycle)，一个依赖管理系统(Dependency  Manangement System)，和用来运行定义在生命周期阶段中插件目标的逻辑。<br>Maven是面向技术层面，针对Java开发项目管理工具，它提供了构建工具所提供功能的超集，除了构建功能之外，Maven还可以管理项目结构、管理依赖关系、生成报告、生成Web站点、有助于团队成员之间的交流与协作。</p>
<p>通过maven所能享受到的便利：<br>指导开发：提供了Java项目的最佳开发实践，自由开发项目骨架而可自动生成项目结构。<br>自动编译：不仅仅只像Ant自动编译，还包括测试，打包，发布，文档生成，项目站点生成……<br>依赖管理：Maven可以方便地管理应用程序依赖，例如第三方依赖、模型依赖<br>无限扩展：插件模式可以无限增强Maven功能，例如通过Tomcat、Jetty插件可以自由控制其服务器。<br>持续集成：鼓励开发者积极提交代码，更早地发现程序错误，在并行开发中稳妥推进。<br>开发协作：更简单和谐的团队协作。</p>
<h3 id="步骤一：Maven的安装及配置"><a href="#步骤一：Maven的安装及配置" class="headerlink" title="步骤一：Maven的安装及配置"></a>步骤一：Maven的安装及配置</h3><p>目前使用的idea默认自带maven插件可以点击idea-Preference中选择 Build-Build Tools-Maven查看maven配置</p>
<p>Maven home path为项目使用的maven版本，可以选择外部应用版本的maven也可以使用默认自带的平台<br>User settings file 为maven使用的配置文件，配置文件包含1.资源库地址 2.远端制品库地址 3.打包文件远端输出制品库配置<br>Local repository 本地资源库地址，一般直接配置在第二项的配置文件中，直接获取使用就可以了<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693281391016.png" alt="img"><br>在开始开发前需要配置一下maven，找到maven配置文件</p>
<p>C:\Program Files\JetBrains\IntelliJ IDEA 2020.1.1\plugins\maven\lib\maven3\conf<br>修改setting文件 添加本地仓库和远端仓库<br>在标签内添加自己的本地位置路径<br>D:\repository<br>添加标签下，添加国内镜像源，这样下载jar包速度很快。默认的中央仓库有时候甚至连接不通。一般使用阿里云镜像库即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;mirror&gt;</span><br><span class="line">  &lt;id&gt;aliyunmaven&lt;/id&gt;</span><br><span class="line">  &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;</span><br><span class="line">  &lt;name&gt;阿里云公共仓库&lt;/name&gt;</span><br><span class="line">  &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;</span><br><span class="line"> &lt;/mirror&gt;</span><br></pre></td></tr></table></figure>

<h3 id="步骤二：Maven-名词解释"><a href="#步骤二：Maven-名词解释" class="headerlink" title="步骤二：Maven 名词解释"></a>步骤二：Maven 名词解释</h3><ul>
<li>Project：任何您想build的事物，Maven都可以认为它们是工程。这些工程被定义为工程对象模型(POM，Poject Object Model)。一个工程可以依赖其它的工程；一个工程也可以由多个子工程构成。</li>
<li>POM：POM(pom.xml)是Maven的核心文件，它是指示Maven如何工作的元数据文件，类似于Ant中的build.xml文件。POM文件位于每个工程的根目录中。</li>
<li>GroupId：groupId是一个工程的在全局中唯一的标识符，一般地，它就是工程名。groupId有利于使用一个完全的包名，将一个工程从其它有类似名称的工程里区别出来。</li>
<li>Artifact：artifact  是工程将要产生或需要使用的文件，它可以是jar文件，源文件，二进制文件，war文件，甚至是pom文件。每个artifact都由groupId和  artifactId组合的标识符唯一识别。需要被使用(依赖)的artifact都要放在仓库(见Repository)中，否则Maven无法找到  (识别)它们。</li>
<li>Dependency：为了能够build或运行，一个典型的Java工程会依赖其它的包。在Maven中，这些被依赖的包就被称为dependency。dependency一般是其它工程的artifact。</li>
<li>Plug-in：Maven是由插件组织的，它的每一个功能都是由插件提供的。插件提供goal(类似于Ant中的target)，并根据在POM中找到的元数据去完成工作。主要的Maven插件要是由Java写成的，但它也支持用Beanshell或Ant脚本写成的插件。</li>
<li>Repository：仓库。</li>
</ul>
<h3 id="步骤三：pom-xml文件属性描述"><a href="#步骤三：pom-xml文件属性描述" class="headerlink" title="步骤三：pom.xml文件属性描述"></a>步骤三：pom.xml文件属性描述</h3><p>Maven项目的核心配置文件，位于每个工程的根目录，指示Maven工作的元数据文件。<br>节点介绍</p>
<ul>
<li>：文件的根节点</li>
<li>： pom.xml使用的对象模型版本</li>
<li>：创建项目的组织或团体的唯一 Id</li>
<li>：项目的唯一 Id, 可视为项目名</li>
<li>：打包类型，一般有JAR,WAR,EAR 等</li>
<li>：产品的版本号</li>
<li>：项目的显示名，常用于 Maven 生成的文档</li>
<li>：组织的站点，常用于 Maven 生成的文档</li>
<li>：项目描述，常用于 Maven 生成的文档</li>
<li>：构件依赖</li>
<li>：模型继承</li>
<li>：依赖管理</li>
<li>：创建报告</li>
<li>：构建</li>
<li>：引用第三方仓库</li>
<li>：许可</li>
</ul>
<h3 id="步骤四：样例构建"><a href="#步骤四：样例构建" class="headerlink" title="步骤四：样例构建"></a>步骤四：样例构建</h3><p>构建一个最简单的maven项目的pom文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;&lt;!--pom文件使用的maven模型版本--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.example&lt;/groupId&gt;&lt;!--项目所属组织唯一性id--&gt;</span><br><span class="line">    &lt;artifactId&gt;testProject&lt;/artifactId&gt;&lt;!--项目名称--&gt;</span><br><span class="line">    &lt;version&gt;VERSION-1.0&lt;/version&gt;&lt;!--版本号--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;&lt;!--配置常量--&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line">    &lt;dependencies&gt;&lt;!--依赖组--&gt;</span><br><span class="line">        &lt;dependency&gt;&lt;!--依赖的包--&gt;</span><br><span class="line">            &lt;groupId&gt;commons-lang&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.6&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h2 id="实验任务二：配置各个组件环境变量"><a href="#实验任务二：配置各个组件环境变量" class="headerlink" title="实验任务二：配置各个组件环境变量"></a>实验任务二：配置各个组件环境变量</h2><p>进入集群的环境变量配置文件进行修改<br>测试JDK是否安装成功</p>
<h4 id="修改环境变量配置文件"><a href="#修改环境变量配置文件" class="headerlink" title="修改环境变量配置文件"></a>修改环境变量配置文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /root/.bash_profile</span><br></pre></td></tr></table></figure>

<h4 id="添加环境变量参数"><a href="#添加环境变量参数" class="headerlink" title="添加环境变量参数"></a>添加环境变量参数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">##JAVA_HOME</span><br><span class="line">export JAVA_HOME=/usr/local/jdk1.8.0_161</span><br><span class="line">export JRE_HOME=/usr/local/jdk1.8.0_161/jre</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib</span><br><span class="line">##HADOOP_HOME</span><br><span class="line">export HADOOP_HOME=/opt/module/hadoop-3.1.3</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/bin</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/sbin</span><br><span class="line">export HDFS_NAMENODE_USER=root</span><br><span class="line">export HDFS_DATANODE_USER=root</span><br><span class="line">export HDFS_SECONDARYNAMENODE_USER=root</span><br><span class="line">export YARN_RESOURCEMANAGER_USER=root</span><br><span class="line">export YARN_NODEMANAGER_USER=root</span><br><span class="line"></span><br><span class="line">##ZOOKEEPER_HOME</span><br><span class="line">export ZOOKEEPER_HOME=/opt/module/zookeeper</span><br><span class="line">export PATH=$PATH:$ZOOKEEPER_HOME/bin</span><br><span class="line"></span><br><span class="line">##KAFKA_HOME</span><br><span class="line">export KAFKA_HOME=/opt/module/kafka</span><br><span class="line">export PATH=$PATH:$KAFKA_HOME/bin</span><br><span class="line"></span><br><span class="line">##HBASE_HOME</span><br><span class="line">export HBASE_HOME=/opt/module/hbase</span><br><span class="line">export PATH=$PATH:$HBASE_HOME/bin</span><br><span class="line"></span><br><span class="line">#phoenix</span><br><span class="line">export PHOENIX_HOME=/opt/module/phoenix</span><br><span class="line">export PHOENIX_CLASSPATH=$PHOENIX_HOME</span><br><span class="line">export PATH=$PATH:$PHOENIX_HOME/bin</span><br></pre></td></tr></table></figure>

<h4 id="保存环境变量并生效"><a href="#保存环境变量并生效" class="headerlink" title="保存环境变量并生效"></a>保存环境变量并生效</h4><p>:wq 保存添加的环境变量信息<br>令环境变量立即生效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /root/.bash_profile</span><br></pre></td></tr></table></figure>

<h4 id="通过查看JDK版本验证环境变量是否生效"><a href="#通过查看JDK版本验证环境变量是否生效" class="headerlink" title="通过查看JDK版本验证环境变量是否生效"></a>通过查看JDK版本验证环境变量是否生效</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>

<p>如果能看到以下结果、则标识环境变量生效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java version &quot;1.8.0_161&quot;</span><br></pre></td></tr></table></figure>

<h3 id="linux快捷化运维脚本"><a href="#linux快捷化运维脚本" class="headerlink" title="linux快捷化运维脚本"></a>linux快捷化运维脚本</h3><h4 id="快速分发文件脚本"><a href="#快速分发文件脚本" class="headerlink" title="快速分发文件脚本"></a>快速分发文件脚本</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">mkdir /module/shell</span><br><span class="line">vim /module/shell/xsync</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">#1. 判断参数个数</span><br><span class="line">if [ $# -lt 1 ]</span><br><span class="line">then</span><br><span class="line">  echo Not Enough Arguement!</span><br><span class="line">  exit;</span><br><span class="line">fi</span><br><span class="line">#2. 遍历集群所有机器</span><br><span class="line">for host in master slave1 slave2</span><br><span class="line">do</span><br><span class="line">  echo ====================  $host  ====================</span><br><span class="line">  #3. 遍历所有目录，挨个发送</span><br><span class="line">  for file in $@</span><br><span class="line">  do</span><br><span class="line">    #4 判断文件是否存在</span><br><span class="line">    if [ -e $file ]</span><br><span class="line">    then</span><br><span class="line">      #5. 获取父目录</span><br><span class="line">      pdir=$(cd -P $(dirname $file); pwd)</span><br><span class="line">      #6. 获取当前文件的名称</span><br><span class="line">      fname=$(basename $file)</span><br><span class="line">      ssh $host &quot;mkdir -p $pdir&quot;</span><br><span class="line">      rsync -av $pdir/$fname $host:$pdir</span><br><span class="line">    else</span><br><span class="line">      echo $file does not exists!</span><br><span class="line">    fi</span><br><span class="line">  done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>1)保存脚本信息 :wq<br>2)修改jpsall权限  chmod  +x &#x2F;module&#x2F;shell&#x2F;xsync<br>3)移动脚本文件到bin目录下，使脚本可以全局执行  mv &#x2F;module&#x2F;shell&#x2F;xsync  &#x2F;bin<br>4)测试脚本 xsync &#x2F;bin&#x2F;xsync</p>
<h4 id="集群多台服务器jps运行状态监控"><a href="#集群多台服务器jps运行状态监控" class="headerlink" title="集群多台服务器jps运行状态监控"></a>集群多台服务器jps运行状态监控</h4><p>vim &#x2F;module&#x2F;shell&#x2F;jpsall</p>
<p>#!&#x2F;bin&#x2F;bash<br>for i in master slave1 slave2<br>do<br>        echo “&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; $i &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;”<br>        ssh $i “jps” | grep -v jps<br>done</p>
<p>1)保存脚本信息 :wq<br>2)修改jpsall权限  chmod  +x &#x2F;module&#x2F;shell&#x2F;jpsall<br>3)移动脚本文件到bin目录下，使脚本可以全局执行  mv &#x2F;module&#x2F;shell&#x2F;jpsall  &#x2F;bin<br>4)测试脚本 jpsall</p>
<h4 id="给三台机器配置域名"><a href="#给三台机器配置域名" class="headerlink" title="给三台机器配置域名"></a>给三台机器配置域名</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/hosts</span><br></pre></td></tr></table></figure>

<p>添加下下述服务器及对应域名（ip要根据对应服务器ip进行调整）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.11.1 master</span><br><span class="line">192.168.11.2 slave1</span><br><span class="line">192.168.11.3 slave2</span><br></pre></td></tr></table></figure>

<p>分发hosts文件到各台机器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync /etc/hosts</span><br></pre></td></tr></table></figure>

<p>测试域名是否配置成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PING slave1 (192.168.11.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from slave1(192.168.11.2): icmp_seq=1 ttl=64 time=2.76 ms</span><br><span class="line">64 bytes from slave1(192.168.11.2): icmp_seq=2 ttl=64 time=0.689 ms</span><br><span class="line">64 bytes from slave1(192.168.11.2): icmp_seq=3 ttl=64 time=0.651 ms</span><br></pre></td></tr></table></figure>

<h4 id="对三个节点做SSH免密"><a href="#对三个节点做SSH免密" class="headerlink" title="对三个节点做SSH免密"></a>对三个节点做SSH免密</h4><p>使用ssh工具登录到每一台服务器，执行命令ssh 主机名，确认每台集群服务器均可SSH免密登录。<br>执行命令ssh-keygen，生成master服务器密钥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure>

<p>如图所示：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693281538017.png" alt="img"></p>
<p>发送master的秘钥给另外两台节点的机器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id master</span><br><span class="line">ssh-copy-id slave1</span><br><span class="line">ssh-copy-id slave2</span><br></pre></td></tr></table></figure>

<p>同样操作执行slave1和slave2两台机器，生成两台机器的秘钥并分发给全部三台机器<br>验证免密是否生效，ssh访问子节点不用输入密码直接登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@slave1 </span><br></pre></td></tr></table></figure>

<h2 id="实验任务三：hadoop搭建"><a href="#实验任务三：hadoop搭建" class="headerlink" title="实验任务三：hadoop搭建"></a>实验任务三：hadoop搭建</h2><h3 id="步骤一：解压组件压缩包"><a href="#步骤一：解压组件压缩包" class="headerlink" title="步骤一：解压组件压缩包"></a>步骤一：解压组件压缩包</h3><h4 id="解压安装文件到-opt-module下面"><a href="#解压安装文件到-opt-module下面" class="headerlink" title="解压安装文件到&#x2F;opt&#x2F;module下面"></a>解压安装文件到&#x2F;opt&#x2F;module下面</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/software</span><br><span class="line">tar -zxvf hadoop-3.1.3.tar.gz -C /opt/module/</span><br><span class="line">mv hadoop-3.1.3 /opt/module/hadoop</span><br></pre></td></tr></table></figure>

<h4 id="查看是否解压成功"><a href="#查看是否解压成功" class="headerlink" title="查看是否解压成功"></a>查看是否解压成功</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /opt/module/</span><br></pre></td></tr></table></figure>

<h3 id="步骤二：集群规划"><a href="#步骤二：集群规划" class="headerlink" title="步骤二：集群规划"></a>步骤二：集群规划</h3><p>集群部署规划<br>    注意：NameNode和SecondaryNameNode不要安装在同一台服务器<br>    注意：ResourceManager也很消耗内存，不要和NameNode、SecondaryNameNode配置在同一台机器上。</p>
<table>
<thead>
<tr>
<th></th>
<th>master</th>
<th>slave1</th>
<th>slave2</th>
</tr>
</thead>
<tbody><tr>
<td>HDFS</td>
<td>NameNode&amp;DataNode</td>
<td>DataNode</td>
<td>SecondaryNameNode&amp;DataNode</td>
</tr>
<tr>
<td>YARN</td>
<td>NodeManager</td>
<td>ResourceManager&amp;NodeManager</td>
<td>NodeManager</td>
</tr>
</tbody></table>
<h3 id="步骤三：修改核心配置文件"><a href="#步骤三：修改核心配置文件" class="headerlink" title="步骤三：修改核心配置文件"></a>步骤三：修改核心配置文件</h3><p>进入hadoop解压目录的配置文件目录 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/hadoop/etc/hadoop</span><br><span class="line">vim core-site.xml</span><br></pre></td></tr></table></figure>

<p>添加相关配置信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;hdfs://master:8020&lt;/value&gt;  &lt;!--定义客户端默认访问地址和端口--&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.data.dir&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;/opt/module/hadoop/data&lt;/value&gt;  &lt;!--hdfs临时目录--&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.proxyuser.root.hosts&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;*&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.proxyuser.root.groups&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;*&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h3 id="步骤四：修改HDFS配置文件"><a href="#步骤四：修改HDFS配置文件" class="headerlink" title="步骤四：修改HDFS配置文件"></a>步骤四：修改HDFS配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim hdfs-site.xml</span><br></pre></td></tr></table></figure>

<p>添加相关配置信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt; &lt;!--命名信息的临时目录--&gt;</span><br><span class="line">    &lt;value&gt;file://$&#123;hadoop.data.dir&#125;/name&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt; &lt;!--数据节点的临时目录--&gt;</span><br><span class="line">    &lt;value&gt;file://$&#123;hadoop.data.dir&#125;/data&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.checkpoint.dir&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;file://$&#123;hadoop.data.dir&#125;/namesecondary&lt;/value&gt;&lt;!--2NN数据临时目录--&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.client.datanode-restart.timeout&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;30&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;slave2:9868&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h3 id="步骤五：修改YARN配置文件"><a href="#步骤五：修改YARN配置文件" class="headerlink" title="步骤五：修改YARN配置文件"></a>步骤五：修改YARN配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim yarn-site.xml</span><br></pre></td></tr></table></figure>

<p>添加相关配置信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;slave1&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.nodemanager.env-whitelist&lt;/name&gt;      &lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;&lt;!-- 日志聚集 --&gt;</span><br><span class="line">            &lt;name&gt;yarn.log-aggregation-enable&lt;/name&gt;</span><br><span class="line">            &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">            &lt;name&gt;yarn.log.server.url&lt;/name&gt;</span><br><span class="line">            &lt;value&gt;http://master:19888/jobhistory/logs&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">            &lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt;</span><br><span class="line">            &lt;value&gt;604800&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h3 id="步骤六：修改MapReduce配置文件"><a href="#步骤六：修改MapReduce配置文件" class="headerlink" title="步骤六：修改MapReduce配置文件"></a>步骤六：修改MapReduce配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim mapred-site.xml</span><br></pre></td></tr></table></figure>

<p>添加相关配置信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;yarn&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;&lt;!-- 历史服务器端地址--&gt;</span><br><span class="line">            &lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;</span><br><span class="line">            &lt;value&gt;master:10020&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;&lt;!-- 历史服务器web端地址 --&gt;</span><br><span class="line">            &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt;</span><br><span class="line">            &lt;value&gt;master:19888&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h3 id="步骤七：配置workers"><a href="#步骤七：配置workers" class="headerlink" title="步骤七：配置workers"></a>步骤七：配置workers</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/module/hadoop/etc/hadoop/workers</span><br></pre></td></tr></table></figure>

<p>添加内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">master</span><br><span class="line">slave1</span><br><span class="line">slave2</span><br></pre></td></tr></table></figure>

<h3 id="步骤八：分发配置的所有配置文件到slave1节点和slave2节点"><a href="#步骤八：分发配置的所有配置文件到slave1节点和slave2节点" class="headerlink" title="步骤八：分发配置的所有配置文件到slave1节点和slave2节点"></a>步骤八：分发配置的所有配置文件到slave1节点和slave2节点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync /opt/module/hadoop/etc/hadoop/</span><br></pre></td></tr></table></figure>

<p>也可以使用scp命令推送至其他节点，但较为繁琐</p>
<h4 id="检查各个节点的文件分发情况"><a href="#检查各个节点的文件分发情况" class="headerlink" title="检查各个节点的文件分发情况"></a>检查各个节点的文件分发情况</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh root@slave1</span><br><span class="line">cat /opt/module/hadoop/etc/hadoop/</span><br><span class="line">ls</span><br></pre></td></tr></table></figure>

<h4 id="步骤九：启动集群"><a href="#步骤九：启动集群" class="headerlink" title="步骤九：启动集群"></a>步骤九：启动集群</h4><p>如果集群是第一次启动，需要在hadoop102节点格式化NameNode（注意格式化之前，一定要先停止上次启动的所有namenode和datanode进程，然后再删除data和log数据）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs namenode -format</span><br></pre></td></tr></table></figure>

<h5 id="分别启动-停止HDFS组件"><a href="#分别启动-停止HDFS组件" class="headerlink" title="分别启动&#x2F;停止HDFS组件"></a>分别启动&#x2F;停止HDFS组件</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs –daemon start/stop namenode/datanode/secondarynamenode</span><br></pre></td></tr></table></figure>

<h5 id="启动-停止YARN"><a href="#启动-停止YARN" class="headerlink" title="启动&#x2F;停止YARN"></a>启动&#x2F;停止YARN</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn --daemon start/stop  resourcemanager/nodemanager</span><br></pre></td></tr></table></figure>

<h5 id="整体启动-停止HDFS"><a href="#整体启动-停止HDFS" class="headerlink" title="整体启动&#x2F;停止HDFS"></a>整体启动&#x2F;停止HDFS</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-dfs.sh/stop-dfs.sh</span><br></pre></td></tr></table></figure>

<h5 id="整体启动-停止YARN"><a href="#整体启动-停止YARN" class="headerlink" title="整体启动&#x2F;停止YARN"></a>整体启动&#x2F;停止YARN</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-yarn.sh/stop-yarn.sh</span><br></pre></td></tr></table></figure>

<h5 id="全部启动"><a href="#全部启动" class="headerlink" title="全部启动"></a>全部启动</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-all.sh/stop-all.sh</span><br></pre></td></tr></table></figure>

<h5 id="查看各节点组件运行状态是否正常"><a href="#查看各节点组件运行状态是否正常" class="headerlink" title="查看各节点组件运行状态是否正常"></a>查看各节点组件运行状态是否正常</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jpsall</span><br></pre></td></tr></table></figure>

<h4 id="集群测试"><a href="#集群测试" class="headerlink" title="集群测试"></a>集群测试</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/test/testdata</span><br><span class="line">hadoop fs -mkdir -p /test/input</span><br><span class="line">hadoop fs -put /opt/test/testdata  /test/input</span><br></pre></td></tr></table></figure>

<p>Web端查看SecondaryNameNode<br>（a）浏览器中输入：<a target="_blank" rel="noopener" href="http://master:50090/">http://master:50090</a><br>（b）查看集群上传的testdata文件信息</p>
<h2 id="实验任务四：Zookeeper搭建"><a href="#实验任务四：Zookeeper搭建" class="headerlink" title="实验任务四：Zookeeper搭建"></a>实验任务四：Zookeeper搭建</h2><p>在三节点上master，slave1，slave2搭建分布式的Zookeeper</p>
<h3 id="步骤一：Zookeeper解压"><a href="#步骤一：Zookeeper解压" class="headerlink" title="步骤一：Zookeeper解压"></a>步骤一：Zookeeper解压</h3><h4 id="解压安装文件到-opt-module下面-1"><a href="#解压安装文件到-opt-module下面-1" class="headerlink" title="解压安装文件到&#x2F;opt&#x2F;module下面"></a>解压安装文件到&#x2F;opt&#x2F;module下面</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cd /opt/software</span><br><span class="line">tar -zxvf zookeeper-3.5.7.tar.gz -C /opt/module/</span><br><span class="line">mv zookeeper-3.5.7 /opt/module/zookeeper</span><br></pre></td></tr></table></figure>

<h4 id="查看是否解压成功-1"><a href="#查看是否解压成功-1" class="headerlink" title="查看是否解压成功"></a>查看是否解压成功</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /opt/module/</span><br></pre></td></tr></table></figure>

<h3 id="步骤二：Zookeeper分布式集群配置"><a href="#步骤二：Zookeeper分布式集群配置" class="headerlink" title="步骤二：Zookeeper分布式集群配置"></a>步骤二：Zookeeper分布式集群配置</h3><h4 id="配置zoo-cfg文件"><a href="#配置zoo-cfg文件" class="headerlink" title="配置zoo.cfg文件"></a>配置zoo.cfg文件</h4><p>重命名&#x2F;opt&#x2F;module&#x2F;zookeeper&#x2F;conf目录下的zoo_sample.cfg为zoo.cfg</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure>

<h4 id="修改zoo-cfg文件中的数据存储路径配置"><a href="#修改zoo-cfg文件中的数据存储路径配置" class="headerlink" title="修改zoo.cfg文件中的数据存储路径配置"></a>修改zoo.cfg文件中的数据存储路径配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim zoo.cfg</span><br><span class="line">dataDir=/opt/module/zookeeper/zkData</span><br></pre></td></tr></table></figure>

<h4 id="增加如下集群配置，配置格式为server-A-B-C-D"><a href="#增加如下集群配置，配置格式为server-A-B-C-D" class="headerlink" title="增加如下集群配置，配置格式为server.A&#x3D;B:C:D"></a>增加如下集群配置，配置格式为server.A&#x3D;B:C:D</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#######################cluster##########################</span><br><span class="line">server.1=master:2888:3888</span><br><span class="line">server.2=salve1:2888:3888</span><br><span class="line">server.3=salve2:2888:3888</span><br></pre></td></tr></table></figure>

<p>A标识在集群中的server序号<br>集群模式会在数据存储路径下dataDir（本例中即是&#x2F;opt&#x2F;module&#x2F;zookeeper&#x2F;zkData）下配置一个myid文件，此文件中数值即为本机的server序号，Zookeeper启动时读取此文件，拿到里面的数据与zoo.cfg里面的配置信息比较从而判断到底是哪个server。<br>B是这个服务器的地址。<br>C是这个服务器Follower与集群中的Leader服务器交换信息的端口。<br>D是万一集群中的Leader服务器挂了，需要一个端口来重新进行选举，选出一个新的Leader，而这个端口就是用来执行选举时服务器相互通信的端口。</p>
<h4 id="在数据存储路径下dataDir目录下创建myid-并在myid中添加对应server的序号"><a href="#在数据存储路径下dataDir目录下创建myid-并在myid中添加对应server的序号" class="headerlink" title="在数据存储路径下dataDir目录下创建myid,并在myid中添加对应server的序号"></a>在数据存储路径下dataDir目录下创建myid,并在myid中添加对应server的序号</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/zookeeper/zkData</span><br><span class="line">vim myid</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h4 id="拷贝配置好的zookeeper目录到各个子节点"><a href="#拷贝配置好的zookeeper目录到各个子节点" class="headerlink" title="拷贝配置好的zookeeper目录到各个子节点"></a>拷贝配置好的zookeeper目录到各个子节点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync /opt/module/zookeeper</span><br></pre></td></tr></table></figure>

<p>修改slave1节点下的&#x2F;opt&#x2F;module&#x2F;zookeeper&#x2F;zkData&#x2F;myid内容为2，修改slave2节点下的&#x2F;opt&#x2F;module&#x2F;zookeeper&#x2F;zkData&#x2F;myid内容为3</p>
<h3 id="步骤三：Zookeeper集群启动"><a href="#步骤三：Zookeeper集群启动" class="headerlink" title="步骤三：Zookeeper集群启动"></a>步骤三：Zookeeper集群启动</h3><h5 id="分别依次到各个节点master，slave1，slave2启动zookeeper"><a href="#分别依次到各个节点master，slave1，slave2启动zookeeper" class="headerlink" title="分别依次到各个节点master，slave1，slave2启动zookeeper"></a>分别依次到各个节点master，slave1，slave2启动zookeeper</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkServer.sh start</span><br></pre></td></tr></table></figure>

<h5 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkServer.sh status</span><br></pre></td></tr></table></figure>

<h5 id="增加linux集群脚本"><a href="#增加linux集群脚本" class="headerlink" title="增加linux集群脚本"></a>增加linux集群脚本</h5><p>把登录多节点集群启动，改为通过脚本一次性启动整个集群所有节点并查看启动后脚本，添加脚本zkAll</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim zkAll</span><br></pre></td></tr></table></figure>

<h5 id="添加脚本内容，一次登录各个节点并执行zookeeper的服务zkServer-sh"><a href="#添加脚本内容，一次登录各个节点并执行zookeeper的服务zkServer-sh" class="headerlink" title="添加脚本内容，一次登录各个节点并执行zookeeper的服务zkServer.sh"></a>添加脚本内容，一次登录各个节点并执行zookeeper的服务zkServer.sh</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">for host in master slave1 slave2</span><br><span class="line">do</span><br><span class="line">echo &quot;========== $host ============&quot;</span><br><span class="line">ssh $host &quot;source /etc/profile;/opt/module/zookeeper/bin/zkServer.sh $1&quot;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">sleep 2</span><br><span class="line">for host in master slave1 slave2</span><br><span class="line">do</span><br><span class="line">echo &quot;========== $host ============&quot;</span><br><span class="line">ssh $host &quot;source /etc/profile;/opt/module/zookeeper/bin/zkServer.sh status&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h5 id="保存脚本并把脚本加入系统全局命令"><a href="#保存脚本并把脚本加入系统全局命令" class="headerlink" title="保存脚本并把脚本加入系统全局命令"></a>保存脚本并把脚本加入系统全局命令</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x zkall</span><br><span class="line">mv zkall /bin</span><br></pre></td></tr></table></figure>

<h5 id="测试集群启动脚本"><a href="#测试集群启动脚本" class="headerlink" title="测试集群启动脚本"></a>测试集群启动脚本</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">zkAll start</span><br><span class="line">========== master ============</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/module/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">========== slave1 ============</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/module/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">========== slave2 ============</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/module/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">========== master ============</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/module/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost.</span><br><span class="line">Mode: follower</span><br><span class="line">========== slave1 ============</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/module/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost.</span><br><span class="line">Mode: leader</span><br><span class="line">========== slave2 ============</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/module/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost.</span><br><span class="line">Mode: follower</span><br></pre></td></tr></table></figure>

<h3 id="步骤四：客户端命令"><a href="#步骤四：客户端命令" class="headerlink" title="步骤四：客户端命令"></a>步骤四：客户端命令</h3><table>
<thead>
<tr>
<th>命令基本语法</th>
<th>功能描述</th>
</tr>
</thead>
<tbody><tr>
<td>help</td>
<td>显示所有操作命令</td>
</tr>
<tr>
<td>ls path [watch]</td>
<td>使用 ls 命令来查看当前znode中所包含的内容</td>
</tr>
<tr>
<td>ls2 path [watch]</td>
<td>查看当前节点数据并能看到更新次数等数据</td>
</tr>
<tr>
<td>create</td>
<td>普通创建</td>
</tr>
<tr>
<td>-s</td>
<td>含有序列</td>
</tr>
<tr>
<td>-e</td>
<td>临时（重启或者超时消失）</td>
</tr>
<tr>
<td>get path [watch]</td>
<td>获得节点的值</td>
</tr>
<tr>
<td>set</td>
<td>设置节点的具体值</td>
</tr>
<tr>
<td>stat</td>
<td>查看节点状态</td>
</tr>
<tr>
<td>delete</td>
<td>删除节点</td>
</tr>
<tr>
<td>rmr</td>
<td>递归删除节点</td>
</tr>
</tbody></table>
<p>1．启动客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkCli.sh</span><br></pre></td></tr></table></figure>

<p>2．显示所有操作命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 1] help</span><br></pre></td></tr></table></figure>

<p>3．查看当前znode中所包含的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] ls /</span><br><span class="line">[zookeeper]</span><br></pre></td></tr></table></figure>

<p>4．查看当前节点详细数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 1] ls2 /</span><br><span class="line">[zookeeper]</span><br><span class="line">cZxid = 0x0</span><br><span class="line">ctime = Thu Jan 11 09:00:00 CST 2021</span><br><span class="line">mZxid = 0x0</span><br><span class="line">mtime = Thu Jan 11 09:00:00 CST 2021</span><br><span class="line">pZxid = 0x0</span><br><span class="line">cversion = -1</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 1</span><br></pre></td></tr></table></figure>

<p>5．创建普通节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 3] create /hadoop &quot;hdfs&quot;</span><br><span class="line">[zk: localhost:2181(CONNECTED) 4] create /hadoop/hbase &quot;phoenix&quot;</span><br></pre></td></tr></table></figure>

<p>6．删除节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 4] delete /hadoop/hbase</span><br></pre></td></tr></table></figure>

<p>7．递归删除节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 15] rmr /hadoop/hbase</span><br></pre></td></tr></table></figure>

<p>8．查看节点状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 17] stat /hadoop</span><br></pre></td></tr></table></figure>

<h2 id="实验任务八：mysql接入"><a href="#实验任务八：mysql接入" class="headerlink" title="实验任务八：mysql接入"></a>实验任务八：mysql接入</h2><p>由于集群自带mysql所以只要进行一些授权配置就可以了</p>
<h3 id="步骤一：配置mysql账号密码"><a href="#步骤一：配置mysql账号密码" class="headerlink" title="步骤一：配置mysql账号密码"></a>步骤一：配置mysql账号密码</h3><p>连接vpn访问集群</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -u root password &#x27;123456&#x27;</span><br></pre></td></tr></table></figure>

<p>登录mysql，密码是123456</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>

<h3 id="步骤二：mysql授权"><a href="#步骤二：mysql授权" class="headerlink" title="步骤二：mysql授权"></a>步骤二：mysql授权</h3><p>授权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>

<p>选中mysql数据库，修改密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"> update user set password=&#x27;*6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9&#x27; where host=&#x27;master&#x27; and user=&#x27;root&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="步骤三：刷新配置"><a href="#步骤三：刷新配置" class="headerlink" title="步骤三：刷新配置"></a>步骤三：刷新配置</h3><p>刷新配置，使配置生效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

<h2 id="72-项目实训-环境监控平台-数据采集项目基础（二）"><a href="#72-项目实训-环境监控平台-数据采集项目基础（二）" class="headerlink" title="72.项目实训-环境监控平台-数据采集项目基础（二）"></a>72.项目实训-环境监控平台-数据采集项目基础（二）</h2><blockquote>
<h3 id="目的-13"><a href="#目的-13" class="headerlink" title="目的"></a>目的</h3><p>完成本实验，您应该能够：</p>
<ul>
<li>掌握集群基本环境搭建</li>
<li>掌握常用采集环境的配置与部署</li>
<li>掌握基本采集环境的架构逻辑</li>
</ul>
<h3 id="要求-13"><a href="#要求-13" class="headerlink" title="要求"></a>要求</h3><ul>
<li>熟悉Kafka队列工具部署</li>
<li>熟悉Kafka相关基本shell命令操作</li>
<li>熟悉Kafka在集群场景下的的用法</li>
<li>熟悉Hbase组件部署</li>
</ul>
<h3 id="原理-13"><a href="#原理-13" class="headerlink" title="原理"></a>原理</h3><h2 id="环境猫项目实训架构描述："><a href="#环境猫项目实训架构描述：" class="headerlink" title="环境猫项目实训架构描述："></a>环境猫项目实训架构描述：</h2><p>日常行业内环境采集平台分为四个步骤：数据采集客户端，数据队列缓冲区，数据清洗及格式化以及最后的数据持久化。通过这四个步骤构建成下述的这个实验架构图，其中服务端+netty框架构建采集数据录入的通道，所有采集的毛数据经过草鸡通道进入kafka队列缓冲区中等待处理。<br>在队列中的数据我们称为环境毛数据，毛数据通过Kafka缓存在系统的内存以及Kafka内部的物理存储，接着我们需要通过java工程对队列中的数据进行统一的采集清洗。数据的采集及清洗主要是为了对采集过程中的脏数据以及空缺数据进行格式化处理，以确保数据格式的统一性以及数据的完整性。当数据清洗动作完成后，就是对数据的业务处理，业务处理的过程主要需要取决于业务的复杂性以及用户对数据的要求，一般会对数据适配一些业务算法并统计算法输出的结果。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693285898017.png" alt="img"><br>最后一步就是对数据的持久化，本实验样例中，把数据分别存储到hadoop的hdfs文件系统以及mysql中。其中hdfs的数据通过HBase提供后续的数据查询统计过程，在一些业务场景中，也会考虑对HBase的数据进一步推送到Hive中构建数据仓库，而mysql中的数据主要是针对日常实时性要求不高的统计展示类需求提供数据支撑。</p>
</blockquote>
<h2 id="实验任务五：Kafka搭建"><a href="#实验任务五：Kafka搭建" class="headerlink" title="实验任务五：Kafka搭建"></a>实验任务五：Kafka搭建</h2><h3 id="步骤一：解压组件包"><a href="#步骤一：解压组件包" class="headerlink" title="步骤一：解压组件包"></a>步骤一：解压组件包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf kafka_2.11-2.4.1.tgz -C /opt/module/</span><br><span class="line">mv /opt/module/kafka_2.11-2.4.1 /opt/module/kafka</span><br></pre></td></tr></table></figure>

<h3 id="步骤二：创建日志文件夹"><a href="#步骤二：创建日志文件夹" class="headerlink" title="步骤二：创建日志文件夹"></a>步骤二：创建日志文件夹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/module/kafka/logs</span><br></pre></td></tr></table></figure>

<h3 id="步骤三：配置环境变量"><a href="#步骤三：配置环境变量" class="headerlink" title="步骤三：配置环境变量"></a>步骤三：配置环境变量</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /root/.bash_profile</span><br></pre></td></tr></table></figure>

<p>添加下述kafka环境配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#KAFKA_HOME</span><br><span class="line">export KAFKA_HOME=/opt/module/kafka</span><br><span class="line">export PATH=$PATH:$KAFKA_HOME/bin</span><br></pre></td></tr></table></figure>

<p>生效环境配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /root/.bash_profile</span><br></pre></td></tr></table></figure>

<h3 id="步骤四：修改配置文件"><a href="#步骤四：修改配置文件" class="headerlink" title="步骤四：修改配置文件"></a>步骤四：修改配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/config/</span><br><span class="line">vim server.properties</span><br></pre></td></tr></table></figure>

<p>输入以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#broker的全局唯一编号，不能重复</span><br><span class="line">broker.id=0</span><br><span class="line">#删除topic功能使能</span><br><span class="line">delete.topic.enable=true</span><br><span class="line">#处理网络请求的线程数量</span><br><span class="line">num.network.threads=3</span><br><span class="line">#用来处理磁盘IO的现成数量</span><br><span class="line">num.io.threads=8</span><br><span class="line">#发送套接字的缓冲区大小</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">#接收套接字的缓冲区大小</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">#请求套接字的缓冲区大小</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line">#kafka运行日志存放的路径</span><br><span class="line">log.dirs=/opt/module/kafka/logs</span><br><span class="line">#topic在当前broker上的分区个数</span><br><span class="line">num.partitions=1</span><br><span class="line">#用来恢复和清理data下数据的线程数量</span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line">#segment文件保留的最长时间，超时将被删除</span><br><span class="line">log.retention.hours=168</span><br><span class="line">#配置连接Zookeeper集群地址</span><br><span class="line">zookeeper.connect=master:2181,slave1:2181,slave2:2181</span><br></pre></td></tr></table></figure>

<p>wq保存对应配置内容</p>
<h3 id="步骤五：分发安装包"><a href="#步骤五：分发安装包" class="headerlink" title="步骤五：分发安装包"></a>步骤五：分发安装包</h3><p>分发配置好的安装目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync /opt/module/kafka/</span><br></pre></td></tr></table></figure>

<p>分别在集群另外两台机修改配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/kafka/config/server.properties</span><br></pre></td></tr></table></figure>

<p>slave1配置broker.id&#x3D;1  salve2配置broker.id&#x3D;2</p>
<h3 id="步骤六：启动集群"><a href="#步骤六：启动集群" class="headerlink" title="步骤六：启动集群"></a>步骤六：启动集群</h3><p>依次在master、slave1、slave2节点上启动kafka</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-start.sh -daemon $KAFKA_HOME/config/server.properties</span><br></pre></td></tr></table></figure>

<p>依次在master、slave1、slave2节点上关闭kafka</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-server-stop.sh</span><br></pre></td></tr></table></figure>

<p>编写kafka群起脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/module/kafkaAll</span><br></pre></td></tr></table></figure>

<p>添加下面内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">#判断用户是否传参</span><br><span class="line">if [ $# -ne 1 ];then</span><br><span class="line">    echo &quot;无效参数，用法为: $0  &#123;start|stop&#125;&quot;</span><br><span class="line">    exit</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#获取用户输入的命令</span><br><span class="line">cmd=$1</span><br><span class="line"></span><br><span class="line">for i in `cat /opt/module/hadoop-2.7.2/etc/hadoop/slaves`</span><br><span class="line">do</span><br><span class="line">    tput setaf 2</span><br><span class="line">    echo ========== $i  $cmd ================</span><br><span class="line">    tput setaf 9</span><br><span class="line">    case $cmd in</span><br><span class="line">        start)</span><br><span class="line">            ssh  $i  &quot;source /etc/profile ; source /etc/profile;/opt/module/kafka/bin/kafka-server-start.sh -daemon /opt/module/kafka/config/server.properties&quot;</span><br><span class="line">            echo  $i &quot;服务已启动&quot;</span><br><span class="line">            ;;</span><br><span class="line">        stop)</span><br><span class="line">            ssh $i  &quot;source /etc/profile ; /opt/module/kafka/bin/kafka-server-stop.sh&quot;</span><br><span class="line">            echo $i  &quot;服务已停止&quot;</span><br><span class="line">            ;;</span><br><span class="line">            *)</span><br><span class="line">            echo &quot;无效参数，用法为: $0  &#123;start|stop&#125;&quot;</span><br><span class="line">            exit</span><br><span class="line">            ;;</span><br><span class="line">     esac</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>把脚本改为全局</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod  +x /opt/module/kafkaAll</span><br><span class="line">mv /opt/module/kafkaAll /bin/</span><br></pre></td></tr></table></figure>

<p>启动脚本验证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafkaAll start</span><br></pre></td></tr></table></figure>

<p>检查kafka启动进程是否都在</p>
<h2 id="实验任务六：Hbase搭建"><a href="#实验任务六：Hbase搭建" class="headerlink" title="实验任务六：Hbase搭建"></a>实验任务六：Hbase搭建</h2><h3 id="步骤一：前置要求"><a href="#步骤一：前置要求" class="headerlink" title="步骤一：前置要求"></a>步骤一：前置要求</h3><p>完成实验任务三的hadoop集群部署</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">start-all.sh</span><br><span class="line">Starting namenodes on [master]</span><br><span class="line">上一次登录：五 12月 17 16:10:52 CST 2021从 192.168.1.1pts/0 上</span><br><span class="line">Starting datanodes</span><br><span class="line">上一次登录：五 12月 17 16:10:59 CST 2021pts/0 上</span><br><span class="line">Starting secondary namenodes [hadoop102]</span><br><span class="line">上一次登录：五 12月 17 16:11:01 CST 2021pts/0 上</span><br><span class="line">Starting resourcemanager</span><br><span class="line">上一次登录：五 12月 17 16:11:05 CST 2021pts/0 上</span><br><span class="line">Starting nodemanagers</span><br><span class="line">上一次登录：五 12月 17 16:11:09 CST 2021pts/0 上</span><br></pre></td></tr></table></figure>

<p>完成实验任务四的Zookeeper集群部署</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">zkAll start</span><br><span class="line">========== master ============</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/module/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">========== slave1 ============</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/module/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">========== slave2 ============</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/module/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">========== master ============</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/module/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost.</span><br><span class="line">Mode: follower</span><br><span class="line">========== slave1 ============</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/module/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost.</span><br><span class="line">Mode: leader</span><br><span class="line">========== slave2 ============</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /opt/module/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost.</span><br><span class="line">Mode: follower</span><br></pre></td></tr></table></figure>

<p>完成实验任务五的Kafka集群部署</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kafkaAll start</span><br><span class="line">========== master start ================</span><br><span class="line">master 服务已启动</span><br><span class="line">========== slave1 start ================</span><br><span class="line">slave1 服务已启动</span><br><span class="line">========== slave2 start ================</span><br><span class="line">slave2 服务已启动</span><br></pre></td></tr></table></figure>

<h3 id="步骤二：解压组件包"><a href="#步骤二：解压组件包" class="headerlink" title="步骤二：解压组件包"></a>步骤二：解压组件包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf hbase-2.0.5-bin.tar.gz -C /opt/module</span><br><span class="line">mv /opt/module/hbase-2.0.5-bin.tar.gz /opt/module/hbase</span><br></pre></td></tr></table></figure>

<h3 id="步骤二：创建日志文件夹-1"><a href="#步骤二：创建日志文件夹-1" class="headerlink" title="步骤二：创建日志文件夹"></a>步骤二：创建日志文件夹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/module/kafka/logs</span><br></pre></td></tr></table></figure>

<h3 id="步骤三：配置环境变量-1"><a href="#步骤三：配置环境变量-1" class="headerlink" title="步骤三：配置环境变量"></a>步骤三：配置环境变量</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /root/.bash_profile</span><br></pre></td></tr></table></figure>

<p>添加下述kafka环境配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">##HBASE_HOME</span><br><span class="line">export HBASE_HOME=/opt/module/hbase</span><br><span class="line">export PATH=$PATH:$HBASE_HOME/bin</span><br></pre></td></tr></table></figure>

<p>生效环境配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /root/.bash_profile</span><br></pre></td></tr></table></figure>

<h3 id="步骤四：修改配置文件-1"><a href="#步骤四：修改配置文件-1" class="headerlink" title="步骤四：修改配置文件"></a>步骤四：修改配置文件</h3><p>1.修改hbase-env.sh修改内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/module/hbase/conf/hbase-env.sh</span><br></pre></td></tr></table></figure>

<p>修改以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export HBASE_MANAGES_ZK=false</span><br></pre></td></tr></table></figure>

<p>2.修改hbase-site.xml修改内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/module/hbase/conf/hbase-site.xml</span><br></pre></td></tr></table></figure>

<p>修改一下配置内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.rootdir&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;hdfs://slave2:8020/hbase&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;master,slave1,slave2&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.unsafe.stream.capability.enforce&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;false&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hbase.wal.provider&lt;/name&gt;</span><br><span class="line">&lt;value&gt;filesystem&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p>3.修改regionservers内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/module/hbase/regionservers</span><br></pre></td></tr></table></figure>

<p>添加一下集群三节点信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">master</span><br><span class="line">slave1</span><br><span class="line">slave2</span><br></pre></td></tr></table></figure>

<p>4.软连接hadoop配置文件到HBase：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /opt/module/hadoop/etc/hadoop/core-site.xml /opt/module/hbase/conf/core-site.xml</span><br><span class="line">ln -s /opt/module/hadoop/etc/hadoop/hdfs-site.xml /opt/module/hbase/conf/hdfs-site.xml</span><br></pre></td></tr></table></figure>

<h3 id="步骤五：分发安装包-1"><a href="#步骤五：分发安装包-1" class="headerlink" title="步骤五：分发安装包"></a>步骤五：分发安装包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync /opt/module/hbase/</span><br></pre></td></tr></table></figure>

<h3 id="步骤六：启动集群-1"><a href="#步骤六：启动集群-1" class="headerlink" title="步骤六：启动集群"></a>步骤六：启动集群</h3><p>集群启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/hbase/bin/start-hbase.sh</span><br></pre></td></tr></table></figure>

<p>对应的停止服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/hbase/bin/stop-hbase.sh</span><br></pre></td></tr></table></figure>

<p>查看HBase页面 <a target="_blank" rel="noopener" href="http://slave2:16010/">http://slave2:16010</a></p>
<h2 id="实验任务七：Phoenix集成"><a href="#实验任务七：Phoenix集成" class="headerlink" title="实验任务七：Phoenix集成"></a>实验任务七：Phoenix集成</h2><h3 id="步骤一：解压Phoenix安装包"><a href="#步骤一：解压Phoenix安装包" class="headerlink" title="步骤一：解压Phoenix安装包"></a>步骤一：解压Phoenix安装包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-phoenix-5.0.0-HBase-2.0-bin.tar.gz</span><br><span class="line">mv  apache-phoenix-5.0.0-HBase-2.0-bin.tar.gz  /opt/module/phoenix</span><br></pre></td></tr></table></figure>

<h3 id="步骤二：复制依赖包并拷贝到-hbase-lib"><a href="#步骤二：复制依赖包并拷贝到-hbase-lib" class="headerlink" title="步骤二：复制依赖包并拷贝到 hbase&#x2F;lib"></a>步骤二：复制依赖包并拷贝到 hbase&#x2F;lib</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/module/phoenix/</span><br><span class="line">cp phoenix-5.0.0-HBase-2.0-server.jar /opt/module/hbase/lib/</span><br><span class="line">cp phoenix-5.0.0-HBase-2.0-client.jar /opt/module/hbase/lib/</span><br></pre></td></tr></table></figure>

<p>同步上述hbase&#x2F;lib目录到各个集群节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync /opt/module/hbase/lib</span><br></pre></td></tr></table></figure>

<h3 id="步骤三：配置环境变量-2"><a href="#步骤三：配置环境变量-2" class="headerlink" title="步骤三：配置环境变量"></a>步骤三：配置环境变量</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /root/.bash_profile</span><br></pre></td></tr></table></figure>

<p>添加下述Phoenix环境配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#phoenix</span><br><span class="line">export PHOENIX_HOME=/opt/module/phoenix</span><br><span class="line">export PHOENIX_CLASSPATH=$PHOENIX_HOME</span><br><span class="line">export PATH=$PATH:$PHOENIX_HOME/bin</span><br></pre></td></tr></table></figure>

<h3 id="步骤四：重启Hbase后再启动Phoenix"><a href="#步骤四：重启Hbase后再启动Phoenix" class="headerlink" title="步骤四：重启Hbase后再启动Phoenix"></a>步骤四：重启Hbase后再启动Phoenix</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/hbase/bin/stop-hbase.sh</span><br><span class="line">/opt/module/hbase/bin/start-hbase.sh</span><br><span class="line">/opt/module/phoenix/bin/sqlline.py master,slave1,slave2:2181</span><br></pre></td></tr></table></figure>



<h2 id="73-项目实训-环境监控平台-环境数据采集"><a href="#73-项目实训-环境监控平台-环境数据采集" class="headerlink" title="73.项目实训-环境监控平台-环境数据采集"></a>73.项目实训-环境监控平台-环境数据采集</h2><blockquote>
<h3 id="目的-14"><a href="#目的-14" class="headerlink" title="目的"></a>目的</h3><p>完成本实验，您应该能够：</p>
<ul>
<li>掌握通过Java后台服务获取及推送kafka队列</li>
<li>掌握通过netty构建数据采集服务</li>
</ul>
<h3 id="要求-14"><a href="#要求-14" class="headerlink" title="要求"></a>要求</h3><ul>
<li>熟悉Java Springboot项目构建方式</li>
<li>熟悉netty构建数据采集服务</li>
<li>熟悉kafka队列推送和读取方式</li>
<li>熟悉通过Java完成kafka队列推送及读取</li>
</ul>
<h3 id="原理-14"><a href="#原理-14" class="headerlink" title="原理"></a>原理</h3><h2 id="Netty简介"><a href="#Netty简介" class="headerlink" title="Netty简介"></a>Netty简介</h2><p>Netty是由JBOSS提供的一个java开源框架，现为  Github上的独立项目。Netty提供异步的、事件驱动的网络应用程序框架和工具，用以快速开发高性能、高可靠性的网络服务器和客户端程序。也就是说，Netty 是一个基于NIO的客户、服务器端的编程框架，使用Netty  可以确保你快速和简单的开发出一个网络应用，例如实现了某种协议的客户、服务端应用。Netty相当于简化和流线化了网络应用的编程开发过程，例如：基于TCP和UDP的socket服务开发。<br>“快速”和“简单”并不用产生维护性或性能上的问题。Netty 是一个吸收了多种协议（包括FTP、SMTP、HTTP等各种二进制文本协议）的实现经验，并经过相当精心设计的项目。最终，Netty  成功的找到了一种方式，在保证易于开发的同时还保证了其应用的性能，稳定性和伸缩性。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286196626.png" alt="img"></p>
<h2 id="总体结构"><a href="#总体结构" class="headerlink" title="总体结构"></a>总体结构</h2><p>数据的采集时通过Netty框架构建出一个或多个TCP-SERVER服务，而部署在各种环境侧的地震环境猫设备，统一通过这个TCP服务把实时的环境数据推送到我们的后端解析服务中去。由于采用的NIO非阻塞式IO，所以也可能同时又多台机器在同步进行环境数据的推送。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286207877.png" alt="img"><br>而后台服务在获取到对应的数据后，首先要进行对数据的清洗与整理。在清洗的过程中，首先是对数据的正常解析，双方在遵循既定规则完成解析后，是对数据的清洗，这个清洗的过程需要遵循一些相关的国家行业标准与软件系统标准。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286219670.png" alt="img"></p>
</blockquote>
<h2 id="实验任务一：Netty框架项目搭建"><a href="#实验任务一：Netty框架项目搭建" class="headerlink" title="实验任务一：Netty框架项目搭建"></a>实验任务一：Netty框架项目搭建</h2><h3 id="步骤一：下载项目代码包"><a href="#步骤一：下载项目代码包" class="headerlink" title="步骤一：下载项目代码包"></a>步骤一：下载项目代码包</h3><p>&#x2F;opt&#x2F;projectcode&#x2F;env_netty</p>
<h3 id="步骤二：配置idea新项目配置"><a href="#步骤二：配置idea新项目配置" class="headerlink" title="步骤二：配置idea新项目配置"></a>步骤二：配置idea新项目配置</h3><h4 id="配置maven本地资源库"><a href="#配置maven本地资源库" class="headerlink" title="配置maven本地资源库"></a>配置maven本地资源库</h4><p>File——new proejct setting——Preferences for New Projects…</p>
<h4 id="配置maven的的资源配置"><a href="#配置maven的的资源配置" class="headerlink" title="配置maven的的资源配置"></a>配置maven的的资源配置</h4><p>User settings 指定的是maven的本地配置文件<br>Local repository 指定的是maven本地资源库jar包存放地址（本例中我们会把本地所需要依赖的jar包统一放在&#x2F;opt&#x2F;projectcode目录下，把jar包目录放在本地一个目录当做资源库，并配置这里的目录指向对应资源库即可）<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286280455.png" alt="img"></p>
<h4 id="配置idea对应SDK"><a href="#配置idea对应SDK" class="headerlink" title="配置idea对应SDK"></a>配置idea对应SDK</h4><p>File——new proejct setting——Structure for New Projects…<br>配置对应的本地jdk或者配置idea自带的jdk都可以<br>注意配置的版本为1.8版本jdk<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286293638.png" alt="img"></p>
<h4 id="引入项目代码"><a href="#引入项目代码" class="headerlink" title="引入项目代码"></a>引入项目代码</h4><p>打开idea，File——Open——选择已有的env_netty项目引入<br>等待项目构建完成<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286311989.png" alt="img"></p>
<h4 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h4><p>代码目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/src/main/java/com.cstor.envNetty</span><br><span class="line">envApi：项目对外接口服务层，填写了相关服务访问路径</span><br><span class="line">config：配置文件层，所有相关配置文件存放目录（直接提供）</span><br><span class="line">kafka：Kafka队列操作相关功能</span><br><span class="line">netty：Netty服务交互功能实现</span><br><span class="line">thread：后台进程服务类</span><br><span class="line">envNettyApplication：springboot启动类（直接提供）</span><br></pre></td></tr></table></figure>

<p>资源目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/conf</span><br><span class="line">config.properties:配置文件，所有环境信息配置内容</span><br><span class="line">/src/main/resources</span><br><span class="line">application.properties:配置文件，存放所有需要放入spring上下文的配置内容</span><br><span class="line">log4j.properties:log4j日志文件配置例如日志存放地址，日志采集周期，日志生成文件格式等相关信息</span><br></pre></td></tr></table></figure>

<h2 id="实验任务二：Kafka对接模块"><a href="#实验任务二：Kafka对接模块" class="headerlink" title="实验任务二：Kafka对接模块"></a>实验任务二：Kafka对接模块</h2><h3 id="步骤一：前置配置"><a href="#步骤一：前置配置" class="headerlink" title="步骤一：前置配置"></a>步骤一：前置配置</h3><p>首先我们要对我们已有的集群队列进行调用配置<br>检查pom.xml中kafka的jar包依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.4.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>修改&#x2F;conf&#x2F;config.properties配置文件中的kafka集群服务地址<br>修改&#x2F;conf&#x2F;config.properties配置文件中的mysql服务地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#MySQL</span><br><span class="line">mysqlhost=#mysql地址ip</span><br><span class="line">mysqlport=3306</span><br><span class="line">mysqluser=root</span><br><span class="line">mysqlpwd=cstorfs</span><br><span class="line">dbname=environment</span><br><span class="line"></span><br><span class="line">#kafka producer</span><br><span class="line">TOPIC_NAME=envTopic</span><br><span class="line">#kafka服务地址</span><br><span class="line">BOOTSTRAP_SERVERS_CONFIG=slave2:9092</span><br></pre></td></tr></table></figure>

<p>需要用到的类：<br>Producer：需要创建一个生产者对象，用来发送数据<br>KafakConfig：获取所需的一系列配置参数<br>Topic：话题生成对象，用来创建队列<br>EnvDataCollect：每条数据都要封装成一个EnvDataCollect对象</p>
<h3 id="步骤二：Kafka对接——队列创建"><a href="#步骤二：Kafka对接——队列创建" class="headerlink" title="步骤二：Kafka对接——队列创建"></a>步骤二：Kafka对接——队列创建</h3><p>Topic话题对象，在src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envNetty&#x2F;kafka&#x2F;Topic.java中添加下述方法</p>
<h4 id="【添加创建队列方法】"><a href="#【添加创建队列方法】" class="headerlink" title="【添加创建队列方法】"></a>【添加创建队列方法】</h4><p>方法参数：topicName 话题名字，numPartitions分区数，replicationNum副本数<br>方法逻辑：</p>
<ul>
<li>动作一：配置新队列实体属性信息-》传入topick名字，分区数，副本数</li>
<li>动作二：初始化AdminClient客户端-》ConstConfig.getDefaultProducerProp方法会补充kafkaConfig配置对象相关其他参数包括集群批次大小，重试数量，kafka集群地址，消息收发验证方式，数据内容序列化及反序列化格式等。<br>由于这些参数相对固定不用调整，所以放入静态方法中统一</li>
<li>动作三：通过客户端内置createTopics方法创建对象-》调用获得创建话题返回结果并关闭客户端。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 创建topic</span><br><span class="line"> */</span><br><span class="line">public void createTopic(String topicName,Integer numPartitions, Integer replicationNum)&#123;</span><br><span class="line">//初始化新增话题对象属性</span><br><span class="line">    NewTopic newTopic=new NewTopic(topicName,</span><br><span class="line">numPartitions,</span><br><span class="line">replicationNum.shortValue());</span><br><span class="line">//通过AdminClient客户端调用创建话题方法</span><br><span class="line">AdminClient adminClient=KafkaAdminClient</span><br><span class="line">.create(ConstConfig.getDefaultProducerProp(kafakConfig));</span><br><span class="line">//        AdminClient adminClient=KafkaAdminClient.create(ConstConfig.getFixedProducerProp());</span><br><span class="line">//获得返回结果</span><br><span class="line">    CreateTopicsResult result=adminClient.createTopics(ListUtil.of(newTopic));</span><br><span class="line">    try &#123;</span><br><span class="line">        result.all().get();</span><br><span class="line">    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (ExecutionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    adminClient.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>*如果不用Java调用也可以使用后台api命令行创建topic</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --zookeeper slave2:2181/kafka \</span><br><span class="line">--create --replication-factor 3 --partitions 1 --topic first</span><br><span class="line">选项说明：</span><br><span class="line">--topic 定义topic名</span><br><span class="line">--replication-factor  定义副本数</span><br><span class="line">--partitions  定义分区数</span><br></pre></td></tr></table></figure>

<h4 id="【添加查询话题方法】"><a href="#【添加查询话题方法】" class="headerlink" title="【添加查询话题方法】"></a>【添加查询话题方法】</h4><p>方法逻辑：</p>
<ul>
<li>动作一：初始化AdminClient对象</li>
<li>动作二：通过自带listTopics方法查询所有话题信息</li>
<li>动作三：返回话题列表，关闭客户端</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    /**</span><br><span class="line">     * 查询topic</span><br><span class="line">     */</span><br><span class="line">    public List&lt;String&gt; listTopics() &#123;</span><br><span class="line">        AdminClient adminClient=KafkaAdminClient</span><br><span class="line">.create(ConstConfig.getDefaultProducerProp(kafakConfig));</span><br><span class="line">//      AdminClient adminClient=KafkaAdminClient</span><br><span class="line">.create(ConstConfig.getFixedProducerProp());</span><br><span class="line">        try &#123;</span><br><span class="line">            List&lt;String&gt; topicNameList=adminClient.listTopics().names().get().stream().collect(Collectors.toList());</span><br><span class="line">            return topicNameList;</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        adminClient.close();</span><br><span class="line">        return new ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>*命令行-查看话题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --zookeeper salve2:2181/kafka --list</span><br></pre></td></tr></table></figure>

<p>- </p>
<h3 id="步骤三：Kafka对接——消息推送"><a href="#步骤三：Kafka对接——消息推送" class="headerlink" title="步骤三：Kafka对接——消息推送"></a>步骤三：Kafka对接——消息推送</h3><p>Producer消息收发对象，在src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envNetty&#x2F;kafka&#x2F;Producer.java中添加下述方法</p>
<h4 id="【推送话题数据】"><a href="#【推送话题数据】" class="headerlink" title="【推送话题数据】"></a>【推送话题数据】</h4><p>方法参数：envDataCollect 推送数据列表, kafakConfig kafka配置类<br>方法逻辑：</p>
<ul>
<li>动作一：实例化KafkaProducer客户端，塞入对应KafkaConfig配置，通话题创建一样，由于相关参数相对固定，通过ConstConfig.getDefaultProducerProp方法补充相关话题信息。</li>
<li>动作二：通过客户端send方法发送队列数据，发送方法参数依次为 ProducerRecord包装之后的话题数据（包括话题名，话题标记位，队列实际消息内容等属性），callBack推送回调方法。<br>我们需要通过函数方法在回调方法中打印推送成功信息。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 推送数据到kafka</span><br><span class="line"> */</span><br><span class="line">private void sendKafkaMsg(EnvDataCollect envDataCollect, KafakConfig kafakConfig) &#123;</span><br><span class="line">    KafkaProducer producer = new KafkaProducer&lt;String,String&gt;(ConstConfig.getDefaultProducerProp(kafakConfig));</span><br><span class="line">    Integer index=0;</span><br><span class="line">    producer.send(new ProducerRecord&lt;&gt;(kafakConfig.getTopicName(),</span><br><span class="line">                    Integer.toString(index),</span><br><span class="line">                    JSONUtil.parseObj(envDataCollect).toString()),</span><br><span class="line">                    (recordMetadata, e) -&gt; &#123;</span><br><span class="line">                        if (e==null)&#123;</span><br><span class="line">                            logger.info(&quot;数据推送到kafka：&#123;&#125;&quot;,recordMetadata);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">    index++;</span><br><span class="line">    producer.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="【推送队列的包装方法】"><a href="#【推送队列的包装方法】" class="headerlink" title="【推送队列的包装方法】"></a>【推送队列的包装方法】</h4><p>方法参数：envDataCollect 推送数据列表<br>方法逻辑：<br>所谓包装方法可以理解为发送队列数据前的准备动作。准备动作包括，数据格式化，数据有效性检查，队列检查，实际发送队列动作。</p>
<ul>
<li>动作一：此处的包装方法中我们加入了话题检查，判断集群话题是否存在，如果不存在我们这创建我们需要的话题（通过topic对象的createTopic动作）</li>
<li>动作二：检查无问题直接调用队列推送动作</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    /**</span><br><span class="line">     * 生产者发送数据队列</span><br><span class="line">     * @param envDataCollect</span><br><span class="line">     */</span><br><span class="line">    public void initKafkaMsg(EnvDataCollect envDataCollect)&#123;</span><br><span class="line">        /**</span><br><span class="line">         * 检查是否存在对应的topic话题</span><br><span class="line">         * 若不存在话题则帮其创建</span><br><span class="line">         */</span><br><span class="line">        Optional&lt;String&gt; findFirst=topic.listTopics()</span><br><span class="line">.stream()</span><br><span class="line">.filter(t-&gt;t.equals(kafakConfig.getTopicName())).findAny();</span><br><span class="line">        if (!findFirst.isPresent())&#123;</span><br><span class="line">topic.createTopic(kafakConfig.getTopicName(),ConstConfig.NUM_PARTITIONS,ConstConfig.NUM_REPLICATION);</span><br><span class="line">        &#125;</span><br><span class="line">        this.sendKafkaMsg(envDataCollect, kafakConfig);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="步骤四：Kafka对接——推送及相关方法验证"><a href="#步骤四：Kafka对接——推送及相关方法验证" class="headerlink" title="步骤四：Kafka对接——推送及相关方法验证"></a>步骤四：Kafka对接——推送及相关方法验证</h3><h4 id="创建main入口方法验证队列方法编写是否准确"><a href="#创建main入口方法验证队列方法编写是否准确" class="headerlink" title="创建main入口方法验证队列方法编写是否准确"></a>创建main入口方法验证队列方法编写是否准确</h4><p>topic中创建验证方法<br>修改createTopic和listTopics方法为静态方法并添加静态标识static<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286347449.png" alt="img"><br>修改adminClient客户端参数获取方式改为已经注释的固定传ConstConfig.getFixedProducerProp(),修改方法中的url塞值改为集群k8s服务地址slave2:9092<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286361864.png" alt="img"></p>
<h4 id="在topic类中添加入口类并执行run-main-方法。"><a href="#在topic类中添加入口类并执行run-main-方法。" class="headerlink" title="在topic类中添加入口类并执行run.main()方法。"></a>在topic类中添加入口类并执行run.main()方法。</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    Topic.createTopic(&quot;testEnv&quot;,ConstConfig.NUM_PARTITIONS,ConstConfig.NUM_REPLICATION);</span><br><span class="line">    List&lt;String&gt; topicList=Topic.listTopics();</span><br><span class="line">    topicList.stream().forEach(t-&gt;&#123;logger.info(&quot;话题名称：&#123;&#125;&quot;,t);&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制台console获得调用结果日志表示调用成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">09:41:44.157 [main] INFO com.cstor.envNetty.kafka.Producer - 话题名称：envTopic</span><br><span class="line">09:41:44.157 [main] INFO com.cstor.envNetty.kafka.Producer - 话题名称：testEnv</span><br></pre></td></tr></table></figure>

<p>同理验证在producer中增加验证main方法，并调整对应方法为静态属性（重复上述动作）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    EnvDataCollect data=EnvDataCollect.initNewEnvData();</span><br><span class="line">    Producer.initKafkaMsg(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制台查看队列信息推送是否正常<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286383152.png" alt="img"></p>
<h3 id="步骤五：查看测试数据是否已在集群集群中"><a href="#步骤五：查看测试数据是否已在集群集群中" class="headerlink" title="步骤五：查看测试数据是否已在集群集群中"></a>步骤五：查看测试数据是否已在集群集群中</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@slave2 ~]# kafka-console-consumer.sh --bootstrap-server slave2:9092 --from-beginning --topic envTopic</span><br><span class="line">&#123;&quot;HCHO&quot;:&quot;0.008&quot;,&quot;PM25&quot;:&quot;73&quot;,&quot;G&quot;:&quot;0.0&quot;,&quot;H&quot;:&quot;59&quot;,&quot;Time&quot;:&quot;2021-11-08 15:45:46&quot;,&quot;dev_id&quot;:&quot;C8:93:46:72:E0:74&quot;,&quot;Gx&quot;:&quot;307.000&quot;,&quot;Gy&quot;:&quot;43.000&quot;,&quot;Gz&quot;:&quot;822.000&quot;,&quot;T&quot;:&quot;24&quot;,&quot;Light&quot;:&quot;0&quot;&#125;</span><br><span class="line">&#123;&quot;HCHO&quot;:&quot;0.008&quot;,&quot;PM25&quot;:&quot;73&quot;,&quot;G&quot;:&quot;0.0&quot;,&quot;H&quot;:&quot;59&quot;,&quot;Time&quot;:&quot;2021-11-08 15:47:49&quot;,&quot;dev_id&quot;:&quot;C8:93:46:72:E0:74&quot;,&quot;Gx&quot;:&quot;307.000&quot;,&quot;Gy&quot;:&quot;43.000&quot;,&quot;Gz&quot;:&quot;822.000&quot;,&quot;T&quot;:&quot;24&quot;,&quot;Light&quot;:&quot;0&quot;&#125;</span><br><span class="line">&#123;&quot;HCHO&quot;:&quot;0.008&quot;,&quot;PM25&quot;:&quot;73&quot;,&quot;G&quot;:&quot;0.0&quot;,&quot;H&quot;:&quot;59&quot;,&quot;Time&quot;:&quot;2021-11-08 15:48:47&quot;,&quot;dev_id&quot;:&quot;C8:93:46:72:E0:74&quot;,&quot;Gx&quot;:&quot;307.000&quot;,&quot;Gy&quot;:&quot;43.000&quot;,&quot;Gz&quot;:&quot;822.000&quot;,&quot;T&quot;:&quot;24&quot;,&quot;Light&quot;:&quot;0&quot;&#125;</span><br><span class="line">&#123;&quot;HCHO&quot;:&quot;0.008&quot;,&quot;PM25&quot;:&quot;73&quot;,&quot;G&quot;:&quot;0.0&quot;,&quot;H&quot;:&quot;59&quot;,&quot;Time&quot;:&quot;2021-11-08 15:49:46&quot;,&quot;dev_id&quot;:&quot;C8:93:46:72:E0:74&quot;,&quot;Gx&quot;:&quot;307.000&quot;,&quot;Gy&quot;:&quot;43.000&quot;,&quot;Gz&quot;:&quot;822.000&quot;,&quot;T&quot;:&quot;24&quot;,&quot;Light&quot;:&quot;0&quot;&#125;</span><br><span class="line">&#123;&quot;HCHO&quot;:&quot;0.008&quot;,&quot;PM25&quot;:&quot;73&quot;,&quot;G&quot;:&quot;0.0&quot;,&quot;H&quot;:&quot;59&quot;,&quot;Time&quot;:&quot;2021-11-08 15:55:55&quot;,&quot;dev_id&quot;:&quot;C8:93:46:72:E0:74&quot;,&quot;Gx&quot;:&quot;307.000&quot;,&quot;Gy&quot;:&quot;43.000&quot;,&quot;Gz&quot;:&quot;822.000&quot;,&quot;T&quot;:&quot;24&quot;,&quot;Light&quot;:&quot;0&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实验任务三：Netty构建数据通信桥"><a href="#实验任务三：Netty构建数据通信桥" class="headerlink" title="实验任务三：Netty构建数据通信桥"></a>实验任务三：Netty构建数据通信桥</h2><h3 id="步骤一：设置Netty服务端口"><a href="#步骤一：设置Netty服务端口" class="headerlink" title="步骤一：设置Netty服务端口"></a>步骤一：设置Netty服务端口</h3><p>修改&#x2F;conf&#x2F;config.properties配置文件中的netty对外端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#environment</span><br><span class="line">tcp_port = 5588</span><br></pre></td></tr></table></figure>

<h3 id="步骤二：构建Netty服务TcpServer"><a href="#步骤二：构建Netty服务TcpServer" class="headerlink" title="步骤二：构建Netty服务TcpServer"></a>步骤二：构建Netty服务TcpServer</h3><h4 id="【新增进程服务创建Netty服务端】"><a href="#【新增进程服务创建Netty服务端】" class="headerlink" title="【新增进程服务创建Netty服务端】"></a>【新增进程服务创建Netty服务端】</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">在src/main/java/com/cstor/envNetty/netty/TcpServer.java中添加下述方法</span><br><span class="line">public void run() &#123;</span><br><span class="line">            EventLoopGroup bossGroup = new NioEventLoopGroup();</span><br><span class="line">            EventLoopGroup workerGroup = new NioEventLoopGroup();</span><br><span class="line">            final ByteBuf[] bf = new ByteBuf[] &#123;Unpooled.wrappedBuffer(new byte[] &#123; &#x27;]&#x27; &#125;) &#125;;</span><br><span class="line">            try &#123;</span><br><span class="line">                ServerBootstrap b = new ServerBootstrap();</span><br><span class="line">                b.group(bossGroup, workerGroup)</span><br><span class="line">                 .channel(NioServerSocketChannel.class)</span><br><span class="line">                 .option(ChannelOption.SO_BACKLOG, 100)</span><br><span class="line">                 .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                     @Override</span><br><span class="line">                     public void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line">//                       ch.pipeline().addLast(&quot;split&quot;,new DelimiterBasedFrameDecoder(1000, bf));</span><br><span class="line">                         ch.pipeline().addLast(new TcpHandler());</span><br><span class="line">                     &#125;</span><br><span class="line">                 &#125;);</span><br><span class="line">                //绑定端口，同步等待成功</span><br><span class="line">                ChannelFuture f = b.bind(serverPort).sync();</span><br><span class="line">                //等待服务端监听端口关闭</span><br><span class="line">                f.channel().closeFuture().sync();</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                logger.error(e.getMessage());</span><br><span class="line">            &#125;finally &#123;</span><br><span class="line">                // Shut down all event loops to terminate all threads.</span><br><span class="line">                bossGroup.shutdownGracefully();</span><br><span class="line">                workerGroup.shutdownGracefully();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>方法逻辑：</p>
<ul>
<li>动作一：初始化ServerBootstrap，ServerBootstrap是netty中的一个服务器引导类，对ServerBootstrap的实例化就是创建netty服务器的入口</li>
<li>动作二：设置group，设置SeverBootstrap要用到的EventLoopGroup，也就是定义netty服务的线程模型，处理Acceptor链接的主”线程池”以及用于I&#x2F;O工作的从”线程池”；</li>
<li>动作三：设置channel，设置将要被实例化的SeverChannel类；</li>
<li>动作四：设置option，指定要应用到新创建SeverChannel的ChannelConfig的ChannelOption.其实也就是服务本身的一些配置。</li>
<li>动作五：设置childHandler：设置将被添加到已被接收的子Channel的ChannelPipeline中的ChannelHandler，其实就是让你在子函数方法里面定义处理收发数据的动作，需要哪些ChannelHandler按什么顺序去处理。</li>
<li>动作六：通过ServerBootstrap开启服务并传入端口号serverPort，获得异步通知信息ChannelFuture。</li>
<li>动作七：f.channel().closeFuture().sync();作用是产生一个等待事件，保证主线程存活，否则主线程直接结束了（进入finally代码块优雅关闭Netty服务）。</li>
</ul>
<h3 id="步骤三：增加服务端调用Kafka队列推送动作"><a href="#步骤三：增加服务端调用Kafka队列推送动作" class="headerlink" title="步骤三：增加服务端调用Kafka队列推送动作"></a>步骤三：增加服务端调用Kafka队列推送动作</h3><p>TcpHandler是通过ChannelInitializer被添加到每个SocketChannel中，简单说就是读取客户端请求，向客户端响应的方法组件，所以这里要构造响应返回给客户端。<br>在src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envNetty&#x2F;netty&#x2F;TcpHandler.java中添加下述方法</p>
<h4 id="【客户请求处理方法】"><a href="#【客户请求处理方法】" class="headerlink" title="【客户请求处理方法】"></a>【客户请求处理方法】</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void channelRead0(ChannelHandlerContext channelHandlerContext, Object msg) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">    ByteBuf buf = (ByteBuf) msg;</span><br><span class="line">    byte[] req = new byte[buf.readableBytes()];</span><br><span class="line">    buf.readBytes(req);</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        String msgbody = new String(req, &quot;UTF-8&quot;);</span><br><span class="line">        EnvDataCollect envDataCollect = JSONUtil.parseObj(msgbody).toBean(EnvDataCollect.class);</span><br><span class="line">        //把获得的数据放入kafka队列</span><br><span class="line">        tcpHandler.producer.initKafkaMsg(envDataCollect);</span><br><span class="line">    &#125; catch (UnsupportedEncodingException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    //构建客户端响应返回</span><br><span class="line">    byte[] responB = getReturnMsg();</span><br><span class="line">    ByteBuf response = Unpooled.buffer(responB.length);</span><br><span class="line">    response.writeBytes(responB);</span><br><span class="line">    channelHandlerContext.write(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码逻辑：<br>每当从SocketChannel接收到数据时，就会调用channelRead0()方法。正如你在代码中所看到的，每当客户端向服务端发送数据，channelRead0()方法都会在这里对数据进行解析和处理。<br>当没有更多数据从SocketChannel读取数据时，调用channelReadComplete()方法。<br>如果在接收或发送来自SocketChannel的数据时抛出异常，则调用exceptionCaught()方法。在这里，您可以决定应该发生什么，比如关闭连接，或者响应错误代码等等。</p>
<ul>
<li>动作一：读取数据流参数并转化为具体记录实体，这里使用了Json工具jar包完成了字符串数据的实体转化动作。<br>EnvDataCollect envDataCollect &#x3D; JSONUtil.parseObj(msgbody).toBean(EnvDataCollect.class);</li>
<li>动作二：推送记录实体调用Producer类的队列数据初始化推送方法initKafkaMsg()。<br>tcpHandler.producer.initKafkaMsg(envDataCollect)。</li>
<li>动作三：完成上述动作后开始编写客户端的响应方法，直接通过getReturnMsg()构建一个空的返回信息返回给客户端。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private byte[] getReturnMsg() &#123;</span><br><span class="line">    HardReturn hrd = new HardReturn();</span><br><span class="line">    hrd.setCode(&quot;0&quot;);</span><br><span class="line">    String bak = JSON.toJSONString(hrd);</span><br><span class="line">    byte[] responB = new byte[0];</span><br><span class="line">    try &#123;</span><br><span class="line">        responB = bak.getBytes(CHARSET);</span><br><span class="line">    &#125; catch (UnsupportedEncodingException e) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    return responB;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>动作四：完成剩余返回客户端动作。</li>
</ul>
<h3 id="步骤四：构建Netty客户端"><a href="#步骤四：构建Netty客户端" class="headerlink" title="步骤四：构建Netty客户端"></a>步骤四：构建Netty客户端</h3><p>完成了服务端的构建，我们需要通过前端请求模拟的客户端请求，来对已构建的Netty服务端进行调用并传递数据。<br>真实场景下，这里的动作应该是集成在环境采集设备中的，只需要开启设备就可以对网络中的Netty服务进行调用。</p>
<h4 id="【客户端-服务端】"><a href="#【客户端-服务端】" class="headerlink" title="【客户端&#x2F;服务端】"></a>【客户端&#x2F;服务端】</h4><p>在src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envNetty&#x2F;netty&#x2F;TcpClient.java中添加下述方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public void sendNettyInfo(EnvDataCollect envDataCollect)&#123;</span><br><span class="line"></span><br><span class="line">        EventLoopGroup eventLoopGroup =new NioEventLoopGroup();</span><br><span class="line">        try &#123;</span><br><span class="line">        // 首先，netty通过Bootstrap启动客户端</span><br><span class="line">        Bootstrap client = new Bootstrap();</span><br><span class="line">        //第1步 定义线程组，处理读写和链接事件，没有了accept事件</span><br><span class="line">        client.group(eventLoopGroup)</span><br><span class="line">        .channel(NioSocketChannel.class)  //第2步 绑定客户端通道</span><br><span class="line">        .handler(new ChannelInitializer&lt;NioSocketChannel&gt;() &#123;  //第3步 给NIoSocketChannel初始化handler， 处理读写事件</span><br><span class="line">            @Override</span><br><span class="line">            protected void initChannel(NioSocketChannel ch) throws Exception &#123;</span><br><span class="line">                //字符串编码器，一定要加在SimpleClientHandler 的上面</span><br><span class="line">                ch.pipeline().addLast(new StringEncoder());</span><br><span class="line">                //找到他的管道 增加他的handler</span><br><span class="line">                ch.pipeline().addLast(new TcpClientHandler());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">            //连接服务器</span><br><span class="line">            ChannelFuture future = client.connect(&quot;127.0.0.1&quot;, 5588).sync();</span><br><span class="line">            //发送数据给服务器</span><br><span class="line">            future.channel().writeAndFlush(JSONUtil.parseObj(envDataCollect).toString());</span><br><span class="line"></span><br><span class="line">            future.channel().closeFuture().sync();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            eventLoopGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>方法逻辑：<br>类似服务端代码逻辑</p>
<ul>
<li>动作一：初始化Bootstrap是一个客户端调用类，对Bootstrap的实例化就是创建netty客户端的入口</li>
<li>动作二：设置group，设置Bootstrap要用到的EventLoopGroup。</li>
<li>动作三：设置channel，设置将要被实例化的channel类；</li>
<li>动作五：设置childHandler：设置将被添加到已被接收的子Channel的ChannelPipeline中的ChannelHandler，其实就是让你在子函数方法里面定义处理收发数据的动作，需要哪些ChannelHandler按什么顺序去处理。</li>
<li>动作六：通过Bootstrap传入服务地址并调用服务，写入需要传递的字符串格式环境记录信息。</li>
<li>动作七：f.channel().closeFuture().sync();作用是产生一个等待事件，保证主线程存活，否则主线程直接结束了（进入finally代码块优雅关闭Netty服务）。</li>
</ul>
<h3 id="步骤五：开启单独的进程启动Netty的TcpServer服务"><a href="#步骤五：开启单独的进程启动Netty的TcpServer服务" class="headerlink" title="步骤五：开启单独的进程启动Netty的TcpServer服务"></a>步骤五：开启单独的进程启动Netty的TcpServer服务</h3><p>修改src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envNetty&#x2F;thread&#x2F;InitApplicationRunner.java用来当做服务启动类继承ApplicationRunner接口，然后重写这个ApplicationRunner接口的run方法，调用TcpServer并传入服务所要使用的端口号，从而完成Springboot应用启动后的#### 【初始化Netty服务构建动作】<br>这个类的主要作用是用于在服务启动时顺带把Netty服务创建生成出来。<br>run方法实现如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 开通单独进程进行设备初始化</span><br><span class="line"> */</span><br><span class="line">@Override</span><br><span class="line">public void run(ApplicationArguments args) throws Exception &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            new Thread(new TcpServer(Integer.valueOf(tcp_port))).start();</span><br><span class="line">            logger.info(&quot;环境猫TCP服务初始化成功...&quot;);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            logger.error(&quot;环境猫TCP服务初始化异常...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法描述：<br>实例化新的线程Thread在后台启动TcpServer服务（即Netty服务）。</p>
<h3 id="步骤六：创建API服务调用入口类"><a href="#步骤六：创建API服务调用入口类" class="headerlink" title="步骤六：创建API服务调用入口类"></a>步骤六：创建API服务调用入口类</h3><p>本次实验通过Swagger完成对项目的调用请求动作，Swagger是当前最好用的Restful  API文档生成的开源项目，通过swagger-spring项目实现了与SpingMVC框架的无缝集成功能，方便生成spring  restful风格的接口文档，同时swagger-ui还可以测试spring restful风格的接口功能。<br>修改src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envNetty&#x2F;envApi&#x2F;envApi.java服务类</p>
<h4 id="【数据推送方法】"><a href="#【数据推送方法】" class="headerlink" title="【数据推送方法】"></a>【数据推送方法】</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 通过netty推送环境数据</span><br><span class="line"> */</span><br><span class="line">@ApiOperation(value = &quot;环境数据采集&quot;, notes = &quot;&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/envRecordPush&quot;, method = RequestMethod.POST)</span><br><span class="line">@CrossOrigin</span><br><span class="line">public JSONObject envRecordPush() &#123;</span><br><span class="line">    //通过netty推送环境数据</span><br><span class="line">    tcpClient.sendNettyInfo(EnvDataCollect.initNewEnvData());</span><br><span class="line">    return RspBuilder.defaultSuccessResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>方法逻辑: 面向外部客户端请求提供推送环境信息的触发动作,由于提供的项目中引入了swagger的jar包,所以这里直接调用发送方法sendNettyInfo推送环境数据即可。 - @ApiOperation：swagger的接口说明注解，value：“接口说明”, httpMethod ： “接口请求方式get&#x2F;post”, response：“接口返回参数类型”, notes： “接口发布说明”。 - @RequestMapping：springMvc中的映射注解，用它来指定控制器可以处理哪些URL请求。Value：“映射访问请求url路径”，method：调用方式。 - @CrossOrigin：springmvc中的跨域支持。</p>
<p>*【跨域】：出于浏览器的同源策略限制。同源策略（Sameoriginpolicy）是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，则浏览器的正常功能可能都会受到影响。当一个请求url的协议、域名、端口三者之间任意一个与当前页面url不同即为跨域</p>
</blockquote>
<h3 id="步骤七：测试netty服务及推送队列过程"><a href="#步骤七：测试netty服务及推送队列过程" class="headerlink" title="步骤七：测试netty服务及推送队列过程"></a>步骤七：测试netty服务及推送队列过程</h3><p>通过正常启动或者debug模式启动项目服务<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286425800.png" alt="img"><br>当日志输出启动成功后调用swaggger-ui提供的api接口页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2021-11-10 17:19:35.740  INFO 31396 --- [  restartedMain] com.cstor.envNetty.EnvNettyApplication   : Started EnvNettyApplication in 3.036 seconds (JVM running for 4.064)</span><br><span class="line">05:19:35,745 [restartedMain] INFO  com.cstor.envNetty.thread.InitApplicationRunner  - 环境猫TCP服务初始化成功...</span><br></pre></td></tr></table></figure>

<p>服务地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8082/swagger-ui.html">http://127.0.0.1:8082/swagger-ui.html</a> 端口号8082为config中配置的服务端口号<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286449966.png" alt="img"></p>
<h3 id="步骤八：开启后台队列监控检查数据推送消息是否正常"><a href="#步骤八：开启后台队列监控检查数据推送消息是否正常" class="headerlink" title="步骤八：开启后台队列监控检查数据推送消息是否正常"></a>步骤八：开启后台队列监控检查数据推送消息是否正常</h3><p>进入集群执行bin&#x2F;kafka-console-consumer.sh –bootstrap-server slave2:9092开启队列消息监控</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@slave2 ~]# kafka-console-consumer.sh --bootstrap-server slave2:9092 --from-beginning --topic envTopic</span><br></pre></td></tr></table></figure>

<p>点击swagger-ui页面，应为只有一个对外api服务所以直接点击按钮执行就可以了<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286480561.png" alt="img"><br>队列监控显示如下的消息推送内容即为全业务调用成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;HCHO&quot;:&quot;0.008&quot;,&quot;PM25&quot;:&quot;73&quot;,&quot;G&quot;:&quot;0.0&quot;,&quot;H&quot;:&quot;59&quot;,&quot;Time&quot;:&quot;2021-11-08 15:45:46&quot;,&quot;dev_id&quot;:&quot;C8:93:46:72:E0:74&quot;,&quot;Gx&quot;:&quot;307.000&quot;,&quot;Gy&quot;:&quot;43.000&quot;,&quot;Gz&quot;:&quot;822.000&quot;,&quot;T&quot;:&quot;24&quot;,&quot;Light&quot;:&quot;0&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>至此我们即完成了从环境采集设备到后台采集服务的调用，同步完成了后台在收到环境数据后对集群kafka的队列消息推送。</p>
<h2 id="74-项目实训-环境监控平台-环境队列数据业务格式化及持久化"><a href="#74-项目实训-环境监控平台-环境队列数据业务格式化及持久化" class="headerlink" title="74.项目实训-环境监控平台-环境队列数据业务格式化及持久化"></a>74.项目实训-环境监控平台-环境队列数据业务格式化及持久化</h2><blockquote>
<h3 id="目的-15"><a href="#目的-15" class="headerlink" title="目的"></a>目的</h3><p>完成本实验，您应该能够：</p>
<ul>
<li>掌握通过Java后台服务获取及推送kafka队列</li>
<li>掌握通过netty构建数据采集服务实验要求</li>
<li>熟悉Java Springboot项目构建方式</li>
<li>熟悉Kafka队列推送和读取方式</li>
<li>熟悉通过Java完成Kafka队列推送及读取</li>
<li>熟悉Kafka在集群场景下的的用法</li>
<li>熟悉Hbase在集群业务场景下的的用法</li>
<li>熟悉Phoenix组件使用方式</li>
</ul>
<h3 id="要求-15"><a href="#要求-15" class="headerlink" title="要求"></a>要求</h3><ul>
<li>熟悉Java Springboot项目构建方式</li>
<li>熟悉kafka队列推送和读取方式</li>
<li>熟悉Hbase持久化对接项目方式</li>
<li>熟悉mysql数据库对接项目方式</li>
<li>熟悉数据清洗一般模式及对应规则</li>
<li>熟悉通过Java完成kafka队列推送及读取</li>
</ul>
<h3 id="原理-15"><a href="#原理-15" class="headerlink" title="原理"></a>原理</h3><p>数据清洗是发现并纠正数据文件中可识别的错误的最后一道程序，包括对数据一致性的检查、无效值和缺失值得处理。<br>数据清洗的原理如下图所示是利用有关技术及行业规范清理规则将脏数据转化为满足数据质量要求的数据。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286552619.png" alt="img"><br>在数据清洗过程中，针对数据的类型和特性的不同，大致将数据类型分为3类来进行数据的清洗工作。</p>
<h4 id="1-残缺数据"><a href="#1-残缺数据" class="headerlink" title="1.残缺数据"></a>1.残缺数据</h4><p>这一类数据主要是因为部分信息缺失。将这一类数据过滤出来，按照缺失的内容分别填入对应的环境相关补充数据，才可写入数据仓库或是本地数据库。</p>
<h4 id="2-错误数据"><a href="#2-错误数据" class="headerlink" title="2.错误数据"></a>2.错误数据</h4><p>这一类错误产生的原因往往是业务采集逻辑不够健全，在接收输入信息后没有进行判断直接将数据写入缓冲区导致的，比如数值数据输成全角数字字符、字符串数据后面有一个回车操作、日期格式不正确等。这类数据也是需要分类，对于类似于全角字符、数据前后有不可见字符问题的时候，只能用写SQL语句的方式查找出来，并维护清除。</p>
<h4 id="3-重复数据"><a href="#3-重复数据" class="headerlink" title="3.重复数据"></a>3.重复数据</h4><p>这一类数据多出现在采集设备故障中，虽然环境相关数据由于其特殊性，在短时间内存在内容相近或几乎相同的场景比较多，但是当数据源在一定时间范围内，持续输出相同数据时则要考虑对设备的检查以及数据的对比验证，及时清除这些垃圾数据以排除对最后统计结果的干扰。</p>
</blockquote>
<h2 id="实验任务一：初始化构建Kafka数据清洗项目"><a href="#实验任务一：初始化构建Kafka数据清洗项目" class="headerlink" title="实验任务一：初始化构建Kafka数据清洗项目"></a>实验任务一：初始化构建Kafka数据清洗项目</h2><h3 id="步骤一：下载项目代码包-1"><a href="#步骤一：下载项目代码包-1" class="headerlink" title="步骤一：下载项目代码包"></a>步骤一：下载项目代码包</h3><p>&#x2F;opt&#x2F;projectcode&#x2F;env_kafka</p>
<h3 id="步骤二：配置idea新项目配置-1"><a href="#步骤二：配置idea新项目配置-1" class="headerlink" title="步骤二：配置idea新项目配置"></a>步骤二：配置idea新项目配置</h3><h4 id="配置maven本地资源库-1"><a href="#配置maven本地资源库-1" class="headerlink" title="配置maven本地资源库"></a>配置maven本地资源库</h4><p>File——new proejct setting——Preferences for New Projects…</p>
<h4 id="配置maven的的资源配置-1"><a href="#配置maven的的资源配置-1" class="headerlink" title="配置maven的的资源配置"></a>配置maven的的资源配置</h4><p>User settings 指定的是maven的本地配置文件<br>Local repository 指定的是maven本地资源库jar包存放地址（本例中我们会把本地所需要依赖的jar包统一放在&#x2F;opt&#x2F;projectcode目录下，把jar包目录放在本地一个目录当做资源库，并配置这里的目录指向对应资源库即可）<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286567992.png" alt="img"></p>
<h4 id="配置idea对应SDK-1"><a href="#配置idea对应SDK-1" class="headerlink" title="配置idea对应SDK"></a>配置idea对应SDK</h4><p>File——new proejct setting——Structure for New Projects…<br>配置对应的本地jdk或者配置idea自带的jdk都可以<br>注意配置的版本为1.8版本jdk<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286580742.png" alt="img"></p>
<h4 id="引入项目"><a href="#引入项目" class="headerlink" title="引入项目"></a>引入项目</h4><p>打开idea，File——Open——选择已有的env_kafka项目引入<br>等待项目构建完成<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286597783.png" alt="img"></p>
<h4 id="代码结构-1"><a href="#代码结构-1" class="headerlink" title="代码结构"></a>代码结构</h4><ul>
<li>代码目录<br>&#x2F;src&#x2F;main&#x2F;java&#x2F;com.cstor.envKafka<br>env：环境梳理业务处理服务包<br>guide：kafka对接适配样例<br>util：项目工具类</li>
<li>资源目录<br>&#x2F;conf<br>config.properties:配置文件，所有环境信息配置内容<br>&#x2F;src&#x2F;main&#x2F;resources<br>application.properties:配置文件，存放所有需要放入spring上下文的配置内容<br>log4j.properties:log4j日志文件配置例如日志存放地址，日志采集周期，日志生成文件格式等相关信息</li>
</ul>
<h2 id="实验任务二：队列数据业务算法清洗"><a href="#实验任务二：队列数据业务算法清洗" class="headerlink" title="实验任务二：队列数据业务算法清洗"></a>实验任务二：队列数据业务算法清洗</h2><h3 id="步骤一：创建队列读取方法类"><a href="#步骤一：创建队列读取方法类" class="headerlink" title="步骤一：创建队列读取方法类"></a>步骤一：创建队列读取方法类</h3><h4 id="【集群队列消息消费客户端】"><a href="#【集群队列消息消费客户端】" class="headerlink" title="【集群队列消息消费客户端】"></a>【集群队列消息消费客户端】</h4><p>在src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envKafka&#x2F;env&#x2F;dataConsumer&#x2F;EnvRecordConsumer.java中添加下述方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public void getConsumerInfo() &#123;</span><br><span class="line">    KafkaConsumer&lt;String,String&gt; consumer=new KafkaConsumer&lt;&gt;(ConstConfig.getDefaultConsumerProp(kafakConfig));</span><br><span class="line">    /*</span><br><span class="line">     * 消费者订阅话题</span><br><span class="line">     */</span><br><span class="line">    consumer.subscribe(ListUtil.of(ConstConfig.TOPIC_NAME));</span><br><span class="line"></span><br><span class="line">    while (true)&#123;</span><br><span class="line">        ConsumerRecords&lt;String, String&gt; records = consumer.poll(1000);    //按时间段读取数据，读取超时时间为1000ms</span><br><span class="line">        if (records.count()==0) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                Thread.sleep(1000);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(&quot;采集数据异常&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            for (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">                System.out.println(record.value());</span><br><span class="line">                //输出获取的队列信息到数据清洗服务中</span><br><span class="line">                dataCleanService.recordClean(record.value());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法逻辑：</p>
<ul>
<li>动作一：实例化新的consumer消费者客户端，参数为ConstConfig.getDefaultConsumerProp(kafakConfig)获取的Proerties配置参数，这里对配置参数的初始化类似实验二的配置参数初始化动作。但是本次验证我们不用采取main方法调用，所以可以直接把参数内容放在配置文件中。</li>
<li>动作二：设置消费者客户端订阅我们之前创建的话题类容，当然这里参数为list列表，意味着可以同时不止订阅一个话题。</li>
<li>动作三：创建循获取话题内容的代码块，1.设置队列数据读取超时时间。2.如果队列读取记录为空则等待一秒后再重新读取。3.如果读取到队列的数据，则循环对应的数据并调用dataCleanService.recordClean方法，输出到后续业务数据清洗服务。</li>
</ul>
<h3 id="步骤二：数据清洗动作"><a href="#步骤二：数据清洗动作" class="headerlink" title="步骤二：数据清洗动作"></a>步骤二：数据清洗动作</h3><h4 id="【数据清洗方法】"><a href="#【数据清洗方法】" class="headerlink" title="【数据清洗方法】"></a>【数据清洗方法】</h4><p>在src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envKafka&#x2F;env&#x2F;dataClean&#x2F;DataCleanService.java中添加下述数据清洗动作recordClean方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    /**</span><br><span class="line">     * 清洗数据为</span><br><span class="line">     * @param recordString</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public EnvRecord recordClean(String recordString)&#123;</span><br><span class="line">        //通过Json工具完成数据到JavaBean的转化</span><br><span class="line">        EnvRecord envRecord=JSONUtil.toBean(recordString, EnvRecord.class);</span><br><span class="line"></span><br><span class="line">        //数据清洗(为空放弃插入后续持久化数据库及Hbase)</span><br><span class="line">        if(StrUtil.isBlank(envRecord.getT())) return null;</span><br><span class="line"></span><br><span class="line">        //搜集数据完成震感计算</span><br><span class="line">        double feeling = getEarthFeeling(envRecord);</span><br><span class="line"></span><br><span class="line">        //数据清洗（为空默认值塞入）</span><br><span class="line">        envRecord=envRecord.initMissingValue(feeling);</span><br><span class="line"></span><br><span class="line">        //插入hbase和mysql数据库中</span><br><span class="line">        hbaseService.insertHbase(envRecord,feeling);</span><br><span class="line">        dataBaseService.insertDatbase(envRecord,feeling);</span><br><span class="line"></span><br><span class="line">        return envRecord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码逻辑：</p>
<ul>
<li>动作一：转化数据格式，生成为实际后台可以调用的数据实体。</li>
<li>动作二：应对数据清洗中的空值丢弃动作，当某些实体中的某些关键性业务数据为空值时，为了整体业务数据完整性考虑，会把这些数据当做冗余的垃圾数据予以丢弃。</li>
<li>动作三：应对数据清洗中的业务算法格式化，此处通过震感算法方法完成对震感值的计算，具体震感计算方法后面小节详述。</li>
<li>动作四：应对数据清洗中的默认值塞入动作，当某些不影响统计结果的参数值缺失时，可以通过默认值塞入或者业务塞值的方式，把数据记录信息不全。<br>上述的三个动作其实只应对了数据清洗中的一部分场景，当然还有一些更加广泛的数据清洗手段，包括同类别均值填补，前后数据连续性可能值填补等方式，当然比较通用的还是契合行业内相关业务算法进行相关计算获取。</li>
</ul>
<p>震感简单算法计算过程（加入业务清洗服务中提供调用）<br>算法逻辑：按照60条记录为一个周期吧地表收集的X轴变化幅度数据列入一个列表listx中通过计算单个方向的PGA,PGV指标获得震感强度的数据结果。而60条数据获取的方式是连续性的，即进入一条记录，则从60条计算列表中放出一条数据，从而达到数据的连续性。</p>
<h4 id="【计算公式方法】"><a href="#【计算公式方法】" class="headerlink" title="【计算公式方法】"></a>【计算公式方法】</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 通过行业算法获取地震震感数据</span><br><span class="line"> * @param envRecord</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">private double getEarthFeeling(EnvRecord envRecord) &#123;</span><br><span class="line">    //套用地震行业波动算法计算震动频率和震动幅度</span><br><span class="line">    listX.add(Double.parseDouble(envRecord.getGx()));</span><br><span class="line">    double feeling = 0;</span><br><span class="line">    if (listX.size() &gt;= 60) &#123;</span><br><span class="line">        //计算单个方向的PGA、PGV</span><br><span class="line">        double[] objects = EarthQuakeCalculate.PGA_PGV_calculate_single(listX.stream().toArray(Double[]::new));</span><br><span class="line">        //计算地震强度</span><br><span class="line">        feeling = EarthQuakeCalculate.I_calculate(objects[0], objects[1]);</span><br><span class="line">        listX.remove(0);</span><br><span class="line">    &#125;</span><br><span class="line">    return feeling;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>综上所述，数据清洗的动作其实是可以相对非常灵活多变的，这里主要按照市面所认可的数据清洗方式对数据采取了简单化的处理，通常是针对脏数据及错误数据的剔除，以及缺失数值的补植策略。当然在实际场景中，针对数据格式化的清洗方式则比较多出现，大量入库前的过程数据，二次三次处理中数据的算法补全，完善了统计报表过程所需要的各种数据维度和数据结果。</p>
<h2 id="实验任务三：phoenix插件集成及Hbase接入"><a href="#实验任务三：phoenix插件集成及Hbase接入" class="headerlink" title="实验任务三：phoenix插件集成及Hbase接入"></a>实验任务三：phoenix插件集成及Hbase接入</h2><h3 id="步骤一：启动hbase及phoenix插件"><a href="#步骤一：启动hbase及phoenix插件" class="headerlink" title="步骤一：启动hbase及phoenix插件"></a>步骤一：启动hbase及phoenix插件</h3><p>启动集群Hbase</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-hbase.sh</span><br></pre></td></tr></table></figure>

<p>启动phoenix插件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/phoenix/bin/sqlline.py master,slave1,slave2:2181</span><br></pre></td></tr></table></figure>

<p>进入phoenix命令行，显示所有表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:master,slave1,slave2&gt;!table</span><br></pre></td></tr></table></figure>

<p>创建环境记录表,复制下列建表sql语句进入命令行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS records(</span><br><span class="line">id VARCHAR primary key,</span><br><span class="line">dev_id VARCHAR,</span><br><span class="line">PM25 VARCHAR,</span><br><span class="line">HCHO VARCHAR,</span><br><span class="line">T VARCHAR,</span><br><span class="line">H VARCHAR,</span><br><span class="line">Light VARCHAR,</span><br><span class="line">Gx VARCHAR,</span><br><span class="line">Gy VARCHAR,</span><br><span class="line">Gz VARCHAR,</span><br><span class="line">G VARCHAR,</span><br><span class="line">Version VARCHAR,</span><br><span class="line">time VARCHAR,</span><br><span class="line">quakefeeling VARCHAR</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286633522.png" alt="img"><br>查看新增的RECORDS表<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286645613.png" alt="img"></p>
<h3 id="步骤二：Phoenix-Shell操作"><a href="#步骤二：Phoenix-Shell操作" class="headerlink" title="步骤二：Phoenix Shell操作"></a>步骤二：Phoenix Shell操作</h3><ul>
<li>1).插入数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upsert into records values(&#x27;2&#x27;,&#x27;C8:93:46:72:E0:74&#x27;,&#x27;73&#x27;,&#x27;0.008&#x27;,&#x27;24&#x27;,&#x27;60&#x27;,&#x27;0&#x27;,&#x27;307.00&#x27;,&#x27;42.00&#x27;,&#x27;81&#x27;);</span><br></pre></td></tr></table></figure>

<ul>
<li>2).查询记录</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from records;</span><br><span class="line">select * from records where id=&#x27;2&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>3).删除记录</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from records where id=&#x27;2&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>4).删除表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table records;</span><br></pre></td></tr></table></figure>

<ul>
<li>5).退出命令行</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!quit</span><br></pre></td></tr></table></figure>

<h3 id="步骤三：Hbase项目代码接入"><a href="#步骤三：Hbase项目代码接入" class="headerlink" title="步骤三：Hbase项目代码接入"></a>步骤三：Hbase项目代码接入</h3><p>检查pom.xml中Hbase及phoenix的jar包依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--hbase start--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.hbase&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hbase-client&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--phoneix start--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.phoenix&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;phoenix-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.0.0-HBase-2.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.lmax&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;disruptor&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.3.11&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--phoneix end--&gt;</span><br></pre></td></tr></table></figure>

<p>在src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envKafka&#x2F;env&#x2F;toHbase&#x2F;HbaseService.java服务类中添加插入Hbase方法类。添加如下新增记录方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public void insertHbase(EnvRecord envRecord,Double feeling)&#123;</span><br><span class="line">    //插入数据到hbase</span><br><span class="line">    String sql = &quot; upsert into records(id,dev_id,PM25,HCHO,T,H,Light,Gx,Gy,Gz,G,Version,time,quakefeeling) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?) &quot;;</span><br><span class="line">    PhoenixQueryUtil.update(sql, IdUtil.simpleUUID(),envRecord.getDev_id(),</span><br><span class="line">            envRecord.getPM25(),envRecord.getHCHO(),envRecord.getT(),envRecord.getH(),envRecord.getLight(),</span><br><span class="line">            envRecord.getGx(),envRecord.getGy(),envRecord.getGz(),envRecord.getG(),envRecord.getVersion(), DateUtil.now(),</span><br><span class="line">            String.valueOf(feeling));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法逻辑：拼接sql字符串，调用phoenix客户端工具PhoenixQueryUtil，通过自带update方法塞入对应的sql参数值，按照?顺序放入对应字段的值。</p>
<p>在数据清洗方法中加入Hbase插入方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src/main/java/com/cstor/envKafka/env/toHbase/HbaseService.java</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//插入hbase和mysql数据库中</span><br><span class="line">hbaseService.insertHbase(envRecord,feeling);</span><br></pre></td></tr></table></figure>

<h2 id="实验任务四：环境数据接入mysql数据库持久化"><a href="#实验任务四：环境数据接入mysql数据库持久化" class="headerlink" title="实验任务四：环境数据接入mysql数据库持久化"></a>实验任务四：环境数据接入mysql数据库持久化</h2><h3 id="步骤一：mysql数据库及表准备"><a href="#步骤一：mysql数据库及表准备" class="headerlink" title="步骤一：mysql数据库及表准备"></a>步骤一：mysql数据库及表准备</h3><p>进入集群访问mysql集群数据库<br>创建env环境database库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line">create database environment;</span><br><span class="line">use environment;</span><br></pre></td></tr></table></figure>

<p>创建环境设备表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `devices` (</span><br><span class="line">  `id` int NOT NULL AUTO_INCREMENT COMMENT &#x27;id&#x27;,</span><br><span class="line">  `dev_name` varchar(10) DEFAULT NULL COMMENT &#x27;设备名称&#x27;,</span><br><span class="line">  `dev_id` varchar(30) DEFAULT NULL COMMENT &#x27;设备mac地址&#x27;,</span><br><span class="line">  `contacter` varchar(10) DEFAULT NULL COMMENT &#x27;联系人&#x27;,</span><br><span class="line">  `phone` varchar(11) DEFAULT NULL COMMENT &#x27;联系方式&#x27;,</span><br><span class="line">  `region` varchar(10) DEFAULT NULL COMMENT &#x27;行政区&#x27;,</span><br><span class="line">  `dev_num` varchar(10) DEFAULT NULL COMMENT &#x27;设备号&#x27;,</span><br><span class="line">  `type` varchar(10) DEFAULT NULL COMMENT &#x27;结构类型&#x27;,</span><br><span class="line">  `location` int DEFAULT NULL COMMENT &#x27;所处位置&#x27;,</span><br><span class="line">  `unit` varchar(10) DEFAULT NULL COMMENT &#x27;单位名称&#x27;,</span><br><span class="line">  `address` varchar(30) DEFAULT NULL COMMENT &#x27;安装地址&#x27;,</span><br><span class="line">  `installs` int DEFAULT NULL COMMENT &#x27;安装次数&#x27;,</span><br><span class="line">  `placement` varchar(10) DEFAULT NULL COMMENT &#x27;摆放方式&#x27;,</span><br><span class="line">  `fixedmode` varchar(10) DEFAULT NULL COMMENT &#x27;刚性连接&#x27;,</span><br><span class="line">  `samplerete` varchCREATE TABLE `records` (</span><br><span class="line">  `id` int NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `dev_id` varchar(30) NOT NULL,</span><br><span class="line">  `PM25` varchar(20) NOT NULL,</span><br><span class="line">  `HCHO` varchar(20) NOT NULL,</span><br><span class="line">  `T` varchar(20) NOT NULL,</span><br><span class="line">  `H` varchar(20) NOT NULL,</span><br><span class="line">  `Light` varchar(20) NOT NULL,</span><br><span class="line">  `Gx` varchar(20) NOT NULL,</span><br><span class="line">  `Gy` varchar(20) NOT NULL,</span><br><span class="line">  `Gz` varchar(20) NOT NULL,</span><br><span class="line">  `G` varchar(20) NOT NULL,</span><br><span class="line">  `Version` varchar(20) NOT NULL,</span><br><span class="line">  `time` datetime NOT NULL,</span><br><span class="line">  `quakefeeling` double NOT NULL DEFAULT &#x27;0&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=801019 DEFAULT CHARSET=utf8;ar(10) DEFAULT NULL COMMENT &#x27;采样率&#x27;,</span><br><span class="line">  `recordsnum` int NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;记录数&#x27;,</span><br><span class="line">  `longitude` double NOT NULL COMMENT &#x27;经度&#x27;,</span><br><span class="line">  `latitude` double NOT NULL COMMENT &#x27;纬度&#x27;,</span><br><span class="line">  `report` int NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;震感速报&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>

<p>创建环境记录表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `records` (</span><br><span class="line">  `id` int NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `dev_id` varchar(30) NOT NULL,</span><br><span class="line">  `PM25` varchar(20) NOT NULL,</span><br><span class="line">  `HCHO` varchar(20) NOT NULL,</span><br><span class="line">  `T` varchar(20) NOT NULL,</span><br><span class="line">  `H` varchar(20) NOT NULL,</span><br><span class="line">  `Light` varchar(20) NOT NULL,</span><br><span class="line">  `Gx` varchar(20) NOT NULL,</span><br><span class="line">  `Gy` varchar(20) NOT NULL,</span><br><span class="line">  `Gz` varchar(20) NOT NULL,</span><br><span class="line">  `G` varchar(20) NOT NULL,</span><br><span class="line">  `Version` varchar(20) NOT NULL,</span><br><span class="line">  `time` datetime NOT NULL,</span><br><span class="line">  `quakefeeling` double NOT NULL DEFAULT &#x27;0&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=801019 DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>

<h3 id="步骤二：编写项目调用mysql新增环境数据方法"><a href="#步骤二：编写项目调用mysql新增环境数据方法" class="headerlink" title="步骤二：编写项目调用mysql新增环境数据方法"></a>步骤二：编写项目调用mysql新增环境数据方法</h3><p>修改conf&#x2F;config.properties中的数据库相关配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#MySQL</span><br><span class="line">mysqlhost=#集群ip</span><br><span class="line">mysqlport=3306</span><br><span class="line">mysqluser=root</span><br><span class="line">mysqlpwd=#密码</span><br><span class="line">dbname=environment</span><br></pre></td></tr></table></figure>

<p>编写数据库交互层代码src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envKafka&#x2F;env&#x2F;toMysql&#x2F;EnvRecordMapper.java<br>添加如下代码：</p>
<h4 id="【设备数据更新方法】"><a href="#【设备数据更新方法】" class="headerlink" title="【设备数据更新方法】"></a>【设备数据更新方法】</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 更新设备记录数量+1</span><br><span class="line"> */</span><br><span class="line">@Update(&quot;UPDATE environment.devices SET recordsnum = recordsnum + 1 WHERE dev_id = #&#123;dev_id&#125;&quot;)</span><br><span class="line">void update_record_num(String dev_id);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 更新震感，报告数量+1，震感数量+1</span><br><span class="line"> * @param dev_id</span><br><span class="line"> */</span><br><span class="line">@Update(&quot;UPDATE environment.devices SET recordsnum = recordsnum + 1, report = report + 1 WHERE dev_id = #&#123;dev_id&#125;&quot;)</span><br><span class="line">void update_record_num_feeling(String dev_id);</span><br></pre></td></tr></table></figure>

<p>方法逻辑:</p>
<ul>
<li>1.update_record_num方法表示新增设备记录数量。</li>
<li>2.update_record_num_feeling方法表示更新设备震感及报告数量。</li>
</ul>
<h4 id="【数据更新服务调用】"><a href="#【数据更新服务调用】" class="headerlink" title="【数据更新服务调用】"></a>【数据更新服务调用】</h4><p>编写数据库服务调用业务层<br>src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envKafka&#x2F;env&#x2F;toMysql&#x2F;DataBaseService.java<br>添加如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 插入数据库并更新数据库震感记录数</span><br><span class="line"> */</span><br><span class="line">public void insertDatbase(EnvRecord envRecord,Double feeling)&#123;</span><br><span class="line">    envRecordMapper.insert(envRecord);</span><br><span class="line">    //如果地震强度大于11</span><br><span class="line">    if (feeling &gt; 11) &#123;</span><br><span class="line">        //新震感，报告数量+1，震感数量+1</span><br><span class="line">        envRecordMapper.update_record_num_feeling(envRecord.getDev_id());</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        //更新设备记录数量+1</span><br><span class="line">        envRecordMapper.update_record_num(envRecord.getDev_id());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法逻辑：</p>
<ul>
<li>调用环境mapper服务envRecordMapper插入清洗之后的数据</li>
<li>如果震感大于11则更新设备获取的震感数值及记录数值，如果震感小于等于11则只更新记录获取数值</li>
<li>在数据清洗方法中加入mysql插入方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">src/main/java/com/cstor/envKafka/env/toHbase/HbaseService.java</span><br><span class="line">//插入hbase和mysql数据库中</span><br><span class="line">dataBaseService.insertDatbase(envRecord,feeling);</span><br></pre></td></tr></table></figure>

<h3 id="步骤三：编写前端调用api"><a href="#步骤三：编写前端调用api" class="headerlink" title="步骤三：编写前端调用api"></a>步骤三：编写前端调用api</h3><h4 id="【队列读取API】"><a href="#【队列读取API】" class="headerlink" title="【队列读取API】"></a>【队列读取API】</h4><p>修改src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envKafka&#x2F;env&#x2F;envApi&#x2F;envApi.java<br>增加开启队列读取方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 环境云平台实训项目首页数据获取</span><br><span class="line"> */</span><br><span class="line">@ApiOperation(value = &quot;环境数据采集&quot;, notes = &quot;&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/envRecordCollection&quot;, method = RequestMethod.POST)</span><br><span class="line">@CrossOrigin</span><br><span class="line">public JSONObject envRecordCollection() &#123;</span><br><span class="line">    //查询所有设备信息列表</span><br><span class="line">    envRecordConsumer.getConsumerInfo();</span><br><span class="line">    return RspBuilder.defaultSuccessResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法逻辑：</p>
<ul>
<li>调用队列读取服务，开启队列客户端数据读取动作</li>
<li>增加队列数据推送方法（用于推送kafka队列数据，验证队列读取客户端）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 环境云平台实训项目首页数据获取</span><br><span class="line"> */</span><br><span class="line">@ApiOperation(value = &quot;生成新的队列数据&quot;, notes = &quot;&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/initNewEnvRecord&quot;, method = RequestMethod.POST)</span><br><span class="line">@CrossOrigin</span><br><span class="line">public JSONObject initNewEnvRecord() &#123;</span><br><span class="line">    //查询所有设备信息列表</span><br><span class="line">    producer.initKafkaMsg();</span><br><span class="line">    return RspBuilder.defaultSuccessResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法逻辑：</p>
<ul>
<li>调用kafka队列推送动作，实际上队列中的数据主要产生应该通过前置的env_netty项目的环境采集推送。这里加上队列推送动作主要是为了本项目中的自测，先开启队列读取，然后再监控客户端读取动作的正确性。</li>
</ul>
<h3 id="步骤四：测试验证数据清洗及入库情况"><a href="#步骤四：测试验证数据清洗及入库情况" class="headerlink" title="步骤四：测试验证数据清洗及入库情况"></a>步骤四：测试验证数据清洗及入库情况</h3><p>通过正常启动或者debug模式启动项目服务<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286676867.png" alt="img"><br>当日志输出启动成功后调用swaggger-ui提供的api接口页面<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286688526.png" alt="img"><br>服务地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8081/swagger-ui.html">http://127.0.0.1:8081/swagger-ui.html</a> 端口号8081为config中配置的服务端口号<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286700827.png" alt="img"><br>首先开启队列客户端读取服务&#x2F;env&#x2F;envRecordCollection<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286713768.png" alt="img"><br>开启后端kafka队列数据监控</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh --bootstrap-server hadoop100:9092 --from-beginning --topic envTopic</span><br><span class="line">&#123;&quot;HCHO&quot;:&quot;0.008&quot;,&quot;PM25&quot;:&quot;73&quot;,&quot;G&quot;:&quot;0.0&quot;,&quot;H&quot;:&quot;59&quot;,&quot;Time&quot;:&quot;2021-11-12 15:41:40&quot;,&quot;dev_id&quot;:&quot;C8:93:46:72:E0:74&quot;,&quot;Gx&quot;:&quot;307.000&quot;,&quot;Gy&quot;:&quot;43.000&quot;,&quot;Gz&quot;:&quot;822.000&quot;,&quot;T&quot;:&quot;24&quot;,&quot;Light&quot;:&quot;0&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>调用kafka队列推送动作&#x2F;env&#x2F;initNewEnvRecord<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286735781.png" alt="img"><br>查看队列是否收到消息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh --bootstrap-server hadoop100:9092 --from-beginning --topic envTopic</span><br><span class="line">&#123;&quot;HCHO&quot;:&quot;0.008&quot;,&quot;PM25&quot;:&quot;73&quot;,&quot;G&quot;:&quot;0.0&quot;,&quot;H&quot;:&quot;59&quot;,&quot;Time&quot;:&quot;2021-11-12 15:41:40&quot;,&quot;dev_id&quot;:&quot;C8:93:46:72:E0:74&quot;,&quot;Gx&quot;:&quot;307.000&quot;,&quot;Gy&quot;:&quot;43.000&quot;,&quot;Gz&quot;:&quot;822.000&quot;,&quot;T&quot;:&quot;24&quot;,&quot;Light&quot;:&quot;0&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>查看客户端是否读取到数据并塞入mysql数据库及hbase中<br>mysql数据正常入库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use environment;</span><br><span class="line">mysql&gt; select t.* from records t;</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286751803.png" alt="img"><br>Hbase数据正常入库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/phoenix/bin/sqlline.py master,slave1,slave2:2181</span><br><span class="line">0: jdbc:phoenix:master,slave1,slave2&gt; select * from records;</span><br></pre></td></tr></table></figure>

<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286765658.png" alt="img"><br>至此，我们即完成了从环境采集数据的清洗已经持久化入库，后续等待接入环境采集可视化项目env_view即可完成对整个项目调用链的后端业务。</p>
<h2 id="75-项目实训-环境监控平台-环境前端页面服务构建"><a href="#75-项目实训-环境监控平台-环境前端页面服务构建" class="headerlink" title="75.项目实训-环境监控平台-环境前端页面服务构建"></a>75.项目实训-环境监控平台-环境前端页面服务构建</h2><blockquote>
<h3 id="目的-16"><a href="#目的-16" class="headerlink" title="目的"></a>目的</h3><p>完成本实验，您应该能够：</p>
<ul>
<li>熟悉Kafka队列推送和读取方式</li>
<li>熟悉通过Java完成Kafka队列推送及读取</li>
<li>熟悉Kafka在集群场景下的的用法</li>
<li>熟悉Hbase在集群业务场景下的的用法</li>
<li>熟悉Phoenix组件使用方式</li>
</ul>
<h3 id="要求-16"><a href="#要求-16" class="headerlink" title="要求"></a>要求</h3><ul>
<li>熟悉Java 基本语法</li>
<li>熟悉mysql数据库对接项目方式</li>
<li>熟悉日常前端可视化对接后端方法</li>
<li>熟悉日常业务数据统计后台开发动作</li>
</ul>
<h3 id="原理-16"><a href="#原理-16" class="headerlink" title="原理"></a>原理</h3><h2 id="项目整体结构"><a href="#项目整体结构" class="headerlink" title="项目整体结构"></a>项目整体结构</h2><p>最后是对数据的展示，我们对数据的展示主要分为两部分，一部分为日常的机器相关信息，另一部分则是设备的状态变更情况和记录变更情况。第一部分数据我们主要通过API接口的方式统一吐出数据。而第二种方式，由于对数据失效性的要求，我们引入了webSocket，去通过建立webSocket通信，实时的让后台根据自身采集数据的情况去更新前台的展示页面内容。从而保证页面显示内容的及时更新。<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286803238.png" alt="img"></p>
<h2 id="Swagger是什么？它能干什么？"><a href="#Swagger是什么？它能干什么？" class="headerlink" title="Swagger是什么？它能干什么？"></a>Swagger是什么？它能干什么？</h2><p>Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。总体目标是使客户端和文件系统作为服务器以同样的速度来更新。文件的方法，参数和模型紧密集成到服务器端的代码，允许API来始终保持同步。<br>有上述介绍可以看出，swagger的主要用途是用来处理可视化的api服务以及提供规范的api文档。</p>
<h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><p>传统 Web  模式在处理高并发及实时性需求的时候，会遇到难以逾越的瓶颈，我们需要一种高效节能的双向通信机制来保证数据的实时传输。在此背景下，基于 HTML5  规范的、有 Web TCP 之称的 WebSocket  应运而生。它实现了浏览器与服务器全双工通信，能更好的节省服务器资源和带宽并达到实时通讯，它建立在 TCP 之上，同 HTTP 一样通过 TCP  来传输数据，但是它和 HTTP 最大不同是：<br>WebSocket 是一种双向通信协议，在建立连接后，WebSocket 服务器和 Browser&#x2F;Client Agent 都能主动的向对方发送或接收数据，就像 Socket 一样；<br>WebSocket 需要类似 TCP 的客户端和服务器端通过握手连接，连接成功后才能相互通信。传统模式交互与使用 WebSocket 模式的交互如下图：<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286818983.png" alt="img"><br>它的最大特点就是，服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于服务器推送技术的一种。<br>其他特点包括：</p>
<ul>
<li>建立在 TCP 协议之上，服务器端的实现比较容易。</li>
<li>与 HTTP 协议有着良好的兼容性，默认端口也是80和443。</li>
<li>数据格式比较轻量，性能开销小，通信高效。</li>
<li>可以发送文本，也可以发送二进制数据。</li>
<li>没有同源限制，客户端可以与任意服务器通信。</li>
<li>协议标识符是ws（如果加密，则为wss），服务器网址就是 URL。</li>
</ul>
<h2 id="地震环境猫项目实训前端可视化界面"><a href="#地震环境猫项目实训前端可视化界面" class="headerlink" title="地震环境猫项目实训前端可视化界面"></a>地震环境猫项目实训前端可视化界面</h2><p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286831170.png" alt="img"><br>按照如图所示的可视化背板，我们续作按照先后顺序完成下述几步动作：<br>1.可视化页面所需数据API接口规划及定义<br>2.数据API接口实现实现<br>3.接口数据验证及测试<br>4.前端可视化页面接入，及页面联调</p>
</blockquote>
<h2 id="实验任务一：可视化API接口规划及定义"><a href="#实验任务一：可视化API接口规划及定义" class="headerlink" title="实验任务一：可视化API接口规划及定义"></a>实验任务一：可视化API接口规划及定义</h2><h3 id="步骤一：页面所需数据支撑"><a href="#步骤一：页面所需数据支撑" class="headerlink" title="步骤一：页面所需数据支撑"></a>步骤一：页面所需数据支撑</h3><p>通过需要构建的前端页面板所需的数据组成分析，我们需要的支撑数据如下：</p>
<ul>
<li>设备在线数&#x2F;设备总数</li>
<li>系统记录总数</li>
<li>震感数据总数服务地址被调用次数</li>
<li>实时接收数据包速率（实时接口）</li>
<li>采集设备地址（地图显示数据，如果存在移动可能性可以考虑做成实时数据）</li>
<li>震动频次&#x2F;设备在线率&#x2F;数据延迟（实时数据）</li>
<li>设备&#x2F;数据在线完整率（实时数据）</li>
</ul>
<h3 id="步骤二：接口规划"><a href="#步骤二：接口规划" class="headerlink" title="步骤二：接口规划"></a>步骤二：接口规划</h3><p>按照上面的页面数据要求我们罗列了如下的这些接口以满足页面数据支撑：<br>4个rest接口口</p>
<ul>
<li>&#x2F;index 查询平台首页的静态数据</li>
<li>&#x2F;getDeviceCompleteness 设备&#x2F;数据库在线率</li>
<li>&#x2F;devices 查询设备列表信息 </li>
<li>&#x2F;device 查询单台设备详情<br>2个websocket接口</li>
<li>&#x2F;websockt_environment&#x2F;devices&#x2F;  设备在线数实时查询接口</li>
<li>&#x2F;websockt_environment&#x2F;index 平台首页环境实时查询接口</li>
</ul>
<h2 id="实验任务二：数据接口实现"><a href="#实验任务二：数据接口实现" class="headerlink" title="实验任务二：数据接口实现"></a>实验任务二：数据接口实现</h2><h3 id="步骤一：-index首页静态数据显示"><a href="#步骤一：-index首页静态数据显示" class="headerlink" title="步骤一：&#x2F;index首页静态数据显示"></a>步骤一：&#x2F;index首页静态数据显示</h3><h4 id="Mapper数据库对接层"><a href="#Mapper数据库对接层" class="headerlink" title="Mapper数据库对接层"></a>Mapper数据库对接层</h4><p>增加src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envView&#x2F;mapper&#x2F;EnvDeviceMapper.java<br>findAllDevices：查询所有设备列表<br>findDeviceDetail：查询单个设备详情</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *查询所有设备信息</span><br><span class="line"> */</span><br><span class="line">@Select(&quot;select * from environment.devices&quot;)</span><br><span class="line">List&lt;EnvDevice&gt; findAllDevices();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *查询设备详细信息</span><br><span class="line"> */</span><br><span class="line">@Select(&quot;select * from environment.devices where dev_id = #&#123;dev_id&#125;&quot;)</span><br><span class="line">EnvDevice findDeviceDetail(String dev_id);</span><br></pre></td></tr></table></figure>

<p>增加src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envView&#x2F;mapper&#x2F;EnvRecordMapper.java </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 查询在线设备记录数</span><br><span class="line"> */</span><br><span class="line">@Select(&quot;SELECT * FROM (SELECT dev_id FROM environment.records  WHERE TIME &gt;= DATE_SUB(NOW(),INTERVAL 2 SECOND) GROUP BY dev_id) AS result;&quot;)</span><br><span class="line">List&lt;String&gt; findAllOnlineDevices();</span><br></pre></td></tr></table></figure>

<p>sql解析：按照设备id显示设备当前时间段内的在线情况，即是否有在当前时间段内有记录输出。</p>
<h4 id="Service调用层"><a href="#Service调用层" class="headerlink" title="Service调用层"></a>Service调用层</h4><p>增加src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envView&#x2F;service&#x2F;EnvServiceImpl.java 增加查询所有设备列表service中转调用方法，此处没有加入过多业务知识单纯的中转层，对API提供底层服务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 查询所有设备信息</span><br><span class="line"> */</span><br><span class="line">@Override</span><br><span class="line">public List&lt;EnvDevice&gt; findAllDevices() &#123;</span><br><span class="line">    return envDeviceMapper.findAllDevices();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 查询所有在线设备数量</span><br><span class="line"> */</span><br><span class="line">@Override</span><br><span class="line">public Integer findOnlineDevicesNum() &#123;</span><br><span class="line">    return recordMapper.findAllOnlineDevices().size();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Api调用层"><a href="#Api调用层" class="headerlink" title="Api调用层"></a>Api调用层</h4><p>增加src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envView&#x2F;viewApi&#x2F;ViewApi.java平台数据显示方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 环境云平台实训项目首页数据获取</span><br><span class="line"> */</span><br><span class="line">@ApiOperation(value = &quot;查询环境平台首页&quot;, notes = &quot;&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/index&quot;, method = RequestMethod.POST)</span><br><span class="line">@CrossOrigin</span><br><span class="line">public JSONObject environmentIndex() &#123;</span><br><span class="line">    //查询所有设备信息列表</span><br><span class="line">    List&lt;EnvDevice&gt; list = envService.findAllDevices();</span><br><span class="line">    //累加所设备的记录总数</span><br><span class="line">    int num = list.stream().mapToInt(EnvDevice::getRecordsnum).sum();</span><br><span class="line">    //塞入所有查询结果</span><br><span class="line">    return RspBuilder.createSuccessRsp().append(&quot;deviceNum&quot;, list.size())</span><br><span class="line">            .append(&quot;onlineDeviceNum&quot;, envService.findOnlineDevicesNum())</span><br><span class="line">            .append(&quot;recordsnum&quot;, num)</span><br><span class="line">            .append(&quot;serviceTimes&quot;, 0)</span><br><span class="line">            .append(&quot;deviceList&quot;, list).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码逻辑：</p>
<ul>
<li>动作一：查询service层获得所有设备列表</li>
<li>动作二：通过查询的设备列表获取设备记录总是，所有设备记录数相加</li>
<li>动作三：塞入页面所需的数据内容并返回前台</li>
<li><ul>
<li>deviceNum：设备数量</li>
</ul>
</li>
<li><ul>
<li>onlineDeviceNum：在线设备数量（在线设备数量通过当前时间前后是否获得记录数决定设备是否在线）</li>
</ul>
</li>
<li><ul>
<li>recordsnum：采集到的记录总数量</li>
</ul>
</li>
<li><ul>
<li>serviceTimes：服务次数（未实现，可以通过调用本接口的次数统计）</li>
</ul>
</li>
<li><ul>
<li>deviceList：设备列表详情</li>
</ul>
</li>
</ul>
<h3 id="步骤二：-getDeviceCompleteness-设备-数据库在线率"><a href="#步骤二：-getDeviceCompleteness-设备-数据库在线率" class="headerlink" title="步骤二：&#x2F;getDeviceCompleteness 设备&#x2F;数据库在线率"></a>步骤二：&#x2F;getDeviceCompleteness 设备&#x2F;数据库在线率</h3><h4 id="【Mapper数据库对接层】"><a href="#【Mapper数据库对接层】" class="headerlink" title="【Mapper数据库对接层】"></a>【Mapper数据库对接层】</h4><p>增加src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envView&#x2F;mapper&#x2F;EnvRecordMapper.java<br>getDeviceCompleteness：查询设备完整率<br>getRecordCompleteness：查询采集数据记录完整率</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 查询设备完整率</span><br><span class="line"> */</span><br><span class="line">@Select(&quot;SELECT * FROM (SELECT DATE_FORMAT(time,&#x27;%m-%d-%H&#x27;) as time_str,  dev_id FROM environment.records  WHERE TIME &gt;= DATE_SUB(NOW(),INTERVAL 1 DAY) GROUP BY  dev_id,time_str) AS result;&quot;)</span><br><span class="line">List&lt;EnvDeviceCompleteness&gt; getDeviceCompleteness();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 查询数据完整率</span><br><span class="line"> */</span><br><span class="line">@Select(&quot;SELECT time_str,COUNT(*) as record_num FROM (SELECT DATE_FORMAT(time,&#x27;%m-%d-%H&#x27;) as time_str,  dev_id FROM environment.records  WHERE TIME &gt;= DATE_SUB(NOW(),INTERVAL 1 DAY) ) AS result GROUP BY time_str;&quot;)</span><br><span class="line">List&lt;EnvRecordCompleteness&gt; getRecordCompleteness();</span><br></pre></td></tr></table></figure>

<p>sql解析：</p>
<ul>
<li>方法一：按照设备id以及记录时间段分组（创建时间格式化为月日时），以当前时间的24小时为统计周期查询所有的设备时间段在线记录。</li>
<li>方法二: 按照记录数量以及记录时间段分组,以当前时间的24小时为统计周期查询所有时间段的记录数量.</li>
</ul>
<h4 id="【Service调用层】"><a href="#【Service调用层】" class="headerlink" title="【Service调用层】"></a>【Service调用层】</h4><p>增加src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envView&#x2F;service&#x2F;EnvServiceImpl.java 增加两个计算数据完整率的工具方法。</p>
<ul>
<li>方法一:获取最近24小时的时间记录数<br>获取当前时间，利用当前时间前推24小时获得一个完整24小时内的开始时间和结束时间。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 获取最近24小时的小时列表.</span><br><span class="line"> * @return 返回间隔日期</span><br><span class="line"> */</span><br><span class="line">public List&lt;String&gt; getLast24Hours() &#123;</span><br><span class="line">    LocalDateTime currentDate = LocalDateTime.now();</span><br><span class="line">    LocalDateTime lastDate = currentDate.minusHours(24);</span><br><span class="line">    ChronoUnit.HOURS.between(lastDate,currentDate);</span><br><span class="line">    return getBetweenHours(lastDate, currentDate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>方法二：创建时间输出格式对象DateTimeFormatter ftf并定义按照“月-日-时”进行格式输出。<br>获取从当前开始计算的24 小时开始时间及结束时间，按照ftf重新格式化时间格式，最后封装为对应的时间段列表返回。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 获取两个日期间隔的所有日期,包括两端的日期.</span><br><span class="line"> * @param startDate 开始日期</span><br><span class="line"> * @param endDate 结束日期</span><br><span class="line"> * @return 返回间隔日期</span><br><span class="line"> */</span><br><span class="line">public List&lt;String&gt; getBetweenHours(LocalDateTime startDate, LocalDateTime endDate) &#123;</span><br><span class="line">    final DateTimeFormatter ftf = DateTimeFormatter.ofPattern(&quot;MM-dd-HH&quot;);</span><br><span class="line">    return Optional.of(ChronoUnit.HOURS.between(startDate,endDate))</span><br><span class="line">            .filter(t -&gt; t &gt;= 1)</span><br><span class="line">            .map(</span><br><span class="line">                    t -&gt; Stream.iterate(startDate, d -&gt; d.plusHours(1))</span><br><span class="line">                            .limit(t)</span><br><span class="line">                            .map(hours-&gt;ftf.format(hours))</span><br><span class="line">                            .collect(Collectors.toList())</span><br><span class="line">            )</span><br><span class="line">            .orElse(Collections.emptyList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>方法三：设备完整性核心业务方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 获取设备完整性及数据完整性</span><br><span class="line"> */</span><br><span class="line">@Override</span><br><span class="line">public List&lt;EnvRecordCompleteness&gt; getRecordCompleteness() &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 查询24小时内的所有设备完整率信息</span><br><span class="line">     * 查询24小时内的所有记录完整率信息</span><br><span class="line">     */</span><br><span class="line">    List&lt;EnvDeviceCompleteness&gt; EnvDeviceCompletenessList=recordMapper.getDeviceCompleteness();</span><br><span class="line">    List&lt;EnvRecordCompleteness&gt; recordCompletenessList=recordMapper.getRecordCompleteness();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 两个list进行遍历循环 当时间段相等时则累加记录完整度中的设备数量</span><br><span class="line">     */</span><br><span class="line">    for (EnvRecordCompleteness recordCompleteness:recordCompletenessList)&#123;</span><br><span class="line">        for (EnvDeviceCompleteness EnvDeviceCompleteness:EnvDeviceCompletenessList)&#123;</span><br><span class="line">            if (EnvDeviceCompleteness.getTime_str().equals(recordCompleteness.getTime_str()))&#123;</span><br><span class="line">                recordCompleteness.addDeviceNum();</span><br><span class="line">                //计算所有时间段的数据的数据完整度</span><br><span class="line">                recordCompleteness.calculateCompletenessPercent(REFERENCE_VALUE);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //补全时间段内所有数据</span><br><span class="line">    List&lt;EnvRecordCompleteness&gt; remainRecordCompleteness=this.getLast24Hours().stream()</span><br><span class="line">                                    .filter(t-&gt;!recordCompletenessList.stream()</span><br><span class="line">                                    .map(EnvRecordCompleteness::getTime_str)</span><br><span class="line">                                    .collect(Collectors.toList()).contains(t))</span><br><span class="line">                                    .map(EnvRecordCompleteness::getRemainRecordCompleteness)</span><br><span class="line">                                    .collect(Collectors.toList());</span><br><span class="line">    recordCompletenessList.addAll(remainRecordCompleteness);</span><br><span class="line">    return recordCompletenessList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码逻辑：</p>
<ul>
<li>动作一：分别24小时内的所有设备&#x2F;时间段记录数以及24小时内的所有记录时间段数</li>
<li>动作二：嵌套循环上述两套数据记录，获取相同时间段的数据计算数据完整度。<br>数据完整度计算逻辑【记录数量&#x2F;（设备数量）*基准值&#x3D;数据完整率】，计算的结果取余保留两位小数。</li>
<li>动作三：获取最近的24小时记录数，过滤掉已有的时间段数据，并补全剩余的空值时间段数据。</li>
<li>动作四：拼装为完整的24小时完整率数据返回api层。</li>
</ul>
<h4 id="【Api层】"><a href="#【Api层】" class="headerlink" title="【Api层】"></a>【Api层】</h4><p>增加src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envView&#x2F;viewApi&#x2F;ViewApi.java平台数据显示方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(value = &quot;查询设备在线率&quot;, notes = &quot;&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/getDeviceCompleteness&quot;, method = RequestMethod.POST)</span><br><span class="line">@CrossOrigin</span><br><span class="line">public JSONObject getDeviceCompleteness()&#123;</span><br><span class="line">    //查询时间段内的设备在线率</span><br><span class="line">    return RspBuilder.createSuccessRsp().append(&quot;recordCompleteness&quot;,envService.getRecordCompleteness()).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接返回获得的设备数据完整率</p>
<h3 id="步骤三：-devices-查询设备列表信息及-device-查询单台设备详情"><a href="#步骤三：-devices-查询设备列表信息及-device-查询单台设备详情" class="headerlink" title="步骤三：&#x2F;devices 查询设备列表信息及 &#x2F;device 查询单台设备详情"></a>步骤三：&#x2F;devices 查询设备列表信息及 &#x2F;device 查询单台设备详情</h3><h4 id="【Api层】-1"><a href="#【Api层】-1" class="headerlink" title="【Api层】"></a>【Api层】</h4><p>由于我们在4.5.2.1步骤一中已经添加了查询设备列表的和单个设备详情的service方法，所以这里直接复用即可。<br>增加src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envView&#x2F;viewApi&#x2F;ViewApi.java平台数据显示方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 查询所有设备列表信息</span><br><span class="line"> */</span><br><span class="line">@ApiOperation(value = &quot;查询设备列表&quot;, notes = &quot;&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/devices&quot;, method = RequestMethod.POST)</span><br><span class="line">@CrossOrigin</span><br><span class="line">public List&lt;EnvDevice&gt; environmentDevices() &#123;</span><br><span class="line">    return envService.findAllDevices();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  查询单台设备信息</span><br><span class="line"> */</span><br><span class="line">@ApiOperation(value = &quot;查询具体设备&quot;, notes = &quot;&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/device&quot;, method = RequestMethod.POST)</span><br><span class="line">@CrossOrigin</span><br><span class="line">public EnvDevice environmentDeviceDetail(@RequestParam String deviceId) &#123;</span><br><span class="line">    return envService.findDeviceDetail(deviceId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>依次为查询设备列表以及单台设备查询两个方法，获取结果直接返回前台，此处api仅仅作为数据中转。</p>
<h3 id="步骤四：-websockt-environment-devices-设备在环境数据实时查询接口"><a href="#步骤四：-websockt-environment-devices-设备在环境数据实时查询接口" class="headerlink" title="步骤四：&#x2F;websockt_environment&#x2F;devices&#x2F;  设备在环境数据实时查询接口"></a>步骤四：&#x2F;websockt_environment&#x2F;devices&#x2F;  设备在环境数据实时查询接口</h3><h4 id="【Mapper数据库对接层】-1"><a href="#【Mapper数据库对接层】-1" class="headerlink" title="【Mapper数据库对接层】"></a>【Mapper数据库对接层】</h4><p>增加src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envView&#x2F;mapper&#x2F;EnvRecordMapper.java<br>getRecentCompleteness：查询最近时间段的地震数据变化量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 获取最近的地政波动记录数量</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Select(&quot;SELECT Gx,Gy,Gz,G,time FROM environment.records  WHERE TIME &gt;= DATE_SUB(NOW(),INTERVAL 30 SECOND);&quot;)</span><br><span class="line">@Results(&#123;</span><br><span class="line">        @Result(property = &quot;Gx&quot;, column = &quot;Gx&quot;),</span><br><span class="line">        @Result(property = &quot;Gy&quot;, column = &quot;Gy&quot;),</span><br><span class="line">        @Result(property = &quot;Gz&quot;, column = &quot;Gz&quot;),</span><br><span class="line">        @Result(property = &quot;G&quot;, column = &quot;G&quot;),</span><br><span class="line">        @Result(property = &quot;time&quot;, column = &quot;time&quot;),</span><br><span class="line">&#125;)</span><br><span class="line">List&lt;EarthquakeWave&gt; getRecentCompleteness();</span><br></pre></td></tr></table></figure>

<p>sql解析：获取最近三十秒的地震记录</p>
<h4 id="Service调用层-1"><a href="#Service调用层-1" class="headerlink" title="Service调用层"></a>Service调用层</h4><p>增加src&#x2F;main&#x2F;java&#x2F;com&#x2F;cstor&#x2F;envView&#x2F;service&#x2F;EnvServiceImpl.java 增加过度方法，把mapper层数据返回前端api服务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 获取最近的地政波动记录数量</span><br><span class="line"> */</span><br><span class="line">public List&lt;EarthquakeWave&gt; getRecentCompleteness()&#123;</span><br><span class="line">    return recordMapper.getRecentCompleteness();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="【Api层】-2"><a href="#【Api层】-2" class="headerlink" title="【Api层】"></a>【Api层】</h4><p>增加com&#x2F;cstor&#x2F;envView&#x2F;websocket&#x2F;WebSocket_Devices.java平台设备数据socket返回方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@OnOpen//打开连接执行</span><br><span class="line">public void onOpw(Session session, @PathParam(&quot;dev_id&quot;) String dev_id)&#123;</span><br><span class="line">    /*</span><br><span class="line">    * 从spring容器中获取记录查询的mapper服务</span><br><span class="line">    * 从spring容器中获取redis服务</span><br><span class="line">    * 塞入震感详细数据</span><br><span class="line">    */</span><br><span class="line">    EnvService envService = SpringUtil.getBean(EnvService.class);</span><br><span class="line">    this.session = session;</span><br><span class="line">    JSONObject json = new JSONObject();</span><br><span class="line">    while (true) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            List&lt;EarthquakeWave&gt; earthquakeWavesList = envService.getRecentCompleteness();</span><br><span class="line">            Double[] gxArrays=earthquakeWavesList.stream().map(EarthquakeWave::getGx).map(EarthquakeWave::getDoubleValue).toArray(Double[]::new);</span><br><span class="line">            Double[] gyArrays=earthquakeWavesList.stream().map(EarthquakeWave::getGy).map(EarthquakeWave::getDoubleValue).toArray(Double[]::new);</span><br><span class="line">            Double[] PAG_PGV= Calculate.PGA_PGV_calculate(gxArrays,gyArrays);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            EnvRecord envRecord = envService.getDeviceRecordDetail(dev_id);</span><br><span class="line">            json.fluentPut(&quot;HCHO&quot;, envRecord.getHCHO()).fluentPut(&quot;PM25&quot;, envRecord.getPM25())</span><br><span class="line">                    .fluentPut(&quot;T&quot;, envRecord.getT()).fluentPut(&quot;H&quot;, envRecord.getH())</span><br><span class="line">                    .fluentPut(&quot;earthquakeWave&quot;, earthquakeWavesList)</span><br><span class="line">                    .fluentPut(&quot;PGA&quot;, PAG_PGV[0])</span><br><span class="line">                    .fluentPut(&quot;PGV&quot;, PAG_PGV[1]);</span><br><span class="line">            if (envService.findIfOnline(dev_id)) &#123;</span><br><span class="line">                json.fluentPut(&quot;status&quot;, &quot;正常&quot;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                json.fluentPut(&quot;status&quot;, &quot;异常&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            sendMessage(json.toJSONString());</span><br><span class="line"></span><br><span class="line">            Thread.sleep(30000);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法解析：</p>
<ul>
<li>动作一：获取所有地震采集波动记录数据</li>
<li>动作二：获取地面X轴数据结果集及Y轴数据结果集</li>
<li>动作三：通过行业计算工具方法Calculate.PGA_PGV_calculate获得PGA及PGV</li>
<li><ul>
<li>Peak Ground Acceleration (PGA), 峰值地面加速度；</li>
</ul>
</li>
<li><ul>
<li>Peak Ground Velocity (PGV), 峰值地面速度；</li>
</ul>
</li>
<li>动作四：返回前台数据内容</li>
<li><ul>
<li>HCHO：甲醛参数</li>
</ul>
</li>
<li><ul>
<li>PM25：PM2.5参数</li>
</ul>
</li>
<li><ul>
<li>T：温度</li>
</ul>
</li>
<li><ul>
<li>H：湿度</li>
</ul>
</li>
<li><ul>
<li>earthquakeWave：震感记录数</li>
</ul>
</li>
<li><ul>
<li>status：服务调用状态</li>
</ul>
</li>
</ul>
<h3 id="步骤五：-websockt-environment-index-首页背板实时数据获取"><a href="#步骤五：-websockt-environment-index-首页背板实时数据获取" class="headerlink" title="步骤五：&#x2F;websockt_environment&#x2F;index 首页背板实时数据获取"></a>步骤五：&#x2F;websockt_environment&#x2F;index 首页背板实时数据获取</h3><h4 id="【Api层】-3"><a href="#【Api层】-3" class="headerlink" title="【Api层】"></a>【Api层】</h4><p>增加com&#x2F;cstor&#x2F;envView&#x2F;websocket&#x2F;WebSocket_Index.java平台设备数据socket返回方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@OnOpen//打开连接执行</span><br><span class="line">public void onOpw(Session session) &#123;</span><br><span class="line">    EnvService envService = SpringUtil.getBean(EnvService.class);</span><br><span class="line">    //查询所有设备信息列表</span><br><span class="line">    JSONObject json = new JSONObject();</span><br><span class="line">    this.session = session;</span><br><span class="line">    while (true) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            json.fluentPut(&quot;online_devices_mum&quot;, envService.findOnlineDevicesNum())</span><br><span class="line">                    .fluentPut(&quot;devices_num&quot;, envService.findAllDevices())</span><br><span class="line">                    .fluentPut(&quot;records_num&quot;, envService.getAllRecords())</span><br><span class="line">                    .fluentPut(&quot;run_days&quot;, envService.getRunDays())</span><br><span class="line">                    .fluentPut(&quot;report_num&quot;, envService.getEarthquakNum())</span><br><span class="line">                    .fluentPut(&quot;service_num&quot;, 0)</span><br><span class="line">                    .fluentPut(&quot;quakefeeling_num&quot;, envService.getEarthquakNum())</span><br><span class="line">                    .fluentPut(&quot;delay&quot;, 11);</span><br><span class="line">            sendMessage(json.toJSONString());</span><br><span class="line">            Thread.sleep(1000);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法解析：</p>
<ul>
<li>返回前台数据内容</li>
<li><ul>
<li>online_devices_mum：在线设备数</li>
</ul>
</li>
<li><ul>
<li>devices_num：设备总数量</li>
</ul>
</li>
<li><ul>
<li>records_num：记录总数</li>
</ul>
</li>
<li><ul>
<li>run_days：平台运行天数</li>
</ul>
</li>
<li><ul>
<li>service_num：服务调用次数</li>
</ul>
</li>
<li><ul>
<li>quakefeeling_num：震感推送数量</li>
</ul>
</li>
<li><ul>
<li>delay：数据延时率（需要根据实际采集动作分析获得）</li>
</ul>
</li>
</ul>
<p>至此我们已经完成了数据前端展示所需要的RESTful服务接口及websocket服务接口的开发工作</p>
<h2 id="实验任务三：完整前端项目部署及服务端api关联"><a href="#实验任务三：完整前端项目部署及服务端api关联" class="headerlink" title="实验任务三：完整前端项目部署及服务端api关联"></a>实验任务三：完整前端项目部署及服务端api关联</h2><h3 id="步骤一：测试服务请求是否正常"><a href="#步骤一：测试服务请求是否正常" class="headerlink" title="步骤一：测试服务请求是否正常"></a>步骤一：测试服务请求是否正常</h3><p>通过正常启动或者debug模式启动项目服务<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286875361.png" alt="img"><br>当日志输出启动成功后调用swaggger-ui提供的api接口页面<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286887059.png" alt="img"><br>服务地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8083/swagger-ui.html">http://127.0.0.1:8083/swagger-ui.html</a> 端口号8083为config中配置的服务端口号<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286898980.png" alt="img"></p>
<ul>
<li>测试查询设备列表&#x2F;viewApi&#x2F;devices<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286910863.png" alt="img"></li>
<li>测试查询单个设备&#x2F;viewApi&#x2F;device 通过deviceId查询单个设备信息<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286923222.png" alt="img"></li>
<li>测试查询设备信息完整率&#x2F;viewApi&#x2F;getDeviceCompleteness<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286941743.png" alt="img"></li>
<li>测试查询首页信息&#x2F;viewApi&#x2F;index<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286957398.png" alt="img"></li>
</ul>
<h3 id="步骤二：生成服务jar并部署集群中"><a href="#步骤二：生成服务jar并部署集群中" class="headerlink" title="步骤二：生成服务jar并部署集群中"></a>步骤二：生成服务jar并部署集群中</h3><p>使用idea自带的maven插件进行打包动作，执行clean命令清理项目环境，再执行package进行打包动作<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286971790.png" alt="img"><br>查看console命令行可以看到打包结果标识，并获得打包的目标目录，如下图生成的服务jar包呗放到了红圈的目录中<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286983120.png" alt="img"><br>把jar包文件上传到master节点，&#x2F;opt&#x2F;envView 目录下<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286995316.png" alt="img"></p>
<p>修改配置文件&#x2F;opt&#x2F;envView&#x2F;conf&#x2F;config.properties所配置的数据库地址，修改数据库地址指向本地数据库，修改对外开放端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/envView/conf/config.properties</span><br><span class="line">#Server port</span><br><span class="line">serverport=8083</span><br><span class="line">#MySQL</span><br><span class="line">mysqlhost=master_ip地址</span><br><span class="line">mysqlport=3306</span><br><span class="line">mysqluser=root</span><br><span class="line">mysqlpwd=配置的数据库密码</span><br><span class="line">dbname=environment</span><br></pre></td></tr></table></figure>

<p>:wq保存config.properties配置文件<br>修改对应配置文件中的mysqlhost数据库ip地址，同时也配置mysqlpwd数据库密码，密码为前置实验中自己配置的数据库密码。</p>
<p>进入&#x2F;opt&#x2F;envView执行java -jar 直接启动对应的前端服务包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/envView</span><br><span class="line">nohup  java -jar env-view-1.0-SNAPSHOT.jar &amp;</span><br></pre></td></tr></table></figure>

<p>此时后端服务已经启动成功</p>
<h3 id="步骤三：配置服务前端包并调用envView项目进行数据展示"><a href="#步骤三：配置服务前端包并调用envView项目进行数据展示" class="headerlink" title="步骤三：配置服务前端包并调用envView项目进行数据展示"></a>步骤三：配置服务前端包并调用envView项目进行数据展示</h3><p>在&#x2F;home&#x2F;env目录下已经准备好了前端项目，我们把它移动到&#x2F;var&#x2F;www目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /home/env/envView/html/ /var/www/</span><br></pre></td></tr></table></figure>

<p>需要修改一些访问路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /var/www/html/index.html</span><br></pre></td></tr></table></figure>

<p>这个时候前端也部署完成<br>我们输入主节点的ip地址到浏览器<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693287018382.png" alt="img"></p>
<h2 id="76-项目实训-环境监控平台-SpringBoot搭建技术点解析"><a href="#76-项目实训-环境监控平台-SpringBoot搭建技术点解析" class="headerlink" title="76.项目实训-环境监控平台-SpringBoot搭建技术点解析"></a>76.项目实训-环境监控平台-SpringBoot搭建技术点解析</h2><blockquote>
<h3 id="目的-17"><a href="#目的-17" class="headerlink" title="目的"></a>目的</h3><h3 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a>实验目的</h3><p>熟悉正常可视化平台的项目结构</p>
<p>在前后端分离情况下，数据及API接口的验证方式</p>
<p>了解API接口所应遵循的统一规范</p>
<p>了解前后端交互数据的方式以及所遵循的规则</p>
<p>熟悉websocket搭建过程</p>
<h3 id="要求-17"><a href="#要求-17" class="headerlink" title="要求"></a>要求</h3><h3 id="实验知识点"><a href="#实验知识点" class="headerlink" title="实验知识点"></a>实验知识点</h3><p>SpringBoot相关应用配置</p>
<p>MVC模式</p>
<p>Redis配置相关内容</p>
<p>WebSocket所解决的问题和搭建方法</p>
<h3 id="原理-17"><a href="#原理-17" class="headerlink" title="原理"></a>原理</h3><h3 id="我们来重新回顾下我们的项目结构"><a href="#我们来重新回顾下我们的项目结构" class="headerlink" title="我们来重新回顾下我们的项目结构"></a>我们来重新回顾下我们的项目结构</h3><p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693285951752.png" alt="img"></p>
<p><img src="http://10.131.2.101/static/upload/exp/1610084295214_admin_image.png" alt="img"></p>
<p>那么我们划分项目结构的依据应该遵循什么样的原则了<br>可以清楚的是这样的目录结构并不是单纯的按照业务模块的罗列去做的，也不可能是搭建者一拍脑袋就可以决定的，这里就要引出我们的【MVC模式和三层架构】。</p>
<h3 id="MVC模式"><a href="#MVC模式" class="headerlink" title="MVC模式"></a>MVC模式</h3><p>MVC即  Model-View-Controller，它是一种GUI界面设计的主流模式，主流思想，共分为三层：模型层、视图层、控制层。MVC强制性的使应用程序的输入、处理和输出分开。使用MVC应用程序被分成三个核心部件：模型、视图、控制器。它们各自处理自己的任务。</p>
<p>  M：模型层，用来实现数据表结构与应用程序实体对象对应、实现业务逻辑处理以及数据库的访问等等。</p>
<p>  V：视图层，实现与用户交互的界面，实现数据的输入输出功能。</p>
<p>  C：控制层，联系、控制模型层和视图层去完成用户的需求，控制器本身不输出任何东西和做任何处理。它只是接收请求并决定调用哪个模型构件去处理请求，然后再确定用哪个视图来显示返回的数据。</p>
<p>   MVC的工作方式，以实现用户登录为例，首先View层接受用户输入的账号和密码等数据，然后传递给Congtroller层，Controller层调用Model层的业务逻辑处理方法并返回一个结果给Controller层，最后Controller层判断是否登录成功弹出信息或调出登录的界面。</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693285965931.png" alt="img"></p>
<h3 id="三层架构"><a href="#三层架构" class="headerlink" title="三层架构"></a>三层架构</h3><p>通常意义上的三层架构就是将整个业务应用划分为：表现层（UI）、业务逻辑层（BLL）、数据访问层（DAL）。区分层次的目的即为了“高内聚，低耦合”的思想。</p>
<p>  1.表现层（UI）：实现应用程序的界面，从而实现用户进行交互的功能</p>
<p>  2.业务逻辑层（BLL）：针对具体的业务需求而进行业务逻辑处理，直接对数据访问层进行操作</p>
<p>  3.数据访问层（DAL）：该层直接对数据库进行操作，对数据进型增删改等等</p>
<h3 id="为什么要使用-MVC"><a href="#为什么要使用-MVC" class="headerlink" title="为什么要使用 MVC"></a>为什么要使用 MVC</h3><p>首先，最重要的一点是多个视图能共享一个模型，现在需要用越来越多的方式来访问你的应用程序。对此，其中一个解决之道是使用MVC，无论你的用户想要Flash界面或是 WAP 界面，用一个模型就能处理它们。</p>
<p>第二，你已经将数据和业务规则从表示层分开，所以你可以最大化的重用你的代码。</p>
<p>第三，模型返回的数据没有进行格式化，所以同样的构件能被不同界面使用。例如，很多数据可能用HTML来表示，但是它们也有可能要用Adobe  Flash和WAP来表示。模型也有状态管理和数据持久性处理的功能，例如，基于会话的购物车和电子商务过程也能被Flash网站或者无线联网的应用程序所重用。 </p>
<p>第四，模型是自包含的，并且与控制器和视图相分离，所以很容易改变你的应用程序的数据层和业务规则。如果你想把你的数据库从MySQL移植到Oracle，或者改变你的基于RDBMS数据源到LDAP，只需改变你的模型即可。一旦你正确的实现了模型，不管你的数据来自数据库或是LDAP服务器，视图将会正确的显示它们。</p>
<p>第五，由于运用MVC的应用程序的三个部件是相互独立，改变其中一个不会影响其它两个，所以依据这种设计思想你能构造良好的松耦合的构件。  对我来说，控制器也提供了一个好处，就是可以使用控制器来联接不同的模型和视图去完成用户的需求，这样控制器可以为构造应用程序提供强有力的手段。给定一些可重用的模型和视图，控制器可以根据用户的需求选择模型进行处理，然后选择视图将处理结果显示给用户。</p>
<h3 id="WebSocket-1"><a href="#WebSocket-1" class="headerlink" title="WebSocket"></a>WebSocket</h3><p>传统 Web 模式在处理高并发及实时性需求的时候，会遇到难以逾越的瓶颈，我们需要一种高效节能的双向通信机制来保证数据的实时传输。在此背景下，基于 HTML5 规范的、有 Web TCP 之称的 WebSocket 应运而生。</p>
<p>早期 HTML5 并没有形成业界统一的规范，各个浏览器和应用服务器厂商有着各异的类似实现，如 IBM 的 MQTT，Comet  开源框架等，直到 2014 年，HTML5 在 IBM、微软、Google  等巨头的推动和协作下终于尘埃落地，正式从草案落实为实际标准规范，各个应用服务器及浏览器厂商逐步开始统一，在 JavaEE7 中也实现了  WebSocket 协议，从而无论是客户端还是服务端的 WebSocket 都已完备，读者可以查阅HTML5 规范，熟悉新的 HTML  协议规范及 WebSocket 支持。</p>
<h3 id="WebSocket-机制"><a href="#WebSocket-机制" class="headerlink" title="WebSocket 机制"></a>WebSocket 机制</h3><p>以下简要介绍一下 WebSocket 的原理及运行机制。</p>
<p>WebSocket 是 HTML5 一种新的协议。它实现了浏览器与服务器全双工通信，能更好的节省服务器资源和带宽并达到实时通讯，它建立在 TCP 之上，同 HTTP 一样通过 TCP 来传输数据，但是它和 HTTP 最大不同是：</p>
<p>WebSocket 是一种双向通信协议，在建立连接后，WebSocket 服务器和 Browser&#x2F;Client Agent 都能主动的向对方发送或接收数据，就像 Socket 一样；<br>WebSocket 需要类似 TCP 的客户端和服务器端通过握手连接，连接成功后才能相互通信。<br>传统模式交互与使用 WebSocket 模式的交互如下图：：</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693285986935.png" alt="img"></p>
<p>它的最大特点就是，服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于服务器推送技术的一种。</p>
<p>其他特点包括：</p>
<p>建立在 TCP 协议之上，服务器端的实现比较容易。</p>
<p>与 HTTP 协议有着良好的兼容性，默认端口也是80和443。</p>
<p>数据格式比较轻量，性能开销小，通信高效。</p>
<p>可以发送文本，也可以发送二进制数据。</p>
<p>没有同源限制，客户端可以与任意服务器通信。</p>
<p>协议标识符是ws（如果加密，则为wss），服务器网址就是 URL。</p>
</blockquote>
<p>下面我们首先开始第一步工作，先搭建一个空的springBoot项目结构   </p>
<p>1.打开Command Palatte（ctrl+shift+p）<br>输入Spring  Initializer后会弹出两个项可以选择：Spring Initializer: Generate a Maven  Project和Spring Initializer: Generate a Gradle Project。我们选择基于Maven构建项目。</p>
<p>2.选择Spring Boot的版本，这里我选择了2.3.7（后续会更换）。</p>
<p>3.下一步是选择开发语言：Java、Kotlin和Groovy，这里选择Java。</p>
<p>4.输入项目的Group Id。<br>Group Id: com.cstor.platform.envmonitor</p>
<p>5.输入项目的Artifact Id，Group Id对应你的产品归属、Artifact Id对应模块。<br>Artifact Id: envmonitor</p>
<p>6.选择打包方式：jar，war 选择jar包</p>
<p>7.选择jdk版本：这里系统镜像中只有1.8的jdk所以我们选择1.8。</p>
<p>8.选择依赖项，根据我自己的需求选择了两个：Lomok、Spring Web。由于后期依赖仍然可以通过maven的配置文件pom.xml手工按照需要添加，所以这里先选两个跳过选择。</p>
<p>9.选择对应的项目存放目录<br>这时一个空的springboot的maven项目就已经搭建出来了 </p>
<h4 id="接下来我们需要导入项目的所有依赖"><a href="#接下来我们需要导入项目的所有依赖" class="headerlink" title="接下来我们需要导入项目的所有依赖"></a>接下来我们需要导入项目的所有依赖</h4><p>修改对应的pom.xml文件，加入所有的基础jar包依赖（这里已经帮大家整理好所有的基础依赖jar包）</p>
<h4 id="然后我们按照截图的内容，来先搭建一个空架子出来"><a href="#然后我们按照截图的内容，来先搭建一个空架子出来" class="headerlink" title="然后我们按照截图的内容，来先搭建一个空架子出来"></a>然后我们按照截图的内容，来先搭建一个空架子出来</h4><p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286007323.png" alt="img"></p>
<p>需要注意的是虽然这样的项目目录结构是为环境监控平台所创建，但是其结构本身是适用于大部分项目的，只需要按照所用技术的情况，及时新增或者删除对应的目录就可以了。</p>
<h4 id="代码结构-2"><a href="#代码结构-2" class="headerlink" title="代码结构"></a>代码结构</h4><p>api：http服务对外api接口服务</p>
<p>bean：对外业务实体封装类</p>
<p>component：组件服务，单独的业务组件，配合主体业务的插件或者组件功能</p>
<p>config：springboot配置中心，配置所有springboot的配置类</p>
<p>mapper：数据层，写对应的sql语句或者是映射好的方法名</p>
<p>model：数据表到实体的映射</p>
<p>service：业务服务层</p>
<p>tcp：netty框架+tcp服务类</p>
<p>util：工具包</p>
<p>websocket：websocket通信服务对外接口</p>
<p>EnvmonitorApplication：Springboot应用启动入口</p>
<h4 id="资源目录"><a href="#资源目录" class="headerlink" title="资源目录"></a>资源目录</h4><p>application.properties:配置文件，存放所有配置内容</p>
<p>log4j.properties:log4j日志文件</p>
<h4 id="紧接着来进行数据库连接池的配置"><a href="#紧接着来进行数据库连接池的配置" class="headerlink" title="紧接着来进行数据库连接池的配置"></a>紧接着来进行数据库连接池的配置</h4><p>[Tips]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">每次操作数据库，需要先获取连接（socket通道），频繁的操作会不断地获取连接，获取连接的时间可能还大于sql执行时间，重复的这样操作，效率很低；</span><br><span class="line"></span><br><span class="line">连接池说白了，就是提前创建好多个连接，当执行数据库操作就拿一个连接直接用，用完再放回去，不需要创建连接的时间；</span><br></pre></td></tr></table></figure>

<p>我们采用的是druid连接池，配置起来也是很方便的。<br>首先是引入对应的jar包依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.1.8&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>在配置文件中配置所有的数据库相关连接参数</p>
<p><img src="http://10.131.2.101/static/upload/exp/1610009966843_admin_image.png" alt="img"></p>
<p>然后是数据库连接池相关的指标参数<br><img src="http://10.131.2.101/static/upload/exp/1610010077169_admin_image.png" alt="img"></p>
<p>在config目录新增druid的配置类DruidConfiguration.class<br>配置内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 配置druid数据源</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">@PropertySource(&quot;classpath:application.properties&quot;)</span><br><span class="line">@Configuration</span><br><span class="line">public class DruidConfiguration &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 增加日志记录</span><br><span class="line">     */</span><br><span class="line">    private Logger logger = LoggerFactory.getLogger(DruidConfiguration.class);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 展示Druid的统计信息</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public ServletRegistrationBean druidStatViewServlet() &#123;</span><br><span class="line">        ServletRegistrationBean registrationBean = new ServletRegistrationBean(new StatViewServlet(), &quot;/druid/*&quot;);</span><br><span class="line">        registrationBean.addInitParameter(&quot;allow&quot;, &quot;*&quot;);</span><br><span class="line">        registrationBean.addInitParameter(&quot;loginUsername&quot;, &quot;admin&quot;);</span><br><span class="line">        registrationBean.addInitParameter(&quot;loginPassword&quot;, &quot;cstorfs&quot;);</span><br><span class="line">        registrationBean.addInitParameter(&quot;resetEnable&quot;, &quot;false&quot;);</span><br><span class="line"></span><br><span class="line">        return registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *添加Web应用等监控关联的数据</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public FilterRegistrationBean druidWebStatViewFilter() &#123;</span><br><span class="line">        FilterRegistrationBean registrationBean = new FilterRegistrationBean(new WebStatFilter());</span><br><span class="line">        registrationBean.addInitParameter(&quot;urlPatterns&quot;, &quot;/*&quot;);</span><br><span class="line">        registrationBean.addInitParameter(&quot;exclusions&quot;, &quot;*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*&quot;);</span><br><span class="line"></span><br><span class="line">        return registrationBean;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 自定义数据源相关配置</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public DataSource druidDataSource(@Value(&quot;$&#123;spring.datasource.url&#125;&quot;) String url,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.driver-class-name&#125;&quot;) String driver,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.username&#125;&quot;) String userName,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.password&#125;&quot;) String password,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.maxActive&#125;&quot;) int maxActive,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.filters&#125;&quot;) String filters,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.initialSize&#125;&quot;)</span><br><span class="line">                                              int initialSize,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.minIdle&#125;&quot;)</span><br><span class="line">                                              int minIdle,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.maxWait&#125;&quot;)</span><br><span class="line">                                              int maxWait,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.timeBetweenEvictionRunsMillis&#125;&quot;)</span><br><span class="line">                                              int timeBetweenEvictionRunsMillis,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.minEvictableIdleTimeMillis&#125;&quot;)</span><br><span class="line">                                              int minEvictableIdleTimeMillis,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.validationQuery&#125;&quot;)</span><br><span class="line">                                              String validationQuery,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.testWhileIdle&#125;&quot;)</span><br><span class="line">                                              boolean testWhileIdle,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.testOnBorrow&#125;&quot;)</span><br><span class="line">                                              boolean testOnBorrow,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.testOnReturn&#125;&quot;)</span><br><span class="line">                                              boolean testOnReturn,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.poolPreparedStatements&#125;&quot;)</span><br><span class="line">                                              boolean poolPreparedStatements,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.maxPoolPreparedStatementPerConnectionSize&#125;&quot;)</span><br><span class="line">                                              int maxPoolPreparedStatementPerConnectionSize,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.connectionProperties&#125;&quot;)</span><br><span class="line">                                              String connectionProperties,</span><br><span class="line">                                      @Value(&quot;$&#123;spring.datasource.useGlobalDataSourceStat&#125;&quot;)</span><br><span class="line">                                              boolean useGlobalDataSourceStat</span><br><span class="line"></span><br><span class="line">    ) &#123;</span><br><span class="line">        DruidDataSource dataSource = new DruidDataSource();</span><br><span class="line">        /*数据源主要配置*/</span><br><span class="line">        dataSource.setUrl(url);</span><br><span class="line">        dataSource.setDriverClassName(driver);</span><br><span class="line">        dataSource.setUsername(userName);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line"></span><br><span class="line">        /*数据源补充配置*/</span><br><span class="line">        dataSource.setMaxActive(maxActive);</span><br><span class="line">        dataSource.setInitialSize(initialSize);</span><br><span class="line">        dataSource.setMinIdle(minIdle);</span><br><span class="line">        dataSource.setMaxWait(maxWait);</span><br><span class="line">        dataSource.setTimeBetweenEvictionRunsMillis(timeBetweenEvictionRunsMillis);</span><br><span class="line">        dataSource.setMinEvictableIdleTimeMillis(minEvictableIdleTimeMillis);</span><br><span class="line">        dataSource.setValidationQuery(validationQuery);</span><br><span class="line">        dataSource.setTestOnBorrow(testOnBorrow);</span><br><span class="line">        dataSource.setTestOnReturn(testOnReturn);</span><br><span class="line">        dataSource.setTestWhileIdle(testWhileIdle);</span><br><span class="line">        dataSource.setPoolPreparedStatements(poolPreparedStatements);</span><br><span class="line">        dataSource.setMaxPoolPreparedStatementPerConnectionSize(maxPoolPreparedStatementPerConnectionSize);</span><br><span class="line">        dataSource.setConnectionProperties(connectionProperties);</span><br><span class="line">        dataSource.setUseGlobalDataSourceStat(useGlobalDataSourceStat);</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            dataSource.setFilters(filters);</span><br><span class="line">            logger.info(&quot;Druid数据源初始化设置成功......&quot;);</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            logger.info(&quot;Druid数据源filters设置失败......&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return dataSource;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数据库表结构设计"><a href="#数据库表结构设计" class="headerlink" title="数据库表结构设计"></a>数据库表结构设计</h3><p>按照最简单的数据格式我们生成了以下两张表结构，构成我们设备传输记录保存的数据库表<br>a）设备模块</p>
<table>
<thead>
<tr>
<th>表名</th>
<th>devices</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>主键id</td>
</tr>
<tr>
<td>dev_name</td>
<td>设备名称</td>
</tr>
<tr>
<td>dev_id</td>
<td>设备编号</td>
</tr>
<tr>
<td>contacter</td>
<td>设备联系人</td>
</tr>
<tr>
<td>phone</td>
<td>联系电话</td>
</tr>
<tr>
<td>region</td>
<td>安装区域</td>
</tr>
<tr>
<td>dev_num</td>
<td>设备流水号</td>
</tr>
<tr>
<td>type</td>
<td>结构类型</td>
</tr>
<tr>
<td>location</td>
<td>所属位置</td>
</tr>
<tr>
<td>unit</td>
<td>单位名称</td>
</tr>
<tr>
<td>address</td>
<td>安装地址</td>
</tr>
<tr>
<td>installs</td>
<td>安装次数</td>
</tr>
<tr>
<td>placement</td>
<td>摆放方式</td>
</tr>
<tr>
<td>fixedmode</td>
<td>固定方式</td>
</tr>
<tr>
<td>samplerete</td>
<td>采样频率</td>
</tr>
<tr>
<td>recordsnum</td>
<td>接收记录数量</td>
</tr>
<tr>
<td>longitude</td>
<td>经度</td>
</tr>
<tr>
<td>latitude</td>
<td>纬度</td>
</tr>
<tr>
<td>report</td>
<td>震感记录数</td>
</tr>
</tbody></table>
<p>b）记录数据模块</p>
<table>
<thead>
<tr>
<th>表名</th>
<th>records</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>主键id</td>
</tr>
<tr>
<td>dev_id</td>
<td>设备id</td>
</tr>
<tr>
<td>PM25</td>
<td>PM2.5指数</td>
</tr>
<tr>
<td>HCHO</td>
<td>甲醛浓度指数</td>
</tr>
<tr>
<td>T</td>
<td>温度</td>
</tr>
<tr>
<td>H</td>
<td>湿度</td>
</tr>
<tr>
<td>Light</td>
<td>光照情况</td>
</tr>
<tr>
<td>Gx</td>
<td>地震波动X轴</td>
</tr>
<tr>
<td>Gy</td>
<td>地震波动Y轴</td>
</tr>
<tr>
<td>Gz</td>
<td>地政波动Z轴</td>
</tr>
<tr>
<td>G</td>
<td></td>
</tr>
<tr>
<td>Version</td>
<td>版本号</td>
</tr>
<tr>
<td>time</td>
<td>记录日期</td>
</tr>
<tr>
<td>quakefeeling</td>
<td>震感</td>
</tr>
</tbody></table>
<h3 id="Mapper及对应Model实体"><a href="#Mapper及对应Model实体" class="headerlink" title="Mapper及对应Model实体"></a>Mapper及对应Model实体</h3><p>由于我们ORM使用的mybatis框架这里我们先引入一个方便的工具包（tk.mybatis集成）去简化我们mybatis的一些重复写法<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286049966.png" alt="img"><br>当然光引入jar包还不够，还需要定义我们的公用myMapper接口</p>
<p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286060988.png" alt="img"></p>
<h4 id="实体bean定义"><a href="#实体bean定义" class="headerlink" title="实体bean定义"></a>实体bean定义</h4><p>在引出我们的mapper并开始写sql之前，我们先要定义两个表结构锁对应的model映射实体<br>我们先定义一下设备的实体Device<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286072294.png" alt="img"><br>然后同法创建记录的实体Record<br>（上述两个实体都放在model目录中）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">需要注意的我这里两个实体都通过Lombok去简化了实体的get/set方法，有兴趣的同学可以自行去百度了解下lombok的用法，当然如果习惯于原有方式的也可以通过快捷键自动生成实体对应的get/set方法</span><br></pre></td></tr></table></figure>

<h4 id="mapper写法"><a href="#mapper写法" class="headerlink" title="mapper写法"></a>mapper写法</h4><p>首先是设备的mapper，按照目前的需求我们需要四个方法<br>分别是更新设备记录数量&#x2F;更新震感报告数量&#x2F;查询所有设备详细内容&#x2F;查询单个设备详细内容<br>需要注意的是我们这里的mapper统一全部集成了上步骤定义的公共接口类 MyMapper，这样可以让mapper具备一些通用的sql方法，而不需要自己在单独写出<br>代码内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 设备查询mapper</span><br><span class="line"> */</span><br><span class="line">@Repository</span><br><span class="line">public interface DeviceMapper extends MyMapper&lt;Device&gt; &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 更新设备记录数量+1</span><br><span class="line">     */</span><br><span class="line">    @Update(&quot;UPDATE environment.devices SET recordsnum = recordsnum + 1 WHERE dev_id = #&#123;dev_id&#125;&quot;)</span><br><span class="line">    void update_record_num(String dev_id);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 更新震感，报告数量+1，震感数量+1</span><br><span class="line">     * @param dev_id</span><br><span class="line">     */</span><br><span class="line">    @Update(&quot;UPDATE environment.devices SET recordsnum = recordsnum + 1, report = report + 1 WHERE dev_id = #&#123;dev_id&#125;&quot;)</span><br><span class="line">    void update_record_num_feeling(String dev_id);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *查询所有设备信息</span><br><span class="line">     */</span><br><span class="line">    @Select(&quot;select * from environment.devices&quot;)</span><br><span class="line">    List&lt;Device&gt; findAllDevices();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *更新位置信息</span><br><span class="line">     */</span><br><span class="line">    @Update(&quot;update environment.devices set location = #&#123;location&#125; where dev_id = #&#123;dev_id&#125;&quot;)</span><br><span class="line">    void update_location(Device device);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *查询设备详细信息</span><br><span class="line">     */</span><br><span class="line">    @Select(&quot;select * from environment.devices where dev_id = #&#123;dev_id&#125;&quot;)</span><br><span class="line">    Device findDeviceDetail(JSONObject jsonObject);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后同法写出记录的mapper</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 记录mapper</span><br><span class="line"> */</span><br><span class="line">@Repository</span><br><span class="line">public interface RecordMapper extends MyMapper&lt;Record&gt; &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 插入记录数据实体</span><br><span class="line">     */</span><br><span class="line">    @Insert(&quot;insert into environment.records (dev_id,PM25,HCHO,T,H,Light,Gx,Gy,Gz,G,Version,time,quakefeeling) values (#&#123;dev_id&#125;,#&#123;PM25&#125;,#&#123;HCHO&#125;,#&#123;T&#125;,#&#123;H&#125;,#&#123;Light&#125;,#&#123;Gx&#125;,#&#123;Gy&#125;,#&#123;Gz&#125;,#&#123;G&#125;,#&#123;Version&#125;,#&#123;time&#125;,#&#123;quakefeeling&#125;)&quot;)</span><br><span class="line">    void data_insert(JSONObject json);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询在线设备数量</span><br><span class="line">     */</span><br><span class="line">    @Select(&quot;SELECT COUNT(*) FROM (SELECT dev_id FROM environment.records  WHERE TIME &gt;= DATE_SUB(NOW(),INTERVAL 2 SECOND) GROUP BY dev_id) AS result;&quot;)</span><br><span class="line">    Integer findAllOnlineDevices();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这一步做完，我们目前的mapper和数据库层映射便已经完成了</p>
<h3 id="业务层Service"><a href="#业务层Service" class="headerlink" title="业务层Service"></a>业务层Service</h3><p>业务层一般是作为业务处理逻辑存放的位置，这里一般是对复杂的业务逻辑进行处理并返回上层处理之后所得到的正确数据。<br>但是由于我们这里仅仅是用作两个页面的数据展示，所以并没有过多复杂的业务逻辑，仅仅把查询获得的数据返回前台就可以了。<br>定义两个同名接口方法对外提供实际的调用服务，减少代码的耦合性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">public interface EnvironmentService &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询所有的设备信息</span><br><span class="line">     */</span><br><span class="line">    List&lt;Device&gt; findAllDevices();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询所有在线设备数量</span><br><span class="line">     */</span><br><span class="line">    Integer findAllOnlineDevices();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询单个设备相亲</span><br><span class="line">     */</span><br><span class="line">    Device findDeviceDetail(JSONObject jsonObject);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">@Service</span><br><span class="line">public class EnvironmentServiceImpl implements EnvironmentService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    DeviceMapper deviceMapper;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    RecordMapper recordMapper;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;Device&gt; findAllDevices() &#123;</span><br><span class="line">        return deviceMapper.findAllDevices();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Integer findAllOnlineDevices() &#123;</span><br><span class="line">        /**</span><br><span class="line">         * 查询所有在线设备数量</span><br><span class="line">         */</span><br><span class="line">        return recordMapper.findAllOnlineDevices();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Device findDeviceDetail(JSONObject jsonObject) &#123;</span><br><span class="line">        /**</span><br><span class="line">         * 查询单个在线设备详情</span><br><span class="line">         */</span><br><span class="line">        return deviceMapper.findDeviceDetail(jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="对外API接口服务"><a href="#对外API接口服务" class="headerlink" title="对外API接口服务"></a>对外API接口服务</h3><p>api是对外提供http外部接口服务的入口<br>我们这里的业务查询相对比较简单只有一个EnvironmentApi，主要用作环境平台首页的初始化方法，以及设备查询的相关服务。按照正常项目规划，api包应该存放所有api的服务接口的入口类，并且这些类需要按照业务类型逐一进行分类区分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 环境平台监控api查询服务</span><br><span class="line"> */</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(value = &quot;/environment&quot;)</span><br><span class="line">public class EnvironmentApi &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger logger = Logger.getLogger(EnvironmentApi.class);</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    EnvironmentService environmentService;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 环境云平台实训项目首页数据获取</span><br><span class="line">     */</span><br><span class="line">    @ApiOperation(value = &quot;查询环境平台首页&quot;, notes = &quot;&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/index&quot;, method = RequestMethod.POST)</span><br><span class="line">    @CrossOrigin</span><br><span class="line">    public JSONObject environmentIndex() &#123;</span><br><span class="line">        List&lt;Device&gt; list = environmentService.findAllDevices();</span><br><span class="line">        int num = 0;</span><br><span class="line">        for (Device device : list) &#123;</span><br><span class="line">            num += device.getRecordsnum();</span><br><span class="line">        &#125;</span><br><span class="line">        return RspBuilder.createSuccessRsp().append(&quot;deviceNum&quot;, list.size())</span><br><span class="line">                .append(&quot;onlineDeviceNum&quot;, environmentService.findAllOnlineDevices())</span><br><span class="line">                .append(&quot;recordsnum&quot;, num)</span><br><span class="line">                .append(&quot;serviceTimes&quot;, 0)</span><br><span class="line">                .append(&quot;deviceList&quot;, list).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询所有设备列表信息</span><br><span class="line">     */</span><br><span class="line">    @ApiOperation(value = &quot;查询设备列表&quot;, notes = &quot;&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/devices&quot;, method = RequestMethod.POST)</span><br><span class="line">    @CrossOrigin</span><br><span class="line">    public List&lt;Device&gt; environmentDevices() &#123;</span><br><span class="line">        return environmentService.findAllDevices();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *  查询单台设备信息</span><br><span class="line">     */</span><br><span class="line">    @ApiOperation(value = &quot;查询具体设备&quot;, notes = &quot;&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/device&quot;, method = RequestMethod.POST)</span><br><span class="line">    @CrossOrigin</span><br><span class="line">    public Device environmentDeviceDetail(@RequestBody JSONObject jsonObject) &#123;</span><br><span class="line">        return environmentService.findDeviceDetail(jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解析<br>看代码可以这里只是对业务服务层到前端前的中转，也是从前端到后台指定服务的路由。<br>另外其实对前台传入数据的校验以及校验后的异常返回也应该再这里进行。<br>需要注意的是，api服务方法不应该编写相关的业务逻辑，不能模糊service服务层和api接口层的定义。</p>
<h3 id="上述所用到的相关工具类"><a href="#上述所用到的相关工具类" class="headerlink" title="上述所用到的相关工具类"></a>上述所用到的相关工具类</h3><p>计算PGA&#x2F;PGV数据 Calculate<br>参数返回值工具类 RspBuilder<br>spring容器工具类 SpringUtil </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 计算包括：RMS（均方根）、STA/LTA检波、峰值加速度（PGA）、峰值速度（PGV）、烈度、 PGA数值的单位为:（</span><br><span class="line"> * m/s/s），PGV数值单位为：（m/s）</span><br><span class="line"> * </span><br><span class="line"> */</span><br><span class="line">public class Calculate &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 计算设备所在区域，以0.1经度、0.1纬度划分区域</span><br><span class="line">     * </span><br><span class="line">     * lon为设备经度，范围为（73~136）</span><br><span class="line">     * lat为设备纬度，范围为（4~54）</span><br><span class="line">     * @return 设备所在区域</span><br><span class="line">     */</span><br><span class="line">    public static int Error_Trigger(double lon, double lat) &#123;</span><br><span class="line">        double[][] arr = new double[316131][2];</span><br><span class="line">        int t = 0;</span><br><span class="line">        int area = 0;</span><br><span class="line">        for (double i = 73; i &lt;= 136; i = i + 0.1) &#123;</span><br><span class="line">            for (double j = 4; j &lt;= 54; j = j + 0.1) &#123;</span><br><span class="line">                arr[t][0] = i;</span><br><span class="line">                arr[t][1] = j;</span><br><span class="line">                t++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        for (int z = 1; z &lt; arr.length; z++) &#123;</span><br><span class="line">            if (arr[z][0] - 0.1 &lt;= lon &amp;&amp; lon &lt; arr[z][0] &amp;&amp; arr[z][1] - 0.1 &lt;= lat &amp;&amp; lat &lt; arr[z][1]) &#123;</span><br><span class="line">                area = z;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return area;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 计算均方根误差</span><br><span class="line">     * </span><br><span class="line">     * x为加速度值，单位m/s/s</span><br><span class="line">     * @return 均方根误差计算值</span><br><span class="line">     */</span><br><span class="line">    public static double RMS(Double[] x) &#123;</span><br><span class="line">        double RM = 0;</span><br><span class="line">        for (int i = 0; i &lt; x.length; i++) &#123;</span><br><span class="line">            RM = RM + (x[i] / 100) * (x[i] / 100);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        RM = RM / x.length;</span><br><span class="line">        </span><br><span class="line">        double RMS = Math.sqrt(RM);</span><br><span class="line">        return RMS;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 计算峰值加速度、峰值速度</span><br><span class="line">     * </span><br><span class="line">     * x为地震三分量水平方向N-S或W-E方向加速度值（单位m/s/s）</span><br><span class="line">     * y为地震三分量水平方向N-S或W-E方向加速度值（单位m/s/s）</span><br><span class="line">     * @return objArr[0]为峰值加速度，objArr[1]为峰值速度</span><br><span class="line">     */</span><br><span class="line">    public static Object[] PGA_PGV_calculate(Double[] x, Double[] y) &#123;</span><br><span class="line">        double PGA = 0;</span><br><span class="line">        int Num = 0;</span><br><span class="line">        for (int i = 0; i &lt; x.length; i++) &#123;</span><br><span class="line">            double xy = Math.sqrt(x[i] * x[i] + y[i] * y[i]) / 100.0;</span><br><span class="line">            if (xy &gt; PGA) &#123;</span><br><span class="line">                PGA = xy;</span><br><span class="line">                Num = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        double PGV = PGA * (x.length-Num + 1) / (double) (x.length);</span><br><span class="line">        Object[] objArr = new Object[2];</span><br><span class="line">        objArr[0] = new Double(PGA); // 峰值加速度</span><br><span class="line">        objArr[1] = new Double(PGV); // 峰值速度</span><br><span class="line">        return objArr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 计算地震烈度</span><br><span class="line">     * </span><br><span class="line">     * PGA为峰值加速度</span><br><span class="line">     * PGV为峰值速度</span><br><span class="line">     * @return 地震烈度</span><br><span class="line">     */</span><br><span class="line">    public static double I_calculate(double PGA, double PGV) &#123;</span><br><span class="line">        double I_m = 0;</span><br><span class="line">//		System.out.println(&quot;PGA=&quot; + PGA + &quot;PGV=&quot; + PGV);</span><br><span class="line">        double I_PGA = 5.50 * Math.log10(PGA) + 5.59;</span><br><span class="line">        double I_PGV = 4.56 * Math.log10(PGV) + 8.78;</span><br><span class="line">        if (I_PGA &gt;= 6.0 &amp;&amp; I_PGV &gt;= 6.0) &#123;</span><br><span class="line">            I_m = I_PGA;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            I_m = (I_PGA + I_PGV) / 2.0;</span><br><span class="line">        &#125;</span><br><span class="line">        if (I_m &lt; 1.5) &#123;</span><br><span class="line">            return 1.0;</span><br><span class="line"></span><br><span class="line">        &#125; else if (I_m &gt;= 11.5) &#123;</span><br><span class="line">            return 12.0;</span><br><span class="line"></span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            int I = (int) Math.round(I_m);</span><br><span class="line">            return I;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * STA/LTA检波，未超过阈值，返回Object[0]峰值加速度、Object[1]峰值速度、Object[3]为烈度，为null</span><br><span class="line">     * 超过阈值，返回Object[0]峰值加速度、Object[1]峰值速度、Object[3]为烈度值</span><br><span class="line">     * </span><br><span class="line">     * x为地震三分量水平方向N-S或W-E方向加速度值（单位m/s/s）</span><br><span class="line">     * y为地震三分量水平方向N-S或W-E方向加速度值（单位m/s/s）</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static Object[] sta_lta_calculate(Double[] x, Double[] y, double threshold) &#123;</span><br><span class="line">//		System.err.println(&quot;-x=&quot; + x.length + &quot;----y=&quot; + y.length);</span><br><span class="line">        double stalta = 0;</span><br><span class="line">        double stalta1 = 1000;</span><br><span class="line">        double tt = 0;</span><br><span class="line">        double[] cc = new double[x.length];</span><br><span class="line">        double LL = 0;</span><br><span class="line">        for (int i = 0; i &lt; x.length; i++) &#123;</span><br><span class="line">//			System.out.print(&quot;-x=&quot; + x[i] + &quot;-y=&quot; + y[i]);</span><br><span class="line">            LL = LL + Math.sqrt(Math.pow(x[i], 2) + Math.pow(y[i], 2)) / 100.0;</span><br><span class="line">            cc[i] = LL;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">//		System.out.println();</span><br><span class="line">        for (int j = (y.length - 50) - 1; j &lt; y.length; j++) &#123;</span><br><span class="line">            double SL = cc[j];</span><br><span class="line">            double SS = cc[j] - cc[j - 20];</span><br><span class="line">            double lta = SL / (y.length - 50);</span><br><span class="line">            double sta = SS / 20;</span><br><span class="line">            </span><br><span class="line">            if(lta == 0) tt = sta / (lta + 0.000001);</span><br><span class="line">            else tt = sta / lta;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            if (tt &gt;= stalta) &#123;</span><br><span class="line">                stalta = tt;</span><br><span class="line">            &#125;</span><br><span class="line">            if (tt !=0 &amp;&amp; tt &lt; stalta1) &#123;</span><br><span class="line">                stalta1 = tt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Object[] PGA_PGV = PGA_PGV_calculate(x, y);</span><br><span class="line">        double PGA = (double) PGA_PGV[0];</span><br><span class="line">        double PGV = (double) PGA_PGV[1];</span><br><span class="line">        System.err.println(&quot;-stalta=&quot; + stalta + &quot;----stalta1=&quot; + stalta1);</span><br><span class="line">        </span><br><span class="line">        if (stalta &gt; threshold) &#123;</span><br><span class="line">//			System.out.println(&quot;-stalta=&quot; + stalta + &quot;----stalta1=&quot; + stalta1);</span><br><span class="line">            Object[] Im = new Object[3];</span><br><span class="line">            double I = I_calculate(PGA, PGV);</span><br><span class="line">            Im[0] = new Double(PGA); // 峰值加速度</span><br><span class="line">            Im[1] = new Double(PGV); // 峰值速度</span><br><span class="line">            Im[2] = new Double(I); // 峰值速度</span><br><span class="line">            return Im;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Object I = 0;</span><br><span class="line">            Object[] Im = new Object[3];</span><br><span class="line">            Im[0] = new Double(PGA); // 峰值加速度</span><br><span class="line">            Im[1] = new Double(PGV); // 峰值速度</span><br><span class="line">            Im[2] = I; // 烈度为null</span><br><span class="line">            return Im;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 计算单个方向的PGA、PGV</span><br><span class="line">     * </span><br><span class="line">     * 单个方向的峰值加速度</span><br><span class="line">     * @return PGA、PGV</span><br><span class="line">     */</span><br><span class="line">    public static Object[] PGA_PGV_calculate_single(Double[] x) &#123;</span><br><span class="line">        double PGA = 0;</span><br><span class="line">        int Num = 0;</span><br><span class="line">        for (int i = 0; i &lt; x.length; i++) &#123;</span><br><span class="line">            if(x[i] == null) x[i] = 0.00;</span><br><span class="line">            double xy = Math.abs(x[i]) / 100.0;</span><br><span class="line">            if (xy &gt; PGA) &#123;</span><br><span class="line">                PGA = xy;</span><br><span class="line">                Num = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        double PGV = PGA * ((Num + 1) / (double) (x.length));</span><br><span class="line">        Object[] sigle = new Object[2];</span><br><span class="line">        sigle[0] = new Double(PGA); // 峰值加速度</span><br><span class="line">        sigle[1] = new Double(PGV); // 峰值速度</span><br><span class="line">        return sigle;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 响应JSON消息构建体</span><br><span class="line"> * </span><br><span class="line"> * @author samrong</span><br><span class="line"> */</span><br><span class="line">public class RspBuilder &#123;</span><br><span class="line">    private static final String KEY_RESULT = &quot;result&quot;;</span><br><span class="line">    private static final String KEY_CODE = &quot;code&quot;;</span><br><span class="line">    private static final String KEY_MSG = &quot;msg&quot;;</span><br><span class="line">    private static final String RESULT_SUCCESS = &quot;success&quot;;</span><br><span class="line">    private static final String RESULT_FAIL = &quot;fail&quot;;</span><br><span class="line"></span><br><span class="line">    private JSONObject jobj;</span><br><span class="line"></span><br><span class="line">    public RspBuilder() &#123;</span><br><span class="line">        this.jobj = new JSONObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 追加响应键值对</span><br><span class="line">     * </span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public RspBuilder append(String key, Object value) &#123;</span><br><span class="line">        this.jobj.put(key, value);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 追加&#x27;code&#x27;为key的消息</span><br><span class="line">     * </span><br><span class="line">     * @param code</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public RspBuilder appendCode(String code) &#123;</span><br><span class="line">        this.jobj.put(KEY_CODE, code);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 追加&#x27;msg&#x27;为key的消息</span><br><span class="line">     * </span><br><span class="line">     * @param msg</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public RspBuilder appendMsg(String msg) &#123;</span><br><span class="line">        this.jobj.put(KEY_MSG, msg);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置成功响应</span><br><span class="line">     * </span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public RspBuilder setSuccessResult() &#123;</span><br><span class="line">        this.jobj.put(KEY_RESULT, RESULT_SUCCESS);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置失败响应</span><br><span class="line">     * </span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public RspBuilder setErrorResult() &#123;</span><br><span class="line">        this.jobj.put(KEY_RESULT, RESULT_FAIL);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回响应消息体</span><br><span class="line">     * </span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public JSONObject build() &#123;</span><br><span class="line">        return jobj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 构造成功响应Builder</span><br><span class="line">     * </span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static RspBuilder createSuccessRsp() &#123;</span><br><span class="line">        return new RspBuilder().setSuccessResult();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 构造错误响应JSONObject</span><br><span class="line">     * </span><br><span class="line">     * @param msg</span><br><span class="line">     *            错误描述信息</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static JSONObject formatFailResult(String msg) &#123;</span><br><span class="line">        return new RspBuilder().setErrorResult().appendMsg(msg).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 构造默认成功JSONObject</span><br><span class="line">     * </span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static JSONObject defaultSuccessResult() &#123;</span><br><span class="line">        return createSuccessRsp().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@Component</span><br><span class="line">public class SpringUtil implements ApplicationContextAware &#123;</span><br><span class="line">    private static ApplicationContext applicationContext = null;</span><br><span class="line"></span><br><span class="line">    public SpringUtil() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setApplicationContext(ApplicationContext arg0) throws BeansException &#123;</span><br><span class="line">        if (applicationContext == null) &#123;</span><br><span class="line">            applicationContext = arg0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ApplicationContext getApplicationContext() &#123;</span><br><span class="line">        return applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void setAppCtx(ApplicationContext webAppCtx) &#123;</span><br><span class="line">        if (webAppCtx != null) &#123;</span><br><span class="line">            applicationContext = webAppCtx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 拿到ApplicationContext对象实例后就可以手动获取Bean的注入实例对象</span><br><span class="line">     */</span><br><span class="line">    public static &lt;T&gt; T getBean(Class&lt;T&gt; clazz) &#123;</span><br><span class="line">        return getApplicationContext().getBean(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static &lt;T&gt; T getBean(String name, Class&lt;T&gt; clazz) throws ClassNotFoundException &#123;</span><br><span class="line">        return getApplicationContext().getBean(name, clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static final Object getBean(String beanName) &#123;</span><br><span class="line">        return getApplicationContext().getBean(beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static final Object getBean(String beanName, String className) throws ClassNotFoundException &#123;</span><br><span class="line">        Class clz = Class.forName(className);</span><br><span class="line">        return getApplicationContext().getBean(beanName, clz.getClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static boolean containsBean(String name) &#123;</span><br><span class="line">        return getApplicationContext().containsBean(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static boolean isSingleton(String name) throws NoSuchBeanDefinitionException &#123;</span><br><span class="line">        return getApplicationContext().isSingleton(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Class&lt;?&gt; getType(String name) throws NoSuchBeanDefinitionException &#123;</span><br><span class="line">        return getApplicationContext().getType(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static String[] getAliases(String name) throws NoSuchBeanDefinitionException &#123;</span><br><span class="line">        return getApplicationContext().getAliases(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="swagger配置及api接口测试"><a href="#swagger配置及api接口测试" class="headerlink" title="swagger配置及api接口测试"></a>swagger配置及api接口测试</h3><p>Swagger是什么？它能干什么？<br>Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。总体目标是使客户端和文件系统作为服务器以同样的速度来更新。文件的方法，参数和模型紧密集成到服务器端的代码，允许API来始终保持同步。</p>
<p>有上述介绍可以看出，swagger的主要用途是用来处理可视化的api服务以及提供规范的api文档</p>
<p>我们先来看下swagger的对应配置</p>
<h4 id="映入swagger2依赖jar包"><a href="#映入swagger2依赖jar包" class="headerlink" title="映入swagger2依赖jar包"></a>映入swagger2依赖jar包</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--swagger 文档注释--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.7.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.7.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="在config目录创建对应的swagger2配置文件Swagger2Config"><a href="#在config目录创建对应的swagger2配置文件Swagger2Config" class="headerlink" title="在config目录创建对应的swagger2配置文件Swagger2Config"></a>在config目录创建对应的swagger2配置文件Swagger2Config</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableSwagger2</span><br><span class="line">public class Swagger2Config &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建API应用</span><br><span class="line">     * apiInfo() 增加API相关信息</span><br><span class="line">     * 通过select()函数返回一个ApiSelectorBuilder实例,用来控制哪些接口暴露给Swagger来展现，</span><br><span class="line">     * 本例采用指定扫描的包路径来定义指定要建立API的目录。</span><br><span class="line">     * </span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public Docket createRestApi() &#123;</span><br><span class="line">        return new Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">  .apis(RequestHandlerSelectors.withClassAnnotation(RestController.class))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     /**</span><br><span class="line">     * 创建该API的基本信息（这些基本信息会展现在文档页面中）</span><br><span class="line">     * 访问地址：http://项目实际地址/swagger-ui.html</span><br><span class="line">     */</span><br><span class="line">    private ApiInfo apiInfo() &#123;</span><br><span class="line">        return new ApiInfoBuilder()</span><br><span class="line">                .title(&quot;环境平台接口 RESTful API&quot;)</span><br><span class="line">                .description(&quot;展示先做基础功能，后面再添加业务&quot;)</span><br><span class="line">                .termsOfServiceUrl(&quot;&quot;)</span><br><span class="line">                .version(&quot;1.0&quot;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用Swagger提供的注解"><a href="#使用Swagger提供的注解" class="headerlink" title="使用Swagger提供的注解"></a>使用Swagger提供的注解</h4><p>类名上的注解<br>@Api(value &#x3D; “环境平台监控api查询服务”)<br>方法名上的注解<br>@ApiOperation(value &#x3D; “查询环境平台首页”, notes &#x3D; “”)</p>
<h4 id="启动程序-访问-http-地址-端口-swagger-ui-html"><a href="#启动程序-访问-http-地址-端口-swagger-ui-html" class="headerlink" title="启动程序,访问 http:&#x2F;&#x2F;地址+端口&#x2F;swagger-ui.html"></a>启动程序,访问 http:&#x2F;&#x2F;地址+端口&#x2F;swagger-ui.html</h4><p><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286100239.png" alt="img"></p>
<p>尝试直接填写参数直接调用api接口验证接口有效性<br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286114419.png" alt="img"><br><img src="/./assets/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/image.1693286153713.png" alt="img"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">tong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/06/16/Hadoop/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/">http://example.com/2025/06/16/Hadoop/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">Blog</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/./img/touxiang.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/./img/WeChat_pay.jpg" target="_blank"><img class="post-qr-code-img" src="/./img/WeChat_pay.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/./img/Alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/./img/Alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/06/16/Hadoop/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%912/" title="Hadoop应用与开发2"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Hadoop应用与开发2</div></div><div class="info-2"><div class="info-item-1">Hadoop应用与开发221.Spark实验：SparkSQL入门实战 目的1.学习spark的入门编程 要求2.掌握spark基础操作和原理 原理Spark SQLSpark SQL 是 Spark 用来处理结构化数据的模块，通过 Spark SQL 我们可以像之前使用 SQL 语句分析关系型数据库表一样方便地在  Spark 上对海量结构化数据进行快速分析，我们只需要关注数据分析的逻辑而不需要担心底层分布式存储、计算、通信、以及作业解析和调度的细节。 Spark SQL 支持从 JSON 文件、CSV 文件、Hive 表、Parquest 文件中读取数据，通过 SQL  语句对数据进行交互式查询；也可以读取传统关系型数据库中的数据进行数据分析。同时还能与传统的 RDD 编程相结合，让我们能够同时使用 SQL 和  RDD 进行复杂的数据分析。 另外，它还能与其它核心组件比如： Spark Streaming、MLlib、GraphX 等联合使用进行数据分析，所以 Spark SQL...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/./img/touxiang.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">tong</div><div class="author-info-description">这里是描述</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">现在没有公告</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914"><span class="toc-number">1.</span> <span class="toc-text">Hadoop应用与开发4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#59-Hadoop%E5%AE%9E%E9%AA%8C%EF%BC%9AHDFS%E5%9F%BA%E7%A1%80%E4%B8%8E%E9%83%A8%E7%BD%B2"><span class="toc-number">1.1.</span> <span class="toc-text">59.Hadoop实验：HDFS基础与部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84"><span class="toc-number">1.1.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82"><span class="toc-number">1.1.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.3.</span> <span class="toc-text">原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Hadoop-%E7%94%9F%E6%80%81%EF%BC%9A"><span class="toc-number">1.2.</span> <span class="toc-text">3.1 Hadoop 生态：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-HDFS%E4%BC%98%E7%82%B9%EF%BC%9A"><span class="toc-number">1.3.</span> <span class="toc-text">3.2 HDFS优点：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%AE%BE%E7%BD%AE-Host-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.1.</span> <span class="toc-text">4.1 设置 Host 映射文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%AE%BE%E7%BD%AE%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95"><span class="toc-number">1.3.2.</span> <span class="toc-text">4.2 设置集群节点免密登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E8%AE%BE%E7%BD%AE%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83"><span class="toc-number">1.3.3.</span> <span class="toc-text">4.3 设置操作系统环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1%E8%AE%BE%E7%BD%AEJDK%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95"><span class="toc-number">1.3.4.</span> <span class="toc-text">4.3.1设置JDK安装目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2-%E9%85%8D%E7%BD%AEHDFS"><span class="toc-number">1.3.5.</span> <span class="toc-text">4.3.2 配置HDFS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-3-HDFS%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%85%B3%E9%94%AE%E5%B1%9E%E6%80%A7%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.3.6.</span> <span class="toc-text">4.3.3 HDFS配置文件关键属性介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-4-%E6%8B%B7%E8%B4%9D%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E8%87%B3%E5%85%B6%E5%AE%83%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.3.7.</span> <span class="toc-text">4.3.4 拷贝集群配置至其它服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%90%AF%E5%8A%A8Hadoop"><span class="toc-number">1.3.8.</span> <span class="toc-text">4.4 启动Hadoop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E9%80%9A%E8%BF%87%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%96%B9%E5%BC%8F%E9%AA%8C%E8%AF%81"><span class="toc-number">1.3.9.</span> <span class="toc-text">4.5 通过查看进程的方式验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-HDFS%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E6%A0%BC%E5%BC%8F%E5%A6%82%E4%B8%8B"><span class="toc-number">1.3.10.</span> <span class="toc-text">4.6 HDFS基本命令格式如下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#60-Hadoop%E5%AE%9E%E9%AA%8C%EF%BC%9AYARN%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E4%B8%8E%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.4.</span> <span class="toc-text">60.Hadoop实验：YARN集群部署与介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-1"><span class="toc-number">1.4.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-1"><span class="toc-number">1.4.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-1"><span class="toc-number">1.4.3.</span> <span class="toc-text">原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-MapReduce-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.5.</span> <span class="toc-text">3.1 MapReduce 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1%E7%AE%80%E4%BB%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">3.1.1简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2MapReduce%E5%88%86%E8%80%8C%E6%B2%BB%E4%B9%8B%E6%80%9D%E6%83%B3"><span class="toc-number">1.5.2.</span> <span class="toc-text">3.1.2MapReduce分而治之思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3MapReduce%E8%AE%A1%E7%AE%97%E6%A1%86%E6%9E%B6%C2%B7%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.5.3.</span> <span class="toc-text">3.1.3MapReduce计算框架·执行流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-4%E4%B8%A4%E4%B8%AA%E9%87%8D%E8%A6%81%E7%9A%84%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.5.4.</span> <span class="toc-text">3.1.4两个重要的进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-5MapReduce%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.5.5.</span> <span class="toc-text">3.1.5MapReduce配置文件属性介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-YARN%E6%A6%82%E8%BF%B0"><span class="toc-number">1.6.</span> <span class="toc-text">3.2 YARN概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-YARN%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">3.2.1 YARN运行流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-Yarn%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.6.2.</span> <span class="toc-text">3.2.2 Yarn配置文件属性介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%9C%A8master%E6%9C%BA%E4%B8%8A%E9%85%8D%E7%BD%AEYARN"><span class="toc-number">1.6.3.</span> <span class="toc-text">4.1 在master机上配置YARN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E7%BB%9F%E4%B8%80%E5%90%AF%E5%8A%A8YARN"><span class="toc-number">1.6.4.</span> <span class="toc-text">4.2 统一启动YARN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E9%AA%8C%E8%AF%81YARN%E5%90%AF%E5%8A%A8%E6%88%90%E5%8A%9F"><span class="toc-number">1.6.5.</span> <span class="toc-text">4.3 验证YARN启动成功</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%9C%A8master%E6%9C%BA%E4%B8%8A%E6%8F%90%E4%BA%A4DistributedShell%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.6.6.</span> <span class="toc-text">4.4 在master机上提交DistributedShell任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E5%9C%A8master%E6%9C%BA%E4%B8%8A%E6%8F%90%E4%BA%A4MapReduce%E5%9E%8B%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.6.7.</span> <span class="toc-text">4.5 在master机上提交MapReduce型任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-1-%E6%8C%87%E5%AE%9A%E5%9C%A8YARN%E4%B8%8A%E8%BF%90%E8%A1%8CMapReduce%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.6.8.</span> <span class="toc-text">4.5.1 指定在YARN上运行MapReduce任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-2-%E5%9C%A8master%E7%AB%AF%E6%8F%90%E4%BA%A4PI-Estimator%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.6.9.</span> <span class="toc-text">4.5.2 在master端提交PI Estimator任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#61-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E5%87%BA%E7%A7%9F%E8%BD%A6%E8%BF%90%E8%90%A5%E8%B0%83%E5%BA%A6%E7%AE%A1%E6%8E%A7%E5%B9%B3%E5%8F%B0-%E6%95%B0%E6%8D%AE%E4%B8%8A%E4%BC%A0%E5%88%B0KAFKA%E6%8E%A5%E5%8F%A3API"><span class="toc-number">1.7.</span> <span class="toc-text">61.项目实训-出租车运营调度管控平台-数据上传到KAFKA接口API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-2"><span class="toc-number">1.7.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-2"><span class="toc-number">1.7.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-2"><span class="toc-number">1.7.3.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Kafaka%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.7.3.0.1.</span> <span class="toc-text">Kafaka相关组件：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BF%AE%E6%94%B9springboot%E9%A1%B9%E7%9B%AE%E7%9A%84pom-xml%E6%96%87%E4%BB%B6%E6%B7%BB%E5%8A%A0%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96%EF%BC%8C%E6%B7%BB%E5%8A%A0kafka%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96"><span class="toc-number">1.7.4.</span> <span class="toc-text">1 修改springboot项目的pom.xml文件添加相关依赖，添加kafka相关依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AF%B9%E5%A4%96%E6%9A%B4%E9%9C%B2%E5%BC%82%E6%AD%A5%E4%B8%8A%E4%BC%A0%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6%E5%88%B0kafka%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.7.5.</span> <span class="toc-text">2  对外暴露异步上传数据文件到kafka接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B5%8B%E8%AF%95%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E6%95%B0%E6%8D%AE%E5%88%B0kafka%E4%B8%AD%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.7.6.</span> <span class="toc-text">3 测试上传文件数据到kafka中接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#62-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E5%87%BA%E7%A7%9F%E8%BD%A6%E8%BF%90%E8%90%A5%E8%B0%83%E5%BA%A6%E7%AE%A1%E6%8E%A7%E5%B9%B3%E5%8F%B0-SparkStreaming%E6%B6%88%E8%B4%B9Kafka%E4%B8%AD%E6%95%B0%E6%8D%AE"><span class="toc-number">1.8.</span> <span class="toc-text">62.项目实训-出租车运营调度管控平台-SparkStreaming消费Kafka中数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-3"><span class="toc-number">1.8.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-3"><span class="toc-number">1.8.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-3"><span class="toc-number">1.8.3.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E5%AF%B9%E5%A4%96%E6%9A%B4%E9%9C%B2%E5%BC%82%E6%AD%A5%E5%90%AF%E5%8A%A8SparkStreaming%E5%A4%84%E7%90%86Kafka%E6%B6%88%E6%81%AF%E6%8E%A5%E5%8F%A3%EF%BC%9A"><span class="toc-number">1.8.4.</span> <span class="toc-text">1对外暴露异步启动SparkStreaming处理Kafka消息接口：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SparkStreaming%E4%B8%BB%E8%A6%81%E5%A4%84%E7%90%86%E9%80%BB%E8%BE%91%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">1.8.4.0.1.</span> <span class="toc-text">SparkStreaming主要处理逻辑如下：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E5%88%9D%E5%A7%8B%E5%8C%96Redis%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.8.5.</span> <span class="toc-text">2初始化Redis客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%9B%E5%BB%BA%E5%8E%9F%E5%A7%8B%E8%A1%A8"><span class="toc-number">1.8.6.</span> <span class="toc-text">3连接数据库创建原始表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.8.7.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%AA%8C%E8%AF%81%E7%BB%93%E6%9E%9C"><span class="toc-number">1.8.8.</span> <span class="toc-text">4 验证结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#63-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E5%87%BA%E7%A7%9F%E8%BD%A6%E8%BF%90%E8%90%A5%E8%B0%83%E5%BA%A6%E7%AE%A1%E6%8E%A7%E5%B9%B3%E5%8F%B0-%E5%AF%B9%E5%A4%96%E6%8F%90%E4%BE%9B%E5%87%BA%E7%A7%9F%E8%BD%A6%E8%BD%A8%E8%BF%B9%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.9.</span> <span class="toc-text">63.项目实训-出租车运营调度管控平台-对外提供出租车轨迹查询接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-4"><span class="toc-number">1.9.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-4"><span class="toc-number">1.9.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-4"><span class="toc-number">1.9.3.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E6%96%B0%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">1.9.4.</span> <span class="toc-text">1新建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E6%96%B0%E5%BB%BAMapper%E7%94%A8%E4%BA%8E%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%A4%E4%BA%92"><span class="toc-number">1.9.5.</span> <span class="toc-text">2新建Mapper用于与数据库交互</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E6%9F%A5%E8%AF%A2%E4%B8%9A%E5%8A%A1%E5%B0%81%E8%A3%85"><span class="toc-number">1.9.6.</span> <span class="toc-text">3查询业务封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E6%8F%90%E4%BE%9BApi%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.9.7.</span> <span class="toc-text">4提供Api查询接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%A1%E6%81%AF"><span class="toc-number">1.9.8.</span> <span class="toc-text">5配置数据库信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E6%B5%8B%E8%AF%95Api%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.9.9.</span> <span class="toc-text">6测试Api接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#64-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E5%87%BA%E7%A7%9F%E8%BD%A6%E8%BF%90%E8%90%A5%E8%B0%83%E5%BA%A6%E7%AE%A1%E6%8E%A7%E5%B9%B3%E5%8F%B0-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%AF%B9%E6%8E%A5"><span class="toc-number">1.10.</span> <span class="toc-text">64.项目实训-出租车运营调度管控平台-前后端对接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-5"><span class="toc-number">1.10.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-5"><span class="toc-number">1.10.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-5"><span class="toc-number">1.10.3.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1springboot%E7%9A%84maven%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85"><span class="toc-number">1.10.4.</span> <span class="toc-text">1springboot的maven项目打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E4%BA%86%E8%A7%A3httpd"><span class="toc-number">1.10.5.</span> <span class="toc-text">2了解httpd</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#65-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E5%87%BA%E7%A7%9F%E8%BD%A6%E8%BF%90%E8%90%A5%E8%B0%83%E5%BA%A6%E7%AE%A1%E6%8E%A7%E5%B9%B3%E5%8F%B0-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%8F%8Aspringboot%E8%84%9A%E6%89%8B%E6%9E%B6%E6%90%AD%E5%BB%BA"><span class="toc-number">1.11.</span> <span class="toc-text">65.项目实训-出租车运营调度管控平台-环境搭建及springboot脚手架搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-6"><span class="toc-number">1.11.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-6"><span class="toc-number">1.11.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-6"><span class="toc-number">1.11.3.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Idea%E4%B8%ADMAVEN%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">1.11.4.</span> <span class="toc-text">1 Idea中MAVEN安装与配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BDMaven"><span class="toc-number">1.11.4.1.</span> <span class="toc-text">下载Maven</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.11.4.2.</span> <span class="toc-text">配置环境变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AEMaven%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93"><span class="toc-number">1.11.5.</span> <span class="toc-text">2 配置Maven本地仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEidea%E7%9A%84Maven%E7%8E%AF%E5%A2%83"><span class="toc-number">1.11.5.1.</span> <span class="toc-text">配置idea的Maven环境</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AEidea%E7%9A%84Scala%E7%8E%AF%E5%A2%83"><span class="toc-number">1.11.6.</span> <span class="toc-text">3 配置idea的Scala环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%85%8D%E7%BD%AE%E6%9C%AC%E6%9C%BA%E7%9A%84java%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.11.7.</span> <span class="toc-text">4 配置本机的java环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-redis%E5%AE%89%E8%A3%85"><span class="toc-number">1.11.8.</span> <span class="toc-text">5 redis安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-kafka%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc-number">1.11.9.</span> <span class="toc-text">6 kafka环境的搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-Spark%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc-number">1.11.10.</span> <span class="toc-text">7 Spark环境的搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-springboot%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">1.11.11.</span> <span class="toc-text">8 springboot项目搭建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#66-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E8%82%A1%E7%A5%A8%E8%A1%8C%E6%83%85%E5%AE%9E%E6%97%B6%E4%BB%BF%E7%9C%9F%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%8F%8A%E5%89%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.12.</span> <span class="toc-text">66.项目实训-股票行情实时仿真数据平台-需求分析及前置环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-7"><span class="toc-number">1.12.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-7"><span class="toc-number">1.12.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-7"><span class="toc-number">1.12.3.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BA%86%E8%A7%A3%E8%82%A1%E7%A5%A8%E6%A6%82%E5%BF%B5"><span class="toc-number">1.12.4.</span> <span class="toc-text">1 了解股票概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AEhive"><span class="toc-number">1.12.5.</span> <span class="toc-text">2 配置hive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E9%85%8D%E7%BD%AEredis"><span class="toc-number">1.12.6.</span> <span class="toc-text">3 步骤三：配置redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%85%8D%E7%BD%AEhttpd"><span class="toc-number">1.12.7.</span> <span class="toc-text">4 配置httpd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%85%8D%E7%BD%AETomcat"><span class="toc-number">1.12.8.</span> <span class="toc-text">5 配置Tomcat</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#67-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E8%82%A1%E7%A5%A8%E8%A1%8C%E6%83%85%E5%AE%9E%E6%97%B6%E4%BB%BF%E7%9C%9F%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0-%E6%90%AD%E5%BB%BA%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93"><span class="toc-number">1.13.</span> <span class="toc-text">67.项目实训-股票行情实时仿真数据平台-搭建数据仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-8"><span class="toc-number">1.13.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-8"><span class="toc-number">1.13.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-8"><span class="toc-number">1.13.3.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%90%AD%E5%BB%BAODS%E5%B1%82"><span class="toc-number">1.13.4.</span> <span class="toc-text">1 搭建ODS层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%90%AD%E5%BB%BADIM%E5%B1%82"><span class="toc-number">1.13.5.</span> <span class="toc-text">2 搭建DIM层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%90%AD%E5%BB%BADWD%E5%B1%82"><span class="toc-number">1.13.6.</span> <span class="toc-text">3 搭建DWD层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%90%AD%E5%BB%BADWS%E5%B1%82"><span class="toc-number">1.13.7.</span> <span class="toc-text">4 搭建DWS层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%90%AD%E5%BB%BAADS%E5%B1%82"><span class="toc-number">1.13.8.</span> <span class="toc-text">5 搭建ADS层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#68-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E8%82%A1%E7%A5%A8%E8%A1%8C%E6%83%85%E5%AE%9E%E6%97%B6%E4%BB%BF%E7%9C%9F%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0-%E4%BD%BF%E7%94%A8%E6%95%B0%E4%BB%93%E6%95%B0%E6%8D%AE%E6%90%AD%E5%BB%BA%E7%BC%93%E5%AD%98%E5%B1%82"><span class="toc-number">1.14.</span> <span class="toc-text">68.项目实训-股票行情实时仿真数据平台-使用数仓数据搭建缓存层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-9"><span class="toc-number">1.14.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-9"><span class="toc-number">1.14.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-9"><span class="toc-number">1.14.3.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.14.4.</span> <span class="toc-text">1 配置环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8IDEA%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.14.5.</span> <span class="toc-text">2 使用IDEA构建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8JDBC%E8%8E%B7%E5%8F%96%E6%95%B0%E4%BB%93%E6%95%B0%E6%8D%AE"><span class="toc-number">1.14.6.</span> <span class="toc-text">3 使用JDBC获取数仓数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8Jedis%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E8%87%B3redis"><span class="toc-number">1.14.7.</span> <span class="toc-text">4 使用Jedis存储数据至redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%89%A7%E8%A1%8Cjar%E5%8C%85"><span class="toc-number">1.14.8.</span> <span class="toc-text">5 执行jar包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#69-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E8%82%A1%E7%A5%A8%E8%A1%8C%E6%83%85%E5%AE%9E%E6%97%B6%E4%BB%BF%E7%9C%9F%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0-%E5%AE%9E%E6%97%B6%E6%8E%A8%E9%80%81%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="toc-number">1.15.</span> <span class="toc-text">69.项目实训-股票行情实时仿真数据平台-实时推送缓存数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-10"><span class="toc-number">1.15.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-10"><span class="toc-number">1.15.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-10"><span class="toc-number">1.15.3.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%90%AD%E5%BB%BAWeb%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.15.4.</span> <span class="toc-text">1 搭建Web项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BC%96%E5%86%99Servlet%EF%BC%8C%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.15.5.</span> <span class="toc-text">2 编写Servlet，提供服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%BC%96%E5%86%99WebSocket%E7%A8%8B%E5%BA%8F%EF%BC%8C%E5%AE%9E%E6%97%B6%E6%8E%A8%E9%80%81%E6%95%B0%E6%8D%AE"><span class="toc-number">1.15.6.</span> <span class="toc-text">3 编写WebSocket程序，实时推送数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%B7%A8%E5%9F%9F"><span class="toc-number">1.15.7.</span> <span class="toc-text">4 跨域</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#70-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E8%82%A1%E7%A5%A8%E8%A1%8C%E6%83%85%E5%AE%9E%E6%97%B6%E4%BB%BF%E7%9C%9F%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0-%E8%82%A1%E7%A5%A8%E7%9C%8B%E7%9B%98%E5%8A%A8%E6%80%81%E5%B1%95%E7%A4%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">1.16.</span> <span class="toc-text">70.项目实训-股票行情实时仿真数据平台-股票看盘动态展示数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-11"><span class="toc-number">1.16.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-11"><span class="toc-number">1.16.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-11"><span class="toc-number">1.16.3.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%83%A8%E7%BD%B2%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.16.4.</span> <span class="toc-text">1 部署后端项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%83%A8%E7%BD%B2%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.16.5.</span> <span class="toc-text">2 部署前端项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#71-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E7%8E%AF%E5%A2%83%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0-%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%80%EF%BC%89"><span class="toc-number">1.17.</span> <span class="toc-text">71.项目实训-环境监控平台-数据采集项目基础（一）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-12"><span class="toc-number">1.17.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-12"><span class="toc-number">1.17.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-12"><span class="toc-number">1.17.3.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E7%8C%AB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD%E6%9E%B6%E6%9E%84%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.17.3.1.</span> <span class="toc-text">环境猫项目实训架构描述</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%B8%80%EF%BC%9Amaven%E9%83%A8%E7%BD%B2"><span class="toc-number">1.18.</span> <span class="toc-text">实验任务一：maven部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9AMaven%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AE"><span class="toc-number">1.18.1.</span> <span class="toc-text">步骤一：Maven的安装及配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9AMaven-%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-number">1.18.2.</span> <span class="toc-text">步骤二：Maven 名词解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9Apom-xml%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.18.3.</span> <span class="toc-text">步骤三：pom.xml文件属性描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9A%E6%A0%B7%E4%BE%8B%E6%9E%84%E5%BB%BA"><span class="toc-number">1.18.4.</span> <span class="toc-text">步骤四：样例构建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%BA%8C%EF%BC%9A%E9%85%8D%E7%BD%AE%E5%90%84%E4%B8%AA%E7%BB%84%E4%BB%B6%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.19.</span> <span class="toc-text">实验任务二：配置各个组件环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.19.0.1.</span> <span class="toc-text">修改环境变量配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%8F%82%E6%95%B0"><span class="toc-number">1.19.0.2.</span> <span class="toc-text">添加环境变量参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%B9%B6%E7%94%9F%E6%95%88"><span class="toc-number">1.19.0.3.</span> <span class="toc-text">保存环境变量并生效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E6%9F%A5%E7%9C%8BJDK%E7%89%88%E6%9C%AC%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%98%AF%E5%90%A6%E7%94%9F%E6%95%88"><span class="toc-number">1.19.0.4.</span> <span class="toc-text">通过查看JDK版本验证环境变量是否生效</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linux%E5%BF%AB%E6%8D%B7%E5%8C%96%E8%BF%90%E7%BB%B4%E8%84%9A%E6%9C%AC"><span class="toc-number">1.19.1.</span> <span class="toc-text">linux快捷化运维脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%88%86%E5%8F%91%E6%96%87%E4%BB%B6%E8%84%9A%E6%9C%AC"><span class="toc-number">1.19.1.1.</span> <span class="toc-text">快速分发文件脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E5%A4%9A%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8jps%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81%E7%9B%91%E6%8E%A7"><span class="toc-number">1.19.1.2.</span> <span class="toc-text">集群多台服务器jps运行状态监控</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%99%E4%B8%89%E5%8F%B0%E6%9C%BA%E5%99%A8%E9%85%8D%E7%BD%AE%E5%9F%9F%E5%90%8D"><span class="toc-number">1.19.1.3.</span> <span class="toc-text">给三台机器配置域名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E4%B8%89%E4%B8%AA%E8%8A%82%E7%82%B9%E5%81%9ASSH%E5%85%8D%E5%AF%86"><span class="toc-number">1.19.1.4.</span> <span class="toc-text">对三个节点做SSH免密</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%B8%89%EF%BC%9Ahadoop%E6%90%AD%E5%BB%BA"><span class="toc-number">1.20.</span> <span class="toc-text">实验任务三：hadoop搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E8%A7%A3%E5%8E%8B%E7%BB%84%E4%BB%B6%E5%8E%8B%E7%BC%A9%E5%8C%85"><span class="toc-number">1.20.1.</span> <span class="toc-text">步骤一：解压组件压缩包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%8E%8B%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6%E5%88%B0-opt-module%E4%B8%8B%E9%9D%A2"><span class="toc-number">1.20.1.1.</span> <span class="toc-text">解压安装文件到&#x2F;opt&#x2F;module下面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E8%A7%A3%E5%8E%8B%E6%88%90%E5%8A%9F"><span class="toc-number">1.20.1.2.</span> <span class="toc-text">查看是否解压成功</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92"><span class="toc-number">1.20.2.</span> <span class="toc-text">步骤二：集群规划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E4%BF%AE%E6%94%B9%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.20.3.</span> <span class="toc-text">步骤三：修改核心配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9A%E4%BF%AE%E6%94%B9HDFS%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.20.4.</span> <span class="toc-text">步骤四：修改HDFS配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%94%EF%BC%9A%E4%BF%AE%E6%94%B9YARN%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.20.5.</span> <span class="toc-text">步骤五：修改YARN配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%85%AD%EF%BC%9A%E4%BF%AE%E6%94%B9MapReduce%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.20.6.</span> <span class="toc-text">步骤六：修改MapReduce配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%83%EF%BC%9A%E9%85%8D%E7%BD%AEworkers"><span class="toc-number">1.20.7.</span> <span class="toc-text">步骤七：配置workers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%85%AB%EF%BC%9A%E5%88%86%E5%8F%91%E9%85%8D%E7%BD%AE%E7%9A%84%E6%89%80%E6%9C%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%88%B0slave1%E8%8A%82%E7%82%B9%E5%92%8Cslave2%E8%8A%82%E7%82%B9"><span class="toc-number">1.20.8.</span> <span class="toc-text">步骤八：分发配置的所有配置文件到slave1节点和slave2节点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%90%84%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E6%96%87%E4%BB%B6%E5%88%86%E5%8F%91%E6%83%85%E5%86%B5"><span class="toc-number">1.20.8.1.</span> <span class="toc-text">检查各个节点的文件分发情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B9%9D%EF%BC%9A%E5%90%AF%E5%8A%A8%E9%9B%86%E7%BE%A4"><span class="toc-number">1.20.8.2.</span> <span class="toc-text">步骤九：启动集群</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E5%88%AB%E5%90%AF%E5%8A%A8-%E5%81%9C%E6%AD%A2HDFS%E7%BB%84%E4%BB%B6"><span class="toc-number">1.20.8.2.1.</span> <span class="toc-text">分别启动&#x2F;停止HDFS组件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8-%E5%81%9C%E6%AD%A2YARN"><span class="toc-number">1.20.8.2.2.</span> <span class="toc-text">启动&#x2F;停止YARN</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E5%90%AF%E5%8A%A8-%E5%81%9C%E6%AD%A2HDFS"><span class="toc-number">1.20.8.2.3.</span> <span class="toc-text">整体启动&#x2F;停止HDFS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E5%90%AF%E5%8A%A8-%E5%81%9C%E6%AD%A2YARN"><span class="toc-number">1.20.8.2.4.</span> <span class="toc-text">整体启动&#x2F;停止YARN</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A8%E9%83%A8%E5%90%AF%E5%8A%A8"><span class="toc-number">1.20.8.2.5.</span> <span class="toc-text">全部启动</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%90%84%E8%8A%82%E7%82%B9%E7%BB%84%E4%BB%B6%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8"><span class="toc-number">1.20.8.2.6.</span> <span class="toc-text">查看各节点组件运行状态是否正常</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E6%B5%8B%E8%AF%95"><span class="toc-number">1.20.8.3.</span> <span class="toc-text">集群测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E5%9B%9B%EF%BC%9AZookeeper%E6%90%AD%E5%BB%BA"><span class="toc-number">1.21.</span> <span class="toc-text">实验任务四：Zookeeper搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9AZookeeper%E8%A7%A3%E5%8E%8B"><span class="toc-number">1.21.1.</span> <span class="toc-text">步骤一：Zookeeper解压</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%8E%8B%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6%E5%88%B0-opt-module%E4%B8%8B%E9%9D%A2-1"><span class="toc-number">1.21.1.1.</span> <span class="toc-text">解压安装文件到&#x2F;opt&#x2F;module下面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E8%A7%A3%E5%8E%8B%E6%88%90%E5%8A%9F-1"><span class="toc-number">1.21.1.2.</span> <span class="toc-text">查看是否解压成功</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9AZookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">1.21.2.</span> <span class="toc-text">步骤二：Zookeeper分布式集群配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEzoo-cfg%E6%96%87%E4%BB%B6"><span class="toc-number">1.21.2.1.</span> <span class="toc-text">配置zoo.cfg文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9zoo-cfg%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E8%B7%AF%E5%BE%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.21.2.2.</span> <span class="toc-text">修改zoo.cfg文件中的数据存储路径配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%A6%82%E4%B8%8B%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%EF%BC%8C%E9%85%8D%E7%BD%AE%E6%A0%BC%E5%BC%8F%E4%B8%BAserver-A-B-C-D"><span class="toc-number">1.21.2.3.</span> <span class="toc-text">增加如下集群配置，配置格式为server.A&#x3D;B:C:D</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E8%B7%AF%E5%BE%84%E4%B8%8BdataDir%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%88%9B%E5%BB%BAmyid-%E5%B9%B6%E5%9C%A8myid%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%AF%B9%E5%BA%94server%E7%9A%84%E5%BA%8F%E5%8F%B7"><span class="toc-number">1.21.2.4.</span> <span class="toc-text">在数据存储路径下dataDir目录下创建myid,并在myid中添加对应server的序号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%B7%E8%B4%9D%E9%85%8D%E7%BD%AE%E5%A5%BD%E7%9A%84zookeeper%E7%9B%AE%E5%BD%95%E5%88%B0%E5%90%84%E4%B8%AA%E5%AD%90%E8%8A%82%E7%82%B9"><span class="toc-number">1.21.2.5.</span> <span class="toc-text">拷贝配置好的zookeeper目录到各个子节点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9AZookeeper%E9%9B%86%E7%BE%A4%E5%90%AF%E5%8A%A8"><span class="toc-number">1.21.3.</span> <span class="toc-text">步骤三：Zookeeper集群启动</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E5%88%AB%E4%BE%9D%E6%AC%A1%E5%88%B0%E5%90%84%E4%B8%AA%E8%8A%82%E7%82%B9master%EF%BC%8Cslave1%EF%BC%8Cslave2%E5%90%AF%E5%8A%A8zookeeper"><span class="toc-number">1.21.3.0.1.</span> <span class="toc-text">分别依次到各个节点master，slave1，slave2启动zookeeper</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%8A%B6%E6%80%81"><span class="toc-number">1.21.3.0.2.</span> <span class="toc-text">查看状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0linux%E9%9B%86%E7%BE%A4%E8%84%9A%E6%9C%AC"><span class="toc-number">1.21.3.0.3.</span> <span class="toc-text">增加linux集群脚本</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%84%9A%E6%9C%AC%E5%86%85%E5%AE%B9%EF%BC%8C%E4%B8%80%E6%AC%A1%E7%99%BB%E5%BD%95%E5%90%84%E4%B8%AA%E8%8A%82%E7%82%B9%E5%B9%B6%E6%89%A7%E8%A1%8Czookeeper%E7%9A%84%E6%9C%8D%E5%8A%A1zkServer-sh"><span class="toc-number">1.21.3.0.4.</span> <span class="toc-text">添加脚本内容，一次登录各个节点并执行zookeeper的服务zkServer.sh</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E8%84%9A%E6%9C%AC%E5%B9%B6%E6%8A%8A%E8%84%9A%E6%9C%AC%E5%8A%A0%E5%85%A5%E7%B3%BB%E7%BB%9F%E5%85%A8%E5%B1%80%E5%91%BD%E4%BB%A4"><span class="toc-number">1.21.3.0.5.</span> <span class="toc-text">保存脚本并把脚本加入系统全局命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E9%9B%86%E7%BE%A4%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC"><span class="toc-number">1.21.3.0.6.</span> <span class="toc-text">测试集群启动脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9A%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4"><span class="toc-number">1.21.4.</span> <span class="toc-text">步骤四：客户端命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E5%85%AB%EF%BC%9Amysql%E6%8E%A5%E5%85%A5"><span class="toc-number">1.22.</span> <span class="toc-text">实验任务八：mysql接入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E9%85%8D%E7%BD%AEmysql%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81"><span class="toc-number">1.22.1.</span> <span class="toc-text">步骤一：配置mysql账号密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9Amysql%E6%8E%88%E6%9D%83"><span class="toc-number">1.22.2.</span> <span class="toc-text">步骤二：mysql授权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E5%88%B7%E6%96%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">1.22.3.</span> <span class="toc-text">步骤三：刷新配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#72-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E7%8E%AF%E5%A2%83%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0-%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89"><span class="toc-number">1.23.</span> <span class="toc-text">72.项目实训-环境监控平台-数据采集项目基础（二）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-13"><span class="toc-number">1.23.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-13"><span class="toc-number">1.23.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-13"><span class="toc-number">1.23.3.</span> <span class="toc-text">原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E7%8C%AB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD%E6%9E%B6%E6%9E%84%E6%8F%8F%E8%BF%B0%EF%BC%9A"><span class="toc-number">1.24.</span> <span class="toc-text">环境猫项目实训架构描述：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%BA%94%EF%BC%9AKafka%E6%90%AD%E5%BB%BA"><span class="toc-number">1.25.</span> <span class="toc-text">实验任务五：Kafka搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E8%A7%A3%E5%8E%8B%E7%BB%84%E4%BB%B6%E5%8C%85"><span class="toc-number">1.25.1.</span> <span class="toc-text">步骤一：解压组件包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E5%88%9B%E5%BB%BA%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">1.25.2.</span> <span class="toc-text">步骤二：创建日志文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.25.3.</span> <span class="toc-text">步骤三：配置环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9A%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.25.4.</span> <span class="toc-text">步骤四：修改配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%94%EF%BC%9A%E5%88%86%E5%8F%91%E5%AE%89%E8%A3%85%E5%8C%85"><span class="toc-number">1.25.5.</span> <span class="toc-text">步骤五：分发安装包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%85%AD%EF%BC%9A%E5%90%AF%E5%8A%A8%E9%9B%86%E7%BE%A4"><span class="toc-number">1.25.6.</span> <span class="toc-text">步骤六：启动集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E5%85%AD%EF%BC%9AHbase%E6%90%AD%E5%BB%BA"><span class="toc-number">1.26.</span> <span class="toc-text">实验任务六：Hbase搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E5%89%8D%E7%BD%AE%E8%A6%81%E6%B1%82"><span class="toc-number">1.26.1.</span> <span class="toc-text">步骤一：前置要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E8%A7%A3%E5%8E%8B%E7%BB%84%E4%BB%B6%E5%8C%85"><span class="toc-number">1.26.2.</span> <span class="toc-text">步骤二：解压组件包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E5%88%9B%E5%BB%BA%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%A4%B9-1"><span class="toc-number">1.26.3.</span> <span class="toc-text">步骤二：创建日志文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-1"><span class="toc-number">1.26.4.</span> <span class="toc-text">步骤三：配置环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9A%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-1"><span class="toc-number">1.26.5.</span> <span class="toc-text">步骤四：修改配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%94%EF%BC%9A%E5%88%86%E5%8F%91%E5%AE%89%E8%A3%85%E5%8C%85-1"><span class="toc-number">1.26.6.</span> <span class="toc-text">步骤五：分发安装包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%85%AD%EF%BC%9A%E5%90%AF%E5%8A%A8%E9%9B%86%E7%BE%A4-1"><span class="toc-number">1.26.7.</span> <span class="toc-text">步骤六：启动集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%B8%83%EF%BC%9APhoenix%E9%9B%86%E6%88%90"><span class="toc-number">1.27.</span> <span class="toc-text">实验任务七：Phoenix集成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E8%A7%A3%E5%8E%8BPhoenix%E5%AE%89%E8%A3%85%E5%8C%85"><span class="toc-number">1.27.1.</span> <span class="toc-text">步骤一：解压Phoenix安装包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E5%A4%8D%E5%88%B6%E4%BE%9D%E8%B5%96%E5%8C%85%E5%B9%B6%E6%8B%B7%E8%B4%9D%E5%88%B0-hbase-lib"><span class="toc-number">1.27.2.</span> <span class="toc-text">步骤二：复制依赖包并拷贝到 hbase&#x2F;lib</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-2"><span class="toc-number">1.27.3.</span> <span class="toc-text">步骤三：配置环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9A%E9%87%8D%E5%90%AFHbase%E5%90%8E%E5%86%8D%E5%90%AF%E5%8A%A8Phoenix"><span class="toc-number">1.27.4.</span> <span class="toc-text">步骤四：重启Hbase后再启动Phoenix</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#73-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E7%8E%AF%E5%A2%83%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0-%E7%8E%AF%E5%A2%83%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86"><span class="toc-number">1.28.</span> <span class="toc-text">73.项目实训-环境监控平台-环境数据采集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-14"><span class="toc-number">1.28.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-14"><span class="toc-number">1.28.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-14"><span class="toc-number">1.28.3.</span> <span class="toc-text">原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Netty%E7%AE%80%E4%BB%8B"><span class="toc-number">1.29.</span> <span class="toc-text">Netty简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E7%BB%93%E6%9E%84"><span class="toc-number">1.30.</span> <span class="toc-text">总体结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%B8%80%EF%BC%9ANetty%E6%A1%86%E6%9E%B6%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">1.31.</span> <span class="toc-text">实验任务一：Netty框架项目搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E4%B8%8B%E8%BD%BD%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E5%8C%85"><span class="toc-number">1.31.1.</span> <span class="toc-text">步骤一：下载项目代码包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E9%85%8D%E7%BD%AEidea%E6%96%B0%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE"><span class="toc-number">1.31.2.</span> <span class="toc-text">步骤二：配置idea新项目配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEmaven%E6%9C%AC%E5%9C%B0%E8%B5%84%E6%BA%90%E5%BA%93"><span class="toc-number">1.31.2.1.</span> <span class="toc-text">配置maven本地资源库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEmaven%E7%9A%84%E7%9A%84%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE"><span class="toc-number">1.31.2.2.</span> <span class="toc-text">配置maven的的资源配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEidea%E5%AF%B9%E5%BA%94SDK"><span class="toc-number">1.31.2.3.</span> <span class="toc-text">配置idea对应SDK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81"><span class="toc-number">1.31.2.4.</span> <span class="toc-text">引入项目代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84"><span class="toc-number">1.31.2.5.</span> <span class="toc-text">代码结构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%BA%8C%EF%BC%9AKafka%E5%AF%B9%E6%8E%A5%E6%A8%A1%E5%9D%97"><span class="toc-number">1.32.</span> <span class="toc-text">实验任务二：Kafka对接模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E5%89%8D%E7%BD%AE%E9%85%8D%E7%BD%AE"><span class="toc-number">1.32.1.</span> <span class="toc-text">步骤一：前置配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9AKafka%E5%AF%B9%E6%8E%A5%E2%80%94%E2%80%94%E9%98%9F%E5%88%97%E5%88%9B%E5%BB%BA"><span class="toc-number">1.32.2.</span> <span class="toc-text">步骤二：Kafka对接——队列创建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E6%B7%BB%E5%8A%A0%E5%88%9B%E5%BB%BA%E9%98%9F%E5%88%97%E6%96%B9%E6%B3%95%E3%80%91"><span class="toc-number">1.32.2.1.</span> <span class="toc-text">【添加创建队列方法】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E6%B7%BB%E5%8A%A0%E6%9F%A5%E8%AF%A2%E8%AF%9D%E9%A2%98%E6%96%B9%E6%B3%95%E3%80%91"><span class="toc-number">1.32.2.2.</span> <span class="toc-text">【添加查询话题方法】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9AKafka%E5%AF%B9%E6%8E%A5%E2%80%94%E2%80%94%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81"><span class="toc-number">1.32.3.</span> <span class="toc-text">步骤三：Kafka对接——消息推送</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E6%8E%A8%E9%80%81%E8%AF%9D%E9%A2%98%E6%95%B0%E6%8D%AE%E3%80%91"><span class="toc-number">1.32.3.1.</span> <span class="toc-text">【推送话题数据】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E6%8E%A8%E9%80%81%E9%98%9F%E5%88%97%E7%9A%84%E5%8C%85%E8%A3%85%E6%96%B9%E6%B3%95%E3%80%91"><span class="toc-number">1.32.3.2.</span> <span class="toc-text">【推送队列的包装方法】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9AKafka%E5%AF%B9%E6%8E%A5%E2%80%94%E2%80%94%E6%8E%A8%E9%80%81%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95%E9%AA%8C%E8%AF%81"><span class="toc-number">1.32.4.</span> <span class="toc-text">步骤四：Kafka对接——推送及相关方法验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAmain%E5%85%A5%E5%8F%A3%E6%96%B9%E6%B3%95%E9%AA%8C%E8%AF%81%E9%98%9F%E5%88%97%E6%96%B9%E6%B3%95%E7%BC%96%E5%86%99%E6%98%AF%E5%90%A6%E5%87%86%E7%A1%AE"><span class="toc-number">1.32.4.1.</span> <span class="toc-text">创建main入口方法验证队列方法编写是否准确</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8topic%E7%B1%BB%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%85%A5%E5%8F%A3%E7%B1%BB%E5%B9%B6%E6%89%A7%E8%A1%8Crun-main-%E6%96%B9%E6%B3%95%E3%80%82"><span class="toc-number">1.32.4.2.</span> <span class="toc-text">在topic类中添加入口类并执行run.main()方法。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%94%EF%BC%9A%E6%9F%A5%E7%9C%8B%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E5%B7%B2%E5%9C%A8%E9%9B%86%E7%BE%A4%E9%9B%86%E7%BE%A4%E4%B8%AD"><span class="toc-number">1.32.5.</span> <span class="toc-text">步骤五：查看测试数据是否已在集群集群中</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%B8%89%EF%BC%9ANetty%E6%9E%84%E5%BB%BA%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E6%A1%A5"><span class="toc-number">1.33.</span> <span class="toc-text">实验任务三：Netty构建数据通信桥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E8%AE%BE%E7%BD%AENetty%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.33.1.</span> <span class="toc-text">步骤一：设置Netty服务端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E6%9E%84%E5%BB%BANetty%E6%9C%8D%E5%8A%A1TcpServer"><span class="toc-number">1.33.2.</span> <span class="toc-text">步骤二：构建Netty服务TcpServer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E6%96%B0%E5%A2%9E%E8%BF%9B%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%88%9B%E5%BB%BANetty%E6%9C%8D%E5%8A%A1%E7%AB%AF%E3%80%91"><span class="toc-number">1.33.2.1.</span> <span class="toc-text">【新增进程服务创建Netty服务端】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E5%A2%9E%E5%8A%A0%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%B0%83%E7%94%A8Kafka%E9%98%9F%E5%88%97%E6%8E%A8%E9%80%81%E5%8A%A8%E4%BD%9C"><span class="toc-number">1.33.3.</span> <span class="toc-text">步骤三：增加服务端调用Kafka队列推送动作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E5%AE%A2%E6%88%B7%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95%E3%80%91"><span class="toc-number">1.33.3.1.</span> <span class="toc-text">【客户请求处理方法】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9A%E6%9E%84%E5%BB%BANetty%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.33.4.</span> <span class="toc-text">步骤四：构建Netty客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E3%80%91"><span class="toc-number">1.33.4.1.</span> <span class="toc-text">【客户端&#x2F;服务端】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%94%EF%BC%9A%E5%BC%80%E5%90%AF%E5%8D%95%E7%8B%AC%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8Netty%E7%9A%84TcpServer%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.33.5.</span> <span class="toc-text">步骤五：开启单独的进程启动Netty的TcpServer服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%85%AD%EF%BC%9A%E5%88%9B%E5%BB%BAAPI%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8%E5%85%A5%E5%8F%A3%E7%B1%BB"><span class="toc-number">1.33.6.</span> <span class="toc-text">步骤六：创建API服务调用入口类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E6%95%B0%E6%8D%AE%E6%8E%A8%E9%80%81%E6%96%B9%E6%B3%95%E3%80%91"><span class="toc-number">1.33.6.1.</span> <span class="toc-text">【数据推送方法】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%83%EF%BC%9A%E6%B5%8B%E8%AF%95netty%E6%9C%8D%E5%8A%A1%E5%8F%8A%E6%8E%A8%E9%80%81%E9%98%9F%E5%88%97%E8%BF%87%E7%A8%8B"><span class="toc-number">1.33.7.</span> <span class="toc-text">步骤七：测试netty服务及推送队列过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%85%AB%EF%BC%9A%E5%BC%80%E5%90%AF%E5%90%8E%E5%8F%B0%E9%98%9F%E5%88%97%E7%9B%91%E6%8E%A7%E6%A3%80%E6%9F%A5%E6%95%B0%E6%8D%AE%E6%8E%A8%E9%80%81%E6%B6%88%E6%81%AF%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8"><span class="toc-number">1.33.8.</span> <span class="toc-text">步骤八：开启后台队列监控检查数据推送消息是否正常</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#74-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E7%8E%AF%E5%A2%83%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0-%E7%8E%AF%E5%A2%83%E9%98%9F%E5%88%97%E6%95%B0%E6%8D%AE%E4%B8%9A%E5%8A%A1%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%8F%8A%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.34.</span> <span class="toc-text">74.项目实训-环境监控平台-环境队列数据业务格式化及持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-15"><span class="toc-number">1.34.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-15"><span class="toc-number">1.34.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-15"><span class="toc-number">1.34.3.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%AE%8B%E7%BC%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">1.34.3.1.</span> <span class="toc-text">1.残缺数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%94%99%E8%AF%AF%E6%95%B0%E6%8D%AE"><span class="toc-number">1.34.3.2.</span> <span class="toc-text">2.错误数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE"><span class="toc-number">1.34.3.3.</span> <span class="toc-text">3.重复数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%B8%80%EF%BC%9A%E5%88%9D%E5%A7%8B%E5%8C%96%E6%9E%84%E5%BB%BAKafka%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.35.</span> <span class="toc-text">实验任务一：初始化构建Kafka数据清洗项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E4%B8%8B%E8%BD%BD%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E5%8C%85-1"><span class="toc-number">1.35.1.</span> <span class="toc-text">步骤一：下载项目代码包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E9%85%8D%E7%BD%AEidea%E6%96%B0%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE-1"><span class="toc-number">1.35.2.</span> <span class="toc-text">步骤二：配置idea新项目配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEmaven%E6%9C%AC%E5%9C%B0%E8%B5%84%E6%BA%90%E5%BA%93-1"><span class="toc-number">1.35.2.1.</span> <span class="toc-text">配置maven本地资源库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEmaven%E7%9A%84%E7%9A%84%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE-1"><span class="toc-number">1.35.2.2.</span> <span class="toc-text">配置maven的的资源配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEidea%E5%AF%B9%E5%BA%94SDK-1"><span class="toc-number">1.35.2.3.</span> <span class="toc-text">配置idea对应SDK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.35.2.4.</span> <span class="toc-text">引入项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84-1"><span class="toc-number">1.35.2.5.</span> <span class="toc-text">代码结构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%BA%8C%EF%BC%9A%E9%98%9F%E5%88%97%E6%95%B0%E6%8D%AE%E4%B8%9A%E5%8A%A1%E7%AE%97%E6%B3%95%E6%B8%85%E6%B4%97"><span class="toc-number">1.36.</span> <span class="toc-text">实验任务二：队列数据业务算法清洗</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E5%88%9B%E5%BB%BA%E9%98%9F%E5%88%97%E8%AF%BB%E5%8F%96%E6%96%B9%E6%B3%95%E7%B1%BB"><span class="toc-number">1.36.1.</span> <span class="toc-text">步骤一：创建队列读取方法类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E9%9B%86%E7%BE%A4%E9%98%9F%E5%88%97%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E5%AE%A2%E6%88%B7%E7%AB%AF%E3%80%91"><span class="toc-number">1.36.1.1.</span> <span class="toc-text">【集群队列消息消费客户端】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%8A%A8%E4%BD%9C"><span class="toc-number">1.36.2.</span> <span class="toc-text">步骤二：数据清洗动作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E6%96%B9%E6%B3%95%E3%80%91"><span class="toc-number">1.36.2.1.</span> <span class="toc-text">【数据清洗方法】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E8%AE%A1%E7%AE%97%E5%85%AC%E5%BC%8F%E6%96%B9%E6%B3%95%E3%80%91"><span class="toc-number">1.36.2.2.</span> <span class="toc-text">【计算公式方法】</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%B8%89%EF%BC%9Aphoenix%E6%8F%92%E4%BB%B6%E9%9B%86%E6%88%90%E5%8F%8AHbase%E6%8E%A5%E5%85%A5"><span class="toc-number">1.37.</span> <span class="toc-text">实验任务三：phoenix插件集成及Hbase接入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E5%90%AF%E5%8A%A8hbase%E5%8F%8Aphoenix%E6%8F%92%E4%BB%B6"><span class="toc-number">1.37.1.</span> <span class="toc-text">步骤一：启动hbase及phoenix插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9APhoenix-Shell%E6%93%8D%E4%BD%9C"><span class="toc-number">1.37.2.</span> <span class="toc-text">步骤二：Phoenix Shell操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9AHbase%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E6%8E%A5%E5%85%A5"><span class="toc-number">1.37.3.</span> <span class="toc-text">步骤三：Hbase项目代码接入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E5%9B%9B%EF%BC%9A%E7%8E%AF%E5%A2%83%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%85%A5mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.38.</span> <span class="toc-text">实验任务四：环境数据接入mysql数据库持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9Amysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%8A%E8%A1%A8%E5%87%86%E5%A4%87"><span class="toc-number">1.38.1.</span> <span class="toc-text">步骤一：mysql数据库及表准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E7%BC%96%E5%86%99%E9%A1%B9%E7%9B%AE%E8%B0%83%E7%94%A8mysql%E6%96%B0%E5%A2%9E%E7%8E%AF%E5%A2%83%E6%95%B0%E6%8D%AE%E6%96%B9%E6%B3%95"><span class="toc-number">1.38.2.</span> <span class="toc-text">步骤二：编写项目调用mysql新增环境数据方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E8%AE%BE%E5%A4%87%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0%E6%96%B9%E6%B3%95%E3%80%91"><span class="toc-number">1.38.2.1.</span> <span class="toc-text">【设备数据更新方法】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8%E3%80%91"><span class="toc-number">1.38.2.2.</span> <span class="toc-text">【数据更新服务调用】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E7%BC%96%E5%86%99%E5%89%8D%E7%AB%AF%E8%B0%83%E7%94%A8api"><span class="toc-number">1.38.3.</span> <span class="toc-text">步骤三：编写前端调用api</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E9%98%9F%E5%88%97%E8%AF%BB%E5%8F%96API%E3%80%91"><span class="toc-number">1.38.3.1.</span> <span class="toc-text">【队列读取API】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9A%E6%B5%8B%E8%AF%95%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%8F%8A%E5%85%A5%E5%BA%93%E6%83%85%E5%86%B5"><span class="toc-number">1.38.4.</span> <span class="toc-text">步骤四：测试验证数据清洗及入库情况</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#75-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E7%8E%AF%E5%A2%83%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0-%E7%8E%AF%E5%A2%83%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E6%9C%8D%E5%8A%A1%E6%9E%84%E5%BB%BA"><span class="toc-number">1.39.</span> <span class="toc-text">75.项目实训-环境监控平台-环境前端页面服务构建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-16"><span class="toc-number">1.39.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-16"><span class="toc-number">1.39.2.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-16"><span class="toc-number">1.39.3.</span> <span class="toc-text">原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84"><span class="toc-number">1.40.</span> <span class="toc-text">项目整体结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Swagger%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E5%AE%83%E8%83%BD%E5%B9%B2%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.41.</span> <span class="toc-text">Swagger是什么？它能干什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebSocket"><span class="toc-number">1.42.</span> <span class="toc-text">WebSocket</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E9%9C%87%E7%8E%AF%E5%A2%83%E7%8C%AB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD%E5%89%8D%E7%AB%AF%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2"><span class="toc-number">1.43.</span> <span class="toc-text">地震环境猫项目实训前端可视化界面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%B8%80%EF%BC%9A%E5%8F%AF%E8%A7%86%E5%8C%96API%E6%8E%A5%E5%8F%A3%E8%A7%84%E5%88%92%E5%8F%8A%E5%AE%9A%E4%B9%89"><span class="toc-number">1.44.</span> <span class="toc-text">实验任务一：可视化API接口规划及定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E9%A1%B5%E9%9D%A2%E6%89%80%E9%9C%80%E6%95%B0%E6%8D%AE%E6%94%AF%E6%92%91"><span class="toc-number">1.44.1.</span> <span class="toc-text">步骤一：页面所需数据支撑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E6%8E%A5%E5%8F%A3%E8%A7%84%E5%88%92"><span class="toc-number">1.44.2.</span> <span class="toc-text">步骤二：接口规划</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%BA%8C%EF%BC%9A%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.45.</span> <span class="toc-text">实验任务二：数据接口实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A-index%E9%A6%96%E9%A1%B5%E9%9D%99%E6%80%81%E6%95%B0%E6%8D%AE%E6%98%BE%E7%A4%BA"><span class="toc-number">1.45.1.</span> <span class="toc-text">步骤一：&#x2F;index首页静态数据显示</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E6%8E%A5%E5%B1%82"><span class="toc-number">1.45.1.1.</span> <span class="toc-text">Mapper数据库对接层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E8%B0%83%E7%94%A8%E5%B1%82"><span class="toc-number">1.45.1.2.</span> <span class="toc-text">Service调用层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Api%E8%B0%83%E7%94%A8%E5%B1%82"><span class="toc-number">1.45.1.3.</span> <span class="toc-text">Api调用层</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A-getDeviceCompleteness-%E8%AE%BE%E5%A4%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9C%A8%E7%BA%BF%E7%8E%87"><span class="toc-number">1.45.2.</span> <span class="toc-text">步骤二：&#x2F;getDeviceCompleteness 设备&#x2F;数据库在线率</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90Mapper%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E6%8E%A5%E5%B1%82%E3%80%91"><span class="toc-number">1.45.2.1.</span> <span class="toc-text">【Mapper数据库对接层】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90Service%E8%B0%83%E7%94%A8%E5%B1%82%E3%80%91"><span class="toc-number">1.45.2.2.</span> <span class="toc-text">【Service调用层】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90Api%E5%B1%82%E3%80%91"><span class="toc-number">1.45.2.3.</span> <span class="toc-text">【Api层】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A-devices-%E6%9F%A5%E8%AF%A2%E8%AE%BE%E5%A4%87%E5%88%97%E8%A1%A8%E4%BF%A1%E6%81%AF%E5%8F%8A-device-%E6%9F%A5%E8%AF%A2%E5%8D%95%E5%8F%B0%E8%AE%BE%E5%A4%87%E8%AF%A6%E6%83%85"><span class="toc-number">1.45.3.</span> <span class="toc-text">步骤三：&#x2F;devices 查询设备列表信息及 &#x2F;device 查询单台设备详情</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90Api%E5%B1%82%E3%80%91-1"><span class="toc-number">1.45.3.1.</span> <span class="toc-text">【Api层】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9A-websockt-environment-devices-%E8%AE%BE%E5%A4%87%E5%9C%A8%E7%8E%AF%E5%A2%83%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.45.4.</span> <span class="toc-text">步骤四：&#x2F;websockt_environment&#x2F;devices&#x2F;  设备在环境数据实时查询接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90Mapper%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E6%8E%A5%E5%B1%82%E3%80%91-1"><span class="toc-number">1.45.4.1.</span> <span class="toc-text">【Mapper数据库对接层】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service%E8%B0%83%E7%94%A8%E5%B1%82-1"><span class="toc-number">1.45.4.2.</span> <span class="toc-text">Service调用层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90Api%E5%B1%82%E3%80%91-2"><span class="toc-number">1.45.4.3.</span> <span class="toc-text">【Api层】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%94%EF%BC%9A-websockt-environment-index-%E9%A6%96%E9%A1%B5%E8%83%8C%E6%9D%BF%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"><span class="toc-number">1.45.5.</span> <span class="toc-text">步骤五：&#x2F;websockt_environment&#x2F;index 首页背板实时数据获取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90Api%E5%B1%82%E3%80%91-3"><span class="toc-number">1.45.5.1.</span> <span class="toc-text">【Api层】</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%BB%E5%8A%A1%E4%B8%89%EF%BC%9A%E5%AE%8C%E6%95%B4%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%8F%8A%E6%9C%8D%E5%8A%A1%E7%AB%AFapi%E5%85%B3%E8%81%94"><span class="toc-number">1.46.</span> <span class="toc-text">实验任务三：完整前端项目部署及服务端api关联</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E6%B5%8B%E8%AF%95%E6%9C%8D%E5%8A%A1%E8%AF%B7%E6%B1%82%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8"><span class="toc-number">1.46.1.</span> <span class="toc-text">步骤一：测试服务请求是否正常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E7%94%9F%E6%88%90%E6%9C%8D%E5%8A%A1jar%E5%B9%B6%E9%83%A8%E7%BD%B2%E9%9B%86%E7%BE%A4%E4%B8%AD"><span class="toc-number">1.46.2.</span> <span class="toc-text">步骤二：生成服务jar并部署集群中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%89%8D%E7%AB%AF%E5%8C%85%E5%B9%B6%E8%B0%83%E7%94%A8envView%E9%A1%B9%E7%9B%AE%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%B1%95%E7%A4%BA"><span class="toc-number">1.46.3.</span> <span class="toc-text">步骤三：配置服务前端包并调用envView项目进行数据展示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#76-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%AE%AD-%E7%8E%AF%E5%A2%83%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0-SpringBoot%E6%90%AD%E5%BB%BA%E6%8A%80%E6%9C%AF%E7%82%B9%E8%A7%A3%E6%9E%90"><span class="toc-number">1.47.</span> <span class="toc-text">76.项目实训-环境监控平台-SpringBoot搭建技术点解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-17"><span class="toc-number">1.47.1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84"><span class="toc-number">1.47.2.</span> <span class="toc-text">实验目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-17"><span class="toc-number">1.47.3.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">1.47.4.</span> <span class="toc-text">实验知识点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-17"><span class="toc-number">1.47.5.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E4%BB%AC%E6%9D%A5%E9%87%8D%E6%96%B0%E5%9B%9E%E9%A1%BE%E4%B8%8B%E6%88%91%E4%BB%AC%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.47.6.</span> <span class="toc-text">我们来重新回顾下我们的项目结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MVC%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.47.7.</span> <span class="toc-text">MVC模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84"><span class="toc-number">1.47.8.</span> <span class="toc-text">三层架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8-MVC"><span class="toc-number">1.47.9.</span> <span class="toc-text">为什么要使用 MVC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebSocket-1"><span class="toc-number">1.47.10.</span> <span class="toc-text">WebSocket</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebSocket-%E6%9C%BA%E5%88%B6"><span class="toc-number">1.47.11.</span> <span class="toc-text">WebSocket 机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E5%AF%BC%E5%85%A5%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%89%80%E6%9C%89%E4%BE%9D%E8%B5%96"><span class="toc-number">1.47.11.1.</span> <span class="toc-text">接下来我们需要导入项目的所有依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E6%88%91%E4%BB%AC%E6%8C%89%E7%85%A7%E6%88%AA%E5%9B%BE%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C%E6%9D%A5%E5%85%88%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%A9%BA%E6%9E%B6%E5%AD%90%E5%87%BA%E6%9D%A5"><span class="toc-number">1.47.11.2.</span> <span class="toc-text">然后我们按照截图的内容，来先搭建一个空架子出来</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84-2"><span class="toc-number">1.47.11.3.</span> <span class="toc-text">代码结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95"><span class="toc-number">1.47.11.4.</span> <span class="toc-text">资源目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A7%E6%8E%A5%E7%9D%80%E6%9D%A5%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.47.11.5.</span> <span class="toc-text">紧接着来进行数据库连接池的配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.47.12.</span> <span class="toc-text">数据库表结构设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mapper%E5%8F%8A%E5%AF%B9%E5%BA%94Model%E5%AE%9E%E4%BD%93"><span class="toc-number">1.47.13.</span> <span class="toc-text">Mapper及对应Model实体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93bean%E5%AE%9A%E4%B9%89"><span class="toc-number">1.47.13.1.</span> <span class="toc-text">实体bean定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mapper%E5%86%99%E6%B3%95"><span class="toc-number">1.47.13.2.</span> <span class="toc-text">mapper写法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%B1%82Service"><span class="toc-number">1.47.14.</span> <span class="toc-text">业务层Service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%A4%96API%E6%8E%A5%E5%8F%A3%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.47.15.</span> <span class="toc-text">对外API接口服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E8%BF%B0%E6%89%80%E7%94%A8%E5%88%B0%E7%9A%84%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">1.47.16.</span> <span class="toc-text">上述所用到的相关工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#swagger%E9%85%8D%E7%BD%AE%E5%8F%8Aapi%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95"><span class="toc-number">1.47.17.</span> <span class="toc-text">swagger配置及api接口测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%A0%E5%85%A5swagger2%E4%BE%9D%E8%B5%96jar%E5%8C%85"><span class="toc-number">1.47.17.1.</span> <span class="toc-text">映入swagger2依赖jar包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8config%E7%9B%AE%E5%BD%95%E5%88%9B%E5%BB%BA%E5%AF%B9%E5%BA%94%E7%9A%84swagger2%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6Swagger2Config"><span class="toc-number">1.47.17.2.</span> <span class="toc-text">在config目录创建对应的swagger2配置文件Swagger2Config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Swagger%E6%8F%90%E4%BE%9B%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.47.17.3.</span> <span class="toc-text">使用Swagger提供的注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F-%E8%AE%BF%E9%97%AE-http-%E5%9C%B0%E5%9D%80-%E7%AB%AF%E5%8F%A3-swagger-ui-html"><span class="toc-number">1.47.17.4.</span> <span class="toc-text">启动程序,访问 http:&#x2F;&#x2F;地址+端口&#x2F;swagger-ui.html</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/16/Hadoop/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%913/" title="Hadoop应用与开发3">Hadoop应用与开发3</a><time datetime="2025-06-16T04:00:00.000Z" title="发表于 2025-06-16 12:00:00">2025-06-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/16/Hadoop/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%912/" title="Hadoop应用与开发2">Hadoop应用与开发2</a><time datetime="2025-06-16T04:00:00.000Z" title="发表于 2025-06-16 12:00:00">2025-06-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/16/Hadoop/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%914/" title="Hadoop应用与开发4">Hadoop应用与开发4</a><time datetime="2025-06-16T04:00:00.000Z" title="发表于 2025-06-16 12:00:00">2025-06-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/13/Hadoop/Hadoop%E5%BA%94%E7%94%A8%E4%B8%8E%E5%BC%80%E5%8F%91/" title="Hadoop应用与开发1">Hadoop应用与开发1</a><time datetime="2025-06-13T04:00:00.000Z" title="发表于 2025-06-13 12:00:00">2025-06-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/12/Java/mooc%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E2%80%94%E2%80%94Java/" title="mooc面向对象程序设计——Java">mooc面向对象程序设计——Java</a><time datetime="2025-03-12T10:22:00.000Z" title="发表于 2025-03-12 18:22:00">2025-03-12</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient(20deg, #ffd6e0, #f5f5f5, #c1f0c1);"><div id="footer-wrap"><div class="copyright">&copy;2025 By tong</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>